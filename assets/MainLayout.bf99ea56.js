import{P as S}from"./LocalStorage.1844a26b.js";import{u as q}from"./use-quasar.bae2301b.js";import{api as T}from"./axios.a22f84a8.js";import{n as O}from"./myFuncts.3679a5e3.js";import{u as N,i as _,r as s,p as d,k as P,o as U,l as R,m as L,n as B,q as a,f as o,Q as I,t as $,v as M,x as z,y as G,z as J,A as j,B as K,C as H,F,D as W,b as X,E as Y,G as Z,w as tt,H as et}from"./index.7ddf54de.js";import{m as p}from"./myAuth.f2132660.js";import{u as ot}from"./use-meta.34b46143.js";import{Q as x}from"./QItemLabel.af98036f.js";import{Q as V,a as A}from"./QItem.cbdda9a5.js";/* empty css               */import{_ as at}from"./DynamicFormItem.4c6196ce.js";import{_ as nt}from"./plugin-vue_export-helper.21dcd24c.js";import"./QImg.b604589a.js";import"./use-ratio.18934406.js";const g="SessionToken",h="AccessToken",lt={__name:"AuthComponent",setup(E,{expose:C}){const u=q(),r=String("https://api.sakh-orch.ru/");N();const k=_("isOptionsLoaded"),v=_("admin"),b=_("Halls");function n(){console.log("loadOptions started"),T.post(r+"api/get/options.php",{params:{}}).then(t=>{var e,i,m,c;if(!((e=t==null?void 0:t.data)!=null&&e.result))throw new Error;b.value=(c=(m=(i=t==null?void 0:t.data)==null?void 0:i.data)==null?void 0:m.Halls)!=null?c:[],console.log("options Loaded"),k.value=!0}).catch(t=>{u.notify(O(t))})}const l=s(""),Q=s("");function f(t,e,i="90d"){u.cookies.set(t,e,{expires:i,path:"/",domain:null,sameSite:"Strict",secure:!0,httpOnly:!1}),t===h&&(T.defaults.headers.common.AccessToken=e,l.value=e,p.self.AccessToken=e),t===g&&(Q.value=e,p.self.SessionToken=e)}function y(){T.post(String("https://auth.symphograph.ru/")+"/api/register.php",{params:{authType:"default"}}).then(t=>{var e,i,m,c,w;if(!((e=t==null?void 0:t.data)!=null&&e.result))throw new Error;f(h,(m=(i=t==null?void 0:t.data)==null?void 0:i.data.AccessToken)!=null?m:""),f(g,(w=(c=t==null?void 0:t.data)==null?void 0:c.data.SessionToken)!=null?w:""),n()}).catch(t=>{u.notify(O(t))})}d("register",y);function D(){T.post(String("https://auth.symphograph.ru/")+"/api/refresh.php",{params:{SessionToken:p.self.SessionToken,AccessToken:p.self.AccessToken}}).then(t=>{var e,i,m,c,w;if(!((e=t==null?void 0:t.data)!=null&&e.result))throw new Error;f(g,(m=(i=t==null?void 0:t.data)==null?void 0:i.data.SessionToken)!=null?m:""),f(h,(w=(c=t==null?void 0:t.data)==null?void 0:c.data.AccessToken)!=null?w:""),v.value=p.self.isPermit([4]),n()}).catch(t=>{var e;if(((e=t==null?void 0:t.response)==null?void 0:e.status)===401){y();return}u.notify(O(t))})}return d("refreshAccessToken",D),C({}),P(()=>{console.log("auth beforeMounted"),T.defaults.headers.common.Accept="application/json",p.self=new p}),U(()=>{console.log("auth Mounted"),!u.cookies.getAll()[h]||!u.cookies.getAll()[g]?y():(f(g,u.cookies.getAll()[g]),f(h,u.cookies.getAll()[h]),D())}),(t,e)=>R("",!0)}};const it={__name:"LoginDialog",setup(E){const C=_("authTypes"),u=String("https://auth.symphograph.ru/"),r=_("showLoginDialog"),k=_("leftDrawerOpen");function v(){k.value=!1}return(b,n)=>(L(),B(Y,{modelValue:H(r),"onUpdate:modelValue":n[3]||(n[3]=l=>X(r)?r.value=l:null),onHide:n[4]||(n[4]=l=>v())},{default:a(()=>[o(W,{class:"dialogArea",style:{color:"var(--dTitle)"}},{default:a(()=>[o(I,null,{default:a(()=>[o(V,{dense:""},{default:a(()=>[o(A,null,{default:a(()=>[o(x,{lines:"1",class:"cardTitle"},{default:a(()=>[o($,{name:"lock"}),M("\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0439 \u0432\u0445\u043E\u0434")]),_:1})]),_:1}),o(A,{side:""},{default:a(()=>[o(z,{round:"",flat:"",icon:"close",onMouseover:n[0]||(n[0]=()=>console.log("kjk")),onClick:n[1]||(n[1]=G(l=>r.value=!1,["stop","prevent"]))})]),_:1})]),_:1}),o(J),o(V,null,{default:a(()=>[o(A,null,{default:a(()=>[o(x,null,{default:a(()=>[M(" \u041F\u0440\u0435\u0434\u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D \u0434\u043B\u044F \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u043E\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430 ")]),_:1})]),_:1})]),_:1}),o(V,{clickable:"",to:"/vacancies",onClick:n[2]||(n[2]=l=>r.value=!1)},{default:a(()=>[o(A,null,{default:a(()=>[o(x,{caption:""},{default:a(()=>[M(" \u0415\u0441\u043B\u0438 \u0412\u044B \u043D\u0435 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430, \u0442\u043E \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442\u0435 \u043A \u043D\u0430\u043C \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C. ")]),_:1}),o(x,{caption:""},{default:a(()=>[M(" \u0423 \u043D\u0430\u0441 \u0441\u0435\u0439\u0447\u0430\u0441 \u0435\u0441\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0438\u043D\u0442\u0435\u0440\u0435\u0441\u043D\u044B\u0445 \u0432\u0430\u043A\u0430\u043D\u0441\u0438\u0439.\u{1F603} ")]),_:1})]),_:1}),o(A,{side:""},{default:a(()=>[o($,{name:"open_in_new"})]),_:1})]),_:1})]),_:1}),o(I,null,{default:a(()=>[(L(!0),j(F,null,K(H(C),l=>(L(),B(at,{key:l.id,btnLabel:l.label,icon:l.img,url:H(u)+l.url},null,8,["btnLabel","icon","url"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var st=nt(it,[["__scopeId","data-v-761e7acf"]]);const Tt={__name:"MainLayout",setup(E){Z(),ot({meta:{viewport:{name:"viewport",content:"initial-scale=1, width=device-width, user-scalable=yes"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}});const u=q(),r=N(),k=s(),v=s([{id:2,label:"\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C",url:"auth/telegram/login.php",img:"/img/auth/telegram.svg"},{id:3,label:"MailRu",url:"auth/mailru/login.php",img:"/img/auth/mailru.svg"},{id:4,label:"Discord",url:"auth/discord/login.php",img:"/img/auth/discord.svg"},{id:4,label:"V\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435",url:"auth/vkontakte/login.php",img:"/img/auth/vkontakte.svg"}]);d("authTypes",v);const b=s(!1);d("progress",b);const n=s(!1);d("editMode",n);const l=s(!1);d("admin",l);const Q=s(!1);d("leftDrawerOpen",Q),s("gfdsg"),s("gfdsg");const f=s(!1);d("isOptionsLoaded",f);const y=s([]);d("Halls",y);const D=s(!1);d("showLoginDialog",D),tt(r,i=>{S.set("lastPath",i.path)});function t(){S.set("CookieConfirm","1")}function e(){S.getItem("CookieConfirm")||u.notify({message:"\u041C\u044B \u0442\u043E\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C Cookies. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0431\u0435\u0437 \u043D\u0438\u0445 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442.",color:"primary",timeout:0,multiLine:!0,onDismiss:t,icon:"ion-information-circle-outline",actions:[{label:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E",color:"yellow",handler:()=>{}}]})}return P(()=>{console.log("mainLayout beforeMount"),document.body.style.backgroun="none"}),U(()=>{S.set("lastPath",r.path),console.log("mainLayout Mounted"),e()}),(i,m)=>{const c=et("router-view");return L(),j(F,null,[o(lt,{ref_key:"refAuth",ref:k},null,512),f.value?(L(),B(c,{key:0})):R("",!0),o(st)],64)}}};export{Tt as default};
