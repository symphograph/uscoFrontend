import{i as b,r as k,m as y,n as B,q as t,f as l,B as K,bm as z,bi as C,v as n,A as c,x as N,b as ol,G as il,I as nl,p as q,k as ul,D as F,F as H,ax as R,y as h,l as j,t as v,E as dl,u as U}from"./index.e91fb510.js";import{b as Z,Q as g}from"./QImg.74d9d22f.js";import{Q as x}from"./QTooltip.32ca611d.js";import{Q as E}from"./QItemLabel.5220bd87.js";import{Q as rl}from"./QList.840fbbd1.js";import{P as fl}from"./PageShell.39877c62.js";import{a as T}from"./axios.07914dc4.js";import{u as al}from"./use-quasar.87d72c4b.js";import{a as J,n as L,h as ll}from"./myFuncts.bdba1267.js";import{_ as tl}from"./BtnDelete.916ee5e0.js";import{Q as ml}from"./QForm.e9759f6d.js";/* empty css               */import{_ as sl}from"./BtnLibEdit.86045c93.js";import{A as pl}from"./AuthorItem.64525302.js";import{P as G}from"./lib.16fb7434.js";import"./position-engine.530b58a5.js";import"./selection.b594d881.js";import"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.ce02be63.js";import"./touch.9135741d.js";import"./AnderHeader.vue_vue_type_style_index_0_lang.d39e13e6.js";import"./QScrollArea.1d5f5a86.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./format.de7e9769.js";import"./QLinearProgress.66f5a960.js";import"./myAuth.5621b016.js";/* empty css                                                               */import"./myAxios.849041e3.js";const vl={__name:"PartitionDialog",setup(el){const _=al(),m=String("https://sakh-orch.ru/stapi/"),s=b("isOpenPartitionDialog"),u=b("selectedPartition"),w=b("loadPartitions"),d=k(!1);function V(){var p;d.value=!0,T.post(m+"epoint/lib/partition.php",{params:{method:u.value.id?"update":"add",workId:u.value.workId,title:u.value.title,caption:u.value.caption,num:u.value.num,id:(p=u.value.id)!=null?p:void 0}}).then(i=>{var r,$,A;if(!((r=i==null?void 0:i.data)!=null&&r.result))throw new Error;_.notify(J((A=($=i==null?void 0:i.data)==null?void 0:$.result)!=null?A:null)),w(),s.value=!1}).catch(i=>{_.notify(L(i))}).finally(()=>{d.value=!1})}function O(){d.value=!1}const Q=[p=>!!p||"\u041F\u0443\u0441\u0442\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435!"],I=[p=>p>0&p<1e3||"\u2116?"],S=k(),P=k();function M(){!W()||V()}function W(){return S.value.validate()&&P.value.validate()}return(p,i)=>(y(),B(il,{modelValue:n(s),"onUpdate:modelValue":i[4]||(i[4]=r=>ol(s)?s.value=r:null),onBeforeHide:O},{default:t(()=>[l(N,{bordered:"",class:"dialogArea"},{default:t(()=>[l(ml,{onSubmit:K(M,["prevent","stop"])},{default:t(()=>[l(z,null,{default:t(()=>[l(C,{type:"number",rules:I,ref_key:"refNum",ref:P,prefix:"\u2116",modelValue:n(u).num,"onUpdate:modelValue":i[0]||(i[0]=r=>n(u).num=r),style:{width:"5em"}},null,8,["modelValue"]),l(C,{modelValue:n(u).title,"onUpdate:modelValue":i[1]||(i[1]=r=>n(u).title=r),filled:"",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0447\u0430\u0441\u0442\u0438",rules:Q,style:{width:"100%"},ref_key:"refTitle",ref:S},null,8,["modelValue"]),l(C,{modelValue:n(u).caption,"onUpdate:modelValue":i[2]||(i[2]=r=>n(u).caption=r),filled:"",label:"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(z,{align:"right"},{default:t(()=>[l(c,{class:"goldBtn",label:"\u041E\u0442\u043C\u0435\u043D\u0430",onClick:i[3]||(i[3]=r=>s.value=!1)}),l(c,{color:"green",type:"submit",label:"\u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",loading:d.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},cl={class:"centralCol"},ql={__name:"WorkPage",setup(el){const _=String("https://sakh-orch.ru/stapi/"),m=al(),s=nl(),u=b("libEditMode"),w=k(!1),d=k({});k(null);const V=k([]),O=b("selectedAuthorId"),Q=b("selectedAuthor"),I=k(!1);q("isOpenPartitionDialog",I);function S(){return{id:void 0,num:V.value.length+1,title:"",workId:d.value.id}}const P=k({});q("selectedPartition",P);function M(){P.value=S(),I.value=!0}function W(e){P.value=e,I.value=!0}function p(){T.post(_+"epoint/lib/work.php",{params:{method:"get",workId:s.params.id}}).then(e=>{var a,o;d.value=(o=(a=e==null?void 0:e.data)==null?void 0:a.data)!=null?o:{},O.value=d.value.authorId,i(),D()}).catch(e=>{m.notify(L(e))})}const i=b("loadAuthor");function r(){T.post(_+"epoint/lib/work.php",{params:{method:"update",workId:s.params.id,work:d.value}}).then(e=>{var a,o,f;if(!((a=e==null?void 0:e.data)!=null&&a.result))throw new Error;m.notify(J((f=(o=e==null?void 0:e.data)==null?void 0:o.result)!=null?f:null))}).catch(e=>{m.notify(L(e))})}function $(){T.post(_+"epoint/lib/work.php",{params:{method:"del",workId:s.params.id}}).then(e=>{var a,o,f;if(!((a=e==null?void 0:e.data)!=null&&a.result))throw new Error;m.notify(J((f=(o=e==null?void 0:e.data)==null?void 0:o.result)!=null?f:null))}).catch(e=>{m.notify(L(e))})}async function A(e){await G.del(m,e)&&D()}async function D(){const e=await G.getList(m,s.params.id);e.length&&(V.value=[],V.value=e)}q("loadPartitions",D);async function X(e,a){w.value=!0,await G.moveSort(m,e,a)&&await D(),w.value=!1}return ul(()=>{p()}),(e,a)=>(y(),F(H,null,[l(fl,{"page-title":d.value.titleRu},{ToolPanel:t(()=>{var o,f,Y;return[l(pl,{id:n(O),iofEn:(o=n(Q))==null?void 0:o.iofEn,iconUrl:(f=n(Q))==null?void 0:f.iconUrl,fioRu:(Y=n(Q))==null?void 0:Y.fioRu},null,8,["id","iofEn","iconUrl","fioRu"]),l(sl)]}),PageContent:t(()=>[R("div",cl,[a[10]||(a[10]=R("br",null,null,-1)),l(N,null,{default:t(()=>[l(h,null,{default:t(()=>[l(Z,null,{default:t(()=>[l(c,{label:`ID: ${d.value.id}`,flat:"",onClick:a[0]||(a[0]=o=>n(ll)(d.value.id,n(m))),"icon-right":"content_copy"},null,8,["label"])]),_:1}),l(C,{modelValue:d.value.titleRu,"onUpdate:modelValue":a[1]||(a[1]=o=>d.value.titleRu=o),readonly:!n(u),label:"\u041B\u043E\u043A\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue","readonly"]),l(C,{modelValue:d.value.titleEn,"onUpdate:modelValue":a[2]||(a[2]=o=>d.value.titleEn=o),readonly:!n(u),label:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue","readonly"]),l(C,{modelValue:d.value.opus,"onUpdate:modelValue":a[3]||(a[3]=o=>d.value.opus=o),label:"opus",readonly:!n(u),prefix:"Op."},null,8,["modelValue","readonly"])]),_:1}),n(u)?(y(),B(z,{key:0,align:"right"},{default:t(()=>[l(c,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green",onClick:r}),l(tl,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435","throw-confirm":"",danger:"",onOnOk:$,tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435"})]),_:1})):j("",!0)]),_:1}),a[11]||(a[11]=R("br",null,null,-1)),l(N,null,{default:t(()=>[l(h,null,{default:t(()=>[a[5]||(a[5]=v("\u0427\u0430\u0441\u0442\u0438 \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u044F ")),n(u)?(y(),B(c,{key:0,icon:"add",round:"",onClick:M},{default:t(()=>[l(x,null,{default:t(()=>a[4]||(a[4]=[v("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C")])),_:1})]),_:1})):j("",!0)]),_:1}),l(h,null,{default:t(()=>[l(rl,null,{default:t(()=>[(y(!0),F(H,null,dl(V.value,o=>(y(),B(Z,{key:o.id},{default:t(()=>[l(g,{avatar:""},{default:t(()=>[l(E,null,{default:t(()=>[v(U(o.sortVal),1)]),_:2},1024)]),_:2},1024),l(g,{avatar:""},{default:t(()=>[l(E,null,{default:t(()=>[v("\u2116"+U(o.num),1)]),_:2},1024)]),_:2},1024),l(g,null,{default:t(()=>[l(E,null,{default:t(()=>[v(U(o.title),1)]),_:2},1024),l(E,{caption:""},{default:t(()=>[v(U(o.caption),1)]),_:2},1024)]),_:2},1024),l(g,{side:""},{default:t(()=>[l(E,null,{default:t(()=>[l(c,{label:`ID: ${o.id}`,flat:"",onClick:f=>n(ll)(o.id,n(m)),"icon-right":"content_copy"},null,8,["label","onClick"])]),_:2},1024)]),_:2},1024),n(u)?(y(),F(H,{key:0},[l(g,{side:""},{default:t(()=>[l(c,{icon:"edit",dense:"",round:"",flat:"",onClick:f=>W(o)},{default:t(()=>[l(x,null,{default:t(()=>a[6]||(a[6]=[v("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024),l(g,{side:""},{default:t(()=>[l(tl,{"throw-confirm":"",danger:"",flat:"",onOnOk:f=>A(o.id),tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C"},null,8,["onOnOk"])]),_:2},1024),l(g,{side:""},{default:t(()=>[l(c,{round:"",icon:"keyboard_arrow_up",loading:w.value,disable:o.sortVal===1,onClick:K(f=>X("up",o.id),["stop","prevent"])},{default:t(()=>[l(x,null,{default:t(()=>a[7]||(a[7]=[v("\u0421\u0434\u0432\u0438\u043D\u0443\u0442\u044C \u0432\u0432\u0435\u0440\u0445")])),_:1})]),_:2},1032,["loading","disable","onClick"])]),_:2},1024),l(g,{side:""},{default:t(()=>[l(c,{round:"",icon:"keyboard_arrow_down",loading:w.value,onClick:K(f=>X("down",o.id),["stop","prevent"])},{default:t(()=>[l(x,null,{default:t(()=>a[8]||(a[8]=[v("\u0421\u0434\u0432\u0438\u043D\u0443\u0442\u044C \u0432\u043D\u0438\u0437")])),_:1})]),_:2},1032,["loading","onClick"])]),_:2},1024)],64)):j("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),a[12]||(a[12]=R("br",null,null,-1)),l(N,null,{default:t(()=>[l(h,null,{default:t(()=>a[9]||(a[9]=[v("\u0418\u0437\u0434\u0430\u043D\u0438\u044F")])),_:1}),l(h)]),_:1})])]),_:1},8,["page-title"]),l(vl)],64))}};export{ql as default};
