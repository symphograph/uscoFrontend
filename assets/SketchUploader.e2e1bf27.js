import{Q as f}from"./QTooltip.87ead732.js";import{r as d,i as H,c as J,n as u,q as P,f as o,G as t,H as n,t as i,a9 as m,U as _,l as c,aH as D,ax as F,aZ as G,V as K,bk as M,ay as Y,aY as Z,F as $,I as W,J as X}from"./index.d7d1bcb8.js";import{a as ee,Q as le,f as ae}from"./style.dba5a572.js";import{n as te}from"./myFuncts.bfee3d05.js";import{u as oe}from"./use-quasar.ff1c236f.js";import{m as ne}from"./myAuth.f2132660.js";import{_ as re}from"./plugin-vue_export-helper.21dcd24c.js";const x=p=>(W("data-v-73c93308"),p=p(),X(),p),se={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},de={class:"col"},ue=x(()=>n("div",{class:"q-uploader__title"},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437",-1)),ie={class:"q-uploader__subtitle"},ce=x(()=>n("ul",null,[n("li",null,"\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0443 \u043C\u043E\u0436\u0435\u0442 \u0440\u0430\u0441\u0442\u044F\u043D\u0443\u0442\u044C \u0438\u043B\u0438 \u0441\u043F\u043B\u044E\u0449\u0438\u0442\u044C."),n("li",null,"\u041A\u0432\u0430\u0434\u0440\u0430\u0442\u044B \u0441\u0442\u0430\u043D\u0443\u0442 \u043F\u0440\u044F\u043C\u043E\u0443\u0433\u043E\u043B\u044C\u043D\u0438\u043A\u0430\u043C\u0438."),n("li",null,"\u041A\u0440\u0443\u0433\u0438 \u0441\u0442\u0430\u043D\u0443\u0442 \u043E\u0432\u0430\u043B\u0430\u043C\u0438."),n("li",null,"\u041B\u044E\u0434\u0438 \u0431\u0443\u0434\u0443\u0442 \u0432\u044B\u0433\u043B\u044F\u0434\u0435\u0442\u044C \u043D\u0435\u0435\u0441\u0442\u0435\u0441\u0442\u0432\u0435\u043D\u043D\u043E \u0442\u043E\u043B\u0441\u0442\u044B\u043C\u0438 \u0438\u043B\u0438 \u0445\u0443\u0434\u044B\u043C\u0438."),n("li",null,"\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u043F\u043E\u0442\u0435\u0440\u044F\u0435\u0442 \u0447\u0435\u0442\u043A\u043E\u0441\u0442\u044C"),n("li",null,"\u0418\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0435 \u043F\u0440\u043E\u043F\u043E\u0440\u0446\u0438\u0439 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043C\u043E\u0436\u0435\u0442 \u0432\u043E\u0441\u043F\u0440\u0438\u043D\u0438\u043C\u0430\u0442\u044C\u0441\u044F \u043A\u0430\u043A \u0441\u043B\u0435\u0434\u0441\u0442\u0432\u0438\u0435 \u0443\u043F\u043E\u0442\u0440\u0435\u0431\u043B\u0435\u043D\u0438\u044F \u043D\u0430\u0440\u043A\u043E\u0442\u0438\u0447\u0435\u0441\u043A\u0438\u0445 \u0432\u0435\u0449\u0435\u0441\u0442\u0432")],-1)),pe={__name:"SketchUploader",props:{id:Number,type:String},emits:["onUploaded"],setup(p,{emit:Q}){const R=String("https://api.sakh-orch.ru/"),V=oe(),k=p,U=d(),r=d(),y={},q=Q,v=d(""),b=d("");d({src:"",type:""}),d({coordinates:null,image:null});const h=H("pwUrl");function N(){C()}let A="image/jpeg";function B(l){v.value=URL.createObjectURL(l[0])}function C(){const{canvas:l}=U.value.getResult();l.toBlob(a=>{b.value=a,h.value=URL.createObjectURL(a)},A)}function S(){C();const l=r.value.queuedFiles[0],a=l.name.replace(/[\[\]]/g,"_"),s=new File([b.value],a,{type:l.type});r.value.reset(),r.value.addFiles([s]),r.value.upload()}function T(){v.value="",h.value=""}function L(l){var s,e,w;let a=(w=(e=JSON.parse((s=l==null?void 0:l.xhr)==null?void 0:s.response))==null?void 0:e.error)!=null?w:"";V.notify(te(null,a))}function I(){r.value.reset(),h.value="",q("onUploaded")}function j(){return{url:R+`api/${k.type}/sketch.php`,headers:[{name:"ACCESSTOKEN",value:ne.self.AccessToken}],formFields:[{name:"id",value:k.id},{name:"method",value:"add"}]}}function E({imageSize:l,visibleArea:a}){return{width:(a||l).width,height:(a||l).height}}const O={left:0,top:0},g=d(!1),z=J(()=>g.value?{}:{aspectRatio:1920/1080});return(l,a)=>{var s;return u(),P($,null,[o(le,{modelValue:y,"onUpdate:modelValue":a[0]||(a[0]=e=>y=e),accept:"image/*",style:{width:"100%"},label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437 16:9",factory:j,multiple:!1,"hide-upload-btn":"",ref_key:"refUploader",ref:r,onAdded:B,onRemoved:T,onUploaded:I,onFailed:L,"no-thumbnails":""},{header:t(e=>[n("div",se,[e.uploadedFiles.length>0?(u(),i(m,{key:0,icon:"done_all",onClick:e.removeUploadedFiles,round:"",dense:"",flat:""},{default:t(()=>[o(f,null,{default:t(()=>[_("Remove Uploaded Files")]),_:1})]),_:2},1032,["onClick"])):c("",!0),e.isUploading?(u(),i(D,{key:1,class:"q-uploader__spinner"})):c("",!0),n("div",de,[ue,n("div",ie,F(e.uploadSizeLabel)+" / "+F(e.uploadProgressLabel),1)]),e.canAddFiles?(u(),i(m,{key:2,type:"a",icon:"add_box",onClick:e.pickFiles,round:"",dense:"",flat:""},{default:t(()=>[o(ee),o(f,null,{default:t(()=>[_("\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0444\u0430\u0439\u043B")]),_:1})]),_:2},1032,["onClick"])):c("",!0),e.canUpload?(u(),i(m,{key:3,icon:"cloud_upload",onClick:S,round:"",dense:"",flat:""},{default:t(()=>[o(f,null,{default:t(()=>[_("\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C")]),_:1})]),_:1})):c("",!0),e.isUploading?(u(),i(m,{key:4,icon:"clear",onClick:e.abort,round:"",dense:"",flat:""},{default:t(()=>[o(f,null,{default:t(()=>[_("Abort Upload")]),_:1})]),_:2},1032,["onClick"])):c("",!0)])]),_:1},512),(s=r.value)!=null&&s.queuedFiles.length?(u(),i(Z,{key:0,dark:"",style:{width:"100%"}},{default:t(()=>[o(G,null,{default:t(()=>[o(K(ae),{class:"cropper",ref_key:"refCropper",ref:U,src:v.value,canvas:{width:1920,height:1080},"stencil-props":z.value,"default-size":E,"default-position":O,onChange:N},null,8,["src","stencil-props"])]),_:1}),o(M,{align:"between"},{default:t(()=>[o(Y,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e),label:"\u0418\u0433\u043D\u043E\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u043E\u043E\u0442\u043D\u043E\u0448\u0435\u043D\u0438\u0435 \u0441\u0442\u043E\u0440\u043E\u043D",color:"red"},{default:t(()=>[o(f,{self:"top middle",class:"bg-red text-black text-body2",delay:300},{default:t(()=>[ce]),_:1})]),_:1},8,["modelValue"]),o(m,{label:"\u0413\u043E\u0442\u043E\u0432\u043E",color:"green",onClick:S})]),_:1})]),_:1})):c("",!0)],64)}}};var Ue=re(pe,[["__scopeId","data-v-73c93308"]]);export{Ue as S};
