import{Q as A}from"./QImg.f9998e06.js";import{Q as R}from"./QVideo.2fdd28fe.js";import{u as W}from"./use-meta.1e53df67.js";import{u as Y}from"./use-quasar.b9e4067c.js";import{api as F}from"./axios.808fc3dd.js";import{aJ as X,aK as G,_ as Z,i as z,u as q,r as U,f as i,g as r,A as s,h as n,aY as $,t as o,a1 as S,s as v,z as C,F as w,at as T,a4 as ee,j as B,au as L,av as te,a0 as ae,aX as le,aW as oe,c as b,a5 as ne,v as se,x as ie,p as de,a as re}from"./index.9a351014.js";import{a as M,b as K,Q as ue}from"./QItemSection.94715d12.js";import{Q as ce}from"./QList.def0bdbb.js";import{Q as P}from"./QUploader.cbe7d553.js";import{b as D,n as I}from"./myFuncts.8c7f864e.js";import"./use-ratio.97e04bf5.js";import"./format.3e32b8d9.js";import"./jwt-decode.esm.74bd4619.js";function pe(m){const l=document.createElement("textarea");l.value=m,l.contentEditable="true",l.style.position="fixed";const a=()=>{};X(a),document.body.appendChild(l),l.focus(),l.select();const u=document.execCommand("copy");return l.remove(),G(a),u}function me(m){return navigator.clipboard!==void 0?navigator.clipboard.writeText(m):new Promise((l,a)=>{const u=pe(m);u?l(!0):a(u)})}const x=m=>(se("data-v-0740ee62"),m=m(),ie(),m),_e={key:0,class:"newsarea"},fe=x(()=>o("br",null,null,-1)),ve={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},ye={class:"nimg_block"},ge={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},he={class:"inputArea"},ke={class:"input"},be={id:"categs",class:"input"},we={id:"uploaderArea",class:"input"},xe={class:"uploaderArea"},Ve={id:"uploaderArea2",class:"input"},$e={class:"uploaderArea"},Ne={class:"imagesArea"},Qe={class:"row no-wrap"},Ce=x(()=>o("br",null,null,-1)),Ie=x(()=>o("br",null,null,-1)),Ue=x(()=>o("br",null,null,-1)),Ee=x(()=>o("br",null,null,-1)),Se=x(()=>o("br",null,null,-1)),Fe=x(()=>o("br",null,null,-1)),Ae={__name:"NewEditor",emits:["uploaded"],setup(m,{emit:l}){const a=z("newData"),u=String("https://api.sakh-orch.ru/"),_=Y(),N=q(),V=U(null),Q=z("AccessToken"),g=U([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u0421\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]);function f(d){d=`
![](`+d+")",me(d).then(()=>{_.notify({color:"positive",position:"center",message:"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E",icon:"content_copy",timeout:1})}).catch(()=>{})}function h(d,t){F.post(u+"api/set/news/delimg.php",{params:{id:N.params.id,img:d}}).then(e=>{var p,k;_.notify(D((k=(p=e==null?void 0:e.data)==null?void 0:p.result)!=null?k:"")),a.value.Images.splice(t,1),l("uploaded")}).catch(e=>{_.notify(I(e))})}function c(d){F.post(u+"api/set/news/delpw.php",{params:{id:N.params.id,img:d}}).then(t=>{a.value.img="/img/entry/default.svg"}).catch(t=>{_.notify(I(t))})}function y(){return{url:u+"api/upload/entrypw.php",headers:[{name:"ACCESSTOKEN",value:Q.value}],formFields:[{name:"id",value:a.value.id}]}}function E(){return{url:u+"api/upload/entryimg.php",headers:[{name:"ACCESSTOKEN",value:Q.value}],formFields:[{name:"id",value:a.value.id}]}}function O(d){_.notify(D("\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E")),l("uploaded"),V.value.reset()}function j(d){var e,p,k;let t=(k=(p=JSON.parse((e=d==null?void 0:d.xhr)==null?void 0:e.response))==null?void 0:p.error)!=null?k:"";_.notify(I(null,t))}function H(){const d=Object.keys(g.value);let t=[];return d.forEach(e=>{t[g.value[e].id]=g.value[e].checked}),t}function J(d=0){F.post(u+"api/set/news/entry.php",{params:{entry:a.value,addNew:d,categs:H()}}).then(t=>{var e,p;_.notify(D((p=(e=t==null?void 0:t.data)==null?void 0:e.result)!=null?p:"")),l("uploaded")}).catch(t=>{_.notify(I(t))})}return(d,t)=>(i(),r(w,null,[s(a)?(i(),r("div",_e,[n($,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:s(a).title,"onUpdate:modelValue":t[0]||(t[0]=e=>s(a).title=e)},null,8,["modelValue"]),fe,o("div",ve,[o("div",ye,[n(A,{ratio:1080/684,src:s(u)+s(a).img},null,8,["src"])]),n(S,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{transform:"translateY(-50%)"},onClick:t[1]||(t[1]=e=>c(s(a).img))}),o("div",ge,[n($,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",type:"textarea",modelValue:s(a).descr,"onUpdate:modelValue":t[2]||(t[2]=e=>s(a).descr=e),outlined:""},null,8,["modelValue"])])]),o("div",he,[o("div",ke,[n($,{type:"date",modelValue:s(a).date,"onUpdate:modelValue":t[3]||(t[3]=e=>s(a).date=e),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),n($,{modelValue:s(a).refName,"onUpdate:modelValue":t[4]||(t[4]=e=>s(a).refName=e),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),n($,{modelValue:s(a).refLink,"onUpdate:modelValue":t[5]||(t[5]=e=>s(a).refLink=e),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},null,8,["modelValue"])]),o("div",be,[n(ce,{bordered:"",padding:""},{default:v(()=>[n(M,{header:""},{default:v(()=>[C("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(i(!0),r(w,null,T(g.value,e=>ee((i(),B(ue,{key:e.id,tag:"label"},{default:v(()=>[n(K,null,{default:v(()=>[n(M,null,{default:v(()=>[C(L(e.name),1)]),_:2},1024),n(M,{caption:""},{default:v(()=>[C(L(e.caption),1)]),_:2},1024)]),_:2},1024),n(K,{side:"",top:""},{default:v(()=>[n(te,{color:"green",modelValue:s(a).categs[e.id],"onUpdate:modelValue":p=>s(a).categs[e.id]=p,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[ne]])),128))]),_:1})]),o("div",we,[o("div",xe,[n(P,{label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437",factory:y,"max-file-size":"50000000",ref_key:"uploader",ref:V,onUploaded:O,onFailed:j,padding:"0",margin:"0",bordered:""},null,512)])]),o("div",Ve,[o("div",$e,[n(P,{"input-style":"max-width: 300px; padding: 0",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",factory:E,"max-file-size":"50000000",ref_key:"uploader",ref:V,onUploaded:O,onFailed:j,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)])])]),o("div",Ne,[(i(!0),r(w,null,T(s(a).Images,(e,p)=>(i(),B(oe,{key:p},{default:v(()=>[n(A,{ratio:96/54,src:s(u)+"/img/entry/1080/"+s(a).id+"/"+e.fileName},null,8,["src"]),n(le,null,{default:v(()=>[n(S,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{top:"0",right:"0.5em",transform:"translateY(-50%)"},onClick:k=>h(e.fileName,p)},null,8,["onClick"]),o("div",Qe,[n(S,{padding:"0.5em 1em",onClick:k=>f(e.fileName)},{default:v(()=>[n(ae,{name:"content_copy"}),C(" \u041A\u043E\u0434 \u0432\u0441\u0442\u0430\u0432\u043A\u0438 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),n($,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:s(a).markdown,"onUpdate:modelValue":t[6]||(t[6]=e=>s(a).markdown=e),dense:""},null,8,["modelValue"]),Ce,Ie,n(S,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",onClick:t[7]||(t[7]=e=>J(0))}),Ue,Ee])):b("",!0),Se,Fe],64))}};var Te=Z(Ae,[["__scopeId","data-v-0740ee62"]]);const Le={key:0,class:"content"},Me={key:1,class:"newsarea"},De={class:"p_title"},ze={class:"narea"},Be={class:"text"},Oe=["innerHTML"],je={key:1},Ke=o("br",null,null,-1),Pe={key:1,class:"newsImg"},Ye={key:2,class:"vitem"},qe={key:0},He=["href"],Je={key:1,class:"content"},Re=o("div",{class:"newsarea"},[o("div",{class:"narea"},[o("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),We=[Re],ut={__name:"NewPage",setup(m){U(0);const l=U(null);de("newData",l);const a=Y(),u=String("https://api.sakh-orch.ru/"),_=q(),N=z("editMode"),V=U("\u041D\u043E\u0432\u043E\u0441\u0442\u044C");W(()=>({title:V.value}));function Q(f){return u+"/img/entry/1080/"+l.value.id+"/"+f}function g(){F.post(u+"api/get/new.php",{params:{id:_.params.id}}).then(f=>{var h,c,y,E;l.value=(c=(h=f==null?void 0:f.data)==null?void 0:h.data)!=null?c:null,V.value=(E=(y=l==null?void 0:l.value)==null?void 0:y.title)!=null?E:""}).catch(f=>{a.notify(I(f))})}return re(()=>{g()}),(f,h)=>l.value||s(N)?(i(),r("div",Le,[s(N)&&l.value?(i(),B(Te,{key:0,onUploaded:h[0]||(h[0]=c=>g())})):b("",!0),l.value?(i(),r("div",Me,[o("div",De,L(l.value.title),1),o("div",ze,[o("div",Be,[(i(!0),r(w,null,T(l.value.parsedMD,(c,y)=>(i(),r(w,{key:y},[c.type==="text"?(i(),r(w,{key:0},[c.content!==`
`?(i(),r("section",{key:0,innerHTML:c.content},null,8,Oe)):(i(),r("br",je)),Ke],64)):b("",!0),c.type==="img"?(i(),r("div",Pe,[n(A,{src:Q(c.content),fit:"fill"},null,8,["src"])])):b("",!0),c.type==="video"?(i(),r("div",Ye,[n(R,{ratio:16/9,src:"https://www.youtube.com/embed/"+c.content},null,8,["src"])])):b("",!0)],64))),128)),l.value.refLink?(i(),r("div",qe,[C("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "),o("a",{href:l.value.refLink,target:"_blank"},L(l.value.refName),9,He)])):b("",!0),(i(!0),r(w,null,T(l.value.unusedImages,(c,y)=>(i(),r("div",{class:"newsImg",key:y},[n(A,{src:Q(c),fit:"fill"},null,8,["src"])]))),128))])])])):b("",!0)])):(i(),r("div",Je,We))}};export{ut as default};
