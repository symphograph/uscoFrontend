import{Q as le}from"./QLinearProgress.754aded5.js";import{i as I,r as b,f as n,g as v,F as O,bN as L,J as _,B as f,av as s,h as a,z as l,c as z,A as c,_ as K,j as g,aY as re,a7 as J,a3 as w,a8 as W,a4 as Y,aX as Z,u as ie,p as U,s as ne,a as ce,au as q,D as oe,E as se,W as ue}from"./index.22494882.js";import{api as j}from"./axios.e2ec1837.js";import{u as ee,d as de,n as V}from"./myFuncts.2470a9df.js";import{u as pe}from"./use-meta.8fbf0ea1.js";import{u as te}from"./use-quasar.5a28d56d.js";import{Q as G}from"./QTooltip.0a126085.js";import{Q as _e}from"./QImg.dbdc5b59.js";import{Q as A,b as m,a as M}from"./QItemSection.3906cff6.js";import"./jwt-decode.esm.74bd4619.js";import"./position-engine.ad83e008.js";import"./use-ratio.3f1e5982.js";const fe={class:"cellArea"},ve=c("br",null,null,-1),me=c("br",null,null,-1),ke=c("br",null,null,-1),ye=c("br",null,null,-1),he=c("br",null,null,-1),be={__name:"HallUserCell",props:{cell:Object,ticket:Object},emits:["reserve","returnTicket"],setup(d,{emit:k}){const r=d,u=I("colors"),T=b(r.ticket);I("HallPlan"),b("Invite"),b(0);const h=I("AccessToken"),$=ee(h.value)*1;function C(){k("reserve",T.value.id)}function H(){k("returnTicket",T.value.id)}return(o,P)=>{var N,E,S,R,B,D,Q;return n(),v("div",fe,[d.cell.exist?(n(),v(O,{key:0},[(N=d.ticket)!=null&&N.offline?(n(),v("div",{key:0,class:"offlineCell",style:L({borderColor:_(u)[((E=r.ticket)==null?void 0:E.priceType)||"Invite"][1],backgroundColor:_(u)[((S=r.ticket)==null?void 0:S.priceType)||"Invite"][1]})},null,4)):r.ticket.userId===$?(n(),v("div",{key:1,class:"userCell",onClick:P[0]||(P[0]=F=>H()),style:L({borderColor:_(u)[((R=r.ticket)==null?void 0:R.priceType)||"Invite"][1]})},[f(s(r.ticket.seatNum)+" ",1),a(G,{offset:[0,-120],"max-width":"20em",delay:300},{default:l(()=>[f(s("\u042D\u0442\u043E \u0412\u0430\u0448\u0435 \u043C\u0435\u0441\u0442\u043E")),ve,f(" "+s("\u0420\u044F\u0434: "+r.ticket.seatRow),1),me,f(" "+s("\u041C\u0435\u0441\u0442\u043E: "+r.ticket.seatNum),1),ke,f(" "+s("\u0426\u0435\u043D\u0430: "+r.ticket.priceType),1)]),_:1})],4)):r.ticket.userId?(n(),v("div",{key:2,class:"offlineCell",style:L({borderColor:_(u)[((B=r.ticket)==null?void 0:B.priceType)||"Invite"][1],backgroundColor:_(u)[((D=r.ticket)==null?void 0:D.priceType)||"Invite"][1]})},null,4)):(n(),v("div",{key:3,class:"availableCell",style:L({borderColor:_(u)[((Q=r.ticket)==null?void 0:Q.priceType)||"Invite"][1]}),onClick:P[1]||(P[1]=F=>C())},[f(s(r.ticket.seatNum)+" ",1),a(G,{offset:[0,-120],"max-width":"20em",delay:300},{default:l(()=>[f(s("\u0420\u044F\u0434: "+r.ticket.seatRow),1),ye,f(" "+s("\u041C\u0435\u0441\u0442\u043E: "+r.ticket.seatNum),1),he,f(" "+s("\u0426\u0435\u043D\u0430: "+r.ticket.priceType),1)]),_:1})],4))],64)):z("",!0)])}}};const ge={class:"mapLink"},Te={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"space-between"}},we={__name:"TicketCard",props:{ticket:{},price:Number},emits:["reserve"],setup(d,{emit:k}){const r=String("https://api.sakh-orch.ru/");te();const u=I("Announce");return(T,h)=>(n(),g(Z,{class:"ticketCard"},{default:l(()=>[a(re,{class:"progName"},{default:l(()=>[f(s(_(u).progName),1)]),_:1}),a(A,{dense:""},{default:l(()=>[a(m,{avatar:""},{default:l(()=>[a(_e,{width:"10em",ratio:16/9,src:_(r)+_(u).Sketch.verLink},null,8,["src"])]),_:1}),a(m,{avatar:""},{default:l(()=>[J((n(),g(A,{dense:""},{default:l(()=>[a(m,{avatar:""},{default:l(()=>[a(w,{name:"schedule",color:"amber"})]),_:1}),a(m,null,{default:l(()=>[a(M,{caption:""},{default:l(()=>[f(s(_(de)(_(u).datetime)),1)]),_:1})]),_:1})]),_:1})),[[W]]),a(A,{clickable:"",dense:"",href:_(u).Hall.map,target:"_blank"},{default:l(()=>[a(m,{avatar:""},{default:l(()=>[a(w,{color:"amber",name:"place"})]),_:1}),a(M,null,{default:l(()=>[c("span",ge,s(_(u).Hall.name),1)]),_:1})]),_:1},8,["href"]),J((n(),g(A,{dense:""},{default:l(()=>[a(m,{avatar:""},{default:l(()=>[a(w,{name:"ion-person",color:"amber"})]),_:1}),a(m,null,{default:l(()=>[a(M,{lines:"1"},{default:l(()=>[f("\u0420\u044F\u0434: "+s(d.ticket.seatRow)+" | \u041C\u0435\u0441\u0442\u043E: "+s(d.ticket.seatNum),1)]),_:1})]),_:1})]),_:1})),[[W]]),d.price?J((n(),g(A,{key:0,dense:""},{default:l(()=>[a(m,{avatar:""},{default:l(()=>[a(w,{name:"ion-wallet",color:"amber"})]),_:1}),a(m,null,{default:l(()=>[a(M,{lines:1},{default:l(()=>[f("\u0426\u0435\u043D\u0430: "+s(d.price),1)]),_:1})]),_:1})]),_:1})),[[W]]):z("",!0)]),_:1}),a(m),a(m,{side:""},{default:l(()=>[c("div",Te,[c("div",null,[a(Y,{onClick:h[0]||(h[0]=$=>k("reserve",d.ticket.id))},{default:l(()=>[a(w,{name:"add"})]),_:1})]),c("div",null,[a(Y,null,{default:l(()=>[a(w,{name:"delete"})]),_:1})])])]),_:1})]),_:1})]),_:1}))}};var Ie=K(we,[["__scopeId","data-v-245cee63"]]);const X=d=>(oe("data-v-02de6679"),d=d(),se(),d),Ce={class:"content"},Pe=X(()=>c("div",null,"rer",-1)),Ne=X(()=>c("div",null,"rer",-1)),Qe=X(()=>c("div",null,"rer",-1)),xe={class:"tableArea"},Ae={class:"rowNumber"},$e={class:"rowNumber"},He={key:0,class:"ticketList"},Ee={__name:"EventPage",setup(d){const k=String("https://api.sakh-orch.ru/"),r=te(),u=ie(),T=b([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);U("defaultPricing",T);const h=I("progress"),$=I("AccessToken"),C=ee($.value)*1,H=b({});U("Announce",H);const o=b({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:T.value,cells:[],tickets:[]});U("HallPlan",o),U("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]});const N=b(!1),E=ne(()=>[...o.value.tickets].filter(e=>e.userId===C));function S(t){var e,i;return(i=(e=o.value.pricing.find(p=>p.priceType===t.priceType))==null?void 0:e.price)!=null?i:0}function R(t){return o.value.tickets.find(e=>e.cellId===t)}function B(){j.post(k+"api/tickets/hallplan.php",{params:{method:"get",id:u.params.id}}).then(async t=>{var e,i,p,y;if(!((i=(e=t==null?void 0:t.data)==null?void 0:e.data)!=null&&i.HallPlan))throw new Error;N.value=!1,o.value=(y=(p=t==null?void 0:t.data)==null?void 0:p.data)==null?void 0:y.HallPlan,await ue(),N.value=!0,console.log("HallPlan loaded")}).catch(t=>{o.value={},r.notify(V(t))}).finally(()=>{h.value=!1,console.log("progress off")})}function D(){h.value=!0,console.log("progress on"),j.post(k+"api/event/announce.php",{params:{method:"get",id:u.params.id}}).then(t=>{var e,i,p;if(!((e=t==null?void 0:t.data)!=null&&e.result))throw console.log("announce err:",t.data),new Error;H.value=(p=(i=t==null?void 0:t.data)==null?void 0:i.data)!=null?p:{},console.log("Announce loaded"),B()}).catch(t=>{r.notify(V(t))}).finally(()=>{})}function Q(t){o.value.tickets.find(e=>e.id===t).userId=C,j.post(k+"api/tickets/ticket.php",{params:{method:"reserve",id:t}}).then(e=>{var i;if(!((i=e==null?void 0:e.data)!=null&&i.result))throw new Error}).catch(e=>{o.value.tickets.find(i=>i.id===t).userId=null,r.notify(V(e))})}function F(t){o.value.tickets.find(e=>e.id===t).userId=null,j.post(k+"api/tickets/ticket.php",{params:{method:"returnTicket",id:t}}).then(e=>{var i;if(!((i=e==null?void 0:e.data)!=null&&i.result))throw new Error}).catch(e=>{o.value.tickets.find(i=>i.id===t).userId=C,r.notify(V(e))})}return ce(()=>{D()}),b({width:"100%",height:"100%",margin:"auto",overflow:"scroll"}),pe({title:"\u0411\u0438\u043B\u0435\u0442\u044B"}),(t,e)=>(n(),v("div",Ce,[Pe,Ne,Qe,a(Z,{class:"card"},{default:l(()=>[_(h)?(n(),g(le,{key:0,indeterminate:"",color:"secondary"})):z("",!0),c("div",xe,[c("table",null,[c("tbody",null,[(n(!0),v(O,null,q(o.value.cells,(i,p)=>(n(),v("tr",{key:"row_"+p},[c("td",null,[c("div",Ae,s(o.value.structure.rowNums[p]||""),1)]),(n(!0),v(O,null,q(i,(y,ae)=>(n(),v("td",{key:p+"_"+ae},[(n(),g(be,{cell:o.value.cells[y.row-1][y.col-1],"onUpdate:cell":x=>o.value.cells[y.row-1][y.col-1]=x,ticket:R(y.id),key:y.id,onReserve:e[0]||(e[0]=x=>Q(x)),onReturnTicket:e[1]||(e[1]=x=>F(x))},null,8,["cell","onUpdate:cell","ticket"]))]))),128)),c("td",null,[c("div",$e,s(o.value.structure.rowNums[p]||""),1)])]))),128))])])])]),_:1}),o.value.tickets.length?(n(),v("div",He,[(n(!0),v(O,null,q(E.value,i=>(n(),g(Ie,{key:"tic_"+i.id,ticket:i,price:S(i),onReserve:e[2]||(e[2]=p=>Q(p))},null,8,["ticket","price"]))),128))])):z("",!0)]))}};var We=K(Ee,[["__scopeId","data-v-02de6679"]]);export{We as default};
