import{Q as j}from"./QTooltip.517e09cf.js";import{i as q,r as l,p as r,o as rt,m as u,E as m,f as a,q as o,x as v,F as P,n as f,t as g,B as _,l as p,ax as Q,G as z,v as C,D as it,Q as nt,C as F,bl as ut}from"./index.a5870079.js";import{Q as $}from"./QItemLabel.0d0b080b.js";import{a as O,Q as h}from"./QItem.3e6977f2.js";import{a as dt}from"./QExpansionItem.fed8d0fb.js";import{Q as W}from"./QImg.91ad1435.js";import{Q as ft}from"./QList.d74b0ab0.js";import{h as K,g as pt,n as b,i as ct}from"./myFuncts.53913e80.js";import{u as mt}from"./use-meta.cf01c1ff.js";import{u as vt}from"./use-quasar.0de5ef34.js";import{a as A}from"./axios.cfc20e25.js";import{_ as gt,a as _t,b as ht,c as yt,d as Dt}from"./AddPlayerDialog.4e0b1ab8.js";import{m as x}from"./myAuth.5621b016.js";import"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.8f324279.js";import{_ as kt}from"./plugin-vue_export-helper.21dcd24c.js";import{P as Pt}from"./PageShell.8957d69d.js";import"./position-engine.c3ef8083.js";import"./selection.d4ebb01f.js";import"./style.e0e28890.js";import"./format.de7e9769.js";import"./use-file.efeada9d.js";import"./get-emits-object.a3f16783.js";/* empty css               */import"./BtnDelete.29fef6b1.js";import"./QPopupProxy.ab70e35e.js";import"./use-render-cache.3aae9b27.js";import"./QMenu.9a7f8f26.js";import"./ClosePopup.1d6fe8a6.js";import"./QToolbar.ef33fd9e.js";import"./QScrollArea.764be9a4.js";import"./TouchPan.ae7b660f.js";import"./touch.9135741d.js";import"./QLinearProgress.ca807237.js";import"./MainFooter.22354635.js";import"./AnderHeader.b1044c1f.js";/* empty css                                                    */const Qt={class:"centralCol"},Ct={class:"gridArea"},St={key:0,class:"group"},wt={class:"cardTitle"},It={__name:"StaffPageTest",setup(Mt){const S=vt(),y=String("https://api.staff.sakh-orch.ru/"),H=q("editMode"),i=l(!1);r("staffEditMode",i);const c=l(!1);r("progress",c);const d=l([]);r("groups",d);const J=l(""),w=l(K(new Date).format("YYYY-MM-DD"));r("condDate",w);const N=l(!1);r("showUploader",N),r("pwUrl",J);const R=x.self.persId(),U=l(0);r("selectedPersId",U);const Y=l({});r("selectedPers",Y);const B=l(null);r("selectedGroup",B);const D=l([]);r("actionDates",D);const X=q("stopScrollWatch"),T=l([{id:1,name:"\u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043D\u0442 \u0434\u0438\u0440\u0438\u0436\u0435\u0440\u0430"},{id:2,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"},{id:3,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u0433\u0440\u0443\u043F\u043F\u044B"},{id:4,name:"\u041F\u043E\u043C\u043E\u0449\u043D\u0438\u043A \u043A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440\u0430"},{id:5,name:"\u0420\u0435\u0433\u0443\u043B\u044F\u0442\u043E\u0440"}]);r("statusNames",T);const E=l(!1);r("showStatusDialog",E);const V=l(!1);r("showAddPlayerDialog",V);const Z=l("\u0421\u043E\u0441\u0442\u0430\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"),G=pt(Z.value);mt(G);function I(e=!1){return c.value=!0,D.value=[],console.log("start loadActionDates"),A.post(y+"api/staff.php",{params:{method:"actionDates",force:e}}).then(t=>{var s,n;D.value=(n=(s=t==null?void 0:t.data)==null?void 0:s.data)!=null?n:[],console.log("end loadActionDates")}).catch(t=>{throw D.value=[],S.notify(b(t)),t}).finally(()=>{c.value=!1})}function M(){console.log("start loadData"),c.value=!0,A.post(y+"api/staff.php",{params:{method:"get",date:w.value}}).then(e=>{var t,s;X(),d.value=[],d.value=Object.values((s=(t=e==null?void 0:e.data)==null?void 0:t.data)!=null?s:[])}).catch(e=>{d.value=[],S.notify(b(e))}).finally(()=>{c.value=!1})}r("loadData",M);function L(){A.post(y+"/api/staff.php",{params:{method:"update",groups:d.value,date:w.value}}).then(e=>{I()}).catch(e=>{S.notify(b(e))})}function tt(e){!i.value&&R!==e||(U.value=e,N.value=!0)}function at(e){!i.value||(console.log(e),Y.value=e,E.value=!0)}function et(e){B.value=e,V.value=!0}function ot(e){return e?ct(y,e.md5,e.ext,50):"/img/avatars/init_ava.png"}return rt(()=>{I().then(()=>{M()}),console.log(K(new Date).format("YYYY-MM-DD"))}),(e,t)=>(u(),m(P,null,[a(Pt,{"page-title":v(G).title},{ToolPanel:o(()=>[v(x).self.isPermit([1,2])&&v(H)?(u(),f(_,{key:0,icon:"update",flat:"",stretch:"",onClick:t[0]||(t[0]=s=>I(!0))},{default:o(()=>[a(j,null,{default:o(()=>t[3]||(t[3]=[g("\u0416\u0435\u0441\u0442\u043A\u043E \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u0442\u044B")])),_:1})]),_:1})):p("",!0),v(x).self.isPermit([1,2,3])?(u(),f(_,{key:1,icon:"edit",flat:"",stretch:"",color:i.value?"red":"grey",onClick:t[1]||(t[1]=s=>i.value=!i.value)},{default:o(()=>[a(j,null,{default:o(()=>t[4]||(t[4]=[g("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u043E\u0441\u0442\u0430\u0432")])),_:1})]),_:1},8,["color"])):p("",!0),a(yt)]),PageContent:o(()=>[Q("div",Qt,[Q("div",Ct,[(u(!0),m(P,null,z(d.value,s=>(u(),m(P,{key:s.groupId},[i.value||s.groupId!==200?(u(),m("div",St,[a(ft,null,{default:o(()=>[a(O,{dense:""},{default:o(()=>[a(h,{avatar:""},{default:o(()=>[a($,null,{default:o(()=>[Q("span",wt,C(s.groupName),1)]),_:2},1024)]),_:2},1024),a(dt),i.value?(u(),f(h,{key:0,side:""},{default:o(()=>[a(_,{round:"",icon:"add",onClick:n=>et(s)},null,8,["onClick"])]),_:2},1024)):p("",!0)]),_:2},1024),a(it,{inset:""}),t[5]||(t[5]=Q("br",null,null,-1)),a(v(Dt),{list:s.Players,itemKey:"persId",disabled:!i.value,group:"people"},{item:o(({element:n})=>[a(O,{clickable:i.value},{default:o(()=>[a(h,{avatar:""},{default:o(()=>[a(nt,{size:"50px"},{default:o(()=>[a(W,{src:ot(n==null?void 0:n.avatar),alt:"img",onClick:F(k=>tt(n.persId),["stop","prevent"]),style:{height:"100%"}},{error:o(()=>[a(W,{style:{height:"100%"},src:"/img/avatars/init_ava.png",alt:"img"})]),_:2},1032,["src","onClick"])]),_:2},1024)]),_:2},1024),a(h,null,{default:o(()=>[a($,null,{default:o(()=>[g(C(n.name)+" "+C(n.lastName),1)]),_:2},1024),(u(!0),m(P,null,z(n.statuses,(k,st)=>(u(),f($,{key:`${st}_${k}`,caption:""},{default:o(()=>[g(C(T.value.find(lt=>lt.id===k).name),1)]),_:2},1024))),128))]),_:2},1024),i.value?(u(),f(h,{key:0,side:""},{default:o(()=>[a(_,{icon:"edit",stretch:"",size:"0.5em",flat:"",onClick:F(k=>at(n),["stop","prevent"])},null,8,["onClick"])]),_:2},1024)):p("",!0)]),_:2},1032,["clickable"])]),_:2},1032,["list","disabled"])]),_:2},1024)])):p("",!0)],64))),128))]),a(ut,{align:"right"},{default:o(()=>[i.value?(u(),f(_,{key:0,class:"goldBtn",onClick:L},{default:o(()=>t[6]||(t[6]=[g("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])),_:1})):p("",!0)]),_:1})])]),_:1},8,["page-title"]),a(gt,{onUpdated:t[2]||(t[2]=s=>M())}),a(_t),a(ht,{onOnPlayersAdd:L})],64))}};var fa=kt(It,[["__scopeId","data-v-41742f7b"]]);export{fa as default};
