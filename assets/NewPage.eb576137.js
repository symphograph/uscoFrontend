import{Q as j}from"./QImg.91cbb958.js";import{Q as te}from"./QVideo.429a9b24.js";import{u as ae}from"./use-meta.aada446e.js";import{u as J}from"./use-quasar.fa648407.js";import{api as E}from"./axios.a3c69ad0.js";import{aK as le,aL as oe,_ as ne,i as O,u as X,d as ie,r as S,f as d,g as u,J as s,h as i,aZ as C,A as n,a4 as k,z as _,B as L,F as x,au as z,a7 as de,j as U,av as D,aw as se,aY as re,aX as ue,c as w,a8 as ce,D as pe,E as me,p as fe,a as ve}from"./index.47be0674.js";import{a as M,b as q,Q as _e}from"./QItemSection.c242e017.js";import{Q as he}from"./QList.109bc5e6.js";import{Q as H}from"./QUploader.21b4bd1e.js";import{b as B,n as b}from"./myFuncts.24341304.js";import"./use-ratio.0e843f0c.js";import"./format.3e32b8d9.js";import"./get-emits-object.24798346.js";import"./jwt-decode.esm.74bd4619.js";function ye(v){const o=document.createElement("textarea");o.value=v,o.contentEditable="true",o.style.position="fixed";const a=()=>{};le(a),document.body.appendChild(o),o.focus(),o.select();const r=document.execCommand("copy");return o.remove(),oe(a),r}function ge(v){return navigator.clipboard!==void 0?navigator.clipboard.writeText(v):new Promise((o,a)=>{const r=ye(v);r?o(!0):a(r)})}const V=v=>(pe("data-v-7720f1b5"),v=v(),me(),v),ke={key:0,class:"newsarea"},we=V(()=>n("br",null,null,-1)),be={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},xe={class:"nimg_block",style:{position:"relative"}},Ve={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},$e={class:"inputArea"},Ie={class:"input"},Ce={id:"categs",class:"input"},Ee={id:"uploaderArea",class:"input"},Se={class:"uploaderArea"},Qe={id:"uploaderArea2",class:"input"},Ne={class:"uploaderArea"},Ue={class:"imagesArea"},Ae={class:"row no-wrap"},Te={style:{display:"flex","justify-content":"flex-end","grid-gap":"1em",padding:"1em"}},Fe=V(()=>n("br",null,null,-1)),Le=V(()=>n("br",null,null,-1)),je=V(()=>n("br",null,null,-1)),ze=V(()=>n("br",null,null,-1)),De=V(()=>n("br",null,null,-1)),Me=V(()=>n("br",null,null,-1)),Be={__name:"NewEditor",emits:["uploaded"],setup(v,{emit:o}){const a=O("newData"),r=String("https://api.sakh-orch.ru/"),m=J(),Q=X(),A=ie(),$=o,I=S(null),N=O("AccessToken"),c=S([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u0421\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]);function y(){var e,t;let l=m.platform.is.mobile?1080:260;return r+"/img/entry/sketch/"+l+"/entry_"+a.value.id+".jpg?ver="+((t=(e=a.value)==null?void 0:e.verString)!=null?t:"jhj")}function p(l){l="![]("+l+")",ge(l).then(()=>{m.notify({color:"positive",position:"center",message:"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E",icon:"content_copy",timeout:1})}).catch(()=>{})}function h(l,e){E.post(r+"api/news/photo.php",{params:{entryId:Q.params.id,fileName:l,method:"del"}}).then(t=>{var f,g,Y;if(!((f=t==null?void 0:t.data)!=null&&f.result))throw new Error;m.notify(B((Y=(g=t==null?void 0:t.data)==null?void 0:g.result)!=null?Y:"")),a.value.Images.splice(e,1),$("uploaded")}).catch(t=>{m.notify(b(t))})}function T(l){E.post(r+"api/news/sketch.php",{params:{method:"del",entryId:Q.params.id}}).then(e=>{$("uploaded")}).catch(e=>{m.notify(b(e))})}function F(){return{url:r+"api/news/sketch.php",headers:[{name:"ACCESSTOKEN",value:N.value}],formFields:[{name:"entryId",value:a.value.id},{name:"method",value:"add"}]}}function Z(){return{url:r+"api/news/photo.php",headers:[{name:"ACCESSTOKEN",value:N.value}],formFields:[{name:"entryId",value:a.value.id},{name:"method",value:"add"}]}}function P(l){m.notify(B("\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E")),$("uploaded"),I.value.reset()}function K(l){var t,f,g;let e=(g=(f=JSON.parse((t=l==null?void 0:l.xhr)==null?void 0:t.response))==null?void 0:f.error)!=null?g:"";m.notify(b(null,e))}function G(){const l=Object.keys(c.value);let e=[];return l.forEach(t=>{e[c.value[t].id]=c.value[t].checked}),e}function W(l=0){E.post(r+"api/news/entry.php",{params:{method:"update",entry:a.value,addNew:l,categs:G()}}).then(e=>{var t,f;m.notify(B((f=(t=e==null?void 0:e.data)==null?void 0:t.result)!=null?f:"")),$("uploaded")}).catch(e=>{m.notify(b(e))})}function ee(){E.post(r+"api/news/entry.php",{params:{method:"del",entryId:a.value.id}}).then(l=>{var e;if(!((e=l==null?void 0:l.data)!=null&&e.result))throw new Error;A.push({path:"/news/all"})}).catch(l=>{m.notify(b(l))})}function R(){E.post(r+"api/news/entry.php",{params:{method:a.value.isShow?"hide":"show",entryId:a.value.id}}).then(l=>{var e;if(!((e=l==null?void 0:l.data)!=null&&e.result))throw new Error;a.value.isShow=!a.value.isShow}).catch(l=>{m.notify(b(l))}).finally(()=>{})}return(l,e)=>(d(),u(x,null,[s(a)?(d(),u("div",ke,[i(C,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:s(a).title,"onUpdate:modelValue":e[0]||(e[0]=t=>s(a).title=t)},null,8,["modelValue"]),we,n("div",be,[n("div",xe,[i(j,{ratio:1920/1080,src:y(),fit:"fill"},null,8,["src"]),i(k,{size:"0.7em",round:"",color:"red",icon:"delete",style:{transform:"translateY(-50%)",right:"1em","z-index":"100",position:"absolute",top:"2em"},onClick:e[1]||(e[1]=t=>T(s(a).img))})]),n("div",Ve,[i(C,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",type:"textarea",modelValue:s(a).descr,"onUpdate:modelValue":e[2]||(e[2]=t=>s(a).descr=t),outlined:""},null,8,["modelValue"])])]),n("div",$e,[n("div",Ie,[i(C,{type:"date",modelValue:s(a).date,"onUpdate:modelValue":e[3]||(e[3]=t=>s(a).date=t),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),i(C,{modelValue:s(a).refName,"onUpdate:modelValue":e[4]||(e[4]=t=>s(a).refName=t),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),i(C,{modelValue:s(a).refLink,"onUpdate:modelValue":e[5]||(e[5]=t=>s(a).refLink=t),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},null,8,["modelValue"])]),n("div",Ce,[i(he,{bordered:"",padding:""},{default:_(()=>[i(M,{header:""},{default:_(()=>[L("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(d(!0),u(x,null,z(s(a).categs,t=>de((d(),U(_e,{key:t.id,tag:"label"},{default:_(()=>[i(q,null,{default:_(()=>[i(M,null,{default:_(()=>[L(D(t.label),1)]),_:2},1024),i(M,{caption:""},{default:_(()=>[L(D(t.caption),1)]),_:2},1024)]),_:2},1024),i(q,{side:"",top:""},{default:_(()=>[i(se,{color:"green",modelValue:t.checked,"onUpdate:modelValue":f=>t.checked=f,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[ce]])),128))]),_:1})]),n("div",Ee,[n("div",Se,[i(H,{label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437",factory:F,"max-file-size":"50000000",ref_key:"uploader",ref:I,onUploaded:P,onFailed:K,padding:"0",margin:"0",bordered:""},null,512)])]),n("div",Qe,[n("div",Ne,[i(H,{"input-style":"max-width: 300px; padding: 0",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",factory:Z,"max-file-size":"50000000",ref_key:"uploader",ref:I,onUploaded:P,onFailed:K,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)])])]),n("div",Ue,[(d(!0),u(x,null,z(s(a).Images,(t,f)=>(d(),U(ue,{key:f},{default:_(()=>[i(j,{ratio:96/54,src:s(r)+"/img/entry/photo/"+s(a).id+"/260/"+t},null,8,["src"]),i(re,null,{default:_(()=>[i(k,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{top:"0",right:"0.5em",transform:"translateY(-50%)"},onClick:g=>h(t,f)},null,8,["onClick"]),n("div",Ae,[i(k,{padding:"0.5em 1em",icon:"content_copy",label:"\u041A\u043E\u0434",onClick:g=>p(t)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),i(C,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:s(a).markdown,"onUpdate:modelValue":e[6]||(e[6]=t=>s(a).markdown=t),dense:""},null,8,["modelValue"]),n("div",Te,[i(k,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",color:"red",onClick:e[7]||(e[7]=t=>ee())}),s(a).isShow?(d(),U(k,{key:0,label:"\u0421\u043A\u0440\u044B\u0442\u044C",color:"orange",outline:"",onClick:e[8]||(e[8]=t=>R())})):(d(),U(k,{key:1,label:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C",color:"green",outline:"",onClick:e[9]||(e[9]=t=>R())})),i(k,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green",onClick:e[10]||(e[10]=t=>W(0))})]),Fe,Le,je,ze])):w("",!0),De,Me],64))}};var Oe=ne(Be,[["__scopeId","data-v-7720f1b5"]]);const Pe={key:0,class:"content"},Ke={key:1,class:"newsarea"},Re={class:"p_title"},Ye={class:"narea"},qe={class:"text"},He=["innerHTML"],Je={key:1},Xe={key:1,class:"newsImg"},Ze={key:2,class:"vitem"},Ge={key:0},We=["href"],et={key:1,class:"content"},tt=n("div",{class:"newsarea"},[n("div",{class:"narea"},[n("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),at=[tt],ht={__name:"NewPage",setup(v){S(0);const o=S(null);fe("newData",o);const a=J(),r=String("https://api.sakh-orch.ru/"),m=X(),Q=O("editMode"),A=S("\u041D\u043E\u0432\u043E\u0441\u0442\u044C"),$=S(!1);ae(()=>({title:A.value}));function I(c){return r+"/img/entry/photo/"+o.value.id+"/1080/"+c}function N(){E.post(r+"api/news/entry.php",{params:{method:"get",id:m.params.id}}).then(c=>{var y,p,h,T,F;if(!((y=c==null?void 0:c.data)!=null&&y.result))throw new Error;o.value=(h=(p=c==null?void 0:c.data)==null?void 0:p.data)!=null?h:null,A.value=(F=(T=o==null?void 0:o.value)==null?void 0:T.title)!=null?F:""}).catch(c=>{$.value=!0,a.notify(b(c))})}return ve(()=>{N()}),(c,y)=>o.value||s(Q)?(d(),u("div",Pe,[s(Q)&&o.value?(d(),U(Oe,{key:0,onUploaded:y[0]||(y[0]=p=>N())})):w("",!0),o.value?(d(),u("div",Ke,[n("div",Re,D(o.value.title),1),n("div",Ye,[n("div",qe,[(d(!0),u(x,null,z(o.value.parsedMD,(p,h)=>(d(),u(x,{key:h},[p.type==="text"?(d(),u(x,{key:0},[p.content!==`
`?(d(),u("section",{key:0,innerHTML:p.content},null,8,He)):(d(),u("br",Je))],64)):w("",!0),p.type==="img"?(d(),u("div",Xe,[i(j,{src:I(p.content),fit:"fill"},null,8,["src"])])):w("",!0),p.type==="video"?(d(),u("div",Ze,[i(te,{ratio:16/9,src:"https://www.youtube.com/embed/"+p.content},null,8,["src"])])):w("",!0)],64))),128)),o.value.refLink?(d(),u("div",Ge,[L("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "),n("a",{href:o.value.refLink,target:"_blank"},D(o.value.refName),9,We)])):w("",!0),(d(!0),u(x,null,z(o.value.unusedImages,(p,h)=>(d(),u("div",{class:"newsImg",key:h},[i(j,{src:I(p),fit:"fill"},null,8,["src"])]))),128))])])])):w("",!0)])):(d(),u("div",et,at))}};export{ht as default};
