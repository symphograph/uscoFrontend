import{Q as j}from"./QImg.0b9554ed.js";import{Q as ee}from"./QVideo.5879ed55.js";import{u as te}from"./use-meta.2ecba784.js";import{u as J}from"./use-quasar.b69da31b.js";import{api as C}from"./axios.ac8b4bf8.js";import{aK as ae,aL as le,_ as oe,i as O,u as X,d as ne,r as E,f as d,g as u,J as s,h as i,aZ as I,A as n,a4 as k,z as _,B as L,F as x,au as z,a7 as ie,j as U,av as D,aw as de,aY as se,aX as re,c as w,a8 as ue,D as ce,E as pe,p as me,a as fe}from"./index.98761dbe.js";import{a as M,b as q,Q as ve}from"./QItemSection.80a876c3.js";import{Q as _e}from"./QList.ece78673.js";import{Q as H}from"./QUploader.50a85080.js";import{b as B,n as b}from"./myFuncts.1e6ef4e3.js";import"./use-ratio.77e03928.js";import"./format.3e32b8d9.js";import"./get-emits-object.24798346.js";import"./jwt-decode.esm.74bd4619.js";function he(v){const l=document.createElement("textarea");l.value=v,l.contentEditable="true",l.style.position="fixed";const a=()=>{};ae(a),document.body.appendChild(l),l.focus(),l.select();const r=document.execCommand("copy");return l.remove(),le(a),r}function ye(v){return navigator.clipboard!==void 0?navigator.clipboard.writeText(v):new Promise((l,a)=>{const r=he(v);r?l(!0):a(r)})}const V=v=>(ce("data-v-7720f1b5"),v=v(),pe(),v),ge={key:0,class:"newsarea"},ke=V(()=>n("br",null,null,-1)),we={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},be={class:"nimg_block",style:{position:"relative"}},xe={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},Ve={class:"inputArea"},$e={class:"input"},Ie={id:"categs",class:"input"},Ce={id:"uploaderArea",class:"input"},Ee={class:"uploaderArea"},Se={id:"uploaderArea2",class:"input"},Qe={class:"uploaderArea"},Ne={class:"imagesArea"},Ue={class:"row no-wrap"},Ae={style:{display:"flex","justify-content":"flex-end","grid-gap":"1em",padding:"1em"}},Te=V(()=>n("br",null,null,-1)),Fe=V(()=>n("br",null,null,-1)),Le=V(()=>n("br",null,null,-1)),je=V(()=>n("br",null,null,-1)),ze=V(()=>n("br",null,null,-1)),De=V(()=>n("br",null,null,-1)),Me={__name:"NewEditor",emits:["uploaded"],setup(v,{emit:l}){const a=O("newData"),r=String("https://api.sakh-orch.ru/"),p=J(),S=X(),A=ne(),Q=E(null),N=O("AccessToken"),$=E([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u0421\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]);function m(){var e,t;let o=p.platform.is.mobile?1080:260;return r+"/img/entry/sketch/"+o+"/entry_"+a.value.id+".jpg?ver="+((t=(e=a.value)==null?void 0:e.verString)!=null?t:"jhj")}function y(o){o="![]("+o+")",ye(o).then(()=>{p.notify({color:"positive",position:"center",message:"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E",icon:"content_copy",timeout:1})}).catch(()=>{})}function c(o,e){C.post(r+"api/news/photo.php",{params:{entryId:S.params.id,fileName:o,method:"del"}}).then(t=>{var f,g,Y;if(!((f=t==null?void 0:t.data)!=null&&f.result))throw new Error;p.notify(B((Y=(g=t==null?void 0:t.data)==null?void 0:g.result)!=null?Y:"")),a.value.Images.splice(e,1),l("uploaded")}).catch(t=>{p.notify(b(t))})}function h(o){C.post(r+"api/news/sketch.php",{params:{method:"del",entryId:S.params.id}}).then(e=>{l("uploaded")}).catch(e=>{p.notify(b(e))})}function T(){return{url:r+"api/news/sketch.php",headers:[{name:"ACCESSTOKEN",value:N.value}],formFields:[{name:"entryId",value:a.value.id},{name:"method",value:"add"}]}}function F(){return{url:r+"api/news/photo.php",headers:[{name:"ACCESSTOKEN",value:N.value}],formFields:[{name:"entryId",value:a.value.id},{name:"method",value:"add"}]}}function P(o){p.notify(B("\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E")),l("uploaded"),Q.value.reset()}function K(o){var t,f,g;let e=(g=(f=JSON.parse((t=o==null?void 0:o.xhr)==null?void 0:t.response))==null?void 0:f.error)!=null?g:"";p.notify(b(null,e))}function Z(){const o=Object.keys($.value);let e=[];return o.forEach(t=>{e[$.value[t].id]=$.value[t].checked}),e}function G(o=0){C.post(r+"api/news/entry.php",{params:{method:"update",entry:a.value,addNew:o,categs:Z()}}).then(e=>{var t,f;p.notify(B((f=(t=e==null?void 0:e.data)==null?void 0:t.result)!=null?f:"")),l("uploaded")}).catch(e=>{p.notify(b(e))})}function W(){C.post(r+"api/news/entry.php",{params:{method:"del",entryId:a.value.id}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;A.push({path:"/news/all"})}).catch(o=>{p.notify(b(o))})}function R(){C.post(r+"api/news/entry.php",{params:{method:a.value.isShow?"hide":"show",entryId:a.value.id}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;a.value.isShow=!a.value.isShow}).catch(o=>{p.notify(b(o))}).finally(()=>{})}return(o,e)=>(d(),u(x,null,[s(a)?(d(),u("div",ge,[i(I,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:s(a).title,"onUpdate:modelValue":e[0]||(e[0]=t=>s(a).title=t)},null,8,["modelValue"]),ke,n("div",we,[n("div",be,[i(j,{ratio:1920/1080,src:m(),fit:"fill"},null,8,["src"]),i(k,{size:"0.7em",round:"",color:"red",icon:"delete",style:{transform:"translateY(-50%)",right:"1em","z-index":"100",position:"absolute",top:"2em"},onClick:e[1]||(e[1]=t=>h(s(a).img))})]),n("div",xe,[i(I,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",type:"textarea",modelValue:s(a).descr,"onUpdate:modelValue":e[2]||(e[2]=t=>s(a).descr=t),outlined:""},null,8,["modelValue"])])]),n("div",Ve,[n("div",$e,[i(I,{type:"date",modelValue:s(a).date,"onUpdate:modelValue":e[3]||(e[3]=t=>s(a).date=t),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),i(I,{modelValue:s(a).refName,"onUpdate:modelValue":e[4]||(e[4]=t=>s(a).refName=t),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),i(I,{modelValue:s(a).refLink,"onUpdate:modelValue":e[5]||(e[5]=t=>s(a).refLink=t),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},null,8,["modelValue"])]),n("div",Ie,[i(_e,{bordered:"",padding:""},{default:_(()=>[i(M,{header:""},{default:_(()=>[L("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(d(!0),u(x,null,z(s(a).categs,t=>ie((d(),U(ve,{key:t.id,tag:"label"},{default:_(()=>[i(q,null,{default:_(()=>[i(M,null,{default:_(()=>[L(D(t.label),1)]),_:2},1024),i(M,{caption:""},{default:_(()=>[L(D(t.caption),1)]),_:2},1024)]),_:2},1024),i(q,{side:"",top:""},{default:_(()=>[i(de,{color:"green",modelValue:t.checked,"onUpdate:modelValue":f=>t.checked=f,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[ue]])),128))]),_:1})]),n("div",Ce,[n("div",Ee,[i(H,{label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437",factory:T,"max-file-size":"50000000",ref_key:"uploader",ref:Q,onUploaded:P,onFailed:K,padding:"0",margin:"0",bordered:""},null,512)])]),n("div",Se,[n("div",Qe,[i(H,{"input-style":"max-width: 300px; padding: 0",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",factory:F,"max-file-size":"50000000",ref_key:"uploader",ref:Q,onUploaded:P,onFailed:K,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)])])]),n("div",Ne,[(d(!0),u(x,null,z(s(a).Images,(t,f)=>(d(),U(re,{key:f},{default:_(()=>[i(j,{ratio:96/54,src:s(r)+"/img/entry/photo/"+s(a).id+"/260/"+t},null,8,["src"]),i(se,null,{default:_(()=>[i(k,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{top:"0",right:"0.5em",transform:"translateY(-50%)"},onClick:g=>c(t,f)},null,8,["onClick"]),n("div",Ue,[i(k,{padding:"0.5em 1em",icon:"content_copy",label:"\u041A\u043E\u0434",onClick:g=>y(t)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),i(I,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:s(a).markdown,"onUpdate:modelValue":e[6]||(e[6]=t=>s(a).markdown=t),dense:""},null,8,["modelValue"]),n("div",Ae,[i(k,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",color:"red",onClick:e[7]||(e[7]=t=>W())}),s(a).isShow?(d(),U(k,{key:0,label:"\u0421\u043A\u0440\u044B\u0442\u044C",color:"orange",outline:"",onClick:e[8]||(e[8]=t=>R())})):(d(),U(k,{key:1,label:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C",color:"green",outline:"",onClick:e[9]||(e[9]=t=>R())})),i(k,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green",onClick:e[10]||(e[10]=t=>G(0))})]),Te,Fe,Le,je])):w("",!0),ze,De],64))}};var Be=oe(Me,[["__scopeId","data-v-7720f1b5"]]);const Oe={key:0,class:"content"},Pe={key:1,class:"newsarea"},Ke={class:"p_title"},Re={class:"narea"},Ye={class:"text"},qe=["innerHTML"],He={key:1},Je={key:1,class:"newsImg"},Xe={key:2,class:"vitem"},Ze={key:0},Ge=["href"],We={key:1,class:"content"},et=n("div",{class:"newsarea"},[n("div",{class:"narea"},[n("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),tt=[et],_t={__name:"NewPage",setup(v){E(0);const l=E(null);me("newData",l);const a=J(),r=String("https://api.sakh-orch.ru/"),p=X(),S=O("editMode"),A=E("\u041D\u043E\u0432\u043E\u0441\u0442\u044C"),Q=E(!1);te(()=>({title:A.value}));function N(m){return r+"/img/entry/photo/"+l.value.id+"/1080/"+m}function $(){C.post(r+"api/news/entry.php",{params:{method:"get",id:p.params.id}}).then(m=>{var y,c,h,T,F;if(!((y=m==null?void 0:m.data)!=null&&y.result))throw new Error;l.value=(h=(c=m==null?void 0:m.data)==null?void 0:c.data)!=null?h:null,A.value=(F=(T=l==null?void 0:l.value)==null?void 0:T.title)!=null?F:""}).catch(m=>{Q.value=!0,a.notify(b(m))})}return fe(()=>{$()}),(m,y)=>l.value||s(S)?(d(),u("div",Oe,[s(S)&&l.value?(d(),U(Be,{key:0,onUploaded:y[0]||(y[0]=c=>$())})):w("",!0),l.value?(d(),u("div",Pe,[n("div",Ke,D(l.value.title),1),n("div",Re,[n("div",Ye,[(d(!0),u(x,null,z(l.value.parsedMD,(c,h)=>(d(),u(x,{key:h},[c.type==="text"?(d(),u(x,{key:0},[c.content!==`
`?(d(),u("section",{key:0,innerHTML:c.content},null,8,qe)):(d(),u("br",He))],64)):w("",!0),c.type==="img"?(d(),u("div",Je,[i(j,{src:N(c.content),fit:"fill"},null,8,["src"])])):w("",!0),c.type==="video"?(d(),u("div",Xe,[i(ee,{ratio:16/9,src:"https://www.youtube.com/embed/"+c.content},null,8,["src"])])):w("",!0)],64))),128)),l.value.refLink?(d(),u("div",Ze,[L("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "),n("a",{href:l.value.refLink,target:"_blank"},D(l.value.refName),9,Ge)])):w("",!0),(d(!0),u(x,null,z(l.value.unusedImages,(c,h)=>(d(),u("div",{class:"newsImg",key:h},[i(j,{src:N(c),fit:"fill"},null,8,["src"])]))),128))])])])):w("",!0)])):(d(),u("div",We,tt))}};export{_t as default};
