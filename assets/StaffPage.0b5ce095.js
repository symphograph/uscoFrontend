import{Q as sa}from"./QTooltip.b7287151.js";import{i as L,p as l,r,o as oa,m as n,E as m,f as a,q as e,x as u,F as k,n as p,t as D,B as P,l as v,ax as _,G as q,v as Q,D as la,Q as ra,C as z,bm as ia}from"./index.52314c0a.js";import{Q as $}from"./QItemLabel.1623a9a2.js";import{b as F,Q as g,a as O}from"./QImg.596a2b33.js";import{c as na}from"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.fe28985f.js";import{Q as da}from"./QList.5ebcd5b3.js";import{j as ua,g as ca,n as N}from"./myFuncts.671597d2.js";import{u as fa}from"./use-meta.bb1668c8.js";import{u as pa}from"./use-quasar.c9b9d459.js";import{a as x}from"./axios.7c1287c1.js";import{_ as ma,a as va,b as _a,c as ga,d as ha}from"./AddPlayerDialog.12921d82.js";import{m as A}from"./myAuth.5621b016.js";import{P as ya}from"./PageShell.74f1b758.js";import{_ as ka}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.2cf59900.js";import"./selection.0aa390e5.js";import"./touch.9135741d.js";import"./style.8821cec0.js";import"./format.de7e9769.js";import"./use-file.31d6e56b.js";import"./get-emits-object.a3f16783.js";/* empty css               */import"./BtnDelete.e0975511.js";import"./QPopupProxy.741dd5fa.js";import"./use-render-cache.3aae9b27.js";import"./QMenu.e39235f4.js";import"./ClosePopup.b7ff2684.js";import"./AnderHeader.vue_vue_type_style_index_0_lang.956c3b84.js";import"./QScrollArea.546a57de.js";import"./QLinearProgress.1ce87716.js";const Da={class:"centralCol"},Pa={class:"gridArea"},Qa={key:0,class:"group"},Ca={class:"cardTitle"},Sa={class:"lastName"},wa={__name:"StaffPage",setup(Ia){const C=pa(),S=String("https://api.staff.sakh-orch.ru/"),d=L("staffEditMode");l("editMode",d);const c=r(!1);l("progress",c);const f=r([]);l("groups",f);const W=r(""),w=r(ua(new Date).format("YYYY-MM-DD"));l("condDate",w);const M=r(!1);l("showUploader",M),l("pwUrl",W);const K=A.self.persId(),B=r(0);l("selectedPersId",B);const U=r({});l("selectedPers",U);const E=r(null);l("selectedGroup",E);const h=r([]);l("actionDates",h);const H=L("stopScrollWatch"),V=r([{id:1,name:"\u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043D\u0442 \u0434\u0438\u0440\u0438\u0436\u0435\u0440\u0430"},{id:2,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"},{id:3,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u0433\u0440\u0443\u043F\u043F\u044B"},{id:4,name:"\u041F\u043E\u043C\u043E\u0449\u043D\u0438\u043A \u043A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440\u0430"},{id:5,name:"\u0420\u0435\u0433\u0443\u043B\u044F\u0442\u043E\u0440"}]);l("statusNames",V);const T=r(!1);l("showStatusDialog",T);const Y=r(!1);l("showAddPlayerDialog",Y);const J=r("\u0421\u043E\u0441\u0442\u0430\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"),j=ca(J.value);fa(j);function I(s=!1){return c.value=!0,h.value=[],x.post(S+"api/staff.php",{params:{method:"actionDates",force:s}}).then(t=>{var o,i;h.value=(i=(o=t==null?void 0:t.data)==null?void 0:o.data)!=null?i:[]}).catch(t=>{throw h.value=[],C.notify(N(t)),t}).finally(()=>{c.value=!1})}function b(){console.log("start loadData"),c.value=!0,x.post(S+"api/staff.php",{params:{method:"get",date:w.value}}).then(s=>{var t,o;H(),f.value=[],f.value=Object.values((o=(t=s==null?void 0:s.data)==null?void 0:t.data)!=null?o:[])}).catch(s=>{f.value=[],C.notify(N(s))}).finally(()=>{c.value=!1})}l("loadData",b);function G(){c.value=!0,x.post(S+"/api/staff.php",{params:{method:"update",groups:f.value,date:w.value}}).then(s=>{I()}).catch(s=>{C.notify(N(s))}).finally(()=>{c.value=!1})}function R(s){!A.self.isPermit([1,2])||!d.value&&K!==s||(B.value=s,M.value=!0)}function X(s){!d.value||(U.value=s,T.value=!0)}function Z(s){E.value=s,Y.value=!0}function aa(s){return"/img/avatars/init_ava.png"}return oa(()=>{I().then(()=>{b()})}),(s,t)=>(n(),m(k,null,[a(ya,{"page-title":u(j).title},{ToolPanel:e(()=>[u(A).self.isPermit([1,2])&&u(d)?(n(),p(P,{key:0,icon:"update",flat:"",stretch:"",onClick:t[0]||(t[0]=o=>I(!0))},{default:e(()=>[a(sa,null,{default:e(()=>t[2]||(t[2]=[D("\u0416\u0435\u0441\u0442\u043A\u043E \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u0442\u044B")])),_:1})]),_:1})):v("",!0),a(ga)]),PageContent:e(()=>[_("div",Da,[_("div",Pa,[(n(!0),m(k,null,q(f.value,o=>(n(),m(k,{key:o.groupId},[u(d)||o.Players.length&&o.groupId!==200?(n(),m("div",Qa,[a(da,null,{default:e(()=>[a(F,{dense:""},{default:e(()=>[a(g,{avatar:""},{default:e(()=>[a($,null,{default:e(()=>[_("span",Ca,Q(o.groupName),1)]),_:2},1024)]),_:2},1024),a(na),u(d)?(n(),p(g,{key:0,side:""},{default:e(()=>[a(P,{round:"",icon:"add",onClick:i=>Z(o)},null,8,["onClick"])]),_:2},1024)):v("",!0)]),_:2},1024),a(la,{inset:""}),t[3]||(t[3]=_("br",null,null,-1)),a(u(ha),{list:o.Players,itemKey:"persId",disabled:!u(d),group:"people"},{item:e(({element:i})=>[a(F,{clickable:u(d)},{default:e(()=>[(n(),p(g,{key:0,avatar:""},{default:e(()=>[a(ra,{size:"50px"},{default:e(()=>[a(O,{src:aa(i==null?void 0:i.avatar),alt:"img",onClick:z(y=>R(i.persId),["stop","prevent"]),style:{height:"100%"}},{error:e(()=>[a(O,{style:{height:"100%"},src:"/img/avatars/init_ava.png",alt:"img"})]),_:2},1032,["src","onClick"])]),_:2},1024)]),_:2},1024)),a(g,null,{default:e(()=>[a($,null,{default:e(()=>[D(Q(i.name)+" ",1),_("span",Sa,Q(i.lastName),1)]),_:2},1024),(n(!0),m(k,null,q(i.statuses,(y,ta)=>(n(),p($,{key:`${ta}_${y}`,caption:""},{default:e(()=>[D(Q(V.value.find(ea=>ea.id===y).name),1)]),_:2},1024))),128))]),_:2},1024),u(d)?(n(),p(g,{key:1,side:"",onClick:z(y=>X(i),["prevent","stop"])},{default:e(()=>[a(P,{icon:"edit",stretch:"",size:"1em",flat:""})]),_:2},1032,["onClick"])):v("",!0)]),_:2},1032,["clickable"])]),_:2},1032,["list","disabled"])]),_:2},1024)])):v("",!0)],64))),128))]),a(ia,{align:"right"},{default:e(()=>[u(d)?(n(),p(P,{key:0,class:"goldBtn",onClick:G,loading:c.value},{default:e(()=>t[4]||(t[4]=[D("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])),_:1},8,["loading"])):v("",!0)]),_:1})])]),_:1},8,["page-title"]),a(ma,{onUpdated:t[1]||(t[1]=o=>b())}),a(va),a(_a,{onOnPlayersAdd:G})],64))}};var ot=ka(wa,[["__scopeId","data-v-34d11cd8"]]);export{ot as default};
