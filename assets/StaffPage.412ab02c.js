import{Q as st}from"./QTooltip.1fff9ced.js";import{i as q,p as l,r,o as ot,m as n,D as m,f as t,q as e,v as u,F as k,n as f,t as D,A as P,l as v,ax as _,E as z,u as Q,C as lt,Q as rt,B as F,bm as it}from"./index.0397f575.js";import{Q as M}from"./QItemLabel.a10d727b.js";import{b as G,Q as g,a as O}from"./QImg.ed2e8a35.js";import{d as nt}from"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.cdb5b0a7.js";import{Q as dt}from"./QList.ec27c126.js";import{j as ut,g as ct,n as $}from"./myFuncts.4c1c0a46.js";import{u as pt}from"./use-meta.64659eb5.js";import{u as ft}from"./use-quasar.e3a3eea5.js";import{a as A}from"./axios.4457879b.js";import{_ as mt,a as vt,b as _t,c as gt,d as ht}from"./AddPlayerDialog.0728a873.js";import{m as N}from"./myAuth.5621b016.js";import{P as yt}from"./PageShell.7c45db9f.js";import{_ as kt}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.a50f21d0.js";import"./selection.ab5a7a92.js";import"./touch.9135741d.js";import"./style.42b5d7f2.js";import"./format.de7e9769.js";import"./use-file.0386bb48.js";import"./get-emits-object.a3f16783.js";/* empty css               */import"./BtnDelete.223bae22.js";import"./QPopupProxy.0d3bef59.js";import"./use-render-cache.3aae9b27.js";import"./QMenu.a86e8c95.js";import"./ClosePopup.92b227e9.js";import"./QScrollArea.a21302d6.js";import"./QLinearProgress.6d0c67fe.js";/* empty css                                                    */const Dt={class:"centralCol"},Pt={class:"gridArea"},Qt={key:0,class:"group"},Ct={class:"cardTitle"},St={class:"lastName"},bt={__name:"StaffPage",setup(wt){const C=ft(),S=String("https://sakh-orch.ru/stapi/"),d=q("editModes").staff;l("editMode",d);const c=r(!1);l("progress",c);const p=r([]);l("groups",p);const W=r(""),b=r(ut(new Date).format("YYYY-MM-DD"));l("condDate",b);const x=r(!1);l("showUploader",x),l("pwUrl",W);const K=N.self.persId(),B=r(0);l("selectedPersId",B);const U=r({});l("selectedPers",U);const V=r(null);l("selectedGroup",V);const h=r([]);l("actionDates",h);const H=q("stopScrollWatch"),E=r([{id:1,name:"\u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043D\u0442 \u0434\u0438\u0440\u0438\u0436\u0435\u0440\u0430"},{id:2,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"},{id:3,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u0433\u0440\u0443\u043F\u043F\u044B"},{id:4,name:"\u041F\u043E\u043C\u043E\u0449\u043D\u0438\u043A \u043A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440\u0430"},{id:5,name:"\u0420\u0435\u0433\u0443\u043B\u044F\u0442\u043E\u0440"}]);l("statusNames",E);const T=r(!1);l("showStatusDialog",T);const Y=r(!1);l("showAddPlayerDialog",Y);const J=r("\u0421\u043E\u0441\u0442\u0430\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"),j=ct(J.value);pt(j);function w(s=!1){return c.value=!0,h.value=[],A.post(S+"epoint/staff.php",{params:{method:"actionDates",force:s}}).then(a=>{var o,i;h.value=(i=(o=a==null?void 0:a.data)==null?void 0:o.data)!=null?i:[]}).catch(a=>{throw h.value=[],C.notify($(a)),a}).finally(()=>{c.value=!1})}function I(){console.log("start loadData"),c.value=!0,A.post(S+"epoint/staff.php",{params:{method:"get",date:b.value}}).then(s=>{var a,o;H(),p.value=[],p.value=Object.values((o=(a=s==null?void 0:s.data)==null?void 0:a.data)!=null?o:[])}).catch(s=>{p.value=[],C.notify($(s))}).finally(()=>{c.value=!1})}l("loadData",I);function L(){c.value=!0,A.post(S+"epoint/staff.php",{params:{method:"update",groups:p.value,date:b.value}}).then(s=>{w()}).catch(s=>{C.notify($(s))}).finally(()=>{c.value=!1})}function R(s){!N.self.isPermit([1,2])||!d.value&&K!==s||(B.value=s,x.value=!0)}function X(s){!d.value||(U.value=s,T.value=!0)}function Z(s){V.value=s,Y.value=!0}function tt(s){return"/img/avatars/init_ava.png"}return ot(()=>{w().then(()=>{I()})}),(s,a)=>(n(),m(k,null,[t(yt,{"page-title":u(j).title},{ToolPanel:e(()=>[u(N).self.isPermit([1,2])&&u(d)?(n(),f(P,{key:0,icon:"update",flat:"",stretch:"",onClick:a[0]||(a[0]=o=>w(!0))},{default:e(()=>[t(st,null,{default:e(()=>a[2]||(a[2]=[D("\u0416\u0435\u0441\u0442\u043A\u043E \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u0442\u044B")])),_:1})]),_:1})):v("",!0),t(gt)]),PageContent:e(()=>[_("div",Dt,[_("div",Pt,[(n(!0),m(k,null,z(p.value,o=>(n(),m(k,{key:o.groupId},[u(d)||o.Players.length&&o.groupId!==200?(n(),m("div",Qt,[t(dt,null,{default:e(()=>[t(G,{dense:""},{default:e(()=>[t(g,{avatar:""},{default:e(()=>[t(M,null,{default:e(()=>[_("span",Ct,Q(o.groupName),1)]),_:2},1024)]),_:2},1024),t(nt),u(d)?(n(),f(g,{key:0,side:""},{default:e(()=>[t(P,{round:"",icon:"add",onClick:i=>Z(o)},null,8,["onClick"])]),_:2},1024)):v("",!0)]),_:2},1024),t(lt,{inset:""}),a[3]||(a[3]=_("br",null,null,-1)),t(u(ht),{list:o.Players,itemKey:"persId",disabled:!u(d),group:"people"},{item:e(({element:i})=>[t(G,{clickable:u(d)},{default:e(()=>[(n(),f(g,{key:0,avatar:""},{default:e(()=>[t(rt,{size:"50px"},{default:e(()=>[t(O,{src:tt(i==null?void 0:i.avatar),alt:"img",onClick:F(y=>R(i.persId),["stop","prevent"]),style:{height:"100%"}},{error:e(()=>[t(O,{style:{height:"100%"},src:"/img/avatars/init_ava.png",alt:"img"})]),_:2},1032,["src","onClick"])]),_:2},1024)]),_:2},1024)),t(g,null,{default:e(()=>[t(M,null,{default:e(()=>[D(Q(i.name)+" ",1),_("span",St,Q(i.lastName),1)]),_:2},1024),(n(!0),m(k,null,z(i.statuses,(y,at)=>(n(),f(M,{key:`${at}_${y}`,caption:""},{default:e(()=>[D(Q(E.value.find(et=>et.id===y).name),1)]),_:2},1024))),128))]),_:2},1024),u(d)?(n(),f(g,{key:1,side:"",onClick:F(y=>X(i),["stop","prevent"])},{default:e(()=>[t(P,{icon:"edit",stretch:"",size:"1em",flat:""})]),_:2},1032,["onClick"])):v("",!0)]),_:2},1032,["clickable"])]),_:2},1032,["list","disabled"])]),_:2},1024)])):v("",!0)],64))),128))]),t(it,{align:"right"},{default:e(()=>[u(d)?(n(),f(P,{key:0,class:"goldBtn",onClick:L,loading:c.value},{default:e(()=>a[4]||(a[4]=[D("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])),_:1},8,["loading"])):v("",!0)]),_:1})])]),_:1},8,["page-title"]),t(mt,{onUpdated:a[1]||(a[1]=o=>I())}),t(vt),t(_t,{onOnPlayersAdd:L})],64))}};var la=kt(bt,[["__scopeId","data-v-64c11b92"]]);export{la as default};
