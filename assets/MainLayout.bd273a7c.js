import{P as I}from"./LocalStorage.43206d44.js";import{u as E}from"./use-quasar.692c4e2e.js";import{a as C}from"./axios.2f222f0a.js";import{n as H,d as K}from"./myFuncts.080b71d0.js";import{m as f}from"./myAuth.5621b016.js";import{H as $}from"./hall.c32c95b1.js";import{i as D,r as s,p as u,k as N,o as U,l as B,m as _,n as Q,q as a,f as o,Q as X,t as b,u as Y,v as S,x as Z,y as q,z as F,A as tt,B as et,C as ot,D as R,F as W,E as at,b as nt,G as st,H as lt,I as it,w as rt,J as ut}from"./index.16a1d53f.js";import{u as ct}from"./use-meta.8256d130.js";import{Q as L}from"./QItemLabel.ff6efd8a.js";import{Q as k,a as dt,b as V}from"./QImg.72472eb0.js";/* empty css               */import{_ as ft}from"./plugin-vue_export-helper.21dcd24c.js";const T="SessionToken",w="AccessToken",mt={__name:"AuthComponent",setup(v){const i=E(),A=D("isOptionsLoaded"),r=D("admin");async function g(){console.log("loadOptions started");const t=await $.getList(i);$.List=s(t),$.List.value.length?(A.value=!0,console.log("options Loaded")):console.error("Halls is empty")}const y=s(""),M=s("");function e(t,n,c="90d"){i.cookies.set(t,n,{expires:c,path:"/",domain:null,sameSite:"Strict",secure:!0,httpOnly:!1}),t===w&&(C.defaults.headers.common.AccessToken=n,y.value=n,f.self.AccessToken=n),t===T&&(M.value=n,f.self.SessionToken=n)}function l(){C.post(String("https://sakh-orch.ru/auth/")+"epoint/register.php",{params:{method:"register",authType:"default"}}).then(t=>{var n,c,p,d,h;if(!((n=t==null?void 0:t.data)!=null&&n.result))throw new Error;e(w,(p=(c=t==null?void 0:t.data)==null?void 0:c.data.AccessToken)!=null?p:""),e(T,(h=(d=t==null?void 0:t.data)==null?void 0:d.data.SessionToken)!=null?h:""),g()}).catch(t=>{i.notify(H(t))})}u("register",l);function x(){C.post(String("https://sakh-orch.ru/auth/")+"epoint/refresh.php",{params:{method:"refresh",SessionToken:f.self.SessionToken,AccessToken:f.self.AccessToken}}).then(t=>{var n,c,p,d,h;if(!((n=t==null?void 0:t.data)!=null&&n.result))throw new Error;e(T,(p=(c=t==null?void 0:t.data)==null?void 0:c.data.SessionToken)!=null?p:""),e(w,(h=(d=t==null?void 0:t.data)==null?void 0:d.data.AccessToken)!=null?h:""),r.value=f.self.isPermit([4]),g()}).catch(t=>{var n;if(((n=t==null?void 0:t.response)==null?void 0:n.status)===401){l();return}i.notify(H(t))})}return u("refreshAccessToken",x),N(()=>{console.log("auth beforeMounted"),C.defaults.headers.common.Accept="application/json",f.self=new f}),U(()=>{console.log("auth Mounted"),!i.cookies.getAll()[w]||!i.cookies.getAll()[T]?l():(e(T,i.cookies.getAll()[T]),e(w,i.cookies.getAll()[w]),x())}),(t,n)=>B("",!0)}},gt={__name:"DynamicFormItem",props:{btnLabel:String,icon:String,url:String},setup(v){E();const i=v;return(A,r)=>(_(),Q(V,{clickable:"",onClick:r[0]||(r[0]=g=>S(K)(v.url,{AccessToken:S(f).self.AccessToken,SessionToken:S(f).self.SessionToken}))},{default:a(()=>[o(k,{avatar:""},{default:a(()=>[o(X,null,{default:a(()=>[o(dt,{src:v.icon},null,8,["src"])]),_:1})]),_:1}),o(k,null,{default:a(()=>[o(L,{caption:""},{default:a(()=>r[1]||(r[1]=[b("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),o(L,null,{default:a(()=>[b(Y(i.btnLabel),1)]),_:1})]),_:1})]),_:1}))}};const pt={__name:"LoginDialog",setup(v){const i=D("authTypes"),A=String("https://sakh-orch.ru/auth/"),r=D("showLoginDialog"),g=D("leftDrawerOpen");function y(){g.value=!1}return(M,e)=>(_(),Q(st,{modelValue:S(r),"onUpdate:modelValue":e[3]||(e[3]=l=>nt(r)?r.value=l:null),onHide:e[4]||(e[4]=l=>y())},{default:a(()=>[o(Z,{class:"dialogArea",style:{color:"var(--dTitle)"}},{default:a(()=>[o(q,null,{default:a(()=>[o(V,{dense:""},{default:a(()=>[o(k,null,{default:a(()=>[o(L,{lines:"1",class:"cardTitle"},{default:a(()=>[o(F,{name:"lock"}),e[5]||(e[5]=b("\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0439 \u0432\u0445\u043E\u0434"))]),_:1})]),_:1}),o(k,{side:""},{default:a(()=>[o(tt,{round:"",flat:"",icon:"close",onMouseover:e[0]||(e[0]=()=>console.log("kjk")),onClick:e[1]||(e[1]=et(l=>r.value=!1,["stop","prevent"]))})]),_:1})]),_:1}),o(ot),o(V,null,{default:a(()=>[o(k,null,{default:a(()=>[o(L,null,{default:a(()=>e[6]||(e[6]=[b(" \u041F\u0440\u0435\u0434\u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D \u0434\u043B\u044F \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u043E\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430 ")])),_:1})]),_:1})]),_:1}),o(V,{clickable:"",to:"/vacancies",onClick:e[2]||(e[2]=l=>r.value=!1)},{default:a(()=>[o(k,null,{default:a(()=>[o(L,{caption:""},{default:a(()=>e[7]||(e[7]=[b(" \u0415\u0441\u043B\u0438 \u0412\u044B \u043D\u0435 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430, \u0442\u043E \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442\u0435 \u043A \u043D\u0430\u043C \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C. ")])),_:1}),o(L,{caption:""},{default:a(()=>e[8]||(e[8]=[b(" \u0423 \u043D\u0430\u0441 \u0441\u0435\u0439\u0447\u0430\u0441 \u0435\u0441\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0438\u043D\u0442\u0435\u0440\u0435\u0441\u043D\u044B\u0445 \u0432\u0430\u043A\u0430\u043D\u0441\u0438\u0439.\u{1F603} ")])),_:1})]),_:1}),o(k,{side:""},{default:a(()=>[o(F,{name:"open_in_new"})]),_:1})]),_:1})]),_:1}),o(q,null,{default:a(()=>[(_(!0),R(W,null,at(S(i),l=>(_(),Q(gt,{key:l.id,btnLabel:l.label,icon:l.img,url:S(A)+l.url},null,8,["btnLabel","icon","url"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var ht=ft(pt,[["__scopeId","data-v-761e7acf"]]);const Qt={__name:"MainLayout",setup(v){const i=lt();ct({meta:{viewport:{name:"viewport",content:"initial-scale=1, width=device-width, user-scalable=yes"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}});const r=E(),g=String("https://sakh-orch.ru/api/"),y=it(),M=s(),e=s([{id:2,label:"\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C",url:"login/telegram/login.php",img:"/img/auth/telegram.svg"},{id:3,label:"MailRu",url:"login/mailru/login.php",img:"/img/auth/mailru.svg"},{id:4,label:"Discord",url:"login/discord/login.php",img:"/img/auth/discord.svg"},{id:4,label:"V\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435",url:"login/vkontakte/login.php",img:"/img/auth/vkontakte.svg"}]);u("authTypes",e);const l=s(!1);u("progress",l);const x={entry:s(!1),announce:s(!1),doc:s(!1),staff:s(!1),libVideo:s(!1)};u("editModes",x);const t=s(!1);u("admin",t);const n=s(!1);u("leftDrawerOpen",n);const c=s(!1);u("isOptionsLoaded",c);const p=s(!1);u("showLoginDialog",p);const d=s(!0);u("scrollWatch",d);const h=s(0);u("scrollPos",h),rt(y,m=>{I.set("lastPath",m.path)});function j(){I.set("CookieConfirm","1")}function z(){I.getItem("CookieConfirm")||r.notify({message:"\u041C\u044B \u0442\u043E\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C Cookies. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0431\u0435\u0437 \u043D\u0438\u0445 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442.",color:"primary",timeout:0,multiLine:!0,onDismiss:j,icon:"ion-information-circle-outline",actions:[{label:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E",color:"yellow",handler:()=>{}}]})}function G(m=500){d.value=!1,setTimeout(()=>{d.value=!0},m)}u("stopScrollWatch",G);function J(){C.post(g+"debug/debug.php",{params:{method:"isDebugIp",client:"usso"}}).then(m=>{var P,O;if(!((O=(P=m==null?void 0:m.data)==null?void 0:P.data)!=null&&O.is))throw new Error}).catch(()=>{i.push({path:"/maintenance"})})}return N(()=>{J(),console.log("mainLayout beforeMount"),document.body.style.backgroun="none"}),U(()=>{I.set("lastPath",y.path),console.log("mainLayout Mounted"),z()}),(m,P)=>{const O=ut("router-view");return _(),R(W,null,[o(mt,{ref_key:"refAuth",ref:M},null,512),c.value?(_(),Q(O,{key:0})):B("",!0),c.value?(_(),Q(ht,{key:1})):B("",!0)],64)}}};export{Qt as default};
