import{Q as ce}from"./QVideo.d04bd32b.js";import{K as me,ap as pe,a6 as he,ar as fe,az as ve,c as H,h as R,aD as _e,g as ye,aH as ke,u as Z,i as z,r as E,w as ge,a as we,n as i,q as f,H as s,f as l,V as r,t as I,G as p,bk as xe,a9 as T,U as B,l as g,aZ as oe,F as C,aw as W,aY as ne,aX as be,p as L,o as de,bh as q,ay as ie,ac as Pe,ax as K,W as J,ad as $e,I as Ie,J as Se,S as Ve}from"./index.6dad6fb5.js";import{b as G,Q as F,a as j}from"./QItemLabel.549ab149.js";import{u as Ce}from"./use-meta.913a1700.js";import{u as X}from"./use-quasar.d6a5ba34.js";import{api as U}from"./axios.7b84a9dc.js";import{Q as ee}from"./QImg.4ebc455d.js";import{Q as Ue}from"./QTooltip.684b4eca.js";import{Q as Ee}from"./QList.df29de3c.js";import{i as te,n as Q,c as Qe,a as Ne,g as Oe}from"./myFuncts.e1715cba.js";import{S as Ae}from"./SketchUploader.77e904cb.js";import{Q as De}from"./style.821fa0a2.js";import{_ as Y}from"./BtnDelete.6405c9fa.js";import{m as Me}from"./myAuth.f2132660.js";import{_ as ae}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as qe}from"./PageTitle.dd30c7fc.js";import"./use-ratio.2d02bf26.js";import"./position-engine.13c0858e.js";import"./format.3e32b8d9.js";import"./use-file.d7c29277.js";import"./get-emits-object.24798346.js";import"./QToolbarTitle.7a23c9ce.js";import"./QToolbar.6731bc21.js";import"./QLinearProgress.f13ab238.js";var Te=me({name:"QInnerLoading",props:{...pe,...he,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(u,{slots:d}){const w=ye(),t=fe(u,w.proxy.$q),{transitionProps:h,transitionStyle:y}=ve(u),x=H(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(t.value===!0?" q-inner-loading--dark":"")),b=H(()=>"q-inner-loading__label"+(u.labelClass!==void 0?` ${u.labelClass}`:""));function S(){const P=[R(ke,{size:u.size,color:u.color})];return u.label!==void 0&&P.push(R("div",{class:b.value,style:u.labelStyle},[u.label])),P}function V(){return u.showing===!0?R("div",{class:x.value,style:y.value},d.default!==void 0?d.default():S()):null}return()=>R(_e,h.value,V)}});const ze={class:"uploaderArea"},Be={class:"imagesArea"},Le={class:"absolute delBthArea"},Fe={class:"row no-wrap"},Re={__name:"PhotoUploader",setup(u){const d=String("https://api.sakh-orch.ru/"),w=X(),t=Z(),h=z("Entry"),y=z("isPhotosCompleted"),x=E(null),b=z("unlinkPhoto");function S(){U.post(d+"api/news/photo.php",{params:{entryId:t.params.id,method:"unlinkAll"}}).then(a=>{var v;if(!((v=a==null?void 0:a.data)!=null&&v.result))throw new Error;h.value.Photos=[]}).catch(a=>{w.notify(Q(a))})}function V(){return{url:d+"api/news/photo.php",headers:[{name:"ACCESSTOKEN",value:Me.self.AccessToken}],formFields:[{name:"entryId",value:h.value.id},{name:"method",value:"add"}]}}function P(a){console.log(a.xhr.response),O(),x.value.reset(),m.value=!0}function A(a){var k,$,D;console.log(a.xhr.response);let v=(D=($=JSON.parse((k=a==null?void 0:a.xhr)==null?void 0:k.response))==null?void 0:$.error)!=null?D:"";w.notify(Q(null,v))}function O(){U.post(d+"api/news/photo.php",{params:{method:"list",entryId:t.params.id}}).then(a=>{var v,k,$;if(!((v=a==null?void 0:a.data)!=null&&v.result))throw new Error;h.value.Photos=($=(k=a==null?void 0:a.data)==null?void 0:k.data)!=null?$:[],y()&&(m.value=!1)}).catch(a=>{w.notify(Q(a))}).finally(()=>{})}function c(a){const v=`
![](${a.md5}.${a.ext})
`;Qe(v,w)}const m=E(!1);let _=null;return ge(m,a=>{a&&!_?_=setInterval(O,3e3):!a&&_&&(clearInterval(_),_=null)}),we(()=>{_&&clearInterval(_)}),(a,v)=>(i(),f(C,null,[s("div",ze,[l(De,{style:{width:"100%"},label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438 (\u0434\u043E 20)",factory:V,"max-file-size":5e7,"max-files":20,ref_key:"uploader",ref:x,onUploaded:P,onFailed:A,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)]),r(h).Photos&&r(h).Photos.length?(i(),I(ne,{key:0,bordered:"",flat:"",class:"transparent"},{default:p(()=>[l(xe,{align:"right"},{default:p(()=>[l(Y,{"throw-confirm":"",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",onOnOk:v[0]||(v[0]=k=>S()),title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438"}),g("",!0)]),_:1}),l(oe,null,{default:p(()=>[s("div",Be,[(i(!0),f(C,null,W(r(h).Photos,(k,$)=>(i(),I(ne,{key:$},{default:p(()=>[k.status==="completed"?(i(),I(ee,{key:0,ratio:96/54,src:r(te)(r(d),k.md5,k.ext,260)},null,8,["src"])):(i(),I(G,{key:1},{default:p(()=>[l(F,null,{default:p(()=>[l(Te,{showing:"",label:"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0430"})]),_:1})]),_:1})),l(oe,null,{default:p(()=>[s("div",Le,[l(Y,{size:"0.7em","throw-confirm":"",onOnOk:D=>r(b)(k.id),title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E"},null,8,["onOnOk"])]),s("div",Fe,[l(T,{padding:"0.5em 1em",icon:"content_copy",label:"\u041A\u043E\u0434",onClick:D=>c(k)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])]),_:1})]),_:1})):g("",!0)],64))}};var je=ae(Re,[["__scopeId","data-v-0ef5ada4"]]);const N=u=>(Ie("data-v-33c749ca"),u=u(),Se(),u),He={key:0,class:"newsarea"},We=N(()=>s("br",null,null,-1)),Ke={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},Je={class:"nimg_block",style:{position:"relative"}},Ye=N(()=>s("img",{src:"/img/news/default_sketch.svg"},null,-1)),Ze={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},Ge={class:"inputArea"},Xe={class:"inputArea"},et={class:"input"},tt={id:"categs",class:"input"},at={style:{display:"flex","justify-content":"flex-end","grid-gap":"1em",padding:"1em"}},lt=N(()=>s("br",null,null,-1)),ot=N(()=>s("br",null,null,-1)),nt=N(()=>s("br",null,null,-1)),it=N(()=>s("br",null,null,-1)),rt=N(()=>s("br",null,null,-1)),dt=N(()=>s("br",null,null,-1)),st={__name:"NewEditor",emits:["uploaded"],setup(u,{expose:d,emit:w}){const t=z("Entry"),h=String("https://api.sakh-orch.ru/"),y=X(),x=Z(),b=be(),S=w,V=E([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u0421\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]),P=E("");L("pwUrl",P);function A(){if(P.value)return P.value;let o=y.platform.is.mobile?1080:260;return t.value.sketch?te(h,t.value.sketch.md5,t.value.sketch.ext,o):"error.err"}function O(){U.post(h+"api/news/sketch.php",{params:{method:"unlink",id:x.params.id}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;S("uploaded")}).catch(o=>{y.notify(Q(o))})}function c(o){U.post(h+"api/news/photo.php",{params:{entryId:x.params.id,imgId:o,method:"unlink"}}).then(e=>{var le;if(!((le=e==null?void 0:e.data)!=null&&le.result))throw new Error;let n=t.value.Photos.findIndex(ue=>ue.id===o),M=t.value.Photos[n];m(M.md5),t.value.Photos.splice(n,1)}).catch(e=>{y.notify(Q(e))})}L("unlinkPhoto",c);function m(o){const e=new RegExp(`!\\[]\\(${o}\\.[a-zA-Z0-9]+\\)`,"g"),n=t.value.markdown;t.value.markdown=t.value.markdown.replace(e,""),t.value.markdown!==n&&$()}function _(){const o=Object.keys(V.value);let e=[];return o.forEach(n=>{e[V.value[n].id]=V.value[n].checked}),e}function a(o=0){U.post(h+"api/news/entry.php",{params:{method:"update",entry:t.value,addNew:o,categs:_()}}).then(e=>{var n,M;y.notify(Ne((M=(n=e==null?void 0:e.data)==null?void 0:n.result)!=null?M:"")),S("uploaded")}).catch(e=>{y.notify(Q(e))})}function v(){U.post(h+"api/news/entry.php",{params:{method:"del",entryId:t.value.id,force:!1}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;b.push({path:"/news/all"})}).catch(o=>{y.notify(Q(o))})}function k(){U.post(h+"api/news/entry.php",{params:{method:t.value.isShow?"hide":"show",entryId:t.value.id}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;t.value.isShow=!t.value.isShow}).catch(o=>{y.notify(Q(o))}).finally(()=>{})}function $(){U.post(h+"api/news/entry.php",{params:{method:"updateMarkdown",id:t.value.id,markdown:t.value.markdown}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;t.value.parsedMD=o==null?void 0:o.data.data}).catch(o=>{})}L("updateMarkdown",$);function D(){return!t.value.Photos||t.value.Photos.length===0?!1:t.value.Photos.every(o=>o.status==="completed")}L("isPhotosCompleted",D);function se(){S("uploaded")}return d({unlinkPhoto:c}),de(()=>{}),(o,e)=>(i(),f(C,null,[r(t)?(i(),f("div",He,[l(q,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:r(t).title,"onUpdate:modelValue":e[0]||(e[0]=n=>r(t).title=n)},null,8,["modelValue"]),We,s("div",Ke,[s("div",Je,[l(ee,{ratio:16/9,src:A(),fit:"fill"},{error:p(()=>[Ye]),_:1},8,["src"]),P.value?g("",!0):(i(),I(T,{key:0,size:"0.7em",round:"",color:"red",icon:"delete",style:{transform:"translateY(-50%)",right:"1em","z-index":"100",position:"absolute",top:"2em"},onClick:e[1]||(e[1]=n=>O(r(t).img))}))]),s("div",Ze,[l(Ae,{id:r(t).id,type:"news",onOnUploaded:se},null,8,["id"])])]),s("div",Ge,[l(q,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",style:{width:"100%"},type:"textarea",autogrow:"",modelValue:r(t).descr,"onUpdate:modelValue":e[2]||(e[2]=n=>r(t).descr=n),outlined:""},null,8,["modelValue"])]),s("div",Xe,[s("div",et,[l(q,{type:"date",modelValue:r(t).date,"onUpdate:modelValue":e[3]||(e[3]=n=>r(t).date=n),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),l(q,{modelValue:r(t).refName,"onUpdate:modelValue":e[4]||(e[4]=n=>r(t).refName=n),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),l(q,{modelValue:r(t).refLink,"onUpdate:modelValue":e[6]||(e[6]=n=>r(t).refLink=n),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},{append:p(()=>[l(ie,{modelValue:r(t).isExternal,"onUpdate:modelValue":e[5]||(e[5]=n=>r(t).isExternal=n),color:"green"},{default:p(()=>[l(Ue,null,{default:p(()=>[B("\u041F\u0440\u0438 \u043A\u043B\u0438\u043A\u0435 \u0432 \u043B\u0435\u043D\u0442\u0435 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),s("div",tt,[l(Ee,{bordered:"",padding:""},{default:p(()=>[l(j,{header:""},{default:p(()=>[B("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(i(!0),f(C,null,W(r(t).categs,n=>Pe((i(),I(G,{key:n.id,tag:"label"},{default:p(()=>[l(F,null,{default:p(()=>[l(j,null,{default:p(()=>[B(K(n.label),1)]),_:2},1024),l(j,{caption:""},{default:p(()=>[B(K(n.caption),1)]),_:2},1024)]),_:2},1024),l(F,{side:"",top:""},{default:p(()=>[l(ie,{color:"green",modelValue:n.checked,"onUpdate:modelValue":M=>n.checked=M,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[$e]])),128))]),_:1})])]),l(je),l(J,{spaced:"2em"}),l(q,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",autogrow:"",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:r(t).markdown,"onUpdate:modelValue":[e[7]||(e[7]=n=>r(t).markdown=n),e[8]||(e[8]=n=>$())],debounce:300,dense:""},null,8,["modelValue"]),s("div",at,[l(T,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",color:"red",onClick:e[9]||(e[9]=n=>v())}),r(t).isShow?(i(),I(T,{key:0,label:"\u0421\u043A\u0440\u044B\u0442\u044C",color:"orange",outline:"",onClick:e[10]||(e[10]=n=>k())})):(i(),I(T,{key:1,label:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C",color:"green",outline:"",onClick:e[11]||(e[11]=n=>k())})),l(T,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green",onClick:e[12]||(e[12]=n=>a(0))})]),lt,ot,nt,it])):g("",!0),rt,dt],64))}};var ut=ae(st,[["__scopeId","data-v-33c749ca"]]);const ct={class:"newsImg"},mt={key:0,class:"btnArea"},pt={__name:"EntryPhoto",props:{id:{type:Number,required:!0},md5:{type:String,required:!0},ext:{type:String,required:!0},size:{type:Number,required:!1,default:1080}},emits:["onDel"],setup(u,{emit:d}){const w=String("https://api.sakh-orch.ru/"),t=z("editMode"),h=d;return(y,x)=>(i(),f("div",ct,[r(t)?(i(),f("div",mt,[l(Y,{tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E","throw-confirm":"",onOnOk:x[0]||(x[0]=b=>h("onDel",u.id))})])):g("",!0),l(ee,{src:r(te)(r(w),u.md5,u.ext,u.size),fit:"fill"},null,8,["src"])]))}};var re=ae(pt,[["__scopeId","data-v-a666a9ca"]]);const ht={key:0,class:"contentArea"},ft={key:1,class:"contentArea"},vt={key:0,class:"textBlock"},_t=["innerHTML"],yt={key:1},kt={key:2,class:"videoItem"},gt={key:2,class:"content"},wt=s("div",{class:"newsarea"},[s("div",{class:"narea"},[s("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),xt=[wt],Wt={__name:"NewPage",setup(u){E(0);const d=E(null);L("Entry",d);const w=X(),t=String("https://api.sakh-orch.ru/"),h=Z(),y=z("editMode"),x=E(!1),b=E(!0),S=E();Ce(()=>{var c,m;return Oe((m=(c=d==null?void 0:d.value)==null?void 0:c.title)!=null?m:"\u041D\u043E\u0432\u043E\u0441\u0442\u044C")});function V(){b.value=!0,U.post(t+"api/news/entry.php",{params:{method:"get",id:h.params.id}}).then(c=>{var m,_,a;if(!((m=c==null?void 0:c.data)!=null&&m.result))throw new Error;d.value=(a=(_=c==null?void 0:c.data)==null?void 0:_.data)!=null?a:null}).catch(c=>{x.value=!0,w.notify(Q(c))}).finally(()=>{b.value=!1})}const P=H(()=>d.value.parsedMD.filter(m=>m.type==="img").map(m=>d.value.Photos.find(_=>_.id===m.fileId)).filter(Boolean)),A=H(()=>{const c=P.value.map(m=>m.id);return d.value.Photos.filter(m=>!c.includes(m.id))});function O(c){y.value&&S.value.unlinkPhoto(c)}return de(()=>{V()}),(c,m)=>{var _;return i(),f(C,null,[r(y)&&d.value?(i(),f("div",ht,[r(y)&&d.value?(i(),I(ut,{key:0,onUploaded:m[0]||(m[0]=a=>V()),ref_key:"editorRef",ref:S},null,512)):g("",!0)])):g("",!0),l(qe,{title:((_=d.value)==null?void 0:_.title)||"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",loading:b.value},null,8,["title","loading"]),d.value?(i(),f("div",ft,[(i(!0),f(C,null,W(d.value.parsedMD,(a,v)=>(i(),f(C,{key:v},[a.type==="text"?(i(),f("div",vt,[a.content!==`
`?(i(),f("section",{key:0,innerHTML:a.content},null,8,_t)):(i(),f("br",yt))])):g("",!0),a.type==="img"?(i(),I(re,{key:1,id:a.fileId,md5:a.md5,ext:a.ext,onOnDel:O},null,8,["id","md5","ext"])):g("",!0),a.type==="video"?(i(),f("div",kt,[l(ce,{ratio:16/9,src:"https://www.youtube.com/embed/"+a.content},null,8,["src"])])):g("",!0)],64))),128)),d.value.refLink?(i(),f(C,{key:0},[l(J,{spaced:"1em"}),l(G,{clickable:"",href:d.value.refLink},{default:p(()=>[l(F,{avatar:""},{default:p(()=>[l(Ve,{name:"link"})]),_:1}),l(F,null,{default:p(()=>[l(j,null,{default:p(()=>[B("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "+K(d.value.refName),1)]),_:1})]),_:1})]),_:1},8,["href"])],64)):g("",!0),A.value.length?(i(),f(C,{key:1},[l(J,{spaced:"2em"}),(i(!0),f(C,null,W(A.value,(a,v)=>(i(),I(re,{key:v,id:a.id,ext:a.ext,md5:a.md5,onOnDel:O},null,8,["id","ext","md5"]))),128))],64)):g("",!0)])):b.value?g("",!0):(i(),f("div",gt,xt))],64)}}};export{Wt as default};
