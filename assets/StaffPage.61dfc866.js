import{Q as q}from"./QTooltip.68b71f8b.js";import{i as F,r as l,p as r,o as at,m as i,E as v,f as e,q as a,x as p,F as S,n as f,t as _,B as g,l as u,ax as P,G as O,v as C,D as ot,C as st,bn as lt,az as rt,aA as it}from"./index.204d8958.js";import{Q as M}from"./QItemLabel.d15cacf0.js";import{u as nt,a as W,Q as I}from"./QItem.db344a92.js";import{a as dt}from"./QExpansionItem.cb2e0347.js";import"./QImg.34ca62b2.js";import{Q as ut}from"./QList.5476f330.js";import{h as ct,g as pt,n as N,i as ft}from"./myFuncts.f29ac30b.js";import{u as mt}from"./use-meta.b08df21f.js";import{api as b}from"./axios.0f195894.js";import{_ as vt,a as _t,b as gt,c as ht,d as yt}from"./AddPlayerDialog.5683c58e.js";import{m as B}from"./myAuth.f2132660.js";import{P as kt}from"./PageShell.6301a2fa.js";import{_ as Dt}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.0e7f3203.js";import"./selection.b8a3fcef.js";import"./style.05d139bb.js";import"./format.de7e9769.js";import"./use-file.718fa2e7.js";import"./get-emits-object.a3f16783.js";/* empty css               */import"./BtnDelete.4c0bed29.js";import"./QPopupProxy.fb3aba97.js";import"./use-render-cache.3aae9b27.js";import"./QMenu.e94238c6.js";import"./ClosePopup.76a8a1dc.js";import"./QToolbar.39937926.js";import"./QScrollArea.33f1695d.js";import"./TouchPan.5da0364f.js";import"./touch.9135741d.js";import"./QLinearProgress.fc4d1da7.js";import"./MainFooter.ed3ab838.js";import"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.ec463db7.js";import"./AnderHeader.637ebe8d.js";/* empty css                                                    */const Qt=h=>(rt("data-v-6092377e"),h=h(),it(),h),St={class:"centralCol"},Ct={class:"gridArea"},It={key:0,class:"group"},Pt={class:"cardTitle"},wt=Qt(()=>P("br",null,null,-1)),xt={__name:"StaffPage",setup(h){const w=nt(),y=String("https://api.staff.sakh-orch.ru/"),k=F("editMode"),n=l(!1);r("staffEditMode",n);const m=l(!1);r("progress",m);const c=l([]);r("groups",c);const K=l(""),x=l(ct(new Date).format("YYYY-MM-DD"));r("condDate",x);const U=l(!1);r("showUploader",U),r("pwUrl",K);const H=B.self.persId(),V=l(0);r("selectedPersId",V);const E=l({});r("selectedPers",E);const T=l(null);r("selectedGroup",T);const D=l([]);r("actionDates",D);const J=F("stopScrollWatch"),Y=l([{id:1,name:"\u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043D\u0442 \u0434\u0438\u0440\u0438\u0436\u0435\u0440\u0430"},{id:2,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"},{id:3,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u0433\u0440\u0443\u043F\u043F\u044B"},{id:4,name:"\u041F\u043E\u043C\u043E\u0449\u043D\u0438\u043A \u043A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440\u0430"},{id:5,name:"\u0420\u0435\u0433\u0443\u043B\u044F\u0442\u043E\u0440"}]);r("statusNames",Y);const z=l(!1);r("showStatusDialog",z);const G=l(!1);r("showAddPlayerDialog",G);const R=l("\u0421\u043E\u0441\u0442\u0430\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"),L=pt(R.value);mt(L);function A(t=!1){return m.value=!0,D.value=[],b.post(y+"api/staff.php",{params:{method:"actionDates",force:t}}).then(o=>{var s,d;D.value=(d=(s=o==null?void 0:o.data)==null?void 0:s.data)!=null?d:[]}).catch(o=>{throw D.value=[],w.notify(N(o)),o}).finally(()=>{m.value=!1})}function $(){console.log("start loadData"),m.value=!0,b.post(y+"api/staff.php",{params:{method:"get",date:x.value}}).then(t=>{var o,s;J(),c.value=[],c.value=Object.values((s=(o=t==null?void 0:t.data)==null?void 0:o.data)!=null?s:[])}).catch(t=>{c.value=[],w.notify(N(t))}).finally(()=>{m.value=!1})}r("loadData",$);function j(){b.post(y+"/api/staff.php",{params:{method:"update",groups:c.value,date:x.value}}).then(t=>{A()}).catch(t=>{w.notify(N(t))})}function At(t){!k.value&&H!==t||(V.value=t,U.value=!0)}function X(t){!k.value||(E.value=t,z.value=!0)}function Z(t){T.value=t,G.value=!0}function $t(t){return t?ft(y,t.md5,t.ext,50):"/img/avatars/init_ava.png"}return at(()=>{A().then(()=>{$()})}),(t,o)=>(i(),v(S,null,[e(kt,{"page-title":p(L).title},{ToolPanel:a(()=>[p(B).self.isPermit([1,2])&&p(k)?(i(),f(g,{key:0,icon:"update",flat:"",stretch:"",onClick:o[0]||(o[0]=s=>A(!0))},{default:a(()=>[e(q,null,{default:a(()=>[_("\u0416\u0435\u0441\u0442\u043A\u043E \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u0442\u044B")]),_:1})]),_:1})):u("",!0),p(B).self.isPermit([1,2,3])?(i(),f(g,{key:1,icon:"edit",flat:"",stretch:"",color:n.value?"red":"grey",onClick:o[1]||(o[1]=s=>n.value=!n.value)},{default:a(()=>[e(q,null,{default:a(()=>[_("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u043E\u0441\u0442\u0430\u0432")]),_:1})]),_:1},8,["color"])):u("",!0),e(ht)]),PageContent:a(()=>[P("div",St,[P("div",Ct,[(i(!0),v(S,null,O(c.value,s=>(i(),v(S,{key:s.groupId},[n.value||s.groupId!==200?(i(),v("div",It,[e(ut,null,{default:a(()=>[e(W,{dense:""},{default:a(()=>[e(I,{avatar:""},{default:a(()=>[e(M,null,{default:a(()=>[P("span",Pt,C(s.groupName),1)]),_:2},1024)]),_:2},1024),e(dt),n.value?(i(),f(I,{key:0,side:""},{default:a(()=>[e(g,{round:"",icon:"add",onClick:d=>Z(s)},null,8,["onClick"])]),_:2},1024)):u("",!0)]),_:2},1024),e(ot,{inset:""}),wt,e(p(yt),{list:s.Players,itemKey:"persId",disabled:!n.value,group:"people"},{item:a(({element:d})=>[e(W,{clickable:n.value},{default:a(()=>[u("",!0),e(I,null,{default:a(()=>[e(M,null,{default:a(()=>[_(C(d.name)+" "+C(d.lastName),1)]),_:2},1024),(i(!0),v(S,null,O(d.statuses,(Q,tt)=>(i(),f(M,{key:`${tt}_${Q}`,caption:""},{default:a(()=>[_(C(Y.value.find(et=>et.id===Q).name),1)]),_:2},1024))),128))]),_:2},1024),p(k)?(i(),f(I,{key:1,side:"",onClick:st(Q=>X(d),["prevent","stop"])},{default:a(()=>[e(g,{icon:"edit",stretch:"",size:"1em",flat:""})]),_:2},1032,["onClick"])):u("",!0)]),_:2},1032,["clickable"])]),_:2},1032,["list","disabled"])]),_:2},1024)])):u("",!0)],64))),128))]),e(lt,{align:"right"},{default:a(()=>[n.value?(i(),f(g,{key:0,class:"goldBtn",onClick:j},{default:a(()=>[_("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")]),_:1})):u("",!0)]),_:1})])]),_:1},8,["page-title"]),e(vt,{onUpdated:o[2]||(o[2]=s=>$())}),e(_t),e(gt,{onOnPlayersAdd:j})],64))}};var me=Dt(xt,[["__scopeId","data-v-6092377e"]]);export{me as default};
