import{i as I,r as f,m as s,n as k,p as l,f as e,A as oe,bm as N,bi as S,u as i,z as $,v as M,b as ae,E as ne,d as T,I as R,C as D,F as L,B as ue,l as C,q as Q,t as W,k as G,x as E,D as Z,H as ie,G as re,ax as B}from"./index.bc11f4d7.js";import{b as K,Q as w}from"./QImg.448eb956.js";import{b as j}from"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.c49da512.js";import{P as de}from"./PageShell.60dd4b3f.js";import"./axios.63d2f48d.js";import{u as x,h}from"./myFuncts.d4b02984.js";import{_ as ee}from"./BtnDelete.307e8830.js";import{A as se}from"./AuthorItem.d222a757.js";import{P as F,V as fe,A as q,W as z}from"./lib.8923d048.js";import{Q as pe}from"./QList.0e3b907c.js";import{Q as le}from"./QTooltip.dcd6f58a.js";import{Q as me}from"./QForm.dcb7c451.js";/* empty css               */import{Q as A}from"./QItemLabel.6f822438.js";import{_ as Y}from"./BtnMoveSort.288dd054.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as ve}from"./QSelect.8d95d6c1.js";import{V as ge}from"./VKVideoItem.99b7e353.js";import"./touch.9135741d.js";import"./selection.295e94e6.js";import"./QScrollArea.0b5361ec.js";import"./format.de7e9769.js";import"./QLinearProgress.1a146b15.js";/* empty css                                                    */import"./myAxios.f72ca8da.js";import"./position-engine.6616cb3e.js";import"./QMenu.9b09f739.js";import"./use-virtual-scroll.18864eed.js";import"./rtl.276c3f1b.js";import"./announce.d13a9b89.js";import"./img.c8a2a222.js";import"./SketchImg.a0266007.js";const ce={__name:"PartitionDialog",emits:["onSave"],setup(y,{emit:d}){const m=x(),r=I("isOpenPartitionDialog"),a=I("selectedPartition"),v=I("loadPartitions"),t=f(!1);function g(){r.value=!1}async function V(){t.value=!0,await F.save(m,a.value)&&(await v(),g()),t.value=!1}function n(){t.value=!1}const u=[P=>!!P||"\u041F\u0443\u0441\u0442\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435!"],p=[P=>P>0&P<1e3||"\u2116?"],b=f(),O=f();function U(){!H()||V()}function H(){return b.value.validate()&&O.value.validate()}return(P,c)=>(s(),k(ne,{modelValue:i(r),"onUpdate:modelValue":c[4]||(c[4]=o=>ae(r)?r.value=o:null),onBeforeHide:n},{default:l(()=>[e(M,{bordered:"",class:"dialogArea"},{default:l(()=>[e(me,{onSubmit:oe(U,["stop","prevent"])},{default:l(()=>[e(N,null,{default:l(()=>[e(S,{type:"number",rules:p,ref_key:"refNum",ref:O,prefix:"\u2116",modelValue:i(a).num,"onUpdate:modelValue":c[0]||(c[0]=o=>i(a).num=o),style:{width:"5em"}},null,8,["modelValue"]),e(S,{modelValue:i(a).title,"onUpdate:modelValue":c[1]||(c[1]=o=>i(a).title=o),filled:"",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0447\u0430\u0441\u0442\u0438",rules:u,style:{width:"100%"},ref_key:"refTitle",ref:b},null,8,["modelValue"]),e(S,{modelValue:i(a).caption,"onUpdate:modelValue":c[2]||(c[2]=o=>i(a).caption=o),filled:"",label:"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(N,{align:"right"},{default:l(()=>[e($,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",flat:"",onClick:c[3]||(c[3]=o=>r.value=!1)}),e($,{color:"green",type:"submit",label:"\u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",flat:"",loading:t.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},_e=T({__name:"PartitionItem",props:{partition:{},idx:{},length:{}},emits:["onDel","onSort","onEdit"],setup(y,{emit:d}){const m=x(),r=d,a=f(!1),v=I("editMode"),t=I("isOpenPartitionDialog");R("isOpenPartitionDialog",t);async function g(n){await F.del(m,n)&&r("onDel")}async function V(n,u){a.value=!0,await F.moveSort(m,n,u)&&r("onSort"),a.value=!1}return(n,u)=>(s(),D(L,null,[e(K,null,{default:l(()=>[e(w,{avatar:""},{default:l(()=>[e(A,null,{default:l(()=>[Q(W(n.partition.sortVal),1)]),_:1})]),_:1}),e(w,{avatar:""},{default:l(()=>[e(A,null,{default:l(()=>[Q("\u2116"+W(n.partition.num),1)]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(A,null,{default:l(()=>[Q(W(n.partition.title),1)]),_:1}),e(A,{caption:""},{default:l(()=>[Q(W(n.partition.caption),1)]),_:1})]),_:1}),e(w,{side:""},{default:l(()=>[e(A,null,{default:l(()=>[e($,{label:`ID: ${n.partition.id}`,flat:"",onClick:u[0]||(u[0]=p=>i(h)(n.partition.id,i(m))),"icon-right":"content_copy"},null,8,["label"])]),_:1})]),_:1})]),_:1}),i(v)?(s(),D(L,{key:0},[e(K,null,{default:l(()=>[e(w),e(w,{side:""},{default:l(()=>[e($,{icon:"edit",dense:"",round:"",flat:"",onClick:u[1]||(u[1]=p=>r("onEdit",n.partition))},{default:l(()=>[e(le,null,{default:l(()=>u[5]||(u[5]=[Q("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")])),_:1})]),_:1})]),_:1}),e(w,{side:""},{default:l(()=>[e(ee,{"throw-confirm":"",danger:"",flat:"",onOnOk:u[2]||(u[2]=p=>g(n.partition.id)),tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C"})]),_:1}),e(w,{side:""},{default:l(()=>[e(Y,{disable:n.idx<1,loading:a.value,onOnClick:u[3]||(u[3]=p=>V("up",n.partition.id)),direction:"up"},null,8,["disable","loading"])]),_:1}),e(w,{side:""},{default:l(()=>[e(Y,{disable:n.idx>=n.length-1,loading:a.value,onOnClick:u[4]||(u[4]=p=>V("down",n.partition.id)),direction:"down"},null,8,["disable","loading"])]),_:1})]),_:1}),e(ue)],64)):C("",!0)],64))}}),Ve=T({__name:"PartitionList",props:{workId:{}},setup(y){const d=x(),m=I("editMode");f(!1);const r=y,a=f([]),v=f({});R("selectedPartition",v);const t=f(!1);R("isOpenPartitionDialog",t);function g(){return{id:void 0,num:a.value.length+1,title:"",workId:r.workId}}function V(){v.value=g(),t.value=!0}function n(p){v.value=p,t.value=!0}async function u(){const p=await F.getList(d,r.workId);p.length&&(a.value=[],a.value=p)}return R("loadPartitions",u),G(()=>{u()}),(p,b)=>(s(),D(L,null,[e(M,null,{default:l(()=>[e(E,null,{default:l(()=>b[0]||(b[0]=[Q("\u0427\u0430\u0441\u0442\u0438 \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u044F ")])),_:1}),e(E,null,{default:l(()=>[e(pe,null,{default:l(()=>[(s(!0),D(L,null,Z(a.value,(O,U)=>(s(),k(_e,{key:O.id,partition:O,onOnEdit:n,onOnDel:u,onOnSort:u,idx:U,length:a.value.length},null,8,["partition","idx","length"]))),128))]),_:1})]),_:1}),e(N,{align:"right"},{default:l(()=>[i(m)?(s(),k($,{key:0,icon:"add",label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C",flat:"",onClick:V},{default:l(()=>[e(le,null,{default:l(()=>b[1]||(b[1]=[Q("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C")])),_:1})]),_:1})):C("",!0)]),_:1})]),_:1}),e(ce)],64))}}),ke={};function ye(y,d){return s(),k(M,null,{default:l(()=>[e(E,null,{default:l(()=>d[0]||(d[0]=[Q("\u0418\u0437\u0434\u0430\u043D\u0438\u044F")])),_:1}),e(E)]),_:1})}var be=te(ke,[["render",ye]]);const we=T({__name:"GenreSelect",props:{genreId:{},readonly:{type:Boolean}},emits:["onSelect"],setup(y,{emit:d}){const m=I("genres"),r=f(),a=y,v=d;return G(()=>{r.value=m.value.find(t=>t.id===a.genreId)}),(t,g)=>(s(),k(ve,{modelValue:r.value,"onUpdate:modelValue":[g[0]||(g[0]=V=>r.value=V),g[1]||(g[1]=V=>v("onSelect",r.value))],options:i(m),readonly:t.readonly,label:"\u0416\u0430\u043D\u0440","map-options":"","option-value":"id","option-label":"name",clearable:""},null,8,["modelValue","options","readonly"]))}});const Ie={key:0,class:"vidarea"},Pe=T({__name:"VideoList",props:{workId:{}},setup(y){const d=f([]),m=x(),r=f(!1);R("editMode",r);const a=y;return G(async()=>{d.value=await fe.getListByWork(m,a.workId)}),(v,t)=>(s(),k(M,null,{default:l(()=>[e(E,null,{default:l(()=>[d.value.length?(s(),D("div",Ie,[(s(!0),D(L,null,Z(d.value,g=>(s(),k(ge,{key:`v-list${g.id}`,video:g},null,8,["video"]))),128))])):C("",!0)]),_:1})]),_:1}))}});var Ce=te(Pe,[["__scopeId","data-v-03d8f378"]]);const Qe={class:"centralCol"},nl={__name:"WorkPage",setup(y){const d=x(),m=ie(),r=re(),a=I("editMode"),v=f(!1),t=f({});f(null);const g=I("selectedAuthorId"),V=q.selected,n=f(!1),u=f(!1),p=f(!1);async function b(){t.value=await z.get(d,m.params.id),await O()}async function O(){V.value=await q.get(d,t.value.authorId)}function U(){v.value=!0,z.update(d,t.value),v.value=!1}function H(c){var o;t.value.genreId=(o=c==null?void 0:c.id)!=null?o:null}async function P(){v.value=!0,await z.del(d,m.params.id)&&await r.push({path:"/lib/works/"+q.selected.value.id}),v.value=!1}return G(()=>{b()}),(c,o)=>(s(),k(de,{"page-title":t.value.titleRu},{ToolPanel:l(()=>{var _,J,X;return[e(se,{id:i(g),iofEn:(_=i(q))==null?void 0:_.iofEn,iconUrl:(J=i(V))==null?void 0:J.iconUrl,fioRu:(X=i(V))==null?void 0:X.fioRu},null,8,["id","iofEn","iconUrl","fioRu"])]}),PageContent:l(()=>[B("div",Qe,[o[7]||(o[7]=B("br",null,null,-1)),t.value.id?(s(),k(M,{key:0},{default:l(()=>[e(E,null,{default:l(()=>[e(K,null,{default:l(()=>[e($,{label:`ID: ${t.value.id}`,flat:"",onClick:o[0]||(o[0]=_=>i(h)(t.value.id,i(d))),"icon-right":"content_copy"},null,8,["label"])]),_:1}),e(S,{modelValue:t.value.titleRu,"onUpdate:modelValue":o[1]||(o[1]=_=>t.value.titleRu=_),readonly:!i(a),label:"\u041B\u043E\u043A\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue","readonly"]),e(S,{modelValue:t.value.titleEn,"onUpdate:modelValue":o[2]||(o[2]=_=>t.value.titleEn=_),readonly:!i(a),label:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue","readonly"]),e(S,{modelValue:t.value.opus,"onUpdate:modelValue":o[3]||(o[3]=_=>t.value.opus=_),label:"opus",readonly:!i(a),prefix:"Op."},null,8,["modelValue","readonly"]),e(we,{onOnSelect:H,readonly:!i(a),genreId:t.value.genreId},null,8,["readonly","genreId"])]),_:1}),i(a)?(s(),k(N,{key:0,align:"right"},{default:l(()=>[e(ee,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435","throw-confirm":"",danger:"",flat:"",onOnOk:P,tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435"}),e($,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green","icon-right":"save",flat:"",onClick:U})]),_:1})):C("",!0)]),_:1})):C("",!0),o[8]||(o[8]=B("br",null,null,-1)),e(j,{label:"\u0420\u0430\u0437\u0434\u0435\u043B\u044B",modelValue:n.value,"onUpdate:modelValue":o[4]||(o[4]=_=>n.value=_)},{default:l(()=>[n.value?(s(),k(Ve,{key:0,workId:t.value.id},null,8,["workId"])):C("",!0)]),_:1},8,["modelValue"]),o[9]||(o[9]=B("br",null,null,-1)),e(j,{label:"\u0412\u0438\u0434\u0435\u043E",modelValue:p.value,"onUpdate:modelValue":o[5]||(o[5]=_=>p.value=_)},{default:l(()=>[p.value?(s(),k(Ce,{key:0,workId:t.value.id},null,8,["workId"])):C("",!0)]),_:1},8,["modelValue"]),o[10]||(o[10]=B("br",null,null,-1)),e(j,{label:"\u0418\u0437\u0434\u0430\u043D\u0438\u044F",modelValue:u.value,"onUpdate:modelValue":o[6]||(o[6]=_=>u.value=_)},{default:l(()=>[u.value?(s(),k(be,{key:0,workId:t.value.id},null,8,["workId"])):C("",!0)]),_:1},8,["modelValue"])])]),_:1},8,["page-title"]))}};export{nl as default};
