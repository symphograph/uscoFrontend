import{d as ue,i as j,r as g,c as J,m as a,n as p,q as e,v as K,b as ae,G as ie,f as u,y as N,t as c,u as b,l as E,bi as te,D as q,bk as le,bl as oe,F as X,bm as me,A,x as Z,p as Y,B as ee,ax as R,aY as ye,E as ce}from"./index.11572179.js";import{b as M,Q as $,a as Ce}from"./QImg.5a36287c.js";import{Q as D}from"./QItemLabel.06f6b55b.js";import{d as ge,e as De,b as be}from"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.55812a5a.js";import{Q as Ve}from"./QList.f13a658d.js";import{Q as ne}from"./QSelect.44bc25a7.js";/* empty css               */import{W as Ee,T as W,V as de}from"./lib.be306c2e.js";import{u as h}from"./use-quasar.894b47c5.js";import{_ as Se}from"./BtnDelete.3d55e9b3.js";import{i as _e}from"./myFuncts.7f91abf8.js";import{u as we}from"./myAxios.d5d7b004.js";import{_ as Te}from"./plugin-vue_export-helper.21dcd24c.js";const ke=ue({__name:"TimeCodeDialog",props:{video:{type:Object,required:!0},timeCode:{type:Object,default:()=>({id:0,start:"00:00:00",uLabel:"",type:"init"})}},emits:["onDelete","onSave"],setup(l,{emit:Q}){const _=h(),m=j("isTCodeDialogOpen"),k=Q,F={id:0,start:"00:00:00",uLabel:"",type:"init"},r=l,y=g(r.timeCode),w=g(!1),L=g([]),S=g(),v=g(),V=J(()=>!r.timeCode.id),H=J(()=>V.value?S.value?v.value?"part":"work":"init":r.timeCode.type);function O(){m.value=!1}J(()=>["work","part"].includes(y.value.type));function B(){V.value&&I(),V.value&&o()}function I(){y.value={...F},S.value=void 0,v.value=void 0}function z(){w.value=!1,V.value&&I()}function U(n){const t=n.split(":");return+t[0]*60*60+ +t[1]*60+ +t[2]}function x(n){const t=(n%60).toString(),T=Math.floor(n/60%60).toString();return`${Math.floor(n/60/60%60).toString().padStart(2,"0")}:${T.padStart(2,"0")}:${t.padStart(2,"0")}`}function G(n){const t=U(n);return n===x(t)}async function s(){w.value=!0,(V.value?await C():await W.update(_,y.value))&&(k("onSave"),O()),w.value=!1}async function C(){y.value.type=H.value;const n=y.value,t=r.video.id,T=n.start;switch(n.type){case"init":return W.addInit(_,t,T,n.uLabel);case"work":return W.addWork(_,t,T,S.value.id);case"part":return W.addPartition(_,t,T,v.value.id)}}async function o(){!r.video.announceId||(w.value=!0,L.value=await Ee.getListByAnnounce(_,r.video.announceId),w.value=!1)}function i(){var n,t;(t=(n=S.value)==null?void 0:n.children)!=null&&t.length||(v.value=null),v.value=S.value.children[0]}async function d(){w.value=!0,await W.del(_,r.timeCode.id)&&(k("onDelete"),O()),w.value=!1}return(n,t)=>(a(),p(ie,{modelValue:K(m),"onUpdate:modelValue":t[5]||(t[5]=T=>ae(m)?m.value=T:null),onBeforeHide:z,onBeforeShow:B},{default:e(()=>[u(Z,{bordered:"",class:"dialogArea"},{default:e(()=>{var T;return[u(N,null,{default:e(()=>[u(M,null,{default:e(()=>[u($,null,{default:e(()=>[u(D,{caption:""},{default:e(()=>[c(b(V.value?"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434":"\u0418\u043C\u0435\u043D\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434 \u0434\u043B\u044F:"),1)]),_:1}),V.value?E("",!0):(a(),p(D,{key:0},{default:e(()=>[c(b(l.timeCode.label),1)]),_:1}))]),_:1})]),_:1})]),_:1}),u(N,null,{default:e(()=>{var P,re,se,ve,fe;return[u(te,{mask:"##:##:##",clearable:"",label:`${x(0)} - ${x(l.video.duration)}`,"onUpdate:modelValue":[t[0]||(t[0]=f=>U(String(f))),t[1]||(t[1]=f=>y.value.start=f)],rules:[f=>!!f||"* \u041E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043F\u043E\u043B\u0435",f=>G(f)||"\u041D\u0443\u0436\u0435\u043D \u0444\u043E\u0440\u043C\u0430\u0442 [HH:MM:SS]",f=>U(String(f))<=l.video.duration||"\u0417\u0430 \u043F\u0440\u0435\u0434\u0435\u043B\u0430\u043C\u0438 \u0432\u0438\u0434\u0435\u043E"],modelValue:y.value.start},null,8,["label","rules","modelValue"]),H.value==="init"?(a(),p(te,{key:0,modelValue:y.value.uLabel,"onUpdate:modelValue":t[2]||(t[2]=f=>y.value.uLabel=f),clearable:"",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u0430\u0439\u043C\u043A\u043E\u0434\u0430","stack-label":""},null,8,["modelValue"])):E("",!0),V.value?(a(),q(X,{key:1},[L.value.length?(a(),p(ne,{key:0,modelValue:S.value,"onUpdate:modelValue":[t[3]||(t[3]=f=>S.value=f),i],label:((P=S.value)==null?void 0:P.author.fioRu)||"\u041F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435",options:L.value,clearable:"","map-options":"","option-value":"id","option-label":"titleRu"},{option:e(f=>[u(M,le(oe(f.itemProps)),{default:e(()=>[u($,null,{default:e(()=>[u(D,{caption:""},{default:e(()=>[c(b(f.opt.author.fioRu),1)]),_:2},1024),u(D,null,{default:e(()=>[c(b(f.opt.titleRu),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label","options"])):(a(),p(M,{key:1},{default:e(()=>[u($,null,{default:e(()=>[u(D,null,{default:e(()=>t[6]||(t[6]=[c("\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0439 \u043F\u0443\u0441\u0442")])),_:1}),l.video.announceId?(a(),p(D,{key:0,caption:""},{default:e(()=>t[7]||(t[7]=[c(" \u041F\u043E\u0445\u043E\u0436\u0435, \u0432 \u0430\u043D\u043E\u043D\u0441\u0435 \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u0430 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430 \u043A\u043E\u043D\u0446\u0435\u043D\u0442\u0430. ")])),_:1})):(a(),p(D,{key:1,caption:""},{default:e(()=>t[8]||(t[8]=[c(" \u041F\u0440\u0438\u0432\u044F\u0436\u0438\u0442\u0435 \u0432\u0438\u0434\u0435\u043E \u043A \u0430\u043D\u043E\u043D\u0441\u0443, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0439. ")])),_:1}))]),_:1})]),_:1})),(se=(re=S.value)==null?void 0:re.children)!=null&&se.length?(a(),p(ne,{key:2,modelValue:v.value,"onUpdate:modelValue":t[4]||(t[4]=f=>v.value=f),options:(fe=(ve=S.value)==null?void 0:ve.children)!=null?fe:[],label:"\u0427\u0430\u0441\u0442\u044C, \u043D\u043E\u043C\u0435\u0440, \u0440\u0430\u0437\u0434\u0435\u043B",clearable:"","stack-label":"","map-options":"","option-value":"id","option-label":"title"},{option:e(f=>[u(M,le(oe(f.itemProps)),{default:e(()=>[u($,{avatar:""},{default:e(()=>[c(b(f.opt.sortVal),1)]),_:2},1024),u($,null,{default:e(()=>[u(D,null,{default:e(()=>[c(b(f.opt.title),1)]),_:2},1024),u(D,{caption:""},{default:e(()=>[c(b(f.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])):E("",!0)],64)):E("",!0)]}),_:1}),E("",!0),(T=S.value)!=null&&T.children.length?(a(),p(N,{key:1},{default:e(()=>[u(M,null,{default:e(()=>[u($,null,{default:e(()=>[u(D,null,{default:e(()=>[c(b(v.value?"\u0427\u0430\u0441\u0442\u044C \u0431\u0443\u0434\u0435\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0430 \u0432 \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u043D\u043E\u0439 \u043F\u0430\u043F\u043A\u0435":"\u0411\u0443\u0434\u0435\u0442 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435 \u0431\u0435\u0437 \u0447\u0430\u0441\u0442\u0435\u0439"),1)]),_:1})]),_:1})]),_:1})]),_:1})):E("",!0),c(" "+b(H.value)+" ",1),u(me,{align:"right"},{default:e(()=>[l.timeCode.id?(a(),p(Se,{key:0,label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C","throw-confirm":"",onOnOk:d,danger:""})):E("",!0),u(ge),u(A,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",onClick:O}),u(A,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",loading:w.value,color:"green",onClick:s},null,8,["loading"])]),_:1})]}),_:1})]),_:1},8,["modelValue"]))}}),pe=ue({__name:"TimeCodeItem",props:{video:{type:Object,required:!0},timeCode:{type:Object,required:!0}},emits:["goToMoment","onDelete","onSave"],setup(l,{emit:Q}){h();const _=j("editMode"),m=g(!1);Y("isTCodeDialogOpen",m);const k=Q;return g(!1),(F,r)=>(a(),p(M,{clickable:"",onClick:r[3]||(r[3]=y=>k("goToMoment",l.timeCode.formattedStart))},{default:e(()=>[u($,{avatar:""},{default:e(()=>[u(D,{caption:""},{default:e(()=>[c(b(l.timeCode.start),1)]),_:1}),E("",!0)]),_:1}),u($,null,{default:e(()=>[l.timeCode.type!=="part"?(a(),p(D,{key:0,caption:""},{default:e(()=>[c(b(l.timeCode.caption),1)]),_:1})):E("",!0),u(D,null,{default:e(()=>[c(b(l.timeCode.label),1)]),_:1}),l.timeCode.type==="part"?(a(),p(D,{key:1,caption:""},{default:e(()=>[c(b(l.timeCode.caption),1)]),_:1})):E("",!0)]),_:1}),K(_)?(a(),q(X,{key:0},[u($,{side:""},{default:e(()=>[u(A,{icon:"edit",flat:"",round:"",onClick:r[0]||(r[0]=ee(y=>m.value=!0,["stop","prevent"]))})]),_:1}),u(ke,{timeCode:l.timeCode,onOnDelete:r[1]||(r[1]=y=>k("onDelete")),onOnSave:r[2]||(r[2]=y=>k("onSave")),video:l.video},null,8,["timeCode","video"])],64)):E("",!0)]),_:1}))}}),$e=["innerHTML"],Be=ue({__name:"DescrDialog",props:{video:{type:Object,required:!0}},setup(l){const Q=h(),_=l,m=g(),k=g(!1),F=j("isOpenDescrDialog");function r(){}function y(){}function w(){m.value.hide()}async function L(){k.value=!0,await de.putDescrToVK(Q,_.video.id)&&w(),k.value=!1}return(S,v)=>(a(),p(ie,{modelValue:K(F),"onUpdate:modelValue":v[0]||(v[0]=V=>ae(F)?F.value=V:null),onBeforeHide:r,onBeforeShow:y,ref_key:"refDialog",ref:m},{default:e(()=>[u(Z,{bordered:""},{default:e(()=>[u(N,null,{default:e(()=>[u(M,null,{default:e(()=>[u($,null,{default:e(()=>[u(D,null,{default:e(()=>v[1]||(v[1]=[c("\u0422\u0435\u043F\u0435\u0440\u044C \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0432\u044B\u0433\u043B\u044F\u0434\u0438\u0442 \u0442\u0430\u043A:")])),_:1})]),_:1})]),_:1})]),_:1}),u(N,null,{default:e(()=>[u(Z,null,{default:e(()=>[u(N,null,{default:e(()=>{var V;return[R("section",{innerHTML:(V=l.video)==null?void 0:V.description,style:{whiteSpace:"pre-line"}},null,8,$e)]}),_:1})]),_:1})]),_:1}),u(N,null,{default:e(()=>v[2]||(v[2]=[c("\u0412\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0435\u0433\u043E \u0432 \u0438\u0441\u0445\u043E\u0434\u043D\u043E\u043C \u0432\u0438\u0434\u0435\u043E \u043D\u0430 VK \u0438\u043B\u0438 \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")])),_:1}),u(me,{align:"between"},{default:e(()=>[u(ge),u(A,{label:"\u041D\u0435 \u0441\u0435\u0439\u0447\u0430\u0441",onClick:w}),u(A,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043D\u0430 VK",color:"green",onClick:L})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Oe=ue({__name:"VKVideoDialog",props:{video:{type:Object,required:!0}},emits:["onSave"],setup(l,{emit:Q}){const _=h(),m=j("isOpenVKVideoDialog"),k=g(!1),F=we.getApiUrl(""),r=j("announceList"),y=g("");function w(s){y.value=s}const L=J(()=>{if(!y.value)return r.value;const s=y.value.toLowerCase().trim();return s?r.value.filter(C=>{var n,t,T,P;const o=((n=C.progName)==null?void 0:n.toLowerCase())||"",i=((t=C.eventTime)==null?void 0:t.toLowerCase())||"",d=((P=(T=C.Hall)==null?void 0:T.name)==null?void 0:P.toLowerCase())||"";return o.includes(s)||i.includes(s)||d.includes(s)}):r.value}),S=Q,v=l,V=g(v.video),H=g(),O=g(!1),B=g();function I(){k.value=!1}function z(){!v.video.announceId||(B.value=r.value.find(s=>s.id===v.video.announceId))}function U(){m.value=!1}function x(s){var d,n;const C=((d=s==null?void 0:s.sketch)==null?void 0:d.md5)||null,o=((n=s==null?void 0:s.sketch)==null?void 0:n.ext)||null;return _e(F,C,o,100)}async function G(){k.value=!0;const s={id:B.value.id,progName:B.value.progName,eventTime:B.value.eventTime};await de.linkToAnnounce(_,v.video.id,s)&&(S("onSave"),U())}return(s,C)=>(a(),p(ie,{modelValue:K(m),"onUpdate:modelValue":C[4]||(C[4]=o=>ae(m)?m.value=o:null),onBeforeShow:z,onBeforeHide:I},{default:e(()=>[u(Z,{bordered:"",class:"dialogArea"},{default:e(()=>[u(N,null,{default:e(()=>[u(ne,{modelValue:B.value,"onUpdate:modelValue":[C[0]||(C[0]=o=>B.value=o),()=>{}],options:L.value,label:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u043A\u043E\u043D\u0446\u0435\u0440\u0442","map-options":"","option-label":"progName","option-value":"id",clearable:"","use-input":"",onInputValue:w},ye({option:e(o=>[u(M,le(oe(o.itemProps)),{default:e(()=>[u($,{avatar:""},{default:e(()=>[u(Ce,{src:x(o.opt)},null,8,["src"])]),_:2},1024),u($,null,{default:e(()=>[u(D,null,{default:e(()=>[c(b(o.opt.progName),1)]),_:2},1024),u(D,{caption:""},{default:e(()=>[c(b(o.opt.eventTime),1)]),_:2},1024),u(D,{caption:""},{default:e(()=>[c(b(o.opt.Hall.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},[B.value?{name:"append",fn:e(()=>[u(A,{icon:"save",color:"green",onClick:ee(G,["stop","prevent"]),flat:"",round:""})]),key:"0"}:void 0]),1032,["modelValue","options"])]),_:1}),u(N,null,{default:e(()=>[u(te,{modelValue:V.value.title,"onUpdate:modelValue":C[1]||(C[1]=o=>V.value.title=o),label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",onFocus:C[2]||(C[2]=o=>O.value=!0),onBlur:C[3]||(C[3]=o=>O.value=!1),ref_key:"refTitle",ref:H},{append:e(()=>[O.value?(a(),p(A,{key:0,icon:"save",color:"green",label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"})):E("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const Ae={class:"absolute-top-left text-subtitle2"},Fe={key:0,class:"absolute-top-right no-padding"},Ie={key:1,class:"absolute-center",style:{"border-radius":"50%"}},xe={__name:"VKVideoItem",props:{video:{type:Object,required:!0}},emits:["onSave"],setup(l,{emit:Q}){const _=h(),m=l,k=g(m.video),F=j("announceList"),r=Q;function y(){return F.value.find(o=>o.id===k.value.announceId)}const w=J(()=>{const o=y();return o?`${k.value.recordedAt} - ${o.Hall.name}`:k.value.recordedAt});async function L(){r("onSave")}const S=j("editMode"),v=g(!1),V=g(!1);Y("isOpenVKVideoDialog",V);const H=g(!1);Y("isOpenDescrDialog",H);const O=g(!1),B=g(!1);Y("isTCodeDialogOpen",B);const I=g(!1);function z(){V.value=!0}function U(o=null){let i="https://vk.com/video";const d=`${m.video.owner_id}_${m.video.id}`;let n=`list=${m.video.access_key}`;return o&&(n=`${n}&t=${o}`),`${i}${d}?${n}`}function x(o=null){const i=U(o);window.open(i,"_blank")}function G(){B.value=!0}async function s(){I.value=!0,k.value.timeCodes=await W.getList(_,m.video.id),I.value=!1}Y("loadTCodes",s);async function C(){await s(),k.value.description=await de.getDescr(_,m.video.id),H.value=!0}return(o,i)=>(a(),p(Z,null,{default:e(()=>[u(Ce,{style:{cursor:"pointer"},src:l.video.image[4].url,ratio:1920/1080,onMouseover:i[5]||(i[5]=d=>v.value=!0),onMouseleave:i[6]||(i[6]=d=>v.value=!1),class:"rounded-borders"},{default:e(()=>[R("div",Ae,b(w.value),1),K(S)?(a(),q("div",Fe,[u(A,{loading:I.value,icon:"edit",flat:"",onClick:i[0]||(i[0]=ee(d=>z(),["stop","prevent"]))},null,8,["loading"]),E("",!0)])):E("",!0),v.value?(a(),q("div",Ie,[u(A,{icon:"play_circle",style:{cursor:"pointer"},round:"",loading:I.value,onClick:i[2]||(i[2]=d=>x())},null,8,["loading"])])):E("",!0),R("div",{class:"absolute-bottom text-center",style:{display:"flex","justify-content":"space-between"},onClick:i[4]||(i[4]=d=>x())},[i[8]||(i[8]=R("div",null,b(" "),-1)),R("div",null,b(l.video.title),1),R("div",null,[u(A,{icon:"menu",loading:I.value,onClick:i[3]||(i[3]=ee(d=>O.value=!O.value,["stop","prevent"]))},null,8,["loading"])])])]),_:1},8,["src"]),K(S)?(a(),p(Oe,{key:0,video:k.value,onOnSave:L},null,8,["video"])):E("",!0),u(De,null,{default:e(()=>[O.value?(a(),p(Ve,{key:0,separator:""},{default:e(()=>[(a(!0),q(X,null,ce(k.value.timeCodes,d=>{var n;return a(),q(X,{key:`work_${l.video.id}_${d.id}`},[(n=d==null?void 0:d.children)!=null&&n.length?(a(),p(be,{key:0,"content-inset-level":.5},{header:e(()=>[u(M,{class:"full-width no-padding"},{default:e(()=>[u($,null,{default:e(()=>[u(D,{caption:""},{default:e(()=>[c(b(d.caption),1)]),_:2},1024),u(D,null,{default:e(()=>[c(b(d.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),default:e(()=>[(a(!0),q(X,null,ce(d.children,(t,T)=>(a(),p(pe,{key:`part_${t.workId}_${T}`,timeCode:t,video:l.video,onOnDelete:s,onOnSave:C,onGoToMoment:x},null,8,["timeCode","video"]))),128))]),_:2},1024)):d.type!=="part"?(a(),p(pe,{key:1,video:l.video,onOnDelete:s,onGoToMoment:x,onOnSave:C,timeCode:d},null,8,["video","timeCode"])):E("",!0)],64)}),128)),K(S)?(a(),p(M,{key:0,clickable:"",onClick:i[7]||(i[7]=d=>G())},{default:e(()=>[u($,{avatar:""},{default:e(()=>[u(A,{icon:"add"})]),_:1}),u($,null,{default:e(()=>[u(D,null,{default:e(()=>i[9]||(i[9]=[c("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434")])),_:1})]),_:1}),u(ke,{dur:l.video.duration,video:l.video,onOnSave:C},null,8,["dur","video"]),u(Be,{video:k.value},null,8,["video"])]),_:1})):E("",!0)]),_:1})):E("",!0)]),_:1})]),_:1}))}};var Ye=Te(xe,[["__scopeId","data-v-1ab2ae10"]]);export{Ye as V};
