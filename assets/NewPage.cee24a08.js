import{Q as ue}from"./QVideo.e07c9b56.js";import{u as K,i as T,r as U,w as ce,a as me,n as i,q as p,H as s,f as l,V as r,t as x,G as m,bk as pe,a9 as L,U as q,l as k,aZ as ae,F as $,aw as j,aY as le,aX as he,p as z,o as re,bh as D,ay as oe,ac as fe,ax as W,W as H,ad as _e,I as ve,J as ye,c as ne,S as ke}from"./index.20722a01.js";import{b as Y,Q as F,a as R}from"./QItemLabel.e7216d8b.js";import{u as we}from"./use-meta.db3a3e49.js";import{u as Z}from"./use-quasar.17442000.js";import{api as V}from"./axios.f78423a1.js";import{Q as G}from"./QImg.a5f863f4.js";import{Q as ge}from"./QTooltip.9bd7f70f.js";import{Q as xe}from"./QList.6e27fc82.js";import{i as X,n as E,c as be,a as Pe,g as $e}from"./myFuncts.2c2f31d3.js";import{Q as Ie,S as Ve}from"./QInnerLoading.46b0daf9.js";import{Q as Ue}from"./style.33cde305.js";import{_ as J}from"./BtnDelete.a5b4bed3.js";import{m as Ee}from"./myAuth.f2132660.js";import{_ as ee}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as Qe}from"./PageTitle.69519e1f.js";import"./use-ratio.e53c810c.js";import"./position-engine.d48c1194.js";import"./format.3e32b8d9.js";import"./use-file.2925576a.js";import"./get-emits-object.24798346.js";import"./QToolbarTitle.f4fdf82f.js";import"./QToolbar.4b460dbb.js";import"./QLinearProgress.b8d6848a.js";const Se={class:"uploaderArea"},Ce={class:"imagesArea"},Ne={class:"absolute delBthArea"},Oe={class:"row no-wrap"},Me={__name:"PhotoUploader",setup(w){const d=String("https://api.sakh-orch.ru/"),b=Z(),t=K(),h=T("Entry"),y=T("isPhotosCompleted"),P=U(null),I=T("unlinkPhoto");function Q(){V.post(d+"api/news/photo.php",{params:{entryId:t.params.id,method:"unlinkAll"}}).then(a=>{var f;if(!((f=a==null?void 0:a.data)!=null&&f.result))throw new Error;h.value.Photos=[]}).catch(a=>{b.notify(E(a))})}function S(){return{url:d+"api/news/photo.php",headers:[{name:"ACCESSTOKEN",value:Ee.self.AccessToken}],formFields:[{name:"entryId",value:h.value.id},{name:"method",value:"add"}]}}function C(a){console.log(a.xhr.response),O(),P.value.reset(),c.value=!0}function M(a){var v,g,A;console.log(a.xhr.response);let f=(A=(g=JSON.parse((v=a==null?void 0:a.xhr)==null?void 0:v.response))==null?void 0:g.error)!=null?A:"";b.notify(E(null,f))}function O(){V.post(d+"api/news/photo.php",{params:{method:"list",entryId:t.params.id}}).then(a=>{var f,v,g;if(!((f=a==null?void 0:a.data)!=null&&f.result))throw new Error;h.value.Photos=(g=(v=a==null?void 0:a.data)==null?void 0:v.data)!=null?g:[],y()&&(c.value=!1)}).catch(a=>{b.notify(E(a))}).finally(()=>{})}function u(a){const f=`
![](${a.md5}.${a.ext})
`;be(f,b)}const c=U(!1);let _=null;return ce(c,a=>{a&&!_?_=setInterval(O,3e3):!a&&_&&(clearInterval(_),_=null)}),me(()=>{_&&clearInterval(_)}),(a,f)=>(i(),p($,null,[s("div",Se,[l(Ue,{style:{width:"100%"},label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438 (\u0434\u043E 20)",factory:S,"max-file-size":5e7,"max-files":20,ref_key:"uploader",ref:P,onUploaded:C,onFailed:M,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)]),r(h).Photos&&r(h).Photos.length?(i(),x(le,{key:0,bordered:"",flat:"",class:"transparent"},{default:m(()=>[l(pe,{align:"right"},{default:m(()=>[l(J,{"throw-confirm":"",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",onOnOk:f[0]||(f[0]=v=>Q()),title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438"}),k("",!0)]),_:1}),l(ae,null,{default:m(()=>[s("div",Ce,[(i(!0),p($,null,j(r(h).Photos,(v,g)=>(i(),x(le,{key:g},{default:m(()=>[v.status==="completed"?(i(),x(G,{key:0,ratio:96/54,src:r(X)(r(d),v.md5,v.ext,260)},null,8,["src"])):(i(),x(Y,{key:1},{default:m(()=>[l(F,null,{default:m(()=>[l(Ie,{showing:"",label:"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0430"})]),_:1})]),_:1})),l(ae,null,{default:m(()=>[s("div",Ne,[l(J,{size:"0.7em","throw-confirm":"",onOnOk:A=>r(I)(v.id),title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E"},null,8,["onOnOk"])]),s("div",Oe,[l(L,{padding:"0.5em 1em",icon:"content_copy",label:"\u041A\u043E\u0434",onClick:A=>u(v)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])]),_:1})]),_:1})):k("",!0)],64))}};var Ae=ee(Me,[["__scopeId","data-v-0ef5ada4"]]);const N=w=>(ve("data-v-33c749ca"),w=w(),ye(),w),Be={key:0,class:"newsarea"},De=N(()=>s("br",null,null,-1)),Le={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},Te={class:"nimg_block",style:{position:"relative"}},qe=N(()=>s("img",{src:"/img/news/default_sketch.svg"},null,-1)),ze={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},Fe={class:"inputArea"},Re={class:"inputArea"},je={class:"input"},We={id:"categs",class:"input"},He={style:{display:"flex","justify-content":"flex-end","grid-gap":"1em",padding:"1em"}},Je=N(()=>s("br",null,null,-1)),Ke=N(()=>s("br",null,null,-1)),Ye=N(()=>s("br",null,null,-1)),Ze=N(()=>s("br",null,null,-1)),Ge=N(()=>s("br",null,null,-1)),Xe=N(()=>s("br",null,null,-1)),et={__name:"NewEditor",emits:["uploaded"],setup(w,{expose:d,emit:b}){const t=T("Entry"),h=String("https://api.sakh-orch.ru/"),y=Z(),P=K(),I=he(),Q=b,S=U([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u0421\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]),C=U("");z("pwUrl",C);function M(){if(C.value)return C.value;let o=y.platform.is.mobile?1080:260;return t.value.sketch?X(h,t.value.sketch.md5,t.value.sketch.ext,o):"error.err"}function O(){V.post(h+"api/news/sketch.php",{params:{method:"unlink",id:P.params.id}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;Q("uploaded")}).catch(o=>{y.notify(E(o))})}function u(o){V.post(h+"api/news/photo.php",{params:{entryId:P.params.id,imgId:o,method:"unlink"}}).then(e=>{var te;if(!((te=e==null?void 0:e.data)!=null&&te.result))throw new Error;let n=t.value.Photos.findIndex(se=>se.id===o),B=t.value.Photos[n];c(B.md5),t.value.Photos.splice(n,1)}).catch(e=>{y.notify(E(e))})}z("unlinkPhoto",u);function c(o){const e=new RegExp(`!\\[]\\(${o}\\.[a-zA-Z0-9]+\\)`,"g"),n=t.value.markdown;t.value.markdown=t.value.markdown.replace(e,""),t.value.markdown!==n&&g()}function _(){const o=Object.keys(S.value);let e=[];return o.forEach(n=>{e[S.value[n].id]=S.value[n].checked}),e}function a(o=0){V.post(h+"api/news/entry.php",{params:{method:"update",entry:t.value,addNew:o,categs:_()}}).then(e=>{var n,B;y.notify(Pe((B=(n=e==null?void 0:e.data)==null?void 0:n.result)!=null?B:"")),Q("uploaded")}).catch(e=>{y.notify(E(e))})}function f(){V.post(h+"api/news/entry.php",{params:{method:"del",entryId:t.value.id,force:!1}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;I.push({path:"/news/all"})}).catch(o=>{y.notify(E(o))})}function v(){V.post(h+"api/news/entry.php",{params:{method:t.value.isShow?"hide":"show",entryId:t.value.id}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;t.value.isShow=!t.value.isShow}).catch(o=>{y.notify(E(o))}).finally(()=>{})}function g(){V.post(h+"api/news/entry.php",{params:{method:"updateMarkdown",id:t.value.id,markdown:t.value.markdown}}).then(o=>{var e;if(!((e=o==null?void 0:o.data)!=null&&e.result))throw new Error;t.value.parsedMD=o==null?void 0:o.data.data}).catch(o=>{})}z("updateMarkdown",g);function A(){return!t.value.Photos||t.value.Photos.length===0?!1:t.value.Photos.every(o=>o.status==="completed")}z("isPhotosCompleted",A);function de(){Q("uploaded")}return d({unlinkPhoto:u}),re(()=>{}),(o,e)=>(i(),p($,null,[r(t)?(i(),p("div",Be,[l(D,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:r(t).title,"onUpdate:modelValue":e[0]||(e[0]=n=>r(t).title=n)},null,8,["modelValue"]),De,s("div",Le,[s("div",Te,[l(G,{ratio:16/9,src:M(),fit:"fill"},{error:m(()=>[qe]),_:1},8,["src"]),C.value?k("",!0):(i(),x(L,{key:0,size:"0.7em",round:"",color:"red",icon:"delete",style:{transform:"translateY(-50%)",right:"1em","z-index":"100",position:"absolute",top:"2em"},onClick:e[1]||(e[1]=n=>O(r(t).img))}))]),s("div",ze,[l(Ve,{id:r(t).id,type:"news",onOnUploaded:de},null,8,["id"])])]),s("div",Fe,[l(D,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",style:{width:"100%"},type:"textarea",autogrow:"",modelValue:r(t).descr,"onUpdate:modelValue":e[2]||(e[2]=n=>r(t).descr=n),outlined:""},null,8,["modelValue"])]),s("div",Re,[s("div",je,[l(D,{type:"date",modelValue:r(t).date,"onUpdate:modelValue":e[3]||(e[3]=n=>r(t).date=n),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),l(D,{modelValue:r(t).refName,"onUpdate:modelValue":e[4]||(e[4]=n=>r(t).refName=n),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),l(D,{modelValue:r(t).refLink,"onUpdate:modelValue":e[6]||(e[6]=n=>r(t).refLink=n),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},{append:m(()=>[l(oe,{modelValue:r(t).isExternal,"onUpdate:modelValue":e[5]||(e[5]=n=>r(t).isExternal=n),color:"green"},{default:m(()=>[l(ge,null,{default:m(()=>[q("\u041F\u0440\u0438 \u043A\u043B\u0438\u043A\u0435 \u0432 \u043B\u0435\u043D\u0442\u0435 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),s("div",We,[l(xe,{bordered:"",padding:""},{default:m(()=>[l(R,{header:""},{default:m(()=>[q("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(i(!0),p($,null,j(r(t).categs,n=>fe((i(),x(Y,{key:n.id,tag:"label"},{default:m(()=>[l(F,null,{default:m(()=>[l(R,null,{default:m(()=>[q(W(n.label),1)]),_:2},1024),l(R,{caption:""},{default:m(()=>[q(W(n.caption),1)]),_:2},1024)]),_:2},1024),l(F,{side:"",top:""},{default:m(()=>[l(oe,{color:"green",modelValue:n.checked,"onUpdate:modelValue":B=>n.checked=B,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[_e]])),128))]),_:1})])]),l(Ae),l(H,{spaced:"2em"}),l(D,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",autogrow:"",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:r(t).markdown,"onUpdate:modelValue":[e[7]||(e[7]=n=>r(t).markdown=n),e[8]||(e[8]=n=>g())],debounce:300,dense:""},null,8,["modelValue"]),s("div",He,[l(L,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",color:"red",onClick:e[9]||(e[9]=n=>f())}),r(t).isShow?(i(),x(L,{key:0,label:"\u0421\u043A\u0440\u044B\u0442\u044C",color:"orange",outline:"",onClick:e[10]||(e[10]=n=>v())})):(i(),x(L,{key:1,label:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C",color:"green",outline:"",onClick:e[11]||(e[11]=n=>v())})),l(L,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green",onClick:e[12]||(e[12]=n=>a(0))})]),Je,Ke,Ye,Ze])):k("",!0),Ge,Xe],64))}};var tt=ee(et,[["__scopeId","data-v-33c749ca"]]);const at={class:"newsImg"},lt={key:0,class:"btnArea"},ot={__name:"EntryPhoto",props:{id:{type:Number,required:!0},md5:{type:String,required:!0},ext:{type:String,required:!0},size:{type:Number,required:!1,default:1080}},emits:["onDel"],setup(w,{emit:d}){const b=String("https://api.sakh-orch.ru/"),t=T("editMode"),h=d;return(y,P)=>(i(),p("div",at,[r(t)?(i(),p("div",lt,[l(J,{tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E","throw-confirm":"",onOnOk:P[0]||(P[0]=I=>h("onDel",w.id))})])):k("",!0),l(G,{src:r(X)(r(b),w.md5,w.ext,w.size),fit:"fill"},null,8,["src"])]))}};var ie=ee(ot,[["__scopeId","data-v-a666a9ca"]]);const nt={key:0,class:"contentArea"},it={key:1,class:"contentArea"},rt={key:0,class:"textBlock"},dt=["innerHTML"],st={key:1},ut={key:2,class:"videoItem"},ct={key:2,class:"content"},mt=s("div",{class:"newsarea"},[s("div",{class:"narea"},[s("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),pt=[mt],Dt={__name:"NewPage",setup(w){U(0);const d=U(null);z("Entry",d);const b=Z(),t=String("https://api.sakh-orch.ru/"),h=K(),y=T("editMode"),P=U(!1),I=U(!0),Q=U();we(()=>{var u,c;return $e((c=(u=d==null?void 0:d.value)==null?void 0:u.title)!=null?c:"\u041D\u043E\u0432\u043E\u0441\u0442\u044C")});function S(){I.value=!0,V.post(t+"api/news/entry.php",{params:{method:"get",id:h.params.id}}).then(u=>{var c,_,a;if(!((c=u==null?void 0:u.data)!=null&&c.result))throw new Error;d.value=(a=(_=u==null?void 0:u.data)==null?void 0:_.data)!=null?a:null}).catch(u=>{P.value=!0,b.notify(E(u))}).finally(()=>{I.value=!1})}const C=ne(()=>d.value.parsedMD.filter(c=>c.type==="img").map(c=>d.value.Photos.find(_=>_.id===c.fileId)).filter(Boolean)),M=ne(()=>{const u=C.value.map(c=>c.id);return d.value.Photos.filter(c=>!u.includes(c.id))});function O(u){y.value&&Q.value.unlinkPhoto(u)}return re(()=>{S()}),(u,c)=>{var _;return i(),p($,null,[r(y)&&d.value?(i(),p("div",nt,[r(y)&&d.value?(i(),x(tt,{key:0,onUploaded:c[0]||(c[0]=a=>S()),ref_key:"editorRef",ref:Q},null,512)):k("",!0)])):k("",!0),l(Qe,{title:((_=d.value)==null?void 0:_.title)||"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",loading:I.value},null,8,["title","loading"]),d.value?(i(),p("div",it,[(i(!0),p($,null,j(d.value.parsedMD,(a,f)=>(i(),p($,{key:f},[a.type==="text"?(i(),p("div",rt,[a.content!==`
`?(i(),p("section",{key:0,innerHTML:a.content},null,8,dt)):(i(),p("br",st))])):k("",!0),a.type==="img"?(i(),x(ie,{key:1,id:a.fileId,md5:a.md5,ext:a.ext,onOnDel:O},null,8,["id","md5","ext"])):k("",!0),a.type==="video"?(i(),p("div",ut,[l(ue,{ratio:16/9,src:"https://www.youtube.com/embed/"+a.content},null,8,["src"])])):k("",!0)],64))),128)),d.value.refLink?(i(),p($,{key:0},[l(H,{spaced:"1em"}),l(Y,{clickable:"",href:d.value.refLink},{default:m(()=>[l(F,{avatar:""},{default:m(()=>[l(ke,{name:"link"})]),_:1}),l(F,null,{default:m(()=>[l(R,null,{default:m(()=>[q("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "+W(d.value.refName),1)]),_:1})]),_:1})]),_:1},8,["href"])],64)):k("",!0),M.value.length?(i(),p($,{key:1},[l(H,{spaced:"2em"}),(i(!0),p($,null,j(M.value,(a,f)=>(i(),x(ie,{key:f,id:a.id,ext:a.ext,md5:a.md5,onOnDel:O},null,8,["id","ext","md5"]))),128))],64)):k("",!0)])):I.value?k("",!0):(i(),p("div",ct,pt))],64)}}};export{Dt as default};
