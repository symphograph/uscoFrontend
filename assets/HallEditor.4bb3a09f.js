import{_ as Y,i as m,f,g as C,F as E,au as F,v as b,h as o,G as a,aZ as D,a1 as ee,t as y,x,ax as le,bk as re,a2 as G,j as Q,bM as te,ce as ae,av as H,aw as ce,as as se,c as $,r as T,bN as W,aY as ue,p as N,o as de,a as pe,aX as fe,T as j,da as _e}from"./index.672b0c3c.js";import{api as A}from"./axios.92e9b1f5.js";import{n as q,b as me}from"./myFuncts.8c7f864e.js";import{u as oe}from"./use-quasar.fcbdae8e.js";import{Q as K}from"./QSelect.76620d07.js";import{Q as ie,b as z,a as L}from"./QItemSection.9e27c49b.js";import{Q as X}from"./QTooltip.3de1524c.js";import"./jwt-decode.esm.74bd4619.js";import"./rtl.db001b98.js";import"./position-engine.19be774c.js";import"./format.3e32b8d9.js";const ve={class:"priceRow"},ye=["onClick"],be={__name:"PriceInputs",emits:["onSelectPrice"],setup(V,{emit:h}){const l=m("selectedPrice"),s=m("HallPlan");function i(t){l.value=t}const _=m("colors");function n(t){return t.priceType===l.value.priceType?"1.5em":"1em"}return(t,P)=>(f(),C("div",ve,[(f(!0),C(E,null,F(a(s).pricing,u=>(f(),C("div",{key:u.priceType,class:"priceCell"},[b("div",{style:{cursor:"pointer"},onClick:r=>i(u)},[o(D,{label:u.label,dense:"","label-color":a(_)[u.priceType][0],step:"100","input-class":"priceInput",modelValue:a(s).pricing.find(r=>r.priceType===u.priceType).price,"onUpdate:modelValue":r=>a(s).pricing.find(v=>v.priceType===u.priceType).price=r,type:"number"},null,8,["label","label-color","modelValue","onUpdate:modelValue"]),o(ee,{name:"edit",color:a(_)[u.priceType][0],size:n(u)},null,8,["color","size"])],8,ye)]))),128))]))}};var ke=Y(be,[["__scopeId","data-v-607c9cf6"]]);const Ce={style:{width:"100%",border:"1px solid lightgray","border-radius":"3px"}},we={__name:"StructureInputs",setup(V){const h=m("initCells"),l=m("HallPlan"),s=m("addCountable");return(i,_)=>(f(),C(E,null,[o(D,{label:"\u0420\u044F\u0434\u043E\u0432",modelValue:a(l).structure.cntRows,"onUpdate:modelValue":_[0]||(_[0]=n=>a(l).structure.cntRows=n),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),o(D,{label:"\u042F\u0447\u0435\u0435\u043A",modelValue:a(l).structure.cntCols,"onUpdate:modelValue":_[1]||(_[1]=n=>a(l).structure.cntCols=n),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),b("div",Ce,[o(X,{delay:"300"},{default:y(()=>[x("\u0412\u0441\u0435\u0433\u0434\u0430 \u0443\u0447\u0438\u0442\u044B\u0432\u0430\u0442\u044C \u044F\u0447\u0435\u0439\u043A\u0443 \u043F\u0440\u0438 \u043F\u043E\u0434\u0441\u0447\u0435\u0442\u0435 \u043C\u0435\u0441\u0442 \u0440\u044F\u0434\u0430.")]),_:1}),o(re,{modelValue:a(s),"onUpdate:modelValue":_[2]||(_[2]=n=>le(s)?s.value=n:null),label:"+1"},null,8,["modelValue"])]),o(G,{label:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",onClick:a(h),class:"defbtn",outline:""},null,8,["onClick"])],64))}},he={__name:"ModeSelect",setup(V){const h=[{value:"Offline",label:"\u0417\u0430\u043D\u044F\u0442\u044B\u0435 \u043C\u0435\u0441\u0442\u0430",descr:"\u041C\u0435\u0441\u0442\u0430, \u0447\u044C\u0438 \u0431\u0438\u043B\u0435\u0442\u044B \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B \u043E\u043D\u043B\u0430\u0439\u043D. \u0418\u0445 \u0437\u0430\u0431\u0440\u0430\u043B\u0438 \u043E\u0447\u043D\u043E."},{value:"Prices",label:"\u0426\u0435\u043D\u044B",descr:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u0446\u0435\u043D \u0438 \u043F\u0440\u0438\u0432\u044F\u0437\u043A\u0430 \u043C\u0435\u0441\u0442\u0430 \u043A \u0442\u0438\u043F\u0443 \u0446\u0435\u043D\u044B"},{value:"Structure",label:"\u0421\u0442\u0440\u0443\u043A\u0442\u0443\u0440\u0430 \u0417\u0430\u043B\u0430",descr:"\u041E\u0442\u043C\u0435\u0447\u0430\u0435\u0442 \u044F\u0447\u0435\u0439\u043A\u0443 \u043A\u0430\u043A \u043F\u0440\u043E\u0445\u043E\u0434 \u0438\u043B\u0438 \u043C\u0435\u0441\u0442\u043E"}],l=m("selectedMode"),s=m("selectedPrice"),i=m("colors");function _(){return l.value==="Prices"?i[s.value.priceType][0]:"amber"}return(n,t)=>(f(),Q(K,{modelValue:a(l),"onUpdate:modelValue":t[0]||(t[0]=P=>le(l)?l.value=P:null),color:"amber","label-color":_(),outlined:"","emit-value":"","map-options":"",style:{width:"100%"},options:h,label:"\u0427\u0442\u043E \u0431\u0443\u0434\u0435\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C?"},{prepend:y(()=>[o(ee,{name:"edit",color:_()},null,8,["color"])]),option:y(P=>[o(ie,te(ae(P.itemProps)),{default:y(()=>[o(z,null,{default:y(()=>[o(L,null,{default:y(()=>[x(H(P.opt.label),1)]),_:2},1024),o(L,{caption:""},{default:y(()=>[x(H(P.opt.descr),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label-color"]))}};const Te={class:"menuArea"},Pe={class:"menuBlock"},ge={class:"blockRow"},xe={class:"blockRow"},He=["src"],Ve={class:"menuBlock"},Se={class:"blockRow"},Ie={key:0,class:"blockRow"},Ne={__name:"HallCreatorMenu",emits:["onSelectHall","onSelectPrice"],setup(V,{emit:h}){const l=oe(),s=m("HallPlan"),i=m("Halls"),_=m("selectedMode"),n=m("announceList");m("colors");function t(r){let v=480;return l.platform.is.mobile&&(v=1080),String("https://api.sakh-orch.ru/")+r.folder+"/"+v+"/"+r.fileName+"?ver="+r.md5}function P(){}function u(r){h("onSelectHall",r)}return(r,v)=>(f(),C("div",Te,[b("div",Pe,[b("div",ge,[o(K,{options:a(i),modelValue:a(s).id,"onUpdate:modelValue":[v[0]||(v[0]=c=>a(s).id=c),v[1]||(v[1]=c=>u(a(s).id))],color:"amber",outlined:"",style:{width:"100%"},"emit-value":"","map-options":"","option-value":"id","option-label":"name"},null,8,["options","modelValue"])]),b("div",xe,[a(n).length?(f(),Q(K,{key:0,options:a(n),modelValue:a(n).id,"onUpdate:modelValue":[v[2]||(v[2]=c=>a(n).id=c),v[3]||(v[3]=c=>void 0)],color:"amber",outlined:"",style:{width:"100%"},"emit-value":"","map-options":"","option-value":"id","option-label":"progName"},{option:y(c=>[o(ie,te(ae(c.itemProps)),{default:y(()=>[o(z,{avatar:""},{default:y(()=>[b("img",{style:{width:"50px"},src:t(c.opt.Sketch)},null,8,He)]),_:2},1024),o(z,null,{default:y(()=>[o(L,null,{default:y(()=>[x(H(c.opt.progName),1)]),_:2},1024),o(L,{caption:""},{default:y(()=>[x(H(c.opt.datetime),1)]),_:2},1024)]),_:2},1024),o(z,{side:""},{default:y(()=>[o(ce,{modelValue:c.opt.isShow,"onUpdate:modelValue":M=>c.opt.isShow=M,color:"green"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040),o(se)]),_:1},8,["options","modelValue"])):$("",!0)])]),b("div",Ve,[b("div",Se,[o(he)]),a(_)==="Structure"?(f(),C("div",Ie,[o(we)])):$("",!0),a(_)==="Prices"?(f(),Q(ke,{key:1})):$("",!0)])]))}};var $e=Y(Ne,[["__scopeId","data-v-58689219"]]);const Qe=b("br",null,null,-1),Re=b("br",null,null,-1),Ue={key:1,class:"forceCount"},Be={__name:"HallBuilderCell",props:{cell:Object,ticket:Object},emits:["cellClick"],setup(V,{emit:h}){const l=V,s=m("colors"),i=T(l.ticket),_=m("HallPlan"),n=m("selectedMode"),t=m("selectedPrice"),P=m("addCountable"),u=T(!1),r=T(0);function v(d){var k;return(k=_.value.tickets.find(S=>S.id===d))!=null?k:!1}function c(){var d,k,S,I;console.log(i.value),(k=(d=i==null?void 0:i.value)==null?void 0:d.id)!=null&&k&&(console.log(l.ticket),r.value.id!==((I=(S=i==null?void 0:i.value)==null?void 0:S.id)!=null?I:0)&&(u.value=!1),t.value.priceType===i.value.priceType?i.value.priceType=u.value:(u.value=i.value.priceType,i.value.priceType=t.value.priceType),r.value=i.value.id)}function M(d){d.exist=!d.exist,v(d.id)||_.value.tickets.push({id:d.id,offline:!1,seatRow:0,seatNum:0,priceType:"Invite"}),d.forceCount=!!(!d.exist&&P.value),console.log(d)}function R(d){switch(n.value){case"Structure":{M(d);break}case"Prices":{c();break}case"Offline":{i.value.offline=!i.value.offline;break}default:{if(d.priceType===n.value.value){d.priceType="Invite";break}d.priceType=n.value.value}}}return(d,k)=>{var S,I,O;return f(),C("div",{class:"cellArea",onClick:k[0]||(k[0]=Z=>R(V.cell))},[l.cell.exist?(f(),C(E,{key:0},[V.ticket.offline?(f(),C("div",{key:0,class:"offlineCell",style:W({borderColor:a(s)[((S=l.ticket)==null?void 0:S.priceType)||"Invite"][1],backgroundColor:a(s)[((I=l.ticket)==null?void 0:I.priceType)||"Invite"][1]})},null,4)):(f(),C("div",{key:1,class:"availableCell",style:W({borderColor:a(s)[((O=l.ticket)==null?void 0:O.priceType)||"Invite"][1]})},[x(H(l.ticket.seatNum)+" ",1),o(X,{offset:[0,-120],"max-width":"20em",delay:300},{default:y(()=>[x(H("\u041C\u0435\u0441\u0442\u043E: "+l.ticket.seatNum),1),Qe,x(" "+H("\u0420\u044F\u0434: "+l.ticket.seatRow),1),Re,x(" "+H("\u0426\u0435\u043D\u0430: "+l.ticket.priceType),1)]),_:1})],4))],64)):l.cell.forceCount?(f(),C("div",Ue,[x("? "),o(X,{offset:[0,-100],"max-width":"20em"},{default:y(()=>[x(" \u041F\u043E \u043A\u0430\u043A\u0438\u043C-\u0442\u043E \u043F\u0440\u0438\u0447\u0438\u043D\u0430\u043C \u044D\u0442\u043E \u043C\u0435\u0441\u0442\u043E \u043F\u043E\u0441\u0447\u0438\u0442\u0430\u043D\u043E \u0432 \u0441\u0445\u0435\u043C\u0435, \u043D\u043E \u043D\u0430 \u0441\u0430\u043C\u043E\u043C \u0434\u0435\u043B\u0435 \u0435\u0433\u043E \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1})])):$("",!0)])}}};const Me={style:{width:"max-content"}},Ee={style:{margin:"auto"}},Oe={class:"rowNumber"},ze={class:"rowNumber"},Le={__name:"HallTable",emits:["cellClick","ticket"],setup(V,{emit:h}){const l=m("HallPlan");function s(n){h("cellClick",n)}function i(n){h("ticket",n)}function _(n){return l.value.tickets.find(t=>t.id===n)}return(n,t)=>a(l).tickets.length?(f(),Q(ue,{key:0},{default:y(()=>[b("table",Me,[b("tbody",Ee,[(f(!0),C(E,null,F(a(l).cells,(P,u)=>(f(),C("tr",{key:"row_"+u},[b("td",null,[b("div",Oe,H(a(l).structure.rowNums[u]||""),1)]),(f(!0),C(E,null,F(P,(r,v)=>(f(),C("td",{key:u+"_"+v},[(f(),Q(Be,{cell:a(l).cells[r.row-1][r.col-1],"onUpdate:cell":c=>a(l).cells[r.row-1][r.col-1]=c,ticket:_(r.id),key:r.id,onCellClick:c=>s(c),onTickedClick:t[0]||(t[0]=c=>i(c))},null,8,["cell","onUpdate:cell","ticket","onCellClick"]))]))),128)),b("td",null,[b("div",ze,H(a(l).structure.rowNums[u]||""),1)])]))),128))])])]),_:1})):$("",!0)}};var je=Y(Le,[["__scopeId","data-v-4c630040"]]);const Ae={class:"content"},qe={style:{overflow:"auto",margin:"1em auto"}},tl={__name:"HallEditor",setup(V){const h=String("https://api.sakh-orch.ru/"),l=oe(),s=T("Prices");N("selectedMode",s);const i=T([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);N("defaultPricing",i);const _=T({priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"});N("selectedPrice",_);const n=T(!1);N("addCountable",n);const t=T({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:i.value,cells:[],tickets:[]});N("HallPlan",t),N("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]});const u=T(!1);N("progress",u);const r=T([]);N("announceList",r);function v(){s.value==="Structure"&&I(),A.post(h+"api/tickets/hallplan/set.php",{params:{plan:t.value,id:t.value.id}}).then(e=>{var p,w,g;if(!((p=e==null?void 0:e.data)!=null&&p.result))throw new Error;l.notify(me((g=(w=e==null?void 0:e.data)==null?void 0:w.result)!=null?g:""))}).catch(e=>{l.notify(q(e))})}async function c(){k.value=!1,t.value.cells=[];let e=[],p=[],w=0,g={};for(let U=1;U<=t.value.structure.cntRows;U++){for(let B=1;B<=t.value.structure.cntCols;B++)w++,g={id:w,row:U,col:B,exist:!0,forceCount:!1},p.push(g);e.push(p),p=[]}t.value.cells=e,await I(),await j(),k.value=!0}N("initCells",c);function M(e){if(!e.exist&&!e.forceCount||(e.forceCount&&R.value++,!e.exist))return!1;R.value++;let p={id:e.id,offline:!1,seatRow:d.value,seatNum:R.value,priceType:"Invite"};t.value.tickets.push(p)}const R=T(0),d=T(0),k=T(!1);function S(e){if(R.value=0,O(e)){t.value.structure.rowNums.push(!1);return}d.value++,t.value.structure.rowNums.push(d.value),e.forEach(p=>M(p))}async function I(){k.value=!1,d.value=0,t.value.tickets=[],t.value.structure.rowNums=[],t.value.cells.forEach(e=>S(e)),await j(),k.value=!0}function O(e){return![...e].filter(w=>w.exist).length}function Z(e){ne(e),J()}function J(){A.post(h+"api/tickets/hallplan/get.php",{params:{id:t.value.id}}).then(async e=>{var p,w,g,U,B;if(!((p=e==null?void 0:e.data)!=null&&p.result))throw new Error;if(!((g=(w=e==null?void 0:e.data)==null?void 0:w.data)!=null&&g.HallPlan)){c();return}k.value=!1,t.value=(B=(U=e==null?void 0:e.data)==null?void 0:U.data)==null?void 0:B.HallPlan,await j(),k.value=!0}).catch(e=>{c(),l.notify(q(e))})}function ne(e){u.value=!0,A.post(h+"api/event/announce.php",{params:{hallId:e,method:"listByHall"}}).then(p=>{var w,g;r.value=(g=(w=p==null?void 0:p.data)==null?void 0:w.data)!=null?g:[]}).catch(p=>{l.notify(q(p)),r.value=[]}).finally(()=>{u.value=!1})}return de(()=>{}),pe(()=>{J()}),(e,p)=>(f(),C("div",Ae,[o($e,{onOnSelectHall:p[0]||(p[0]=w=>Z(w))}),b("div",qe,[o(fe,{style:{width:"max-content",padding:"2em",margin:"0 auto"},dark:""},{default:y(()=>[k.value?(f(),Q(je,{key:0})):$("",!0),o(_e,{style:{display:"flex","justify-content":"end"}},{default:y(()=>[o(G,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",onClick:v}),s.value==="Prices"?(f(),Q(G,{key:0,label:"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C",onClick:I})):$("",!0)]),_:1})]),_:1})])]))}};export{tl as default};
