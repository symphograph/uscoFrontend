import{Q as F}from"./QImg.97937970.js";import{Q as te}from"./QVideo.ec68744e.js";import{u as ae}from"./use-meta.3869391f.js";import{u as J}from"./use-quasar.e1734797.js";import{api as I}from"./axios.b6965e20.js";import{aL as le,aM as oe,_ as ne,i as B,u as K,d as ie,r as x,p as Z,f as d,g as r,J as s,h as i,a_ as U,A as n,j as E,a4 as k,c as g,z as h,B as j,F as V,av as M,a7 as de,aw as D,ax as se,aZ as re,aY as ue,a8 as ce,D as pe,E as me,a as fe}from"./index.50239517.js";import{a as z,b as q,Q as ve}from"./QItemSection.f60ff076.js";import{Q as _e}from"./QList.50f8d67e.js";import{S as he,Q as ye}from"./SketchUploader.6512080e.js";import{b as H,n as b}from"./myFuncts.24341304.js";import"./use-ratio.98487b54.js";import"./QTooltip.10f580ad.js";import"./position-engine.cddceab3.js";import"./format.3e32b8d9.js";import"./get-emits-object.24798346.js";import"./jwt-decode.esm.74bd4619.js";function ge(_){const o=document.createElement("textarea");o.value=_,o.contentEditable="true",o.style.position="fixed";const a=()=>{};le(a),document.body.appendChild(o),o.focus(),o.select();const u=document.execCommand("copy");return o.remove(),oe(a),u}function we(_){return navigator.clipboard!==void 0?navigator.clipboard.writeText(_):new Promise((o,a)=>{const u=ge(_);u?o(!0):a(u)})}const $=_=>(pe("data-v-1f1df2b9"),_=_(),me(),_),ke={key:0,class:"newsarea"},be=$(()=>n("br",null,null,-1)),xe={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},Ve={class:"nimg_block",style:{position:"relative"}},$e={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},Ue={class:"inputArea"},Ie={class:"inputArea"},Ee={class:"input"},Se={id:"categs",class:"input"},Ce={id:"uploaderArea2",class:"input"},Qe={class:"uploaderArea"},Ne={class:"imagesArea"},Le={class:"row no-wrap"},Te={style:{display:"flex","justify-content":"flex-end","grid-gap":"1em",padding:"1em"}},Ae=$(()=>n("br",null,null,-1)),je=$(()=>n("br",null,null,-1)),Fe=$(()=>n("br",null,null,-1)),Me=$(()=>n("br",null,null,-1)),De=$(()=>n("br",null,null,-1)),ze=$(()=>n("br",null,null,-1)),Be={__name:"NewEditor",emits:["uploaded"],setup(_,{emit:o}){const a=B("newData"),u=String("https://api.sakh-orch.ru/"),f=J(),S=K(),N=ie(),C=o,Q=x(null),L=B("AccessToken"),c=x([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u0421\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]),v=x("");Z("pwUrl",v);function p(){var e,t;if(v.value)return v.value;let l=f.platform.is.mobile?1080:260;return u+"/img/entry/sketch/"+l+"/entry_"+a.value.id+".jpg?ver="+((t=(e=a.value)==null?void 0:e.verString)!=null?t:"jhj")}function y(l){l="![]("+l+")",we(l).then(()=>{f.notify({color:"positive",position:"center",message:"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E",icon:"content_copy",timeout:1})}).catch(()=>{})}function T(l,e){I.post(u+"api/news/photo.php",{params:{entryId:S.params.id,fileName:l,method:"del"}}).then(t=>{var m,w,Y;if(!((m=t==null?void 0:t.data)!=null&&m.result))throw new Error;f.notify(H((Y=(w=t==null?void 0:t.data)==null?void 0:w.result)!=null?Y:"")),a.value.Images.splice(e,1),C("uploaded")}).catch(t=>{f.notify(b(t))})}function A(){I.post(u+"api/news/sketch.php",{params:{method:"del",entryId:S.params.id}}).then(l=>{var e;if(!((e=l==null?void 0:l.data)!=null&&e.result))throw new Error;C("uploaded")}).catch(l=>{f.notify(b(l))})}function G(){return{url:u+"api/news/photo.php",headers:[{name:"ACCESSTOKEN",value:L.value}],formFields:[{name:"entryId",value:a.value.id},{name:"method",value:"add"}]}}function O(){Q.value.reset(),P()}function W(l){var t,m,w;let e=(w=(m=JSON.parse((t=l==null?void 0:l.xhr)==null?void 0:t.response))==null?void 0:m.error)!=null?w:"";f.notify(b(null,e))}function X(){const l=Object.keys(c.value);let e=[];return l.forEach(t=>{e[c.value[t].id]=c.value[t].checked}),e}function P(l=0){I.post(u+"api/news/entry.php",{params:{method:"update",entry:a.value,addNew:l,categs:X()}}).then(e=>{var t,m;f.notify(H((m=(t=e==null?void 0:e.data)==null?void 0:t.result)!=null?m:"")),C("uploaded")}).catch(e=>{f.notify(b(e))})}function ee(){I.post(u+"api/news/entry.php",{params:{method:"del",entryId:a.value.id}}).then(l=>{var e;if(!((e=l==null?void 0:l.data)!=null&&e.result))throw new Error;N.push({path:"/news/all"})}).catch(l=>{f.notify(b(l))})}function R(){I.post(u+"api/news/entry.php",{params:{method:a.value.isShow?"hide":"show",entryId:a.value.id}}).then(l=>{var e;if(!((e=l==null?void 0:l.data)!=null&&e.result))throw new Error;a.value.isShow=!a.value.isShow}).catch(l=>{f.notify(b(l))}).finally(()=>{})}return(l,e)=>(d(),r(V,null,[s(a)?(d(),r("div",ke,[i(U,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:s(a).title,"onUpdate:modelValue":e[0]||(e[0]=t=>s(a).title=t)},null,8,["modelValue"]),be,n("div",xe,[n("div",Ve,[i(F,{ratio:1920/1080,src:p(),fit:"fill",pwUrl:v.value},null,8,["src","pwUrl"]),v.value?g("",!0):(d(),E(k,{key:0,size:"0.7em",round:"",color:"red",icon:"delete",style:{transform:"translateY(-50%)",right:"1em","z-index":"100",position:"absolute",top:"2em"},onClick:e[1]||(e[1]=t=>A(s(a).img))}))]),n("div",$e,[i(he,{id:s(a).id,type:"news",onOnUploaded:O},null,8,["id"])])]),n("div",Ue,[i(U,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",style:{width:"100%"},type:"textarea",modelValue:s(a).descr,"onUpdate:modelValue":e[2]||(e[2]=t=>s(a).descr=t),outlined:""},null,8,["modelValue"])]),n("div",Ie,[n("div",Ee,[i(U,{type:"date",modelValue:s(a).date,"onUpdate:modelValue":e[3]||(e[3]=t=>s(a).date=t),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),i(U,{modelValue:s(a).refName,"onUpdate:modelValue":e[4]||(e[4]=t=>s(a).refName=t),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),i(U,{modelValue:s(a).refLink,"onUpdate:modelValue":e[5]||(e[5]=t=>s(a).refLink=t),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},null,8,["modelValue"])]),n("div",Se,[i(_e,{bordered:"",padding:""},{default:h(()=>[i(z,{header:""},{default:h(()=>[j("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(d(!0),r(V,null,M(s(a).categs,t=>de((d(),E(ve,{key:t.id,tag:"label"},{default:h(()=>[i(q,null,{default:h(()=>[i(z,null,{default:h(()=>[j(D(t.label),1)]),_:2},1024),i(z,{caption:""},{default:h(()=>[j(D(t.caption),1)]),_:2},1024)]),_:2},1024),i(q,{side:"",top:""},{default:h(()=>[i(se,{color:"green",modelValue:t.checked,"onUpdate:modelValue":m=>t.checked=m,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[ce]])),128))]),_:1})]),n("div",Ce,[n("div",Qe,[i(ye,{"input-style":"max-width: 300px; padding: 0",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",factory:G,"max-file-size":"50000000",ref_key:"uploader",ref:Q,onUploaded:O,onFailed:W,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)])])]),n("div",Ne,[(d(!0),r(V,null,M(s(a).Images,(t,m)=>(d(),E(ue,{key:m},{default:h(()=>[i(F,{ratio:96/54,src:s(u)+"/img/entry/photo/"+s(a).id+"/260/"+t},null,8,["src"]),i(re,null,{default:h(()=>[i(k,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{top:"0",right:"0.5em",transform:"translateY(-50%)"},onClick:w=>T(t,m)},null,8,["onClick"]),n("div",Le,[i(k,{padding:"0.5em 1em",icon:"content_copy",label:"\u041A\u043E\u0434",onClick:w=>y(t)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),i(U,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:s(a).markdown,"onUpdate:modelValue":e[6]||(e[6]=t=>s(a).markdown=t),dense:""},null,8,["modelValue"]),n("div",Te,[i(k,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",color:"red",onClick:e[7]||(e[7]=t=>ee())}),s(a).isShow?(d(),E(k,{key:0,label:"\u0421\u043A\u0440\u044B\u0442\u044C",color:"orange",outline:"",onClick:e[8]||(e[8]=t=>R())})):(d(),E(k,{key:1,label:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C",color:"green",outline:"",onClick:e[9]||(e[9]=t=>R())})),i(k,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green",onClick:e[10]||(e[10]=t=>P(0))})]),Ae,je,Fe,Me])):g("",!0),De,ze],64))}};var Oe=ne(Be,[["__scopeId","data-v-1f1df2b9"]]);const Pe={key:0,class:"content"},Re={key:1,class:"newsarea"},Ye={class:"p_title"},qe={class:"narea"},He={class:"text"},Je=["innerHTML"],Ke={key:1},Ze={key:1,class:"newsImg"},Ge={key:2,class:"vitem"},We={key:0},Xe=["href"],et={key:1,class:"content"},tt=n("div",{class:"newsarea"},[n("div",{class:"narea"},[n("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),at=[tt],gt={__name:"NewPage",setup(_){x(0);const o=x(null);Z("newData",o);const a=J(),u=String("https://api.sakh-orch.ru/"),f=K(),S=B("editMode"),N=x("\u041D\u043E\u0432\u043E\u0441\u0442\u044C"),C=x(!1);ae(()=>({title:N.value}));function Q(c){return u+"/img/entry/photo/"+o.value.id+"/1080/"+c}function L(){I.post(u+"api/news/entry.php",{params:{method:"get",id:f.params.id}}).then(c=>{var v,p,y,T,A;if(!((v=c==null?void 0:c.data)!=null&&v.result))throw new Error;o.value=(y=(p=c==null?void 0:c.data)==null?void 0:p.data)!=null?y:null,N.value=(A=(T=o==null?void 0:o.value)==null?void 0:T.title)!=null?A:""}).catch(c=>{C.value=!0,a.notify(b(c))})}return fe(()=>{L()}),(c,v)=>o.value||s(S)?(d(),r("div",Pe,[s(S)&&o.value?(d(),E(Oe,{key:0,onUploaded:v[0]||(v[0]=p=>L())})):g("",!0),o.value?(d(),r("div",Re,[n("div",Ye,D(o.value.title),1),n("div",qe,[n("div",He,[(d(!0),r(V,null,M(o.value.parsedMD,(p,y)=>(d(),r(V,{key:y},[p.type==="text"?(d(),r(V,{key:0},[p.content!==`
`?(d(),r("section",{key:0,innerHTML:p.content},null,8,Je)):(d(),r("br",Ke))],64)):g("",!0),p.type==="img"?(d(),r("div",Ze,[i(F,{src:Q(p.content),fit:"fill"},null,8,["src"])])):g("",!0),p.type==="video"?(d(),r("div",Ge,[i(te,{ratio:16/9,src:"https://www.youtube.com/embed/"+p.content},null,8,["src"])])):g("",!0)],64))),128)),o.value.refLink?(d(),r("div",We,[j("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "),n("a",{href:o.value.refLink,target:"_blank"},D(o.value.refName),9,Xe)])):g("",!0),(d(!0),r(V,null,M(o.value.unusedImages,(p,y)=>(d(),r("div",{class:"newsImg",key:y},[i(F,{src:Q(p),fit:"fill"},null,8,["src"])]))),128))])])])):g("",!0)])):(d(),r("div",et,at))}};export{gt as default};
