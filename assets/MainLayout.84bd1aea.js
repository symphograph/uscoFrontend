import{P as T}from"./LocalStorage.dcf8f94f.js";import{u as O}from"./use-quasar.ff1c236f.js";import{api as h}from"./axios.4ccd572a.js";import{n as C}from"./myFuncts.bfee3d05.js";import{u as x,i as S,r as a,p as l,k as q,o as D,l as E,w as P,m as b,n as L,q as B,f as N,t as F,F as U}from"./index.d7d1bcb8.js";import{m as r}from"./myAuth.f2132660.js";import{u as j}from"./use-meta.6535a57c.js";const u="SessionToken",f="AccessToken",V={__name:"AuthComponent",setup(H,{expose:M}){const n=O(),k=String("https://api.sakh-orch.ru/");x();const y=S("isOptionsLoaded"),w=S("admin"),A=S("Halls");function p(){console.log("loadOptions started"),h.post(k+"api/get/options.php",{params:{}}).then(t=>{var o,e,i,c;if(!((o=t==null?void 0:t.data)!=null&&o.result))throw new Error;A.value=(c=(i=(e=t==null?void 0:t.data)==null?void 0:e.data)==null?void 0:i.Halls)!=null?c:[],console.log("options Loaded"),y.value=!0}).catch(t=>{n.notify(C(t))})}const v=a(""),g=a("");function s(t,o,e="90d"){n.cookies.set(t,o,{expires:e,path:"/",domain:null,sameSite:"Strict",secure:!0,httpOnly:!1}),t===f&&(h.defaults.headers.common.AccessToken=o,v.value=o,r.self.AccessToken=o),t===u&&(g.value=o,r.self.SessionToken=o)}function m(){h.post(String("https://auth.symphograph.ru/")+"/api/register.php",{params:{authType:"default"}}).then(t=>{var o,e,i,c,d;if(!((o=t==null?void 0:t.data)!=null&&o.result))throw new Error;s(f,(i=(e=t==null?void 0:t.data)==null?void 0:e.data.AccessToken)!=null?i:""),s(u,(d=(c=t==null?void 0:t.data)==null?void 0:c.data.SessionToken)!=null?d:""),p()}).catch(t=>{n.notify(C(t))})}l("register",m);function _(){h.post(String("https://auth.symphograph.ru/")+"/api/refresh.php",{params:{SessionToken:r.self.SessionToken,AccessToken:r.self.AccessToken}}).then(t=>{var o,e,i,c,d;if(!((o=t==null?void 0:t.data)!=null&&o.result))throw new Error;s(u,(i=(e=t==null?void 0:t.data)==null?void 0:e.data.SessionToken)!=null?i:""),s(f,(d=(c=t==null?void 0:t.data)==null?void 0:c.data.AccessToken)!=null?d:""),w.value=r.self.isPermit([4]),p()}).catch(t=>{var o;if(((o=t==null?void 0:t.response)==null?void 0:o.status)===401){m();return}n.notify(C(t))})}return l("refreshAccessToken",_),M({}),q(()=>{console.log("auth beforeMounted"),h.defaults.headers.common.Accept="application/json",r.self=new r}),D(()=>{console.log("auth Mounted"),!n.cookies.getAll()[f]||!n.cookies.getAll()[u]?m():(s(u,n.cookies.getAll()[u]),s(f,n.cookies.getAll()[f]),_())}),(t,o)=>E("",!0)}};const K={__name:"MainLayout",setup(H){j({meta:{viewport:{name:"viewport",content:"initial-scale=1, width=device-width, user-scalable=yes"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}});const n=O(),k=x(),y=a(),w=a(!1);l("progress",w);const A=a(!1);l("editMode",A);const p=a(!1);l("admin",p);const v=a(!1);l("leftDrawerOpen",v),a("gfdsg"),a("gfdsg");const g=a(!1);l("isOptionsLoaded",g);const s=a([]);l("Halls",s),P(k,t=>{T.set("lastPath",t.path)});function m(){T.set("CookieConfirm","1")}function _(){T.getItem("CookieConfirm")||n.notify({message:"\u041C\u044B \u0442\u043E\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C Cookies. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0431\u0435\u0437 \u043D\u0438\u0445 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442.",color:"primary",timeout:0,multiLine:!0,onDismiss:m,icon:"ion-information-circle-outline",actions:[{label:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E",color:"yellow",handler:()=>{}}]})}return q(()=>{console.log("mainLayout beforeMount")}),D(()=>{T.set("lastPath",k.path),console.log("mainLayout Mounted"),_()}),(t,o)=>{const e=b("router-view");return L(),B(U,null,[N(V,{ref_key:"refAuth",ref:y},null,512),g.value?(L(),F(e,{key:0})):E("",!0)],64)}}};export{K as default};
