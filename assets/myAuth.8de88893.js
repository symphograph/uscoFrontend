var y=Object.defineProperty;var A=(r,t,e)=>t in r?y(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var u=(r,t,e)=>(A(r,typeof t!="symbol"?t+"":t,e),e);import{a as T}from"./myAxios.f72ca8da.js";import{a as p}from"./axios.63d2f48d.js";const l=class{constructor(t="",e=""){u(this,"AccessToken");u(this,"SessionToken");this.AccessToken=t,this.SessionToken=e}powers(){return n.powers(this.AccessToken)}authType(){return n.authType(this.AccessToken)}id(){return n.userId(this.AccessToken)}persId(){return n.persId(this.AccessToken)}isPermit(t){return t.length?t.some(e=>this.powers().includes(e)):!0}};let o=l;u(o,"self",new l);class n{static powers(t){var a;return(a=this.getPayload(t).powers)!=null?a:[]}static userId(t){var a;return(a=this.getPayload(t).uid)!=null?a:0}static getExploded(t){let[e,a,i]=t.split(".");return{header:e,payload:JSON.parse(atob(a)),Signature:i}}static getPayload(t){return this.getExploded(t).payload}static authType(t){return this.getPayload(t).authType}static persId(t){return this.getPayload(t).persId}}class f{static async register(t){const e={method:"register",authType:"default"},a="auth err",i=await T.get(t,"epoint/register.php",e,a);return i?(d.set(t,i.AccessToken),k.set(t,i.SessionToken),!0):!1}}class d{static getName(){return String("AccessToken")}static set(t,e){t.cookies.set(this.getName(),e,{expires:"1d",path:"/",sameSite:"Strict",secure:!0,httpOnly:!1}),p.defaults.headers.common.AccessToken=e,o.self.AccessToken=e}static get(t){return t.cookies.getAll()[this.getName()]}static async refresh(t){const e=T.getApiUrl("epoint/refresh.php"),a={method:"refresh",SessionToken:o.self.SessionToken,AccessToken:o.self.AccessToken},i="\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0442\u043E\u043A\u0435\u043D\u0430";return p.post(e,{params:a}).then(s=>{var c,h,g;if(!((c=s==null?void 0:s.data)!=null&&c.result))throw new Error(i);return k.set(t,(h=s==null?void 0:s.data)==null?void 0:h.data.SessionToken),d.set(t,(g=s==null?void 0:s.data)==null?void 0:g.data.AccessToken),!0}).catch(async s=>{var c;return((c=s==null?void 0:s.response)==null?void 0:c.status)===401?await f.register(t):!1})}}class k{static getName(){return String("SessionToken")}static set(t,e){t.cookies.set(this.getName(),e,{expires:"90d",path:"/",sameSite:"Strict",secure:!0,httpOnly:!1}),o.self.SessionToken=e}static get(t){return t.cookies.getAll()[this.getName()]}}export{d as A,k as S,f as a,n as b,o as m};
