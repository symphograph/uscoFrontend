import{Q as q}from"./QTooltip.ad78f121.js";import{i as F,r as l,p as r,o as rt,m as n,E as v,f as t,q as e,x as c,F as S,n as p,t as _,B as g,l as f,ax as I,G as O,v as C,D as it,Q as nt,C as W,bm as ut,az as dt,aA as ct}from"./index.5aa96458.js";import{Q as A}from"./QItemLabel.73975017.js";import{u as pt,a as K,Q as h}from"./QItem.ef50f7fe.js";import{a as ft}from"./QExpansionItem.78240fe0.js";import{Q as H}from"./QImg.dc91bf2a.js";import{Q as mt}from"./QList.32a7e7be.js";import{h as vt,g as _t,n as M,i as gt}from"./myFuncts.85bc6a35.js";import{u as ht}from"./use-meta.7f7b99e9.js";import{api as N}from"./axios.dbe2299d.js";import{_ as yt,a as kt,b as Dt,c as Pt,d as Qt}from"./AddPlayerDialog.950cb3b4.js";import{m as U}from"./myAuth.f2132660.js";import{P as St}from"./PageShell.014bf298.js";import{_ as Ct}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.21ae1c83.js";import"./selection.b7755035.js";import"./style.4fbde924.js";import"./format.3e32b8d9.js";import"./use-file.20a37dd4.js";import"./get-emits-object.24798346.js";/* empty css               */import"./BtnDelete.5972ca8c.js";import"./QPopupProxy.246b1bf2.js";import"./use-render-cache.1a7235d4.js";import"./QMenu.62bd5299.js";import"./ClosePopup.3f328ef0.js";import"./QToolbar.1fbe3b97.js";import"./QScrollArea.004b3301.js";import"./TouchPan.c880163b.js";import"./touch.3df10340.js";import"./QLinearProgress.8b629c3f.js";import"./MainFooter.d809ceff.js";import"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.8feca47a.js";import"./AnderHeader.90ed218c.js";/* empty css                                                    */const It=y=>(dt("data-v-36e6b635"),y=y(),ct(),y),wt={class:"centralCol"},bt={class:"gridArea"},$t={key:0,class:"group"},xt={class:"cardTitle"},At=It(()=>I("br",null,null,-1)),Mt={__name:"StaffPage",setup(y){const w=pt(),k=String("https://api.staff.sakh-orch.ru/"),D=F("editMode"),u=l(!1);r("staffEditMode",u);const m=l(!1);r("progress",m);const d=l([]);r("groups",d);const J=l(""),b=l(vt(new Date).format("YYYY-MM-DD"));r("condDate",b);const B=l(!1);r("showUploader",B),r("pwUrl",J);const R=U.self.persId(),E=l(0);r("selectedPersId",E);const T=l({});r("selectedPers",T);const V=l(null);r("selectedGroup",V);const P=l([]);r("actionDates",P);const X=F("stopScrollWatch"),Y=l([{id:1,name:"\u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043D\u0442 \u0434\u0438\u0440\u0438\u0436\u0435\u0440\u0430"},{id:2,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"},{id:3,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u0433\u0440\u0443\u043F\u043F\u044B"},{id:4,name:"\u041F\u043E\u043C\u043E\u0449\u043D\u0438\u043A \u043A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440\u0430"},{id:5,name:"\u0420\u0435\u0433\u0443\u043B\u044F\u0442\u043E\u0440"}]);r("statusNames",Y);const z=l(!1);r("showStatusDialog",z);const G=l(!1);r("showAddPlayerDialog",G);const Z=l("\u0421\u043E\u0441\u0442\u0430\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"),L=_t(Z.value);ht(L);function $(a=!1){return m.value=!0,P.value=[],N.post(k+"api/staff.php",{params:{method:"actionDates",force:a}}).then(o=>{var s,i;P.value=(i=(s=o==null?void 0:o.data)==null?void 0:s.data)!=null?i:[]}).catch(o=>{throw P.value=[],w.notify(M(o)),o}).finally(()=>{m.value=!1})}function x(){console.log("start loadData"),m.value=!0,N.post(k+"api/staff.php",{params:{method:"get",date:b.value}}).then(a=>{var o,s;X(),d.value=[],d.value=Object.values((s=(o=a==null?void 0:a.data)==null?void 0:o.data)!=null?s:[])}).catch(a=>{d.value=[],w.notify(M(a))}).finally(()=>{m.value=!1})}r("loadData",x);function j(){N.post(k+"/api/staff.php",{params:{method:"update",groups:d.value,date:b.value}}).then(a=>{$()}).catch(a=>{w.notify(M(a))})}function tt(a){!D.value&&R!==a||(E.value=a,B.value=!0)}function at(a){!D.value||(T.value=a,z.value=!0)}function et(a){V.value=a,G.value=!0}function ot(a){return a?gt(k,a.md5,a.ext,50):"/img/avatars/init_ava.png"}return rt(()=>{$().then(()=>{x()})}),(a,o)=>(n(),v(S,null,[t(St,{"page-title":c(L).title},{ToolPanel:e(()=>[c(U).self.isPermit([1,2])&&c(D)?(n(),p(g,{key:0,icon:"update",flat:"",stretch:"",onClick:o[0]||(o[0]=s=>$(!0))},{default:e(()=>[t(q,null,{default:e(()=>[_("\u0416\u0435\u0441\u0442\u043A\u043E \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u0442\u044B")]),_:1})]),_:1})):f("",!0),c(U).self.isPermit([1,2,3])?(n(),p(g,{key:1,icon:"edit",flat:"",stretch:"",color:u.value?"red":"grey",onClick:o[1]||(o[1]=s=>u.value=!u.value)},{default:e(()=>[t(q,null,{default:e(()=>[_("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u043E\u0441\u0442\u0430\u0432")]),_:1})]),_:1},8,["color"])):f("",!0),t(Pt)]),PageContent:e(()=>[I("div",wt,[I("div",bt,[(n(!0),v(S,null,O(d.value,s=>(n(),v(S,{key:s.groupId},[u.value||s.groupId!==200?(n(),v("div",$t,[t(mt,null,{default:e(()=>[t(K,{dense:""},{default:e(()=>[t(h,{avatar:""},{default:e(()=>[t(A,null,{default:e(()=>[I("span",xt,C(s.groupName),1)]),_:2},1024)]),_:2},1024),t(ft),u.value?(n(),p(h,{key:0,side:""},{default:e(()=>[t(g,{round:"",icon:"add",onClick:i=>et(s)},null,8,["onClick"])]),_:2},1024)):f("",!0)]),_:2},1024),t(it,{inset:""}),At,t(c(Qt),{list:s.Players,itemKey:"persId",disabled:!u.value,group:"people"},{item:e(({element:i})=>[t(K,{clickable:u.value},{default:e(()=>[t(h,{avatar:""},{default:e(()=>[t(nt,{size:"50px"},{default:e(()=>[t(H,{src:ot(i==null?void 0:i.avatar),alt:"img",onClick:W(Q=>tt(i.persId),["stop","prevent"]),style:{height:"100%"}},{error:e(()=>[t(H,{style:{height:"100%"},src:"/img/avatars/init_ava.png",alt:"img"})]),_:2},1032,["src","onClick"])]),_:2},1024)]),_:2},1024),t(h,null,{default:e(()=>[t(A,null,{default:e(()=>[_(C(i.name)+" "+C(i.lastName),1)]),_:2},1024),(n(!0),v(S,null,O(i.statuses,(Q,st)=>(n(),p(A,{key:`${st}_${Q}`,caption:""},{default:e(()=>[_(C(Y.value.find(lt=>lt.id===Q).name),1)]),_:2},1024))),128))]),_:2},1024),c(D)?(n(),p(h,{key:0,side:"",onClick:W(Q=>at(i),["prevent","stop"])},{default:e(()=>[t(g,{icon:"edit",stretch:"",size:"1em",flat:""})]),_:2},1032,["onClick"])):f("",!0)]),_:2},1032,["clickable"])]),_:2},1032,["list","disabled"])]),_:2},1024)])):f("",!0)],64))),128))]),t(ut,{align:"right"},{default:e(()=>[u.value?(n(),p(g,{key:0,class:"goldBtn",onClick:j},{default:e(()=>[_("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")]),_:1})):f("",!0)]),_:1})])]),_:1},8,["page-title"]),t(yt,{onUpdated:o[2]||(o[2]=s=>x())}),t(kt),t(Dt,{onOnPlayersAdd:j})],64))}};var ma=Ct(Mt,[["__scopeId","data-v-36e6b635"]]);export{ma as default};
