import{P as O}from"./LocalStorage.309b3827.js";import{u as B}from"./use-quasar.5f71050e.js";import{a as I}from"./axios.db5b4ede.js";import{n as H,d as z}from"./myFuncts.9afd62b9.js";import{u as F,i as D,r,p as u,k as N,o as R,l as $,m as h,n as Q,q as a,f as e,Q as G,t as A,v as J,x as b,y as K,z as q,A as E,B as X,C as Y,D as Z,E as U,F as W,G as tt,b as et,H as ot,I as at,w as nt,J as st}from"./index.785ed96a.js";import{m as d}from"./myAuth.5621b016.js";import{H as V}from"./hall.070fa8e3.js";import{u as lt}from"./use-meta.ccda63bf.js";import{Q as S}from"./QItemLabel.8e68d9f3.js";import{Q as g,a as P}from"./QItem.b8c7bc06.js";/* empty css               */import{Q as it}from"./QImg.7e63aac4.js";import{_ as rt}from"./plugin-vue_export-helper.21dcd24c.js";const w="SessionToken",L="AccessToken",ut={__name:"AuthComponent",setup(k,{expose:_}){const i=B();F();const l=D("isOptionsLoaded"),v=D("admin");async function y(){console.log("loadOptions started");const t=await V.getList(i);V.List=r(t),V.List.value.length?(l.value=!0,console.log("options Loaded")):console.error("Halls is empty")}const x=r(""),o=r("");function s(t,n,c="90d"){i.cookies.set(t,n,{expires:c,path:"/",domain:null,sameSite:"Strict",secure:!0,httpOnly:!1}),t===L&&(I.defaults.headers.common.AccessToken=n,x.value=n,d.self.AccessToken=n),t===w&&(o.value=n,d.self.SessionToken=n)}function C(){I.post(String("https://auth.symphograph.ru/")+"/api/register.php",{params:{method:"register",authType:"default"}}).then(t=>{var n,c,f,m,p;if(!((n=t==null?void 0:t.data)!=null&&n.result))throw new Error;s(L,(f=(c=t==null?void 0:t.data)==null?void 0:c.data.AccessToken)!=null?f:""),s(w,(p=(m=t==null?void 0:t.data)==null?void 0:m.data.SessionToken)!=null?p:""),y()}).catch(t=>{i.notify(H(t))})}u("register",C);function T(){I.post(String("https://auth.symphograph.ru/")+"/api/refresh.php",{params:{method:"refresh",SessionToken:d.self.SessionToken,AccessToken:d.self.AccessToken}}).then(t=>{var n,c,f,m,p;if(!((n=t==null?void 0:t.data)!=null&&n.result))throw new Error;s(w,(f=(c=t==null?void 0:t.data)==null?void 0:c.data.SessionToken)!=null?f:""),s(L,(p=(m=t==null?void 0:t.data)==null?void 0:m.data.AccessToken)!=null?p:""),v.value=d.self.isPermit([4]),y()}).catch(t=>{var n;if(((n=t==null?void 0:t.response)==null?void 0:n.status)===401){C();return}i.notify(H(t))})}return u("refreshAccessToken",T),_({}),N(()=>{console.log("auth beforeMounted"),I.defaults.headers.common.Accept="application/json",d.self=new d}),R(()=>{console.log("auth Mounted"),!i.cookies.getAll()[L]||!i.cookies.getAll()[w]?C():(s(w,i.cookies.getAll()[w]),s(L,i.cookies.getAll()[L]),T())}),(t,n)=>$("",!0)}},ct={__name:"DynamicFormItem",props:{btnLabel:String,icon:String,url:String},setup(k){B();const _=k;return(i,l)=>(h(),Q(P,{clickable:"",onClick:l[0]||(l[0]=v=>b(z)(k.url,{AccessToken:b(d).self.AccessToken,SessionToken:b(d).self.SessionToken}))},{default:a(()=>[e(g,{avatar:""},{default:a(()=>[e(G,null,{default:a(()=>[e(it,{src:k.icon},null,8,["src"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(S,{caption:""},{default:a(()=>l[1]||(l[1]=[A("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),e(S,null,{default:a(()=>[A(J(_.btnLabel),1)]),_:1})]),_:1})]),_:1}))}};const dt={__name:"LoginDialog",setup(k){const _=D("authTypes"),i=String("https://auth.symphograph.ru/"),l=D("showLoginDialog"),v=D("leftDrawerOpen");function y(){v.value=!1}return(x,o)=>(h(),Q(ot,{modelValue:b(l),"onUpdate:modelValue":o[3]||(o[3]=s=>et(l)?l.value=s:null),onHide:o[4]||(o[4]=s=>y())},{default:a(()=>[e(K,{class:"dialogArea",style:{color:"var(--dTitle)"}},{default:a(()=>[e(q,null,{default:a(()=>[e(P,{dense:""},{default:a(()=>[e(g,null,{default:a(()=>[e(S,{lines:"1",class:"cardTitle"},{default:a(()=>[e(E,{name:"lock"}),o[5]||(o[5]=A("\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0439 \u0432\u0445\u043E\u0434"))]),_:1})]),_:1}),e(g,{side:""},{default:a(()=>[e(X,{round:"",flat:"",icon:"close",onMouseover:o[0]||(o[0]=()=>console.log("kjk")),onClick:o[1]||(o[1]=Y(s=>l.value=!1,["stop","prevent"]))})]),_:1})]),_:1}),e(Z),e(P,null,{default:a(()=>[e(g,null,{default:a(()=>[e(S,null,{default:a(()=>o[6]||(o[6]=[A(" \u041F\u0440\u0435\u0434\u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D \u0434\u043B\u044F \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u043E\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430 ")])),_:1})]),_:1})]),_:1}),e(P,{clickable:"",to:"/vacancies",onClick:o[2]||(o[2]=s=>l.value=!1)},{default:a(()=>[e(g,null,{default:a(()=>[e(S,{caption:""},{default:a(()=>o[7]||(o[7]=[A(" \u0415\u0441\u043B\u0438 \u0412\u044B \u043D\u0435 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430, \u0442\u043E \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442\u0435 \u043A \u043D\u0430\u043C \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C. ")])),_:1}),e(S,{caption:""},{default:a(()=>o[8]||(o[8]=[A(" \u0423 \u043D\u0430\u0441 \u0441\u0435\u0439\u0447\u0430\u0441 \u0435\u0441\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0438\u043D\u0442\u0435\u0440\u0435\u0441\u043D\u044B\u0445 \u0432\u0430\u043A\u0430\u043D\u0441\u0438\u0439.\u{1F603} ")])),_:1})]),_:1}),e(g,{side:""},{default:a(()=>[e(E,{name:"open_in_new"})]),_:1})]),_:1})]),_:1}),e(q,null,{default:a(()=>[(h(!0),U(W,null,tt(b(_),s=>(h(),Q(ct,{key:s.id,btnLabel:s.label,icon:s.img,url:b(i)+s.url},null,8,["btnLabel","icon","url"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var ft=rt(dt,[["__scopeId","data-v-761e7acf"]]);const Ct={__name:"MainLayout",setup(k){at(),lt({meta:{viewport:{name:"viewport",content:"initial-scale=1, width=device-width, user-scalable=yes"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}});const i=B(),l=F(),v=r(),y=r([{id:2,label:"\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C",url:"auth/telegram/login.php",img:"/img/auth/telegram.svg"},{id:3,label:"MailRu",url:"auth/mailru/login.php",img:"/img/auth/mailru.svg"},{id:4,label:"Discord",url:"auth/discord/login.php",img:"/img/auth/discord.svg"},{id:4,label:"V\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435",url:"auth/vkontakte/login.php",img:"/img/auth/vkontakte.svg"}]);u("authTypes",y);const x=r(!1);u("progress",x);const o=r(!1);u("editMode",o);const s=r(!1);u("admin",s);const C=r(!1);u("leftDrawerOpen",C);const T=r(!1);u("isOptionsLoaded",T);const t=r(!1);u("showLoginDialog",t);const n=r(!0);u("scrollWatch",n);const c=r(0);u("scrollPos",c),nt(l,M=>{O.set("lastPath",M.path)});function f(){O.set("CookieConfirm","1")}function m(){O.getItem("CookieConfirm")||i.notify({message:"\u041C\u044B \u0442\u043E\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C Cookies. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0431\u0435\u0437 \u043D\u0438\u0445 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442.",color:"primary",timeout:0,multiLine:!0,onDismiss:f,icon:"ion-information-circle-outline",actions:[{label:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E",color:"yellow",handler:()=>{}}]})}function p(M=500){n.value=!1,setTimeout(()=>{n.value=!0},M)}return u("stopScrollWatch",p),N(()=>{console.log("mainLayout beforeMount"),document.body.style.backgroun="none"}),R(()=>{O.set("lastPath",l.path),console.log("mainLayout Mounted"),m()}),(M,mt)=>{const j=st("router-view");return h(),U(W,null,[e(ut,{ref_key:"refAuth",ref:v},null,512),T.value?(h(),Q(j,{key:0})):$("",!0),T.value?(h(),Q(ft,{key:1})):$("",!0)],64)}}};export{Ct as default};
