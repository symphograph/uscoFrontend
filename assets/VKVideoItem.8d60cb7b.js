import{d as ue,i as Z,r as g,c as Y,m as n,n as m,q as e,v as K,b as ae,G as ie,f as u,y as N,t as f,u as D,l as V,bi as te,aY as me,A as O,D as q,bk as le,bl as oe,F as J,bm as Ce,x as X,p as G,B as ee,ax as R,E as ce}from"./index.e7a4ac85.js";import{b as M,Q as B,a as ge}from"./QImg.da576236.js";import{Q as y}from"./QItemLabel.0376b164.js";import{d as ke,e as be,b as Ve}from"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.27f0d497.js";import{Q as Ee}from"./QList.c60ea774.js";import{Q as ne}from"./QSelect.f2ed9855.js";/* empty css               */import{W as Se,T as W,V as de}from"./lib.bd005370.js";import{u as h}from"./use-quasar.b2ee9ea6.js";import{_ as _e}from"./BtnDelete.70794f6e.js";import{i as we}from"./myFuncts.c18e673c.js";import{u as Be}from"./myAxios.ade39005.js";import{m as ye}from"./entry.245f8c7b.js";import{_ as Te}from"./plugin-vue_export-helper.21dcd24c.js";const De=ue({__name:"TimeCodeDialog",props:{video:{type:Object,required:!0},timeCode:{type:Object,default:()=>({id:0,start:"00:00:00",uLabel:"",type:"init"})}},emits:["onDelete","onSave"],setup(o,{emit:Q}){const S=h(),C=Z("isTCodeDialogOpen"),k=Q,F={id:0,start:"00:00:00",uLabel:"",type:"init"},d=o,c=g(d.timeCode),_=g(!1),A=g([]),E=g(),p=g(),b=Y(()=>!d.timeCode.id),L=Y(()=>b.value?E.value?p.value?"part":"work":"init":d.timeCode.type);function I(){C.value=!1}Y(()=>["work","part"].includes(c.value.type));function w(){b.value&&j(),b.value&&t()}function j(){c.value={...F},E.value=void 0,p.value=void 0}function z(){_.value=!1,b.value&&j()}function x(i){const l=i.split(":");return+l[0]*60*60+ +l[1]*60+ +l[2]}function U(i){const l=(i%60).toString(),$=Math.floor(i/60%60).toString();return`${Math.floor(i/60/60%60).toString().padStart(2,"0")}:${$.padStart(2,"0")}:${l.padStart(2,"0")}`}function H(i){const l=x(i);return i===U(l)}async function s(){_.value=!0,(b.value?await a():await W.update(S,c.value))&&(k("onSave"),I()),_.value=!1}async function a(){c.value.type=L.value;const i=c.value,l=d.video.id,$=i.start;switch(i.type){case"init":return W.addInit(S,l,$,i.uLabel);case"work":return W.addWork(S,l,$,E.value.id);case"part":return W.addPartition(S,l,$,p.value.id)}}async function t(){!d.video.announceId||(_.value=!0,A.value=await Se.getListByAnnounce(S,d.video.announceId),_.value=!1)}function v(){var i,l;(l=(i=E.value)==null?void 0:i.children)!=null&&l.length||(p.value=null),p.value=E.value.children[0]}async function T(){_.value=!0,await W.del(S,d.timeCode.id)&&(k("onDelete"),I()),_.value=!1}return(i,l)=>(n(),m(ie,{modelValue:K(C),"onUpdate:modelValue":l[6]||(l[6]=$=>ae(C)?C.value=$:null),onBeforeHide:z,onBeforeShow:w},{default:e(()=>[u(X,{bordered:"",class:"dialogArea"},{default:e(()=>{var $;return[u(N,null,{default:e(()=>[u(M,null,{default:e(()=>[u(B,null,{default:e(()=>[u(y,{caption:""},{default:e(()=>[f(D(b.value?"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434":"\u0418\u043C\u0435\u043D\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434 \u0434\u043B\u044F:"),1)]),_:1}),b.value?V("",!0):(n(),m(y,{key:0},{default:e(()=>[f(D(o.timeCode.label),1)]),_:1}))]),_:1})]),_:1})]),_:1}),u(N,null,{default:e(()=>{var P,re,se,ve,fe;return[u(te,{mask:"##:##:##",clearable:"",label:`${U(0)} - ${U(o.video.duration)}`,"onUpdate:modelValue":[l[0]||(l[0]=r=>x(String(r))),l[1]||(l[1]=r=>c.value.start=r)],rules:[r=>!!r||"* \u041E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043F\u043E\u043B\u0435",r=>H(r)||"\u041D\u0443\u0436\u0435\u043D \u0444\u043E\u0440\u043C\u0430\u0442 [HH:MM:SS]",r=>x(String(r))<=o.video.duration||"\u0417\u0430 \u043F\u0440\u0435\u0434\u0435\u043B\u0430\u043C\u0438 \u0432\u0438\u0434\u0435\u043E"],modelValue:c.value.start},null,8,["label","rules","modelValue"]),L.value==="init"?(n(),m(te,{key:0,modelValue:c.value.uLabel,"onUpdate:modelValue":l[3]||(l[3]=r=>c.value.uLabel=r),clearable:"",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u0430\u0439\u043C\u043A\u043E\u0434\u0430","stack-label":""},me({_:2},[c.value.uLabel?void 0:{name:"append",fn:e(()=>[u(O,{label:"\u0432\u0441\u0442. \u0441\u043B\u043E\u0432\u043E",onClick:l[2]||(l[2]=r=>c.value.uLabel="\u0412\u0441\u0442\u0443\u043F\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u0441\u043B\u043E\u0432\u043E")})]),key:"0"}]),1032,["modelValue"])):V("",!0),b.value?(n(),q(J,{key:1},[A.value.length?(n(),m(ne,{key:0,modelValue:E.value,"onUpdate:modelValue":[l[4]||(l[4]=r=>E.value=r),v],label:((P=E.value)==null?void 0:P.author.fioRu)||"\u041F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435",options:A.value,clearable:"","map-options":"","option-value":"id","option-label":"titleRu"},{option:e(r=>[u(M,le(oe(r.itemProps)),{default:e(()=>[u(B,null,{default:e(()=>[u(y,{caption:""},{default:e(()=>[f(D(r.opt.author.fioRu),1)]),_:2},1024),u(y,null,{default:e(()=>[f(D(r.opt.titleRu),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label","options"])):(n(),m(M,{key:1},{default:e(()=>[u(B,null,{default:e(()=>[u(y,null,{default:e(()=>l[7]||(l[7]=[f("\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0439 \u043F\u0443\u0441\u0442")])),_:1}),o.video.announceId?(n(),m(y,{key:0,caption:""},{default:e(()=>l[8]||(l[8]=[f(" \u041F\u043E\u0445\u043E\u0436\u0435, \u0432 \u0430\u043D\u043E\u043D\u0441\u0435 \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u0430 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430 \u043A\u043E\u043D\u0446\u0435\u043D\u0442\u0430. ")])),_:1})):(n(),m(y,{key:1,caption:""},{default:e(()=>l[9]||(l[9]=[f(" \u041F\u0440\u0438\u0432\u044F\u0436\u0438\u0442\u0435 \u0432\u0438\u0434\u0435\u043E \u043A \u0430\u043D\u043E\u043D\u0441\u0443, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0439. ")])),_:1}))]),_:1})]),_:1})),(se=(re=E.value)==null?void 0:re.children)!=null&&se.length?(n(),m(ne,{key:2,modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=r=>p.value=r),options:(fe=(ve=E.value)==null?void 0:ve.children)!=null?fe:[],label:"\u0427\u0430\u0441\u0442\u044C, \u043D\u043E\u043C\u0435\u0440, \u0440\u0430\u0437\u0434\u0435\u043B",clearable:"","stack-label":"","map-options":"","option-value":"id","option-label":"title"},{option:e(r=>[u(M,le(oe(r.itemProps)),{default:e(()=>[u(B,{avatar:""},{default:e(()=>[f(D(r.opt.sortVal),1)]),_:2},1024),u(B,null,{default:e(()=>[u(y,null,{default:e(()=>[f(D(r.opt.title),1)]),_:2},1024),u(y,{caption:""},{default:e(()=>[f(D(r.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])):V("",!0)],64)):V("",!0)]}),_:1}),V("",!0),($=E.value)!=null&&$.children.length?(n(),m(N,{key:1},{default:e(()=>[u(M,null,{default:e(()=>[u(B,null,{default:e(()=>[u(y,null,{default:e(()=>[f(D(p.value?"\u0427\u0430\u0441\u0442\u044C \u0431\u0443\u0434\u0435\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0430 \u0432 \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u043D\u043E\u0439 \u043F\u0430\u043F\u043A\u0435":"\u0411\u0443\u0434\u0435\u0442 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435 \u0431\u0435\u0437 \u0447\u0430\u0441\u0442\u0435\u0439"),1)]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0),f(" "+D(L.value)+" ",1),u(Ce,{align:"right"},{default:e(()=>[o.timeCode.id?(n(),m(_e,{key:0,label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C","throw-confirm":"",onOnOk:T,danger:""})):V("",!0),u(ke),u(O,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",onClick:I}),u(O,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",loading:_.value,color:"green",onClick:s},null,8,["loading"])]),_:1})]}),_:1})]),_:1},8,["modelValue"]))}}),pe=ue({__name:"TimeCodeItem",props:{video:{type:Object,required:!0},timeCode:{type:Object,required:!0}},emits:["goToMoment","onDelete","onSave"],setup(o,{emit:Q}){h();const S=Z("editMode"),C=g(!1);G("isTCodeDialogOpen",C);const k=Q;return g(!1),(F,d)=>(n(),m(M,{clickable:"",onClick:d[3]||(d[3]=c=>k("goToMoment",o.timeCode.formattedStart))},{default:e(()=>[u(B,{avatar:""},{default:e(()=>[u(y,{caption:""},{default:e(()=>[f(D(o.timeCode.start),1)]),_:1}),V("",!0)]),_:1}),u(B,null,{default:e(()=>[o.timeCode.type!=="part"?(n(),m(y,{key:0,caption:""},{default:e(()=>[f(D(o.timeCode.caption),1)]),_:1})):V("",!0),u(y,null,{default:e(()=>[f(D(o.timeCode.label),1)]),_:1}),o.timeCode.type==="part"?(n(),m(y,{key:1,caption:""},{default:e(()=>[f(D(o.timeCode.caption),1)]),_:1})):V("",!0)]),_:1}),K(S)?(n(),q(J,{key:0},[u(B,{side:""},{default:e(()=>[u(O,{icon:"edit",flat:"",round:"",onClick:d[0]||(d[0]=ee(c=>C.value=!0,["stop","prevent"]))})]),_:1}),u(De,{timeCode:o.timeCode,onOnDelete:d[1]||(d[1]=c=>k("onDelete")),onOnSave:d[2]||(d[2]=c=>k("onSave")),video:o.video},null,8,["timeCode","video"])],64)):V("",!0)]),_:1}))}}),$e=["innerHTML"],Oe=ue({__name:"DescrDialog",props:{video:{type:Object,required:!0}},setup(o){const Q=h(),S=o,C=g(),k=g(!1),F=Z("isOpenDescrDialog");function d(){}function c(){}function _(){C.value.hide()}async function A(){k.value=!0,await de.putDescrToVK(Q,S.video.id)&&_(),k.value=!1}return(E,p)=>(n(),m(ie,{modelValue:K(F),"onUpdate:modelValue":p[0]||(p[0]=b=>ae(F)?F.value=b:null),onBeforeHide:d,onBeforeShow:c,ref_key:"refDialog",ref:C},{default:e(()=>[u(X,{bordered:""},{default:e(()=>[u(N,null,{default:e(()=>[u(M,null,{default:e(()=>[u(B,null,{default:e(()=>[u(y,null,{default:e(()=>p[1]||(p[1]=[f("\u0422\u0435\u043F\u0435\u0440\u044C \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0432\u044B\u0433\u043B\u044F\u0434\u0438\u0442 \u0442\u0430\u043A:")])),_:1})]),_:1})]),_:1})]),_:1}),u(N,null,{default:e(()=>[u(X,null,{default:e(()=>[u(N,null,{default:e(()=>{var b;return[R("section",{innerHTML:(b=o.video)==null?void 0:b.description,style:{whiteSpace:"pre-line"}},null,8,$e)]}),_:1})]),_:1})]),_:1}),u(N,null,{default:e(()=>p[2]||(p[2]=[f("\u0412\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0435\u0433\u043E \u0432 \u0438\u0441\u0445\u043E\u0434\u043D\u043E\u043C \u0432\u0438\u0434\u0435\u043E \u043D\u0430 VK \u0438\u043B\u0438 \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")])),_:1}),u(Ce,{align:"between"},{default:e(()=>[u(ke),u(O,{label:"\u041D\u0435 \u0441\u0435\u0439\u0447\u0430\u0441",onClick:_}),u(O,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043D\u0430 VK",color:"green",onClick:A})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ae=ue({__name:"VKVideoDialog",props:{video:{type:Object,required:!0}},emits:["onSave"],setup(o,{emit:Q}){const S=h(),C=Z("isOpenVKVideoDialog"),k=g(!1),F=Be.getApiUrl(""),d=ye.all,c=g("");function _(s){c.value=s}const A=Y(()=>{if(!c.value)return d.value;const s=c.value.toLowerCase().trim();return s?d.value.filter(a=>{var i,l,$,P;const t=((i=a.progName)==null?void 0:i.toLowerCase())||"",v=((l=a.eventTime)==null?void 0:l.toLowerCase())||"",T=((P=($=a.Hall)==null?void 0:$.name)==null?void 0:P.toLowerCase())||"";return t.includes(s)||v.includes(s)||T.includes(s)}):d.value}),E=Q,p=o,b=g(p.video),L=g(),I=g(!1),w=g();function j(){k.value=!1}function z(){!p.video.announceId||(w.value=d.value.find(s=>s.id===p.video.announceId))}function x(){C.value=!1}function U(s){var T,i;const a=((T=s==null?void 0:s.sketch)==null?void 0:T.md5)||null,t=((i=s==null?void 0:s.sketch)==null?void 0:i.ext)||null;return we(F,a,t,100)}async function H(){k.value=!0;const s={id:w.value.id,progName:w.value.progName,eventTime:w.value.eventTime};await de.linkToAnnounce(S,p.video.id,s)&&(E("onSave"),x())}return(s,a)=>(n(),m(ie,{modelValue:K(C),"onUpdate:modelValue":a[4]||(a[4]=t=>ae(C)?C.value=t:null),onBeforeShow:z,onBeforeHide:j},{default:e(()=>[u(X,{bordered:"",class:"dialogArea"},{default:e(()=>[u(N,null,{default:e(()=>[u(ne,{modelValue:w.value,"onUpdate:modelValue":[a[0]||(a[0]=t=>w.value=t),()=>{}],options:A.value,label:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u043A\u043E\u043D\u0446\u0435\u0440\u0442","map-options":"","option-label":"progName","option-value":"id",clearable:"","use-input":"",onInputValue:_},me({option:e(t=>[u(M,le(oe(t.itemProps)),{default:e(()=>[u(B,{avatar:""},{default:e(()=>[u(ge,{src:U(t.opt)},null,8,["src"])]),_:2},1024),u(B,null,{default:e(()=>[u(y,null,{default:e(()=>[f(D(t.opt.progName),1)]),_:2},1024),u(y,{caption:""},{default:e(()=>[f(D(t.opt.eventTime),1)]),_:2},1024),u(y,{caption:""},{default:e(()=>[f(D(t.opt.Hall.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},[w.value?{name:"append",fn:e(()=>[u(O,{icon:"save",color:"green",onClick:ee(H,["stop","prevent"]),flat:"",round:""})]),key:"0"}:void 0]),1032,["modelValue","options"])]),_:1}),u(N,null,{default:e(()=>[u(te,{modelValue:b.value.title,"onUpdate:modelValue":a[1]||(a[1]=t=>b.value.title=t),label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",onFocus:a[2]||(a[2]=t=>I.value=!0),onBlur:a[3]||(a[3]=t=>I.value=!1),ref_key:"refTitle",ref:L},{append:e(()=>[I.value?(n(),m(O,{key:0,icon:"save",color:"green",label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"})):V("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const Fe={class:"absolute-top-left text-subtitle2"},Ie={key:0,class:"absolute-top-right no-padding"},xe={key:1,class:"absolute-center",style:{"border-radius":"50%"}},Me={__name:"VKVideoItem",props:{video:{type:Object,required:!0}},emits:["onSave"],setup(o,{emit:Q}){const S=h(),C=o,k=g(C.video),F=Q;function d(){const a=k.value.announceId;return ye.findById(a)}const c=Y(()=>{const a=d();return a?`${k.value.recordedAt} - ${a.Hall.name}`:k.value.recordedAt});async function _(){F("onSave")}const A=Z("editMode"),E=g(!1),p=g(!1);G("isOpenVKVideoDialog",p);const b=g(!1);G("isOpenDescrDialog",b);const L=g(!1),I=g(!1);G("isTCodeDialogOpen",I);const w=g(!1);function j(){p.value=!0}function z(a=null){let t="https://vk.com/video";const v=`${C.video.owner_id}_${C.video.id}`;let T=`list=${C.video.access_key}`;return a&&(T=`${T}&t=${a}`),`${t}${v}?${T}`}function x(a=null){const t=z(a);window.open(t,"_blank")}function U(){I.value=!0}async function H(){w.value=!0,k.value.timeCodes=await W.getList(S,C.video.id),w.value=!1}G("loadTCodes",H);async function s(){await H(),k.value.description=await de.getDescr(S,C.video.id),b.value=!0}return(a,t)=>(n(),m(X,null,{default:e(()=>[u(ge,{style:{cursor:"pointer"},src:o.video.image[4].url,ratio:1920/1080,onMouseover:t[5]||(t[5]=v=>E.value=!0),onMouseleave:t[6]||(t[6]=v=>E.value=!1),class:"rounded-borders"},{default:e(()=>[R("div",Fe,D(c.value),1),K(A)?(n(),q("div",Ie,[u(O,{loading:w.value,icon:"edit",flat:"",onClick:t[0]||(t[0]=ee(v=>j(),["stop","prevent"]))},null,8,["loading"]),V("",!0)])):V("",!0),E.value?(n(),q("div",xe,[u(O,{icon:"play_circle",style:{cursor:"pointer"},round:"",loading:w.value,onClick:t[2]||(t[2]=v=>x())},null,8,["loading"])])):V("",!0),R("div",{class:"absolute-bottom text-center",style:{display:"flex","justify-content":"space-between"},onClick:t[4]||(t[4]=v=>x())},[t[8]||(t[8]=R("div",null,D(" "),-1)),R("div",null,D(o.video.title),1),R("div",null,[u(O,{icon:"menu",loading:w.value,onClick:t[3]||(t[3]=ee(v=>L.value=!L.value,["stop","prevent"]))},null,8,["loading"])])])]),_:1},8,["src"]),K(A)?(n(),m(Ae,{key:0,video:k.value,onOnSave:_},null,8,["video"])):V("",!0),u(be,null,{default:e(()=>[L.value?(n(),m(Ee,{key:0,separator:""},{default:e(()=>[(n(!0),q(J,null,ce(k.value.timeCodes,v=>{var T;return n(),q(J,{key:`work_${o.video.id}_${v.id}`},[(T=v==null?void 0:v.children)!=null&&T.length?(n(),m(Ve,{key:0,"content-inset-level":.5},{header:e(()=>[u(M,{class:"full-width no-padding"},{default:e(()=>[u(B,null,{default:e(()=>[u(y,{caption:""},{default:e(()=>[f(D(v.caption),1)]),_:2},1024),u(y,null,{default:e(()=>[f(D(v.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),default:e(()=>[(n(!0),q(J,null,ce(v.children,(i,l)=>(n(),m(pe,{key:`part_${i.workId}_${l}`,timeCode:i,video:o.video,onOnDelete:H,onOnSave:s,onGoToMoment:x},null,8,["timeCode","video"]))),128))]),_:2},1024)):v.type!=="part"?(n(),m(pe,{key:1,video:o.video,onOnDelete:H,onGoToMoment:x,onOnSave:s,timeCode:v},null,8,["video","timeCode"])):V("",!0)],64)}),128)),K(A)?(n(),m(M,{key:0,clickable:"",onClick:t[7]||(t[7]=v=>U())},{default:e(()=>[u(B,{avatar:""},{default:e(()=>[u(O,{icon:"add"})]),_:1}),u(B,null,{default:e(()=>[u(y,null,{default:e(()=>t[9]||(t[9]=[f("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434")])),_:1})]),_:1}),u(De,{dur:o.video.duration,video:o.video,onOnSave:s},null,8,["dur","video"]),u(Oe,{video:k.value},null,8,["video"])]),_:1})):V("",!0)]),_:1})):V("",!0)]),_:1})]),_:1}))}};var Xe=Te(Me,[["__scopeId","data-v-339161fe"]]);export{Xe as V};
