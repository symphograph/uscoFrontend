import{Q as ot}from"./QTooltip.e861268c.js";import{i as L,p as r,r as l,o as st,m as n,E as m,f as t,q as e,x as u,F as k,n as c,t as D,B as P,l as v,ax as _,G as q,v as Q,D as rt,Q as lt,C as z,bl as it}from"./index.71bc55bd.js";import{Q as $}from"./QItemLabel.622a6884.js";import{a as F,Q as g}from"./QItem.adc0c735.js";import{b as nt}from"./TouchPan.8802ca0b.js";import{Q as O}from"./QImg.0f12cfff.js";import{Q as dt}from"./QList.dc37ea0b.js";import{j as ut,g as pt,n as N}from"./myFuncts.c043710e.js";import{u as ft}from"./use-meta.0f1f008f.js";import{u as ct}from"./use-quasar.dd0d0041.js";import{a as x}from"./axios.a7f12f6b.js";import{_ as mt,a as vt,b as _t,c as gt,d as ht}from"./AddPlayerDialog.19a7e5dc.js";import{m as A}from"./myAuth.5621b016.js";import{P as yt}from"./PageShell.aafd3cf4.js";import{_ as kt}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.da3a8d11.js";import"./selection.60de79e9.js";import"./touch.9135741d.js";import"./style.d5637314.js";import"./format.de7e9769.js";import"./use-file.6cd60ccb.js";import"./get-emits-object.a3f16783.js";/* empty css               */import"./BtnDelete.a20f6780.js";import"./QPopupProxy.56777780.js";import"./use-render-cache.3aae9b27.js";import"./QMenu.8d45d7c8.js";import"./ClosePopup.84528407.js";import"./QToolbar.e0367470.js";import"./QExpansionItem.ed48e551.js";import"./QScrollArea.447bc3ca.js";import"./QLinearProgress.f42d9a72.js";import"./MainFooter.9d16b95b.js";import"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.e1d9f02c.js";import"./AnderHeader.b5fd0884.js";/* empty css                                                    */const Dt={class:"centralCol"},Pt={class:"gridArea"},Qt={key:0,class:"group"},Ct={class:"cardTitle"},St={class:"lastName"},wt={__name:"StaffPage",setup(It){const C=ct(),S=String("https://api.staff.sakh-orch.ru/"),d=L("staffEditMode");r("editMode",d);const p=l(!1);r("progress",p);const f=l([]);r("groups",f);const W=l(""),w=l(ut(new Date).format("YYYY-MM-DD"));r("condDate",w);const M=l(!1);r("showUploader",M),r("pwUrl",W);const K=A.self.persId(),B=l(0);r("selectedPersId",B);const U=l({});r("selectedPers",U);const E=l(null);r("selectedGroup",E);const h=l([]);r("actionDates",h);const H=L("stopScrollWatch"),V=l([{id:1,name:"\u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043D\u0442 \u0434\u0438\u0440\u0438\u0436\u0435\u0440\u0430"},{id:2,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"},{id:3,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u0433\u0440\u0443\u043F\u043F\u044B"},{id:4,name:"\u041F\u043E\u043C\u043E\u0449\u043D\u0438\u043A \u043A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440\u0430"},{id:5,name:"\u0420\u0435\u0433\u0443\u043B\u044F\u0442\u043E\u0440"}]);r("statusNames",V);const T=l(!1);r("showStatusDialog",T);const Y=l(!1);r("showAddPlayerDialog",Y);const J=l("\u0421\u043E\u0441\u0442\u0430\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"),j=pt(J.value);ft(j);function I(o=!1){return p.value=!0,h.value=[],x.post(S+"api/staff.php",{params:{method:"actionDates",force:o}}).then(a=>{var s,i;h.value=(i=(s=a==null?void 0:a.data)==null?void 0:s.data)!=null?i:[]}).catch(a=>{throw h.value=[],C.notify(N(a)),a}).finally(()=>{p.value=!1})}function b(){console.log("start loadData"),p.value=!0,x.post(S+"api/staff.php",{params:{method:"get",date:w.value}}).then(o=>{var a,s;H(),f.value=[],f.value=Object.values((s=(a=o==null?void 0:o.data)==null?void 0:a.data)!=null?s:[])}).catch(o=>{f.value=[],C.notify(N(o))}).finally(()=>{p.value=!1})}r("loadData",b);function G(){p.value=!0,x.post(S+"/api/staff.php",{params:{method:"update",groups:f.value,date:w.value}}).then(o=>{I()}).catch(o=>{C.notify(N(o))}).finally(()=>{p.value=!1})}function R(o){!A.self.isPermit([1,2])||!d.value&&K!==o||(B.value=o,M.value=!0)}function X(o){!d.value||(U.value=o,T.value=!0)}function Z(o){E.value=o,Y.value=!0}function tt(o){return"/img/avatars/init_ava.png"}return st(()=>{I().then(()=>{b()})}),(o,a)=>(n(),m(k,null,[t(yt,{"page-title":u(j).title},{ToolPanel:e(()=>[u(A).self.isPermit([1,2])&&u(d)?(n(),c(P,{key:0,icon:"update",flat:"",stretch:"",onClick:a[0]||(a[0]=s=>I(!0))},{default:e(()=>[t(ot,null,{default:e(()=>a[2]||(a[2]=[D("\u0416\u0435\u0441\u0442\u043A\u043E \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u0442\u044B")])),_:1})]),_:1})):v("",!0),t(gt)]),PageContent:e(()=>[_("div",Dt,[_("div",Pt,[(n(!0),m(k,null,q(f.value,s=>(n(),m(k,{key:s.groupId},[u(d)||s.Players.length&&s.groupId!==200?(n(),m("div",Qt,[t(dt,null,{default:e(()=>[t(F,{dense:""},{default:e(()=>[t(g,{avatar:""},{default:e(()=>[t($,null,{default:e(()=>[_("span",Ct,Q(s.groupName),1)]),_:2},1024)]),_:2},1024),t(nt),u(d)?(n(),c(g,{key:0,side:""},{default:e(()=>[t(P,{round:"",icon:"add",onClick:i=>Z(s)},null,8,["onClick"])]),_:2},1024)):v("",!0)]),_:2},1024),t(rt,{inset:""}),a[3]||(a[3]=_("br",null,null,-1)),t(u(ht),{list:s.Players,itemKey:"persId",disabled:!u(d),group:"people"},{item:e(({element:i})=>[t(F,{clickable:u(d)},{default:e(()=>[(n(),c(g,{key:0,avatar:""},{default:e(()=>[t(lt,{size:"50px"},{default:e(()=>[t(O,{src:tt(i==null?void 0:i.avatar),alt:"img",onClick:z(y=>R(i.persId),["stop","prevent"]),style:{height:"100%"}},{error:e(()=>[t(O,{style:{height:"100%"},src:"/img/avatars/init_ava.png",alt:"img"})]),_:2},1032,["src","onClick"])]),_:2},1024)]),_:2},1024)),t(g,null,{default:e(()=>[t($,null,{default:e(()=>[D(Q(i.name)+" ",1),_("span",St,Q(i.lastName),1)]),_:2},1024),(n(!0),m(k,null,q(i.statuses,(y,at)=>(n(),c($,{key:`${at}_${y}`,caption:""},{default:e(()=>[D(Q(V.value.find(et=>et.id===y).name),1)]),_:2},1024))),128))]),_:2},1024),u(d)?(n(),c(g,{key:1,side:"",onClick:z(y=>X(i),["prevent","stop"])},{default:e(()=>[t(P,{icon:"edit",stretch:"",size:"1em",flat:""})]),_:2},1032,["onClick"])):v("",!0)]),_:2},1032,["clickable"])]),_:2},1032,["list","disabled"])]),_:2},1024)])):v("",!0)],64))),128))]),t(it,{align:"right"},{default:e(()=>[u(d)?(n(),c(P,{key:0,class:"goldBtn",onClick:G,loading:p.value},{default:e(()=>a[4]||(a[4]=[D("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])),_:1},8,["loading"])):v("",!0)]),_:1})])]),_:1},8,["page-title"]),t(mt,{onUpdated:a[1]||(a[1]=s=>b())}),t(vt),t(_t,{onOnPlayersAdd:G})],64))}};var ua=kt(wt,[["__scopeId","data-v-34d11cd8"]]);export{ua as default};
