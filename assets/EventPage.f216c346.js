import{Q as ce}from"./QLinearProgress.0e4c1524.js";import{i as F,r as p,m as o,C as y,F as q,bN as N,u as r,q as f,t as m,f as e,p as t,ax as a,l as A,n as w,x as G,ak as K,y as I,al as J,z as $,bh as de,v as X,g as fe,Q as ne,E as me,bm as le,H as pe,I as j,c as ke,o as ve,D as W}from"./index.7ebe9bab.js";import{a as Z}from"./axios.5e2b2806.js";import{u as ie,c as _e,a as ee}from"./myFuncts.0e97ec07.js";import{u as ge}from"./use-meta.9fd8737e.js";import{Q as te}from"./QTooltip.ff27ca0c.js";import{b as ye,m as V}from"./myAuth.4904ab28.js";import{b as C,Q as k,a as ae}from"./QImg.480ab182.js";import{Q as x}from"./QItemLabel.a1211d51.js";import{_ as Y}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Te}from"./QList.fd723618.js";import{g as be}from"./get-emits-object.a3f16783.js";import{Q as se}from"./QForm.04af9852.js";import{m as he}from"./announce.2e58aef3.js";import"./position-engine.59731032.js";import"./selection.a18f75a6.js";import"./myAxios.c606122d.js";import"./img.4ff49e19.js";const we={class:"cellArea"},Ce={__name:"HallUserCell",props:{cell:Object,ticket:Object},emits:["reserve","returnTicket"],setup(s,{emit:v}){const l=s,u=F("colors"),_=p(l.ticket);F("HallPlan");const c=v;p("Invite"),p(0);const T=ye.userId();function b(){c("reserve",_.value.id)}function S(){c("returnTicket",_.value.id)}return(R,i)=>{var z,H,L,B,O,E,Q;return o(),y("div",we,[s.cell.exist?(o(),y(q,{key:0},[(z=s.ticket)!=null&&z.offline?(o(),y("div",{key:0,class:"offlineCell",style:N({borderColor:r(u)[((H=l.ticket)==null?void 0:H.priceType)||"Invite"][1],backgroundColor:r(u)[((L=l.ticket)==null?void 0:L.priceType)||"Invite"][1]})},null,4)):l.ticket.userId===r(T)?(o(),y("div",{key:1,class:"userCell",onClick:i[0]||(i[0]=U=>S()),style:N({borderColor:r(u)[((B=l.ticket)==null?void 0:B.priceType)||"Invite"][1]})},[f(m(l.ticket.seatNum)+" ",1),e(te,{offset:[0,-120],"max-width":"20em",delay:300},{default:t(()=>[i[2]||(i[2]=f(m("\u042D\u0442\u043E \u0412\u0430\u0448\u0435 \u043C\u0435\u0441\u0442\u043E"))),i[3]||(i[3]=a("br",null,null,-1)),f(" "+m("\u0420\u044F\u0434: "+l.ticket.seatRow),1),i[4]||(i[4]=a("br",null,null,-1)),f(" "+m("\u041C\u0435\u0441\u0442\u043E: "+l.ticket.seatNum),1),i[5]||(i[5]=a("br",null,null,-1)),f(" "+m("\u0426\u0435\u043D\u0430: "+l.ticket.priceType),1)]),_:1})],4)):l.ticket.userId?(o(),y("div",{key:2,class:"offlineCell",style:N({borderColor:r(u)[((O=l.ticket)==null?void 0:O.priceType)||"Invite"][1],backgroundColor:r(u)[((E=l.ticket)==null?void 0:E.priceType)||"Invite"][1]})},null,4)):(o(),y("div",{key:3,class:"availableCell",style:N({borderColor:r(u)[((Q=l.ticket)==null?void 0:Q.priceType)||"Invite"][1]}),onClick:i[1]||(i[1]=U=>b())},[f(m(l.ticket.seatNum)+" ",1),e(te,{offset:[0,-120],"max-width":"20em",delay:300},{default:t(()=>[f(m("\u0420\u044F\u0434: "+l.ticket.seatRow),1),i[6]||(i[6]=a("br",null,null,-1)),f(" "+m("\u041C\u0435\u0441\u0442\u043E: "+l.ticket.seatNum),1),i[7]||(i[7]=a("br",null,null,-1)),f(" "+m("\u0426\u0435\u043D\u0430: "+l.ticket.priceType),1)]),_:1})],4))],64)):A("",!0)])}}};const Se={class:"mapLink"},xe={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"space-between"}},Ae={__name:"TicketCard",props:{ticket:{},price:Number},emits:["reserve","returnTicket"],setup(s,{emit:v}){const l=String("https://sakh-orch.ru/api/");ie();const u=F("Announce"),_=v,c=p("");function T(b){c.value=" returning",setTimeout(()=>{_("returnTicket",b)},600)}return(b,S)=>(o(),w(X,{class:de("ticketCard"+c.value)},{default:t(()=>[e(G,{class:"progName"},{default:t(()=>[f(m(r(u).progName),1)]),_:1}),e(C,{dense:""},{default:t(()=>[e(k,{avatar:""},{default:t(()=>[e(ae,{width:"10em",ratio:16/9,src:r(l)+r(u).Sketch.verLink},null,8,["src"])]),_:1}),e(k,{avatar:""},{default:t(()=>[K((o(),w(C,{dense:""},{default:t(()=>[e(k,{avatar:""},{default:t(()=>[e(I,{name:"schedule",color:"amber"})]),_:1}),e(k,null,{default:t(()=>[e(x,{caption:""},{default:t(()=>[f(m(r(_e)(r(u).eventTime)),1)]),_:1})]),_:1})]),_:1})),[[J]]),e(C,{clickable:"",dense:"",href:r(u).Hall.map,target:"_blank"},{default:t(()=>[e(k,{avatar:""},{default:t(()=>[e(I,{color:"amber",name:"place"})]),_:1}),e(x,null,{default:t(()=>[a("span",Se,m(r(u).Hall.name),1)]),_:1})]),_:1},8,["href"]),K((o(),w(C,{dense:""},{default:t(()=>[e(k,{avatar:""},{default:t(()=>[e(I,{name:"ion-person",color:"amber"})]),_:1}),e(k,null,{default:t(()=>[e(x,{lines:"1"},{default:t(()=>[f("\u0420\u044F\u0434: "+m(s.ticket.seatRow)+" | \u041C\u0435\u0441\u0442\u043E: "+m(s.ticket.seatNum),1)]),_:1})]),_:1})]),_:1})),[[J]]),s.price?K((o(),w(C,{key:0,dense:""},{default:t(()=>[e(k,{avatar:""},{default:t(()=>[e(I,{name:"ion-wallet",color:"amber"})]),_:1}),e(k,null,{default:t(()=>[e(x,{lines:1},{default:t(()=>[f("\u0426\u0435\u043D\u0430: "+m(s.price),1)]),_:1})]),_:1})]),_:1})),[[J]]):A("",!0)]),_:1}),e(k),e(k,{side:""},{default:t(()=>[a("div",xe,[S[1]||(S[1]=a("div",null,[a("div",{style:{border:"1px solid white",width:"100px",height:"100px"}})],-1)),a("div",null,[e($,{onClick:S[0]||(S[0]=R=>T(s.ticket.id)),flat:""},{default:t(()=>[e(I,{name:"delete",color:"red"})]),_:1})])])]),_:1})]),_:1})]),_:1},8,["class"]))}};var De=Y(Ae,[["__scopeId","data-v-6bf057de"]]);function M(){const{emit:s,proxy:v}=fe(),l=p(null);function u(){l.value.show()}function _(){l.value.hide()}function c(b){s("ok",b),_()}function T(){s("hide")}return Object.assign(v,{show:u,hide:_}),{dialogRef:l,onDialogHide:T,onDialogOK:c,onDialogCancel:_}}const oe=["ok","hide"];M.emits=oe;M.emitsObject=be(oe);const Ie=["value"],Qe=["value"],Pe=["value"],Ne={__name:"TelegramForm",props:{AccessToken:String,SessionToken:String},setup(s){const v=String({}.SelfDomain),l=String("https://sakh-orch.ru/auth/"),u=p(null);return(_,c)=>s.AccessToken?(o(),w(se,{key:0,ref_key:"formTelegram",ref:u,action:r(l)+"auth/telegram/login.php",method:"post"},{default:t(()=>[a("input",{type:"hidden",name:"AccessToken",value:s.AccessToken},null,8,Ie),a("input",{type:"hidden",name:"SessionToken",value:s.SessionToken},null,8,Qe),a("input",{type:"hidden",name:"from",value:r(v)},null,8,Pe),e($,{type:"submit","no-caps":"",align:"between",outline:!1,padding:"none",style:{width:"100%"},flat:"",dense:"",square:""},{default:t(()=>[e(C,{dense:""},{default:t(()=>[e(k,{avatar:""},{default:t(()=>[e(ne,null,{default:t(()=>[e(ae,{src:"/img/auth/telegram.svg"})]),_:1})]),_:1}),e(k,null,{default:t(()=>[e(x,{caption:""},{default:t(()=>c[0]||(c[0]=[f("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),e(x,null,{default:t(()=>c[1]||(c[1]=[f("\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["action"])):A("",!0)}},$e=["value"],Re=["value"],He=["value"],Le={__name:"VkontakteForm",props:{AccessToken:String,SessionToken:String},setup(s){const v=String({}.SelfDomain),l=String("https://sakh-orch.ru/auth/"),u=p(null);return(_,c)=>s.AccessToken?(o(),w(se,{key:0,ref_key:"formVk",ref:u,action:r(l)+"auth/vk/login.php",method:"post"},{default:t(()=>[a("input",{type:"hidden",name:"AccessToken",value:s.AccessToken},null,8,$e),a("input",{type:"hidden",name:"SessionToken",value:s.SessionToken},null,8,Re),a("input",{type:"hidden",name:"from",value:r(v)},null,8,He),e($,{type:"submit","no-caps":"",align:"between",outline:!1,padding:"none",style:{width:"100%"},flat:"",dense:"",square:""},{default:t(()=>[e(C,{dense:""},{default:t(()=>[e(k,{avatar:""},{default:t(()=>[e(ne,{style:{"background-color":"#e9d26c"}},{default:t(()=>[e(I,{name:"ion-logo-vk",color:"info"})]),_:1})]),_:1}),e(k,null,{default:t(()=>[e(x,{caption:""},{default:t(()=>c[0]||(c[0]=[f("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),e(x,null,{default:t(()=>c[1]||(c[1]=[f("\u0412\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["action"])):A("",!0)}};const Be=["innerHTML"],Oe={__name:"DialogLogin",props:{text:p(""),okBtnText:p("OK"),cancelBtnText:p("\u041E\u0442\u043C\u0435\u043D\u0430"),AccessToken:String,SessionToken:String},emits:[...M.emits],setup(s){const{dialogRef:v,onDialogHide:l,onDialogOK:u,onDialogCancel:_}=M();return(c,T)=>(o(),w(me,{ref_key:"dialogRef",ref:v,onHide:r(l)},{default:t(()=>[e(X,{class:"q-dialog-plugin DialogCard"},{default:t(()=>[e(G,{class:"DialogText"},{default:t(()=>[a("div",{innerHTML:s.text},null,8,Be)]),_:1}),e(G,null,{default:t(()=>[e(Te,null,{default:t(()=>[e(C,null,{default:t(()=>[e(Ne,{AccessToken:s.AccessToken,SessionToken:s.SessionToken},null,8,["AccessToken","SessionToken"])]),_:1}),e(C,null,{default:t(()=>[e(Le,{AccessToken:s.AccessToken,SessionToken:s.SessionToken},null,8,["AccessToken","SessionToken"])]),_:1})]),_:1})]),_:1}),e(le,{align:"right"},{default:t(()=>[e($,{label:s.cancelBtnText,class:"DefBtn","no-caps":"",outline:"",onClick:r(_)},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Ee=Y(Oe,[["__scopeId","data-v-090afec6"]]);const Ue={class:"content"},je={class:"rowNumber"},Ve={class:"rowNumber"},qe={key:0,class:"ticketList"},Fe={__name:"EventPage",setup(s){const v=String("https://sakh-orch.ru/api/"),l=ie(),u=pe(),_=p(null),c=p([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);j("defaultPricing",c);const T=F("progress"),b=V.self.id,S=V.self.authType,R=p({});j("Announce",R);const i=p({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:c.value,cells:[],tickets:[]});j("HallPlan",i),j("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]}),p(!1);const H=ke(()=>[...i.value.tickets].filter(n=>n.userId===b));function L(g){var n,d;return(d=(n=i.value.pricing.find(h=>h.priceType===g.priceType))==null?void 0:n.price)!=null?d:0}function B(g){return i.value.tickets.find(n=>n.cellId===g)}function O(){l.dialog({component:Ee,componentProps:{text:"\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",okBtnText:"\u0412 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",cancelBtnText:"\u041D\u0435 \u0441\u0435\u0439\u0447\u0430\u0441",AccessToken:V.self.AccessToken,SessionToken:V.self.SessionToken},cancel:!0,persistent:!0}).onOk(()=>{}).onOk(()=>{router.push("/account")}).onCancel(()=>{}).onDismiss(()=>{})}async function E(){T.value=!0,R.value=await he.get(l,u.params.id),T.value=!1}function Q(g){i.value.tickets.find(n=>n.id===g).userId=b,Z.post(v+"epoint/tickets/ticket.php",{params:{method:"reserve",id:g}}).then(n=>{var d;if(!((d=n==null?void 0:n.data)!=null&&d.result))throw new Error}).catch(n=>{i.value.tickets.find(d=>d.id===g).userId=null,l.notify(ee(n)),n.response.status===403&&(i.value.tickets.find(d=>d.id===g).offline=!0)})}function U(g){i.value.tickets.find(n=>n.id===g).userId=null,Z.post(v+"epoint/tickets/ticket.php",{params:{method:"returnTicket",id:g}}).then(n=>{var d;if(!((d=n==null?void 0:n.data)!=null&&d.result))throw new Error}).catch(n=>{i.value.tickets.find(d=>d.id===g).userId=b,l.notify(ee(n))})}const re=p(50);return ve(()=>{E(),console.log(S)}),p({width:"100%",height:"100%",margin:"auto",overflow:"scroll"}),ge({title:"\u0411\u0438\u043B\u0435\u0442\u044B"}),(g,n)=>(o(),y("div",Ue,[n[5]||(n[5]=a("div",null,"rer",-1)),n[6]||(n[6]=a("div",null,"rer",-1)),n[7]||(n[7]=a("div",null,"rer",-1)),e(X,{class:"card"},{default:t(()=>[r(T)?(o(),w(ce,{key:0,indeterminate:"",color:"secondary"})):A("",!0),r(T)?A("",!0):(o(),y("div",{key:1,class:"tableArea",id:"tableArea",ref_key:"tableAreaRef",ref:_},[a("div",{style:N({transform:"scale("+re.value+"%)"})},[a("div",null,[n[4]||(n[4]=a("div",{class:"scene"},"\u0421\u0446\u0435\u043D\u0430",-1)),a("table",null,[a("tbody",null,[(o(!0),y(q,null,W(i.value.cells,(d,h)=>(o(),y("tr",{key:"row_"+h},[a("td",null,[a("div",je,m(i.value.structure.rowNums[h]||""),1)]),(o(!0),y(q,null,W(d,(D,ue)=>(o(),y("td",{key:h+"_"+ue},[(o(),w(Ce,{cell:i.value.cells[D.row-1][D.col-1],"onUpdate:cell":P=>i.value.cells[D.row-1][D.col-1]=P,ticket:B(D.id),key:D.id,onReserve:n[0]||(n[0]=P=>Q(P)),onReturnTicket:n[1]||(n[1]=P=>U(P))},null,8,["cell","onUpdate:cell","ticket"]))]))),128)),a("td",null,[a("div",Ve,m(i.value.structure.rowNums[h]||""),1)])]))),128))])])])],4)],512)),e(le,{style:{display:"flex","justify-content":"end",padding:"1em"}},{default:t(()=>[e($,{label:"\u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",outline:"",color:"green",onClick:O})]),_:1})]),_:1}),i.value.tickets.length?(o(),y("div",qe,[(o(!0),y(q,null,W(H.value,d=>(o(),w(De,{key:"tic_"+d.id,ticket:d,price:L(d),onReserve:n[2]||(n[2]=h=>Q(h)),onReturnTicket:n[3]||(n[3]=h=>U(h))},null,8,["ticket","price"]))),128))])):A("",!0)]))}};var ct=Y(Fe,[["__scopeId","data-v-3c0ffedc"]]);export{ct as default};
