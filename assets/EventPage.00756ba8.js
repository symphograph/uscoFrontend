import{Q as pe}from"./QLinearProgress.ca807237.js";import{r as k,m as u,n as w,q as t,ax as o,x as d,f as e,B as $,Q as oe,t as m,l as P,i as F,E as T,F as q,bM as H,v as p,z as Y,ak as G,A as I,al as J,a$ as ke,y as Z,g as ve,H as ge,bl as re,u as _e,p as U,c as ye,o as Te,G as X,au as ae}from"./index.a5870079.js";import{a as j}from"./axios.cfc20e25.js";import{b as be,n as V}from"./myFuncts.53913e80.js";import{u as he}from"./use-meta.cf01c1ff.js";import{u as se}from"./use-quasar.0de5ef34.js";import{Q as ie}from"./QTooltip.517e09cf.js";import{a as we,m as M}from"./myAuth.5621b016.js";import{Q as ue}from"./QImg.91ad1435.js";import{a as S,Q as _}from"./QItem.3e6977f2.js";import{Q as A}from"./QItemLabel.0d0b080b.js";import{_ as ee}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Ce}from"./QList.d74b0ab0.js";import{g as Se}from"./get-emits-object.a3f16783.js";import{Q as ce}from"./QForm.1993e204.js";import"./position-engine.c3ef8083.js";import"./selection.d4ebb01f.js";const xe=["value"],Ae=["value"],Pe=["value"],Ie={__name:"TelegramForm",props:{AccessToken:String,SessionToken:String},setup(r){const v=String("sakh-orch.ru"),a=String("https://auth.symphograph.ru/"),c=k(null);return(y,f)=>r.AccessToken?(u(),w(ce,{key:0,ref_key:"formTelegram",ref:c,action:d(a)+"auth/telegram/login.php",method:"post"},{default:t(()=>[o("input",{type:"hidden",name:"AccessToken",value:r.AccessToken},null,8,xe),o("input",{type:"hidden",name:"SessionToken",value:r.SessionToken},null,8,Ae),o("input",{type:"hidden",name:"from",value:d(v)},null,8,Pe),e($,{type:"submit","no-caps":"",align:"between",outline:!1,padding:"none",style:{width:"100%"},flat:"",dense:"",square:""},{default:t(()=>[e(S,{dense:""},{default:t(()=>[e(_,{avatar:""},{default:t(()=>[e(oe,null,{default:t(()=>[e(ue,{src:"/img/auth/telegram.svg"})]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(A,{caption:""},{default:t(()=>f[0]||(f[0]=[m("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),e(A,null,{default:t(()=>f[1]||(f[1]=[m("\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["action"])):P("",!0)}};const Qe={class:"cellArea"},De={__name:"HallUserCell",props:{cell:Object,ticket:Object},emits:["reserve","returnTicket"],setup(r,{emit:v}){const a=r,c=F("colors"),y=k(a.ticket);F("HallPlan");const f=v;k("Invite"),k(0);const b=we.userId();function h(){f("reserve",y.value.id)}function x(){f("returnTicket",y.value.id)}return(N,i)=>{var K,Q,R,B,E,L,O;return u(),T("div",Qe,[r.cell.exist?(u(),T(q,{key:0},[(K=r.ticket)!=null&&K.offline?(u(),T("div",{key:0,class:"offlineCell",style:H({borderColor:d(c)[((Q=a.ticket)==null?void 0:Q.priceType)||"Invite"][1],backgroundColor:d(c)[((R=a.ticket)==null?void 0:R.priceType)||"Invite"][1]})},null,4)):a.ticket.userId===d(b)?(u(),T("div",{key:1,class:"userCell",onClick:i[0]||(i[0]=W=>x()),style:H({borderColor:d(c)[((B=a.ticket)==null?void 0:B.priceType)||"Invite"][1]})},[m(p(a.ticket.seatNum)+" ",1),e(ie,{offset:[0,-120],"max-width":"20em",delay:300},{default:t(()=>[i[2]||(i[2]=m(p("\u042D\u0442\u043E \u0412\u0430\u0448\u0435 \u043C\u0435\u0441\u0442\u043E"))),i[3]||(i[3]=o("br",null,null,-1)),m(" "+p("\u0420\u044F\u0434: "+a.ticket.seatRow),1),i[4]||(i[4]=o("br",null,null,-1)),m(" "+p("\u041C\u0435\u0441\u0442\u043E: "+a.ticket.seatNum),1),i[5]||(i[5]=o("br",null,null,-1)),m(" "+p("\u0426\u0435\u043D\u0430: "+a.ticket.priceType),1)]),_:1})],4)):a.ticket.userId?(u(),T("div",{key:2,class:"offlineCell",style:H({borderColor:d(c)[((E=a.ticket)==null?void 0:E.priceType)||"Invite"][1],backgroundColor:d(c)[((L=a.ticket)==null?void 0:L.priceType)||"Invite"][1]})},null,4)):(u(),T("div",{key:3,class:"availableCell",style:H({borderColor:d(c)[((O=a.ticket)==null?void 0:O.priceType)||"Invite"][1]}),onClick:i[1]||(i[1]=W=>h())},[m(p(a.ticket.seatNum)+" ",1),e(ie,{offset:[0,-120],"max-width":"20em",delay:300},{default:t(()=>[m(p("\u0420\u044F\u0434: "+a.ticket.seatRow),1),i[6]||(i[6]=o("br",null,null,-1)),m(" "+p("\u041C\u0435\u0441\u0442\u043E: "+a.ticket.seatNum),1),i[7]||(i[7]=o("br",null,null,-1)),m(" "+p("\u0426\u0435\u043D\u0430: "+a.ticket.priceType),1)]),_:1})],4))],64)):P("",!0)])}}};const He={class:"mapLink"},$e={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"space-between"}},Ne={__name:"TicketCard",props:{ticket:{},price:Number},emits:["reserve","returnTicket"],setup(r,{emit:v}){const a=String("https://api.sakh-orch.ru/");se();const c=F("Announce"),y=v,f=k("");function b(h){f.value=" returning",setTimeout(()=>{y("returnTicket",h)},600)}return(h,x)=>(u(),w(Z,{class:ke("ticketCard"+f.value)},{default:t(()=>[e(Y,{class:"progName"},{default:t(()=>[m(p(d(c).progName),1)]),_:1}),e(S,{dense:""},{default:t(()=>[e(_,{avatar:""},{default:t(()=>[e(ue,{width:"10em",ratio:16/9,src:d(a)+d(c).Sketch.verLink},null,8,["src"])]),_:1}),e(_,{avatar:""},{default:t(()=>[G((u(),w(S,{dense:""},{default:t(()=>[e(_,{avatar:""},{default:t(()=>[e(I,{name:"schedule",color:"amber"})]),_:1}),e(_,null,{default:t(()=>[e(A,{caption:""},{default:t(()=>[m(p(d(be)(d(c).eventTime)),1)]),_:1})]),_:1})]),_:1})),[[J]]),e(S,{clickable:"",dense:"",href:d(c).Hall.map,target:"_blank"},{default:t(()=>[e(_,{avatar:""},{default:t(()=>[e(I,{color:"amber",name:"place"})]),_:1}),e(A,null,{default:t(()=>[o("span",He,p(d(c).Hall.name),1)]),_:1})]),_:1},8,["href"]),G((u(),w(S,{dense:""},{default:t(()=>[e(_,{avatar:""},{default:t(()=>[e(I,{name:"ion-person",color:"amber"})]),_:1}),e(_,null,{default:t(()=>[e(A,{lines:"1"},{default:t(()=>[m("\u0420\u044F\u0434: "+p(r.ticket.seatRow)+" | \u041C\u0435\u0441\u0442\u043E: "+p(r.ticket.seatNum),1)]),_:1})]),_:1})]),_:1})),[[J]]),r.price?G((u(),w(S,{key:0,dense:""},{default:t(()=>[e(_,{avatar:""},{default:t(()=>[e(I,{name:"ion-wallet",color:"amber"})]),_:1}),e(_,null,{default:t(()=>[e(A,{lines:1},{default:t(()=>[m("\u0426\u0435\u043D\u0430: "+p(r.price),1)]),_:1})]),_:1})]),_:1})),[[J]]):P("",!0)]),_:1}),e(_),e(_,{side:""},{default:t(()=>[o("div",$e,[x[1]||(x[1]=o("div",null,[o("div",{style:{border:"1px solid white",width:"100px",height:"100px"}})],-1)),o("div",null,[e($,{onClick:x[0]||(x[0]=N=>b(r.ticket.id)),flat:""},{default:t(()=>[e(I,{name:"delete",color:"red"})]),_:1})])])]),_:1})]),_:1})]),_:1},8,["class"]))}};var Re=ee(Ne,[["__scopeId","data-v-6bf057de"]]);function z(){const{emit:r,proxy:v}=ve(),a=k(null);function c(){a.value.show()}function y(){a.value.hide()}function f(h){r("ok",h),y()}function b(){r("hide")}return Object.assign(v,{show:c,hide:y}),{dialogRef:a,onDialogHide:b,onDialogOK:f,onDialogCancel:y}}const de=["ok","hide"];z.emits=de;z.emitsObject=Se(de);const Be=["value"],Ee=["value"],Le=["value"],Oe={__name:"VkontakteForm",props:{AccessToken:String,SessionToken:String},setup(r){const v=String("sakh-orch.ru"),a=String("https://auth.symphograph.ru/"),c=k(null);return(y,f)=>r.AccessToken?(u(),w(ce,{key:0,ref_key:"formVk",ref:c,action:d(a)+"auth/vk/login.php",method:"post"},{default:t(()=>[o("input",{type:"hidden",name:"AccessToken",value:r.AccessToken},null,8,Be),o("input",{type:"hidden",name:"SessionToken",value:r.SessionToken},null,8,Ee),o("input",{type:"hidden",name:"from",value:d(v)},null,8,Le),e($,{type:"submit","no-caps":"",align:"between",outline:!1,padding:"none",style:{width:"100%"},flat:"",dense:"",square:""},{default:t(()=>[e(S,{dense:""},{default:t(()=>[e(_,{avatar:""},{default:t(()=>[e(oe,{style:{"background-color":"#e9d26c"}},{default:t(()=>[e(I,{name:"ion-logo-vk",color:"info"})]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(A,{caption:""},{default:t(()=>f[0]||(f[0]=[m("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),e(A,null,{default:t(()=>f[1]||(f[1]=[m("\u0412\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["action"])):P("",!0)}};const Ue=["innerHTML"],je={__name:"DialogLogin",props:{text:k(""),okBtnText:k("OK"),cancelBtnText:k("\u041E\u0442\u043C\u0435\u043D\u0430"),AccessToken:String,SessionToken:String},emits:[...z.emits],setup(r){const{dialogRef:v,onDialogHide:a,onDialogOK:c,onDialogCancel:y}=z();return(f,b)=>(u(),w(ge,{ref_key:"dialogRef",ref:v,onHide:d(a)},{default:t(()=>[e(Z,{class:"q-dialog-plugin DialogCard"},{default:t(()=>[e(Y,{class:"DialogText"},{default:t(()=>[o("div",{innerHTML:r.text},null,8,Ue)]),_:1}),e(Y,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(S,null,{default:t(()=>[e(Ie,{AccessToken:r.AccessToken,SessionToken:r.SessionToken},null,8,["AccessToken","SessionToken"])]),_:1}),e(S,null,{default:t(()=>[e(Oe,{AccessToken:r.AccessToken,SessionToken:r.SessionToken},null,8,["AccessToken","SessionToken"])]),_:1})]),_:1})]),_:1}),e(re,{align:"right"},{default:t(()=>[e($,{label:r.cancelBtnText,class:"DefBtn","no-caps":"",outline:"",onClick:d(y)},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Ve=ee(je,[["__scopeId","data-v-bef1644c"]]);const Me={class:"content"},qe={class:"rowNumber"},Fe={class:"rowNumber"},ze={key:0,class:"ticketList"},Ke={__name:"EventPage",setup(r){const v=String("https://api.sakh-orch.ru/"),a=se(),c=_e(),y=k(null),f=k([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);U("defaultPricing",f);const b=F("progress"),h=M.self.id,x=M.self.authType,N=k({});U("Announce",N);const i=k({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:f.value,cells:[],tickets:[]});U("HallPlan",i),U("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]});const Q=k(!1),R=ye(()=>[...i.value.tickets].filter(l=>l.userId===h));function B(n){var l,s;return(s=(l=i.value.pricing.find(g=>g.priceType===n.priceType))==null?void 0:l.price)!=null?s:0}function E(n){return i.value.tickets.find(l=>l.cellId===n)}function L(){a.dialog({component:Ve,componentProps:{text:"\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",okBtnText:"\u0412 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",cancelBtnText:"\u041D\u0435 \u0441\u0435\u0439\u0447\u0430\u0441",AccessToken:M.self.AccessToken,SessionToken:M.self.SessionToken},cancel:!0,persistent:!0}).onOk(()=>{}).onOk(()=>{router.push("/account")}).onCancel(()=>{}).onDismiss(()=>{})}function O(){j.post(v+"api/tickets/hallplan.php",{params:{method:"get",id:c.params.id}}).then(async n=>{var l,s,g,C;if(!((s=(l=n==null?void 0:n.data)==null?void 0:l.data)!=null&&s.HallPlan))throw new Error;Q.value=!1,i.value=(C=(g=n==null?void 0:n.data)==null?void 0:g.data)==null?void 0:C.HallPlan,await ae(),Q.value=!0,console.log("HallPlan loaded")}).catch(n=>{i.value={},a.notify(V(n))}).finally(()=>{b.value=!1,console.log("progress off"),ae(()=>{let n=document.getElementById("tableArea");n.scrollTo(n.clientWidth/2,0),console.log(n.scrollWidth),fe()})})}function W(){b.value=!0,console.log("progress on"),j.post(v+"api/event/announce.php",{params:{method:"get",id:c.params.id}}).then(n=>{var l,s,g;if(!((l=n==null?void 0:n.data)!=null&&l.result))throw console.log("announce err:",n.data),new Error;N.value=(g=(s=n==null?void 0:n.data)==null?void 0:s.data)!=null?g:{},console.log("Announce loaded"),O()}).catch(n=>{a.notify(V(n))}).finally(()=>{})}function te(n){i.value.tickets.find(l=>l.id===n).userId=h,j.post(v+"api/tickets/ticket.php",{params:{method:"reserve",id:n}}).then(l=>{var s;if(!((s=l==null?void 0:l.data)!=null&&s.result))throw new Error}).catch(l=>{i.value.tickets.find(s=>s.id===n).userId=null,a.notify(V(l)),l.response.status===403&&(i.value.tickets.find(s=>s.id===n).offline=!0)})}function le(n){i.value.tickets.find(l=>l.id===n).userId=null,j.post(v+"api/tickets/ticket.php",{params:{method:"returnTicket",id:n}}).then(l=>{var s;if(!((s=l==null?void 0:l.data)!=null&&s.result))throw new Error}).catch(l=>{i.value.tickets.find(s=>s.id===n).userId=h,a.notify(V(l))})}const ne=k(50);function fe(){setTimeout(()=>{ne.value=100},1e3)}return Te(()=>{W(),console.log(x)}),k({width:"100%",height:"100%",margin:"auto",overflow:"scroll"}),he({title:"\u0411\u0438\u043B\u0435\u0442\u044B"}),(n,l)=>(u(),T("div",Me,[l[5]||(l[5]=o("div",null,"rer",-1)),l[6]||(l[6]=o("div",null,"rer",-1)),l[7]||(l[7]=o("div",null,"rer",-1)),e(Z,{class:"card"},{default:t(()=>[d(b)?(u(),w(pe,{key:0,indeterminate:"",color:"secondary"})):P("",!0),d(b)?P("",!0):(u(),T("div",{key:1,class:"tableArea",id:"tableArea",ref_key:"tableAreaRef",ref:y},[o("div",{style:H({transform:"scale("+ne.value+"%)"})},[o("div",null,[l[4]||(l[4]=o("div",{class:"scene"},"\u0421\u0446\u0435\u043D\u0430",-1)),o("table",null,[o("tbody",null,[(u(!0),T(q,null,X(i.value.cells,(s,g)=>(u(),T("tr",{key:"row_"+g},[o("td",null,[o("div",qe,p(i.value.structure.rowNums[g]||""),1)]),(u(!0),T(q,null,X(s,(C,me)=>(u(),T("td",{key:g+"_"+me},[(u(),w(De,{cell:i.value.cells[C.row-1][C.col-1],"onUpdate:cell":D=>i.value.cells[C.row-1][C.col-1]=D,ticket:E(C.id),key:C.id,onReserve:l[0]||(l[0]=D=>te(D)),onReturnTicket:l[1]||(l[1]=D=>le(D))},null,8,["cell","onUpdate:cell","ticket"]))]))),128)),o("td",null,[o("div",Fe,p(i.value.structure.rowNums[g]||""),1)])]))),128))])])])],4)],512)),e(re,{style:{display:"flex","justify-content":"end",padding:"1em"}},{default:t(()=>[e($,{label:"\u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",outline:"",color:"green",onClick:L})]),_:1})]),_:1}),i.value.tickets.length?(u(),T("div",ze,[(u(!0),T(q,null,X(R.value,s=>(u(),w(Re,{key:"tic_"+s.id,ticket:s,price:B(s),onReserve:l[2]||(l[2]=g=>te(g)),onReturnTicket:l[3]||(l[3]=g=>le(g))},null,8,["ticket","price"]))),128))])):P("",!0)]))}};var ft=ee(Ke,[["__scopeId","data-v-96b6c158"]]);export{ft as default};
