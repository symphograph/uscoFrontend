import{Q as E}from"./QImg.66244b92.js";import{Q as J}from"./QVideo.b3f77149.js";import{u as Z}from"./use-meta.7bac38cb.js";import{u as j}from"./use-quasar.52847c26.js";import{api as A}from"./axios.2afd3ec2.js";import{aK as G,aL as W,_ as X,i as L,S as K,r as C,z as i,A as r,y as s,B as n,aY as I,H as o,N as T,C as v,E as Q,F as w,G as S,m as ee,D as B,J as M,K as te,a3 as ae,aV as le,aU as oe,I as b,R as ne,O as se,P as ie,T as de,o as re}from"./index.fb830c72.js";import{b as O,a as P,Q as ue}from"./QItem.2a899fa4.js";import{Q as ce}from"./QList.4a2c7b8d.js";import{Q as R}from"./QUploader.04d8278c.js";import{a as D,n as U}from"./myFuncts.02e9a0a2.js";import"./use-ratio.f2decef5.js";import"./format.3e32b8d9.js";function pe(m){const l=document.createElement("textarea");l.value=m,l.contentEditable="true",l.style.position="fixed";const a=()=>{};G(a),document.body.appendChild(l),l.focus(),l.select();const u=document.execCommand("copy");return l.remove(),W(a),u}function me(m){return navigator.clipboard!==void 0?navigator.clipboard.writeText(m):new Promise((l,a)=>{const u=pe(m);u?l(!0):a(u)})}const x=m=>(se("data-v-90a9f9c8"),m=m(),ie(),m),_e={key:0,class:"newsarea"},fe=x(()=>o("br",null,null,-1)),ve={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},ye={class:"nimg_block"},ge={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},he={class:"inputArea"},ke={class:"input"},be={id:"categs",class:"input"},we={id:"uploaderArea",class:"input"},xe={class:"uploaderArea"},Ve={id:"uploaderArea2",class:"input"},Ie={class:"uploaderArea"},$e={class:"imagesArea"},Ne={class:"row no-wrap"},Qe=x(()=>o("br",null,null,-1)),Ue=x(()=>o("br",null,null,-1)),Ce=x(()=>o("br",null,null,-1)),Fe=x(()=>o("br",null,null,-1)),Te=x(()=>o("br",null,null,-1)),Ae=x(()=>o("br",null,null,-1)),Ee={__name:"NewEditor",emits:["uploaded"],setup(m,{emit:l}){const a=L("newData"),u=String("https://api.sakh-orch.ru/"),_=j(),$=L("token"),N=K(),V=C(null),g=C([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u041A\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]);function f(d){d=`
![](`+d+")",me(d).then(()=>{_.notify({color:"positive",position:"center",message:"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E",icon:"content_copy",timeout:1})}).catch(()=>{})}function h(d,t){A.post(u+"api/set/news/delimg.php",{params:{id:N.params.id,img:d}}).then(e=>{var p,k;_.notify(D((k=(p=e==null?void 0:e.data)==null?void 0:p.result)!=null?k:"")),a.value.Images.splice(t,1),l("uploaded")}).catch(e=>{_.notify(U(e))})}function c(d){A.post(u+"api/set/news/delpw.php",{params:{id:N.params.id,img:d}}).then(t=>{a.value.img="/img/entry/default.svg"}).catch(t=>{_.notify(U(t))})}function y(){return{url:u+"api/upload/entrypw.php",headers:[{name:"AUTHORIZATION",value:$.value}],formFields:[{name:"id",value:a.value.id}]}}function F(){return{url:u+"api/upload/entryimg.php",headers:[{name:"AUTHORIZATION",value:$.value}],formFields:[{name:"id",value:a.value.id}]}}function z(d){_.notify(D("\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E")),l("uploaded"),V.value.reset()}function H(d){var e,p,k;let t=(k=(p=JSON.parse((e=d==null?void 0:d.xhr)==null?void 0:e.response))==null?void 0:p.error)!=null?k:"";_.notify(U(null,t))}function Y(){const d=Object.keys(g.value);let t=[];return d.forEach(e=>{t[g.value[e].id]=g.value[e].checked}),t}function q(d=0){A.post(u+"api/set/news/entry.php",{params:{entry:a.value,addNew:d,categs:Y()}}).then(t=>{var e,p;_.notify(D((p=(e=t==null?void 0:t.data)==null?void 0:e.result)!=null?p:"")),l("uploaded")}).catch(t=>{_.notify(U(t))})}return(d,t)=>(i(),r(w,null,[s(a)?(i(),r("div",_e,[n(I,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:s(a).title,"onUpdate:modelValue":t[0]||(t[0]=e=>s(a).title=e)},null,8,["modelValue"]),fe,o("div",ve,[o("div",ye,[n(E,{ratio:1080/684,src:s(u)+s(a).img},null,8,["src"])]),n(T,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{transform:"translateY(-50%)"},onClick:t[1]||(t[1]=e=>c(s(a).img))}),o("div",ge,[n(I,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",type:"textarea",modelValue:s(a).descr,"onUpdate:modelValue":t[2]||(t[2]=e=>s(a).descr=e),outlined:""},null,8,["modelValue"])])]),o("div",he,[o("div",ke,[n(I,{type:"date",modelValue:s(a).date,"onUpdate:modelValue":t[3]||(t[3]=e=>s(a).date=e),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),n(I,{modelValue:s(a).refName,"onUpdate:modelValue":t[4]||(t[4]=e=>s(a).refName=e),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),n(I,{modelValue:s(a).refLink,"onUpdate:modelValue":t[5]||(t[5]=e=>s(a).refLink=e),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},null,8,["modelValue"])]),o("div",be,[n(ce,{bordered:"",padding:""},{default:v(()=>[n(O,{header:""},{default:v(()=>[Q("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(i(!0),r(w,null,S(g.value,e=>ee((i(),B(ue,{key:e.id,tag:"label"},{default:v(()=>[n(P,null,{default:v(()=>[n(O,null,{default:v(()=>[Q(M(e.name),1)]),_:2},1024),n(O,{caption:""},{default:v(()=>[Q(M(e.caption),1)]),_:2},1024)]),_:2},1024),n(P,{side:"",top:""},{default:v(()=>[n(te,{color:"green",modelValue:s(a).categs[e.id],"onUpdate:modelValue":p=>s(a).categs[e.id]=p,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[ne]])),128))]),_:1})]),o("div",we,[o("div",xe,[n(R,{label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437",factory:y,"max-file-size":"50000000",ref_key:"uploader",ref:V,onUploaded:z,onFailed:H,padding:"0",margin:"0",bordered:""},null,512)])]),o("div",Ve,[o("div",Ie,[n(R,{"input-style":"max-width: 300px; padding: 0",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",factory:F,"max-file-size":"50000000",ref_key:"uploader",ref:V,onUploaded:z,onFailed:H,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)])])]),o("div",$e,[(i(!0),r(w,null,S(s(a).Images,(e,p)=>(i(),B(oe,{key:p},{default:v(()=>[n(E,{ratio:96/54,src:s(u)+"/img/entry/1080/"+s(a).id+"/"+e.fileName},null,8,["src"]),n(le,null,{default:v(()=>[n(T,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{top:"0",right:"0.5em",transform:"translateY(-50%)"},onClick:k=>h(e.fileName,p)},null,8,["onClick"]),o("div",Ne,[n(T,{padding:"0.5em 1em",onClick:k=>f(e.fileName)},{default:v(()=>[n(ae,{name:"content_copy"}),Q(" \u041A\u043E\u0434 \u0432\u0441\u0442\u0430\u0432\u043A\u0438 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),n(I,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:s(a).markdown,"onUpdate:modelValue":t[6]||(t[6]=e=>s(a).markdown=e),dense:""},null,8,["modelValue"]),Qe,Ue,n(T,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",onClick:t[7]||(t[7]=e=>q(0))}),Ce,Fe])):b("",!0),Te,Ae],64))}};var Le=X(Ee,[["__scopeId","data-v-90a9f9c8"]]);const Se={key:0,class:"content"},Me={key:1,class:"newsarea"},Oe={class:"p_title"},De={class:"narea"},Be={class:"text"},ze=["innerHTML"],He={key:1},Pe=o("br",null,null,-1),Re={key:1,class:"newsImg"},je={key:2,class:"vitem"},Ke={key:0},Ye=["href"],qe={key:1,class:"content"},Je=o("div",{class:"newsarea"},[o("div",{class:"narea"},[o("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),Ze=[Je],rt={__name:"NewPage",setup(m){C(0);const l=C(null);de("newData",l);const a=j(),u=String("https://api.sakh-orch.ru/");L("token");const _=K(),$=L("editMode"),N=C("\u041D\u043E\u0432\u043E\u0441\u0442\u044C");Z(()=>({title:N.value}));function V(f){return u+"/img/entry/1080/"+l.value.id+"/"+f}function g(){A.post(u+"api/get/new.php",{params:{id:_.params.id}}).then(f=>{var h,c,y,F;l.value=(c=(h=f==null?void 0:f.data)==null?void 0:h.data)!=null?c:null,N.value=(F=(y=l==null?void 0:l.value)==null?void 0:y.title)!=null?F:""}).catch(f=>{a.notify(U(f))})}return re(()=>{g()}),(f,h)=>l.value||s($)?(i(),r("div",Se,[s($)&&l.value?(i(),B(Le,{key:0,onUploaded:h[0]||(h[0]=c=>g())})):b("",!0),l.value?(i(),r("div",Me,[o("div",Oe,M(l.value.title),1),o("div",De,[o("div",Be,[(i(!0),r(w,null,S(l.value.parsedMD,(c,y)=>(i(),r(w,{key:y},[c.type==="text"?(i(),r(w,{key:0},[c.content!==`
`?(i(),r("section",{key:0,innerHTML:c.content},null,8,ze)):(i(),r("br",He)),Pe],64)):b("",!0),c.type==="img"?(i(),r("div",Re,[n(E,{src:V(c.content),fit:"fill"},null,8,["src"])])):b("",!0),c.type==="video"?(i(),r("div",je,[n(J,{ratio:16/9,src:"https://www.youtube.com/embed/"+c.content},null,8,["src"])])):b("",!0)],64))),128)),l.value.refLink?(i(),r("div",Ke,[Q("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "),o("a",{href:l.value.refLink,target:"_blank"},M(l.value.refName),9,Ye)])):b("",!0),(i(!0),r(w,null,S(l.value.unusedImages,(c,y)=>(i(),r("div",{class:"newsImg",key:y},[n(E,{src:V(c),fit:"fill"},null,8,["src"])]))),128))])])])):b("",!0)])):(i(),r("div",qe,Ze))}};export{rt as default};
