import{Q as A}from"./QImg.d2c98b48.js";import{Q as J}from"./QVideo.31552aa7.js";import{u as Z}from"./use-meta.355ae365.js";import{u as R}from"./use-quasar.acee65a8.js";import{api as T}from"./axios.296019ec.js";import{aK as G,aL as W,_ as X,i as D,S as j,r as C,z as i,A as r,y as s,B as n,aY as V,H as o,N as F,C as f,E as Q,F as w,G as E,m as ee,D as O,J as L,K as te,a3 as ae,aV as le,aU as oe,I as k,R as ne,O as se,P as ie,T as de,o as re}from"./index.e552dc30.js";import{b as S,a as H,Q as ue}from"./QItem.9df529e7.js";import{Q as ce}from"./QList.cf535f9e.js";import{Q as P}from"./QUploader.4ebd3890.js";import{a as M,n as U}from"./myFuncts.02e9a0a2.js";import"./use-ratio.fa9637be.js";import"./format.3e32b8d9.js";function pe(m){const l=document.createElement("textarea");l.value=m,l.contentEditable="true",l.style.position="fixed";const a=()=>{};G(a),document.body.appendChild(l),l.focus(),l.select();const u=document.execCommand("copy");return l.remove(),W(a),u}function me(m){return navigator.clipboard!==void 0?navigator.clipboard.writeText(m):new Promise((l,a)=>{const u=pe(m);u?l(!0):a(u)})}const b=m=>(se("data-v-6893ec14"),m=m(),ie(),m),_e={key:0,class:"newsarea"},fe=b(()=>o("br",null,null,-1)),ve={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},ye={class:"nimg_block"},ge={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},he={class:"inputArea"},ke={class:"input"},we={id:"categs",class:"input"},be={id:"uploaderArea",class:"input"},xe={class:"uploaderArea"},Ve={id:"uploaderArea2",class:"input"},Ie={class:"uploaderArea"},$e={class:"imagesArea"},Ne={class:"row no-wrap"},Qe=b(()=>o("br",null,null,-1)),Ue=b(()=>o("br",null,null,-1)),Ce=b(()=>o("br",null,null,-1)),Fe=b(()=>o("br",null,null,-1)),Te=b(()=>o("br",null,null,-1)),Ae=b(()=>o("br",null,null,-1)),De={__name:"NewEditor",emits:["uploaded"],setup(m,{emit:l}){const a=D("newData"),u=String("https://api.sakh-orch.ru/"),_=R(),I=D("token"),$=j(),x=C(null),y=C([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u041A\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]);function v(d){d=`
![](`+d+")",me(d).then(()=>{_.notify({color:"positive",position:"center",message:"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E",icon:"content_copy",timeout:1})}).catch(()=>{})}function g(d,t){T.post(u+"api/set/news/delimg.php",{params:{id:$.params.id,img:d}}).then(e=>{var p,h;_.notify(M((h=(p=e==null?void 0:e.data)==null?void 0:p.result)!=null?h:"")),a.value.Images.splice(t,1),l("uploaded")}).catch(e=>{_.notify(U(e))})}function c(d){T.post(u+"api/set/news/delpw.php",{params:{id:$.params.id,img:d}}).then(t=>{a.value.img="/img/entry/default.svg"}).catch(t=>{_.notify(U(t))})}function N(){return{url:u+"api/upload/entrypw.php",headers:[{name:"AUTHORIZATION",value:I.value}],formFields:[{name:"id",value:props.newData.id}]}}function K(){return{url:u+"api/upload/entryimg.php",headers:[{name:"AUTHORIZATION",value:I.value}],formFields:[{name:"id",value:props.newData.id}]}}function B(d){_.notify(M("\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E")),l("uploaded"),x.value.reset()}function z(d){var e,p,h;let t=(h=(p=JSON.parse((e=d==null?void 0:d.xhr)==null?void 0:e.response))==null?void 0:p.error)!=null?h:"";_.notify(U(null,t))}function Y(){const d=Object.keys(y.value);let t=[];return d.forEach(e=>{t[y.value[e].id]=y.value[e].checked}),t}function q(d=0){T.post(u+"api/set/news/entry.php",{params:{entry:a.value,addNew:d,categs:Y()}}).then(t=>{var e,p;_.notify(M((p=(e=t==null?void 0:t.data)==null?void 0:e.result)!=null?p:"")),l("uploaded")}).catch(t=>{_.notify(U(t))})}return(d,t)=>(i(),r(w,null,[s(a)?(i(),r("div",_e,[n(V,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:s(a).title,"onUpdate:modelValue":t[0]||(t[0]=e=>s(a).title=e)},null,8,["modelValue"]),fe,o("div",ve,[o("div",ye,[n(A,{ratio:1080/684,src:s(u)+s(a).img},null,8,["src"])]),n(F,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{transform:"translateY(-50%)"},onClick:t[1]||(t[1]=e=>c(s(a).img))}),o("div",ge,[n(V,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",type:"textarea",modelValue:s(a).descr,"onUpdate:modelValue":t[2]||(t[2]=e=>s(a).descr=e),outlined:""},null,8,["modelValue"])])]),o("div",he,[o("div",ke,[n(V,{type:"date",modelValue:s(a).date,"onUpdate:modelValue":t[3]||(t[3]=e=>s(a).date=e),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),n(V,{modelValue:s(a).refName,"onUpdate:modelValue":t[4]||(t[4]=e=>s(a).refName=e),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),n(V,{modelValue:s(a).refLink,"onUpdate:modelValue":t[5]||(t[5]=e=>s(a).refLink=e),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},null,8,["modelValue"])]),o("div",we,[n(ce,{bordered:"",padding:""},{default:f(()=>[n(S,{header:""},{default:f(()=>[Q("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(i(!0),r(w,null,E(y.value,e=>ee((i(),O(ue,{key:e.id,tag:"label"},{default:f(()=>[n(H,null,{default:f(()=>[n(S,null,{default:f(()=>[Q(L(e.name),1)]),_:2},1024),n(S,{caption:""},{default:f(()=>[Q(L(e.caption),1)]),_:2},1024)]),_:2},1024),n(H,{side:"",top:""},{default:f(()=>[n(te,{color:"green",modelValue:s(a).categs[e.id],"onUpdate:modelValue":p=>s(a).categs[e.id]=p,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[ne]])),128))]),_:1})]),o("div",be,[o("div",xe,[n(P,{label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437",factory:N,"max-file-size":"50000000",ref_key:"uploader",ref:x,onUploaded:B,onFailed:z,padding:"0",margin:"0",bordered:""},null,512)])]),o("div",Ve,[o("div",Ie,[n(P,{"input-style":"max-width: 300px; padding: 0",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",factory:K,"max-file-size":"50000000",ref_key:"uploader",ref:x,onUploaded:B,onFailed:z,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)])])]),o("div",$e,[(i(!0),r(w,null,E(s(a).Images,(e,p)=>(i(),O(oe,{key:p},{default:f(()=>[n(A,{ratio:96/54,src:s(u)+"/img/entry/1080/"+s(a).id+"/"+e.fileName},null,8,["src"]),n(le,null,{default:f(()=>[n(F,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{top:"0",right:"0.5em",transform:"translateY(-50%)"},onClick:h=>g(e.fileName,p)},null,8,["onClick"]),o("div",Ne,[n(F,{padding:"0.5em 1em",onClick:h=>v(e.fileName)},{default:f(()=>[n(ae,{name:"content_copy"}),Q(" \u041A\u043E\u0434 \u0432\u0441\u0442\u0430\u0432\u043A\u0438 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),n(V,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:s(a).markdown,"onUpdate:modelValue":t[6]||(t[6]=e=>s(a).markdown=e),dense:""},null,8,["modelValue"]),Qe,Ue,n(F,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",onClick:t[7]||(t[7]=e=>q(0))}),Ce,Fe])):k("",!0),Te,Ae],64))}};var Ee=X(De,[["__scopeId","data-v-6893ec14"]]);const Le={key:0,class:"content"},Se={key:1,class:"newsarea"},Me={class:"p_title"},Oe={class:"narea"},Be={class:"text"},ze=["innerHTML"],He={key:1},Pe=o("br",null,null,-1),Re={key:1,class:"newsImg"},je={key:2,class:"vitem"},Ke={key:0},Ye=["href"],qe={key:1,class:"content"},Je=o("div",{class:"newsarea"},[o("div",{class:"narea"},[o("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),Ze=[Je],rt={__name:"NewPage",setup(m){C(0);const l=C(null);de("newData",l);const a=R(),u=String("https://api.sakh-orch.ru/");D("token");const _=j(),I=D("editMode"),$=C("\u041D\u043E\u0432\u043E\u0441\u0442\u044C");Z(()=>({title:$.value}));function x(v){return u+"/img/entry/1080/"+l.value.id+"/"+v}function y(){T.post(u+"api/get/new.php",{params:{id:_.params.id}}).then(v=>{var g,c;l.value=(g=v.data.data)!=null?g:[],$.value=(c=l.value.title)!=null?c:""}).catch(v=>{a.notify(U(v))})}return re(()=>{y()}),(v,g)=>l.value||s(I)?(i(),r("div",Le,[s(I)&&l.value?(i(),O(Ee,{key:0,onUploaded:g[0]||(g[0]=c=>y())})):k("",!0),l.value?(i(),r("div",Se,[o("div",Me,L(l.value.title),1),o("div",Oe,[o("div",Be,[(i(!0),r(w,null,E(l.value.parsedMD,(c,N)=>(i(),r(w,{key:N},[c.type==="text"?(i(),r(w,{key:0},[c.content!==`
`?(i(),r("section",{key:0,innerHTML:c.content},null,8,ze)):(i(),r("br",He)),Pe],64)):k("",!0),c.type==="img"?(i(),r("div",Re,[n(A,{src:x(c.content),fit:"fill"},null,8,["src"])])):k("",!0),c.type==="video"?(i(),r("div",je,[n(J,{ratio:16/9,src:"https://www.youtube.com/embed/"+c.content},null,8,["src"])])):k("",!0)],64))),128)),l.value.refLink?(i(),r("div",Ke,[Q("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "),o("a",{href:l.value.refLink,target:"_blank"},L(l.value.refName),9,Ye)])):k("",!0),(i(!0),r(w,null,E(l.value.unusedImages,(c,N)=>(i(),r("div",{class:"newsImg",key:N},[n(A,{src:x(c),fit:"fill"},null,8,["src"])]))),128))])])])):k("",!0)])):(i(),r("div",qe,Ze))}};export{rt as default};
