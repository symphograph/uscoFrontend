import{i as _,n as d,q as k,F as E,aw as K,H as y,f as a,V as n,bh as W,S as le,G as i,U as C,b as Z,bw as ae,a9 as X,t as A,b2 as oe,b3 as ne,ax as g,l as N,W as ue,r as T,bX as te,aZ as se,p as V,k as de,o as pe,aY as fe,a2 as F,bk as me}from"./index.d7d1bcb8.js";import{api as D}from"./axios.4ccd572a.js";import{n as G,a as _e}from"./myFuncts.bfee3d05.js";import{u as J}from"./use-quasar.ff1c236f.js";import{_ as ee}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as z}from"./QTooltip.87ead732.js";import{b as Y,Q as M,a as U}from"./QItemLabel.225c1518.js";import{Q as ce}from"./QSelect.0366063b.js";import{Q as ve}from"./QImg.83f9a5cf.js";import"./position-engine.802685a2.js";import"./rtl.da602a43.js";import"./format.3e32b8d9.js";import"./use-ratio.6d8d9949.js";const ye={class:"priceRow"},ke=["onClick"],be={__name:"PriceInputs",emits:["onSelectPrice"],setup(I,{emit:b}){const t=_("selectedPrice"),c=_("HallPlan");function o(s){t.value=s}const p=_("colors");function u(s){return s.priceType===t.value.priceType?"1.5em":"1em"}return(s,l)=>(d(),k("div",ye,[(d(!0),k(E,null,K(n(c).pricing,r=>(d(),k("div",{key:r.priceType,class:"priceCell"},[y("div",{style:{cursor:"pointer"},onClick:v=>o(r)},[a(W,{label:r.label,dense:"","label-color":n(p)[r.priceType][0],step:"100","input-class":"priceInput",modelValue:n(c).pricing.find(v=>v.priceType===r.priceType).price,"onUpdate:modelValue":v=>n(c).pricing.find(w=>w.priceType===r.priceType).price=v,type:"number"},null,8,["label","label-color","modelValue","onUpdate:modelValue"]),a(le,{name:"edit",color:n(p)[r.priceType][0],size:u(r)},null,8,["color","size"])],8,ke)]))),128))]))}};var we=ee(be,[["__scopeId","data-v-607c9cf6"]]);const he={style:{width:"100%",border:"1px solid lightgray","border-radius":"3px"}},Ce={__name:"StructureInputs",setup(I){const b=_("initCells"),t=_("HallPlan"),c=_("addCountable");return(o,p)=>(d(),k(E,null,[a(W,{label:"\u0420\u044F\u0434\u043E\u0432",modelValue:n(t).structure.cntRows,"onUpdate:modelValue":p[0]||(p[0]=u=>n(t).structure.cntRows=u),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),a(W,{label:"\u042F\u0447\u0435\u0435\u043A",modelValue:n(t).structure.cntCols,"onUpdate:modelValue":p[1]||(p[1]=u=>n(t).structure.cntCols=u),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),y("div",he,[a(z,{delay:"300"},{default:i(()=>[C("\u0412\u0441\u0435\u0433\u0434\u0430 \u0443\u0447\u0438\u0442\u044B\u0432\u0430\u0442\u044C \u044F\u0447\u0435\u0439\u043A\u0443 \u043F\u0440\u0438 \u043F\u043E\u0434\u0441\u0447\u0435\u0442\u0435 \u043C\u0435\u0441\u0442 \u0440\u044F\u0434\u0430.")]),_:1}),a(ae,{modelValue:n(c),"onUpdate:modelValue":p[2]||(p[2]=u=>Z(c)?c.value=u:null),label:"+1"},null,8,["modelValue"])]),a(X,{label:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",onClick:n(b),class:"defbtn",outline:""},null,8,["onClick"])],64))}},Te={__name:"ModeSelect",setup(I){const b=[{value:"Offline",label:"\u0417\u0430\u043D\u044F\u0442\u044B\u0435 \u043C\u0435\u0441\u0442\u0430",descr:"\u041C\u0435\u0441\u0442\u0430, \u0447\u044C\u0438 \u0431\u0438\u043B\u0435\u0442\u044B \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B \u043E\u043D\u043B\u0430\u0439\u043D. \u0418\u0445 \u0437\u0430\u0431\u0440\u0430\u043B\u0438 \u043E\u0447\u043D\u043E."},{value:"Prices",label:"\u0426\u0435\u043D\u044B",descr:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u0446\u0435\u043D \u0438 \u043F\u0440\u0438\u0432\u044F\u0437\u043A\u0430 \u043C\u0435\u0441\u0442\u0430 \u043A \u0442\u0438\u043F\u0443 \u0446\u0435\u043D\u044B"},{value:"Structure",label:"\u0421\u0442\u0440\u0443\u043A\u0442\u0443\u0440\u0430 \u0417\u0430\u043B\u0430",descr:"\u041E\u0442\u043C\u0435\u0447\u0430\u0435\u0442 \u044F\u0447\u0435\u0439\u043A\u0443 \u043A\u0430\u043A \u043F\u0440\u043E\u0445\u043E\u0434 \u0438\u043B\u0438 \u043C\u0435\u0441\u0442\u043E"}],t=_("selectedMode"),c=_("selectedPrice"),o=_("colors");function p(){return t.value==="Prices"?o[c.value.priceType][0]:"amber"}return(u,s)=>(d(),A(ce,{modelValue:n(t),"onUpdate:modelValue":s[0]||(s[0]=l=>Z(t)?t.value=l:null),color:"amber","label-color":p(),outlined:"","emit-value":"","map-options":"",style:{width:"100%"},options:b,label:"\u0427\u0442\u043E \u0431\u0443\u0434\u0435\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C?"},{prepend:i(()=>[a(le,{name:"edit",color:p()},null,8,["color"])]),option:i(l=>[a(Y,oe(ne(l.itemProps)),{default:i(()=>[a(M,null,{default:i(()=>[a(U,null,{default:i(()=>[C(g(l.opt.label),1)]),_:2},1024),a(U,{caption:""},{default:i(()=>[C(g(l.opt.descr),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label-color"]))}},ge=["src"],Pe={__name:"AnnounceSelect",emits:["onSelectAnnounce"],setup(I,{emit:b}){const t=J(),c=_("announceList"),o=_("selectedAnnounce"),p=b;function u(s){let l=480;return t.platform.is.mobile&&(l=1080),String("https://api.sakh-orch.ru/")+s.folder+"/"+l+"/"+s.fileName+"?ver="+s.md5}return(s,l)=>n(c).length?(d(),A(ce,{key:0,options:n(c),modelValue:n(o),"onUpdate:modelValue":[l[0]||(l[0]=r=>Z(o)?o.value=r:null),l[1]||(l[1]=r=>p("onSelectAnnounce"))],color:"amber",outlined:"",style:{width:"100%"},"map-options":"","option-value":"id","option-label":"progName"},{selected:i(()=>[a(Y,{dense:""},{default:i(()=>[a(M,null,{default:i(()=>[a(U,null,{default:i(()=>[C(g(n(o).progName),1)]),_:1}),a(U,{caption:""},{default:i(()=>[C(g(n(o).eventTime)+" | "+g(n(o).Hall.name),1)]),_:1})]),_:1})]),_:1})]),prepend:i(()=>[a(ve,{width:"50px",ratio:"16/9",src:u(n(o).Sketch)},null,8,["src"])]),option:i(r=>[a(Y,oe(ne(r.itemProps)),{default:i(()=>[a(M,{avatar:""},{default:i(()=>[y("img",{style:{width:"50px"},src:u(r.opt.Sketch)},null,8,ge),N("",!0)]),_:2},1024),a(M,null,{default:i(()=>[a(U,null,{default:i(()=>[C(g(r.opt.progName),1)]),_:2},1024),a(U,{caption:""},{default:i(()=>[C(g(r.opt.Hall.name),1)]),_:2},1024),a(U,{caption:""},{default:i(()=>[C(g(r.opt.eventTime),1)]),_:2},1024)]),_:2},1024),a(M,{side:""},{default:i(()=>[N("",!0),a(ae,{disable:"",modelValue:r.opt.isShow,"onUpdate:modelValue":v=>r.opt.isShow=v,color:"green"},{default:i(()=>[a(z,null,{default:i(()=>[C("\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u043D")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040),a(ue)]),_:1},8,["options","modelValue"])):N("",!0)}};const xe={class:"menuArea"},Se={class:"menuBlock"},Ie={class:"blockRow"},Ve={class:"menuBlock"},He={class:"blockRow"},$e={key:0,class:"blockRow"},Ne={__name:"HallCreatorMenu",emits:["onSelectHall","onSelectPrice","onSelectAnnounce"],setup(I,{emit:b}){J(),_("HallPlan"),_("Halls");const t=b,c=_("selectedMode");_("colors");function o(){t("onSelectAnnounce")}return(p,u)=>(d(),k("div",xe,[y("div",Se,[y("div",Ie,[a(Pe,{onOnSelectAnnounce:u[0]||(u[0]=s=>o())})])]),y("div",Ve,[y("div",He,[a(Te)]),n(c)==="Structure"?(d(),k("div",$e,[a(Ce)])):N("",!0)]),n(c)==="Prices"?(d(),A(we,{key:0})):N("",!0)]))}};var Qe=ee(Ne,[["__scopeId","data-v-266509d8"]]);const Ue=y("br",null,null,-1),Ae=y("br",null,null,-1),Re={key:1,class:"forceCount"},Be={__name:"HallBuilderCell",props:{cell:Object,ticket:Object},emits:["cellClick"],setup(I,{emit:b}){const t=I,c=_("colors"),o=T(t.ticket),p=_("HallPlan"),u=_("selectedMode"),s=_("selectedPrice"),l=_("addCountable"),r=T("Invite"),v=T(0);function w(f){var P;return(P=p.value.tickets.find($=>$.cellid===f))!=null?P:!1}function x(){var f,P,$,Q;!((P=(f=o==null?void 0:o.value)==null?void 0:f.cellId)!=null&&P)||(v.value.cellId!==((Q=($=o==null?void 0:o.value)==null?void 0:$.cellId)!=null?Q:0)&&(r.value="Invite"),s.value.priceType===o.value.priceType?o.value.priceType=r.value:(r.value=o.value.priceType,o.value.priceType=s.value.priceType),v.value=o.value.cellId)}function H(f){f.exist=!f.exist,w(f.id)||p.value.tickets.push({cellId:f.id,offline:!1,seatRow:0,seatNum:0,priceType:"Invite"}),f.forceCount=!!(!f.exist&&l.value)}function O(f){switch(u.value){case"Structure":{H(f);break}case"Prices":{x();break}case"Offline":{o.value.offline=!o.value.offline;break}default:{if(f.priceType===u.value.value){f.priceType="Invite";break}f.priceType=u.value.value}}}return(f,P)=>{var $,Q,R,L;return d(),k("div",{class:"cellArea",onClick:P[0]||(P[0]=j=>O(I.cell))},[t.cell.exist?(d(),k(E,{key:0},[($=I.ticket)!=null&&$.offline?(d(),k("div",{key:0,class:"offlineCell",style:te({borderColor:n(c)[((Q=t.ticket)==null?void 0:Q.priceType)||"Invite"][1],backgroundColor:n(c)[((R=t.ticket)==null?void 0:R.priceType)||"Invite"][1]})},null,4)):(d(),k("div",{key:1,class:"availableCell",style:te({borderColor:n(c)[((L=t.ticket)==null?void 0:L.priceType)||"Invite"][1]})},[C(g(t.ticket.seatNum)+" ",1),a(z,{offset:[0,-120],"max-width":"20em",delay:300},{default:i(()=>[C(g("\u041C\u0435\u0441\u0442\u043E: "+t.ticket.seatNum),1),Ue,C(" "+g("\u0420\u044F\u0434: "+t.ticket.seatRow),1),Ae,C(" "+g("\u0426\u0435\u043D\u0430: "+t.ticket.priceType),1)]),_:1})],4))],64)):t.cell.forceCount?(d(),k("div",Re,[C("? "),a(z,{offset:[0,-100],"max-width":"20em"},{default:i(()=>[C(" \u041F\u043E \u043A\u0430\u043A\u0438\u043C-\u0442\u043E \u043F\u0440\u0438\u0447\u0438\u043D\u0430\u043C \u044D\u0442\u043E \u043C\u0435\u0441\u0442\u043E \u043F\u043E\u0441\u0447\u0438\u0442\u0430\u043D\u043E \u0432 \u0441\u0445\u0435\u043C\u0435, \u043D\u043E \u043D\u0430 \u0441\u0430\u043C\u043E\u043C \u0434\u0435\u043B\u0435 \u0435\u0433\u043E \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1})])):N("",!0)])}}};const Me={style:{width:"max-content",margin:"auto"}},Ee={style:{margin:"auto"}},Oe={class:"rowNumber"},Le={class:"rowNumber"},ze={__name:"HallTable",emits:["cellClick","ticket"],setup(I,{emit:b}){const t=_("HallPlan"),c=b;function o(s){c("cellClick",s)}function p(s){c("ticket",s)}function u(s){return t.value.tickets.find(l=>l.cellId===s)}return(s,l)=>n(t).tickets.length?(d(),A(se,{key:0},{default:i(()=>[y("table",Me,[y("tbody",Ee,[(d(!0),k(E,null,K(n(t).cells,(r,v)=>(d(),k("tr",{key:"row_"+v},[y("td",null,[y("div",Oe,g(n(t).structure.rowNums[v]||""),1)]),(d(!0),k(E,null,K(r,(w,x)=>(d(),k("td",{key:v+"_"+x},[(d(),A(Be,{cell:n(t).cells[w.row-1][w.col-1],"onUpdate:cell":H=>n(t).cells[w.row-1][w.col-1]=H,ticket:u(w.id),key:w.id,onCellClick:H=>o(H),onTickedClick:l[0]||(l[0]=H=>p(H))},null,8,["cell","onUpdate:cell","ticket","onCellClick"]))]))),128)),y("td",null,[y("div",Le,g(n(t).structure.rowNums[v]||""),1)])]))),128))])])]),_:1})):N("",!0)}};var je=ee(ze,[["__scopeId","data-v-0fddd53a"]]);const qe={class:"content"},Fe={style:{overflow:"auto",margin:"1em auto","min-width":"100vw"}},ct={__name:"HallEditor",setup(I){const b=String("https://api.sakh-orch.ru/"),t=J(),c=T("Prices");V("selectedMode",c);const o=T([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);V("defaultPricing",o);const p=T({priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"});V("selectedPrice",p);const u=T({});V("selectedAnnounce",u);const s=T(!1);V("addCountable",s);const l=T({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:o.value,cells:[],tickets:[]});V("HallPlan",l),V("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]});const v=T(!1);V("progress",v);const w=T([]);V("announceList",w);const x=T(!1);function H(){c.value==="Structure"&&R(),D.post(b+"api/tickets/hallplan.php",{params:{method:"put",plan:l.value}}).then(e=>{var m,h,S;if(!((m=e==null?void 0:e.data)!=null&&m.result))throw new Error;t.notify(_e((S=(h=e==null?void 0:e.data)==null?void 0:h.result)!=null?S:""))}).catch(e=>{t.notify(G(e))})}async function O(){x.value=!1,l.value.cells=[];let e=[],m=[],h=0,S={};for(let B=1;B<=l.value.structure.cntRows;B++){for(let q=1;q<=l.value.structure.cntCols;q++)h++,S={id:h,row:B,col:q,exist:!0,forceCount:!1},m.push(S);e.push(m),m=[]}l.value.cells=e,await R(),await F(),x.value=!0}V("initCells",O);const f=T(0),P=T(0);function $(e){if(!e.exist&&!e.forceCount)return;if(e.forceCount){f.value++;return}if(!e.exist)return;f.value++;let m={cellId:e.id,offline:!1,seatRow:P.value,seatNum:f.value,priceType:"Invite"};l.value.tickets.push(m)}function Q(e){if(f.value=0,L(e)){l.value.structure.rowNums.push(!1);return}P.value++,l.value.structure.rowNums.push(P.value),e.forEach(m=>$(m))}async function R(){x.value=!1,P.value=0,l.value.tickets=[],l.value.structure.rowNums=[],l.value.cells.forEach(e=>Q(e)),await F(),x.value=!0,console.log("cntOfTickets:",l.value.tickets.length)}function L(e){return![...e].filter(h=>h.exist).length}function j(){D.post(b+"api/tickets/hallplan.php",{params:{method:"get",id:u.value.id}}).then(async e=>{var m,h,S,B;if(e.status===204){l.value.id=u.value.id,await O();return}if(!((h=(m=e==null?void 0:e.data)==null?void 0:m.data)!=null&&h.HallPlan))throw new Error;x.value=!1,l.value=(B=(S=e==null?void 0:e.data)==null?void 0:S.data)==null?void 0:B.HallPlan,await F(),x.value=!0}).catch(e=>{l.value={},t.notify(G(e))})}function ie(){v.value=!0,D.post(b+"api/event/announce.php",{params:{method:"futureList"}}).then(e=>{var m,h,S;if(!((m=e==null?void 0:e.data)!=null&&m.result))throw new Error;w.value=(S=(h=e==null?void 0:e.data)==null?void 0:h.data)!=null?S:[],u.value=w.value[0],j()}).catch(e=>{t.notify(G(e)),w.value=[]}).finally(()=>{v.value=!1})}function re(){switch(c.value){case"Prices":{console.log("resetTickets"),R();break}default:console.log(c.value)}}return de(()=>{}),pe(()=>{ie()}),(e,m)=>(d(),k("div",qe,[a(Qe,{onOnSelectAnnounce:m[0]||(m[0]=h=>j())}),y("div",Fe,[a(fe,{style:{width:"max-content","min-width":"80vw",padding:"2em",margin:"0 auto"},dark:""},{default:i(()=>[x.value?(d(),A(je,{key:0})):N("",!0),a(me,{style:{display:"flex","justify-content":"end"}},{default:i(()=>[c.value==="Prices"?(d(),A(X,{key:0,label:"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C",onClick:m[1]||(m[1]=h=>re())})):N("",!0),a(X,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",onClick:H})]),_:1})]),_:1})])]))}};export{ct as default};
