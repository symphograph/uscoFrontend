import{m as l,n as I,q as s,f as n,x as _,r as E,i as q,E as y,ax as x,B as b,l as S,t as w,v as Q,u as V,I as T,w as j,o as F,F as L,G as H,D as R}from"./index.9d804256.js";import{u as C}from"./use-quasar.ce05c6b2.js";import{a as B}from"./axios.8e87d2f1.js";import{a as D,b as M,Q as G}from"./QImg.2ed0d17c.js";import{Q as $}from"./QItemLabel.eb0025dd.js";import{Q as O}from"./QTooltip.621d4009.js";import{i as K,n as z,a as A,f as J}from"./myFuncts.3b2e3722.js";import{_ as P}from"./BtnDelete.cfbfe6be.js";import{_ as U}from"./plugin-vue_export-helper.21dcd24c.js";const W={__name:"SketchImg",props:{md5:{type:String,required:!0},ext:{type:String,required:!0},size:{type:Number,required:!1,default:0}},setup(o){const p=String("https://api.sakh-orch.ru/");return(v,m)=>(l(),I(D,{src:_(K)(_(p),o.md5,o.ext,o.size),ratio:1920/1080,fit:"fill","placeholder-src":"/img/news/default_sketch.svg"},{error:s(()=>[n(D,{src:"/img/news/default_sketch.svg"})]),_:1},8,["src"]))}};const X={class:"narea"},Y={class:"nimg_block"},Z={class:"tcol"},tt={class:"mainText"},et={key:0,style:{display:"flex","justify-content":"right","grid-gap":"1em"}},it={__name:"NewItem",props:{item:E(null)},emits:["hideOrShow","delEntry"],setup(o,{emit:p}){const v=String("https://api.sakh-orch.ru/"),m=C(),g=q("entryEditMode"),k=p,a=o,d=E(a.item.isShow);function u(){var i,t;return(i=a.item)!=null&&i.announceId?{to:"/announce/"+a.item.announceId,href:void 0}:(t=a.item)!=null&&t.isExternal?{to:void 0,href:a.item.refLink}:{to:"/new/"+a.item.id,href:void 0}}function c(){B.post(v+"api/news/entry.php",{params:{method:d.value?"hide":"show",entryId:a.item.id}}).then(i=>{var t;if(!((t=i==null?void 0:i.data)!=null&&t.result))throw new Error;d.value=!d.value,k("hideOrShow",a.item.id)}).catch(i=>{m.notify(z(i))}).finally(()=>{})}function N(){B.post(v+"api/news/entry.php",{params:{method:"del",entryId:a.item.id}}).then(i=>{var t,e,r;if(!((t=i==null?void 0:i.data)!=null&&t.result))throw new Error;m.notify(A((r=(e=i==null?void 0:i.data)==null?void 0:e.result)!=null?r:"")),k("delEntry",a.item.id)}).catch(i=>{m.notify(z(i))})}return(i,t)=>(l(),y("div",X,[x("div",Y,[x("div",null,[n(M,{href:u().href,to:u().to,dense:"",class:"no-padding",target:"_blank"},{default:s(()=>{var e,r,f,h;return[n(W,{ext:((r=(e=o.item)==null?void 0:e.sketch)==null?void 0:r.ext)||"",md5:((h=(f=o.item)==null?void 0:f.sketch)==null?void 0:h.md5)||"",size:i.$q.platform.is.desktop?260:1080},null,8,["ext","md5","size"])]}),_:1},8,["href","to"])])]),x("div",Z,[n(M,{clickable:"",href:u().href,to:u().to,target:"_blank"},{default:s(()=>[n(G,null,{default:s(()=>[n($,{class:"ItemHeader text-h6"},{default:s(()=>[w(Q(o.item.title),1)]),_:1}),n($,null,{default:s(()=>[x("span",tt,Q(o.item.descr),1)]),_:1}),n($,{caption:""},{default:s(()=>[w(Q(_(J)(o.item.date)),1)]),_:1})]),_:1})]),_:1},8,["href","to"])]),_(g)?(l(),y("div",et,[d.value?(l(),I(b,{key:0,icon:"visibility",flat:"",color:"green",outline:"",onClick:t[0]||(t[0]=e=>c())},{default:s(()=>[n(O,null,{default:s(()=>t[3]||(t[3]=[w("\u0421\u043A\u0440\u044B\u0442\u044C")])),_:1})]),_:1})):(l(),I(b,{key:1,color:"orange",flat:"",icon:"visibility_off",onClick:t[1]||(t[1]=e=>c())},{default:s(()=>[n(O,null,{default:s(()=>t[4]||(t[4]=[w("\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C")])),_:1})]),_:1})),n(P,{danger:"",flat:"",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u043E\u0432\u043E\u0441\u0442\u044C",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C","throw-confirm":"",onOnOk:t[2]||(t[2]=e=>N())}),n(b,{icon:"edit",flat:"",to:"/new/"+o.item.id},{default:s(()=>[n(O,{anchor:"top middle"},{default:s(()=>t[5]||(t[5]=[w("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")])),_:1})]),_:1},8,["to"])])):S("",!0)]))}};var at=U(it,[["__scopeId","data-v-55c5348f"]]);const rt={class:"newscol"},nt={key:1,class:"noEntyes"},ot={__name:"NewsList",props:{category:String,year:Number,limit:Number},setup(o,{expose:p}){const v=String("https://api.sakh-orch.ru/"),m=V();T(),C();const g=q("progress"),k=q("entryEditMode"),a=E([]),d=o,u=E(d.category);j(m,t=>{u.value=t.params.category,c()});function c(){!u.value||(g.value=!0,B.post(v+"api/news/entry.php",{params:{method:d.limit===100?"list":"toplist",category:u.value,year:d.year,limit:d.limit}}).then(t=>{var e,r;a.value=(r=(e=t==null?void 0:t.data)==null?void 0:e.data)!=null?r:[]}).catch(t=>{a.value=[]}).finally(()=>{g.value=!1}))}function N(t){const e=a.value.find(r=>r.id===t);e.isShow=!e.isShow}function i(t){const e=a.value.findIndex(r=>r.id===t);e!==-1&&a.value.splice(e,1)}return p({loadData:c}),F(()=>{c()}),(t,e)=>{var r;return l(),y("div",rt,[(r=a.value)!=null&&r.length?(l(!0),y(L,{key:0},H(a.value,f=>(l(),y(L,{key:f.id},[f.isShow||_(k)?(l(),I(at,{key:0,item:f,onHideOrShow:e[0]||(e[0]=h=>{N(h)}),onDelEntry:e[1]||(e[1]=h=>{i(h)})},null,8,["item"])):S("",!0),n(R)],64))),128)):S("",!0),!a.value&&!_(g)?(l(),y("h5",nt," \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443. ")):S("",!0)])}}};var _t=U(ot,[["__scopeId","data-v-90840456"]]);export{_t as N};
