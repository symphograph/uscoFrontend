import{i as b,r as v,m,n as V,q as l,f as e,B as le,bm as K,bi as $,v as r,A as S,x as M,b as te,G as oe,d as F,p as x,D,F as E,C as ne,l as Q,t as P,u as q,k as T,y as U,E as Y,I as ae,ax as R}from"./index.11572179.js";import{b as j,Q as I}from"./QImg.5a36287c.js";import{b as H}from"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.55812a5a.js";import{P as ue}from"./PageShell.f9f99083.js";import{a as ie}from"./axios.8f562e2b.js";import{u as W}from"./use-quasar.894b47c5.js";import{h as Z,a as re,n as de}from"./myFuncts.7f91abf8.js";import{_ as h}from"./BtnDelete.3d55e9b3.js";import{A as se}from"./AuthorItem.6c196834.js";import{P as N,V as fe,W as J,A as me}from"./lib.be306c2e.js";import{Q as ee}from"./QTooltip.280a1a0c.js";import{Q as pe}from"./QList.f13a658d.js";import{Q as ve}from"./QForm.d7a15229.js";/* empty css               */import{Q as L}from"./QItemLabel.06f6b55b.js";import{_ as X}from"./BtnMoveSort.23b38b4e.js";import{_ as ge}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as ce}from"./QSelect.44bc25a7.js";import{V as ke}from"./VKVideoItem.ab59bc2d.js";import"./touch.9135741d.js";import"./selection.93775355.js";import"./QScrollArea.dd54d94c.js";import"./format.de7e9769.js";import"./QLinearProgress.5ceb5230.js";/* empty css                                                    *//* empty css                                                               */import"./myAxios.d5d7b004.js";import"./position-engine.1bf61849.js";import"./QMenu.924c0b17.js";import"./rtl.276c3f1b.js";const ye={__name:"PartitionDialog",emits:["onSave"],setup(w,{emit:g}){const s=W(),d=b("isOpenPartitionDialog"),n=b("selectedPartition"),c=b("loadPartitions"),o=v(!1);function y(){d.value=!1}async function k(){o.value=!0,await N.save(s,n.value)&&(await c(),y()),o.value=!1}function a(){o.value=!1}const u=[C=>!!C||"\u041F\u0443\u0441\u0442\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435!"],p=[C=>C>0&C<1e3||"\u2116?"],_=v(),O=v();function A(){!G()||k()}function G(){return _.value.validate()&&O.value.validate()}return(C,i)=>(m(),V(oe,{modelValue:r(d),"onUpdate:modelValue":i[4]||(i[4]=t=>te(d)?d.value=t:null),onBeforeHide:a},{default:l(()=>[e(M,{bordered:"",class:"dialogArea"},{default:l(()=>[e(ve,{onSubmit:le(A,["stop","prevent"])},{default:l(()=>[e(K,null,{default:l(()=>[e($,{type:"number",rules:p,ref_key:"refNum",ref:O,prefix:"\u2116",modelValue:r(n).num,"onUpdate:modelValue":i[0]||(i[0]=t=>r(n).num=t),style:{width:"5em"}},null,8,["modelValue"]),e($,{modelValue:r(n).title,"onUpdate:modelValue":i[1]||(i[1]=t=>r(n).title=t),filled:"",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0447\u0430\u0441\u0442\u0438",rules:u,style:{width:"100%"},ref_key:"refTitle",ref:_},null,8,["modelValue"]),e($,{modelValue:r(n).caption,"onUpdate:modelValue":i[2]||(i[2]=t=>r(n).caption=t),filled:"",label:"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(K,{align:"right"},{default:l(()=>[e(S,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",flat:"",onClick:i[3]||(i[3]=t=>d.value=!1)}),e(S,{color:"green",type:"submit",label:"\u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",flat:"",loading:o.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ve=F({__name:"PartitionItem",props:{partition:{},idx:{},length:{}},emits:["onDel","onSort","onEdit"],setup(w,{emit:g}){const s=W(),d=g,n=v(!1),c=b("editMode"),o=b("isOpenPartitionDialog");x("isOpenPartitionDialog",o);async function y(a){await N.del(s,a)&&d("onDel")}async function k(a,u){n.value=!0,await N.moveSort(s,a,u)&&d("onSort"),n.value=!1}return(a,u)=>(m(),D(E,null,[e(j,null,{default:l(()=>[e(I,{avatar:""},{default:l(()=>[e(L,null,{default:l(()=>[P(q(a.partition.sortVal),1)]),_:1})]),_:1}),e(I,{avatar:""},{default:l(()=>[e(L,null,{default:l(()=>[P("\u2116"+q(a.partition.num),1)]),_:1})]),_:1}),e(I,null,{default:l(()=>[e(L,null,{default:l(()=>[P(q(a.partition.title),1)]),_:1}),e(L,{caption:""},{default:l(()=>[P(q(a.partition.caption),1)]),_:1})]),_:1}),e(I,{side:""},{default:l(()=>[e(L,null,{default:l(()=>[e(S,{label:`ID: ${a.partition.id}`,flat:"",onClick:u[0]||(u[0]=p=>r(Z)(a.partition.id,r(s))),"icon-right":"content_copy"},null,8,["label"])]),_:1})]),_:1})]),_:1}),r(c)?(m(),D(E,{key:0},[e(j,null,{default:l(()=>[e(I),e(I,{side:""},{default:l(()=>[e(S,{icon:"edit",dense:"",round:"",flat:"",onClick:u[1]||(u[1]=p=>d("onEdit",a.partition))},{default:l(()=>[e(ee,null,{default:l(()=>u[5]||(u[5]=[P("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")])),_:1})]),_:1})]),_:1}),e(I,{side:""},{default:l(()=>[e(h,{"throw-confirm":"",danger:"",flat:"",onOnOk:u[2]||(u[2]=p=>y(a.partition.id)),tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C"})]),_:1}),e(I,{side:""},{default:l(()=>[e(X,{disable:a.idx<1,loading:n.value,onOnClick:u[3]||(u[3]=p=>k("up",a.partition.id)),direction:"up"},null,8,["disable","loading"])]),_:1}),e(I,{side:""},{default:l(()=>[e(X,{disable:a.idx>=a.length-1,loading:n.value,onOnClick:u[4]||(u[4]=p=>k("down",a.partition.id)),direction:"down"},null,8,["disable","loading"])]),_:1})]),_:1}),e(ne)],64)):Q("",!0)],64))}}),be=F({__name:"PartitionList",props:{workId:{}},setup(w){const g=W(),s=b("editMode");v(!1);const d=w,n=v([]),c=v({});x("selectedPartition",c);const o=v(!1);x("isOpenPartitionDialog",o);function y(){return{id:void 0,num:n.value.length+1,title:"",workId:d.workId}}function k(){c.value=y(),o.value=!0}function a(p){c.value=p,o.value=!0}async function u(){const p=await N.getList(g,d.workId);p.length&&(n.value=[],n.value=p)}return x("loadPartitions",u),T(()=>{u()}),(p,_)=>(m(),D(E,null,[e(M,null,{default:l(()=>[e(U,null,{default:l(()=>[_[1]||(_[1]=P("\u0427\u0430\u0441\u0442\u0438 \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u044F ")),r(s)?(m(),V(S,{key:0,icon:"add",round:"",onClick:k},{default:l(()=>[e(ee,null,{default:l(()=>_[0]||(_[0]=[P("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C")])),_:1})]),_:1})):Q("",!0)]),_:1}),e(U,null,{default:l(()=>[e(pe,null,{default:l(()=>[(m(!0),D(E,null,Y(n.value,(O,A)=>(m(),V(Ve,{key:O.id,partition:O,onOnEdit:a,onOnDel:u,onOnSort:u,idx:A,length:n.value.length},null,8,["partition","idx","length"]))),128))]),_:1})]),_:1})]),_:1}),e(ye)],64))}}),we={};function _e(w,g){return m(),V(M,null,{default:l(()=>[e(U,null,{default:l(()=>g[0]||(g[0]=[P("\u0418\u0437\u0434\u0430\u043D\u0438\u044F")])),_:1}),e(U)]),_:1})}var Ie=ge(we,[["render",_e]]);const Pe=F({__name:"GenreSelect",props:{genreId:{},readonly:{type:Boolean}},emits:["onSelect"],setup(w,{emit:g}){const s=b("genres"),d=v(),n=w,c=g;return T(()=>{d.value=s.value.find(o=>o.id===n.genreId)}),(o,y)=>(m(),V(ce,{modelValue:d.value,"onUpdate:modelValue":[y[0]||(y[0]=k=>d.value=k),y[1]||(y[1]=k=>c("onSelect",d.value))],options:r(s),readonly:o.readonly,label:"\u0416\u0430\u043D\u0440","map-options":"","option-value":"id","option-label":"name",clearable:""},null,8,["modelValue","options","readonly"]))}}),Ce=F({__name:"VideoList",props:{workId:{}},setup(w){const g=v([]),s=W(),d=w;return T(async()=>{g.value=await fe.getListByWork(s,d.workId),console.log(g.value)}),(n,c)=>(m(),V(M,null,{default:l(()=>[e(U,null,{default:l(()=>[(m(!0),D(E,null,Y(g.value,o=>(m(),D(E,{key:`v-list${o.id}`},[e(ke,{video:o},null,8,["video"]),c[0]||(c[0]=P("v "))],64))),128))]),_:1})]),_:1}))}}),Oe={class:"centralCol"},ol={__name:"WorkPage",setup(w){const g=String("https://sakh-orch.ru/stapi/"),s=W(),d=ae(),n=b("editMode"),c=v(!1),o=v({});v(null);const y=b("selectedAuthorId"),k=b("selectedAuthor"),a=v(!1),u=v(!1),p=v(!1);async function _(){o.value=await J.get(s,d.params.id),await O()}async function O(){k.value=await me.get(s,o.value.authorId)}function A(){c.value=!0,J.update(s,o.value),c.value=!1}function G(i){var t;o.value.genreId=(t=i==null?void 0:i.id)!=null?t:null}function C(){ie.post(g+"epoint/lib/work.php",{params:{method:"del",workId:d.params.id}}).then(i=>{var t,f,B;if(!((t=i==null?void 0:i.data)!=null&&t.result))throw new Error;s.notify(re((B=(f=i==null?void 0:i.data)==null?void 0:f.result)!=null?B:null))}).catch(i=>{s.notify(de(i))})}return T(()=>{_()}),(i,t)=>(m(),V(ue,{"page-title":o.value.titleRu},{ToolPanel:l(()=>{var f,B,z;return[e(se,{id:r(y),iofEn:(f=r(k))==null?void 0:f.iofEn,iconUrl:(B=r(k))==null?void 0:B.iconUrl,fioRu:(z=r(k))==null?void 0:z.fioRu},null,8,["id","iofEn","iconUrl","fioRu"])]}),PageContent:l(()=>[R("div",Oe,[t[7]||(t[7]=R("br",null,null,-1)),o.value.id?(m(),V(M,{key:0},{default:l(()=>[e(U,null,{default:l(()=>[e(j,null,{default:l(()=>[e(S,{label:`ID: ${o.value.id}`,flat:"",onClick:t[0]||(t[0]=f=>r(Z)(o.value.id,r(s))),"icon-right":"content_copy"},null,8,["label"])]),_:1}),e($,{modelValue:o.value.titleRu,"onUpdate:modelValue":t[1]||(t[1]=f=>o.value.titleRu=f),readonly:!r(n),label:"\u041B\u043E\u043A\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue","readonly"]),e($,{modelValue:o.value.titleEn,"onUpdate:modelValue":t[2]||(t[2]=f=>o.value.titleEn=f),readonly:!r(n),label:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue","readonly"]),e($,{modelValue:o.value.opus,"onUpdate:modelValue":t[3]||(t[3]=f=>o.value.opus=f),label:"opus",readonly:!r(n),prefix:"Op."},null,8,["modelValue","readonly"]),e(Pe,{onOnSelect:G,readonly:!r(n),genreId:o.value.genreId},null,8,["readonly","genreId"])]),_:1}),r(n)?(m(),V(K,{key:0,align:"right"},{default:l(()=>[e(h,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435","throw-confirm":"",danger:"",flat:"",onOnOk:C,tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435"}),e(S,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green","icon-right":"save",flat:"",onClick:A})]),_:1})):Q("",!0)]),_:1})):Q("",!0),t[8]||(t[8]=R("br",null,null,-1)),e(H,{label:"\u0420\u0430\u0437\u0434\u0435\u043B\u044B",modelValue:a.value,"onUpdate:modelValue":t[4]||(t[4]=f=>a.value=f)},{default:l(()=>[a.value?(m(),V(be,{key:0,workId:o.value.id},null,8,["workId"])):Q("",!0)]),_:1},8,["modelValue"]),t[9]||(t[9]=R("br",null,null,-1)),e(H,{label:"\u0412\u0438\u0434\u0435\u043E",modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=f=>p.value=f)},{default:l(()=>[p.value?(m(),V(Ce,{key:0,workId:o.value.id},null,8,["workId"])):Q("",!0)]),_:1},8,["modelValue"]),t[10]||(t[10]=R("br",null,null,-1)),e(H,{label:"\u0418\u0437\u0434\u0430\u043D\u0438\u044F",modelValue:u.value,"onUpdate:modelValue":t[6]||(t[6]=f=>u.value=f)},{default:l(()=>[u.value?(m(),V(Ie,{key:0,workId:o.value.id},null,8,["workId"])):Q("",!0)]),_:1},8,["modelValue"])])]),_:1},8,["page-title"]))}};export{ol as default};
