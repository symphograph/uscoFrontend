import{i as I,r as p,m as f,n as k,q as t,f as e,B as oe,bm as N,bi as $,v as r,A as S,x,b as ae,G as ne,d as T,p as M,D,F as R,C as ue,l as C,t as O,u as q,k as G,y as E,E as Z,I as ie,ax as A}from"./index.7d1b9a4d.js";import{b as z,Q as w}from"./QImg.9eb68109.js";import{b as K}from"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.c98b8949.js";import{P as re}from"./PageShell.a4781e48.js";import{a as de}from"./axios.d263a8b0.js";import{u as W}from"./use-quasar.ab0f1e42.js";import{h,a as se,n as fe}from"./myFuncts.c4a4425d.js";import{_ as ee}from"./BtnDelete.8fb63d02.js";import{A as me}from"./AuthorItem.5d12af39.js";import{P as F,V as pe,A as j,W as X}from"./lib.0c111b23.js";import{Q as ve}from"./QList.42d90b60.js";import{Q as te}from"./QTooltip.834cbc11.js";import{Q as ge}from"./QForm.67e7cea2.js";/* empty css               */import{Q as L}from"./QItemLabel.2d316d6a.js";import{_ as Y}from"./BtnMoveSort.f3bff816.js";import{_ as le}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as ce}from"./QSelect.b07c2952.js";import{V as _e}from"./VKVideoItem.9063c062.js";import"./touch.9135741d.js";import"./selection.11f3eb57.js";import"./QScrollArea.767b0782.js";import"./format.de7e9769.js";import"./QLinearProgress.19101882.js";/* empty css                                                    */import"./myAxios.afbb5a4e.js";import"./position-engine.edee25d0.js";import"./QMenu.def2b318.js";import"./use-virtual-scroll.fd0d31d1.js";import"./rtl.276c3f1b.js";import"./entry.3386aa3b.js";const ye={__name:"PartitionDialog",emits:["onSave"],setup(V,{emit:g}){const s=W(),d=I("isOpenPartitionDialog"),a=I("selectedPartition"),_=I("loadPartitions"),o=p(!1);function c(){d.value=!1}async function y(){o.value=!0,await F.save(s,a.value)&&(await _(),c()),o.value=!1}function n(){o.value=!1}const u=[P=>!!P||"\u041F\u0443\u0441\u0442\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435!"],v=[P=>P>0&P<1e3||"\u2116?"],b=p(),Q=p();function U(){!H()||y()}function H(){return b.value.validate()&&Q.value.validate()}return(P,i)=>(f(),k(ne,{modelValue:r(d),"onUpdate:modelValue":i[4]||(i[4]=l=>ae(d)?d.value=l:null),onBeforeHide:n},{default:t(()=>[e(x,{bordered:"",class:"dialogArea"},{default:t(()=>[e(ge,{onSubmit:oe(U,["stop","prevent"])},{default:t(()=>[e(N,null,{default:t(()=>[e($,{type:"number",rules:v,ref_key:"refNum",ref:Q,prefix:"\u2116",modelValue:r(a).num,"onUpdate:modelValue":i[0]||(i[0]=l=>r(a).num=l),style:{width:"5em"}},null,8,["modelValue"]),e($,{modelValue:r(a).title,"onUpdate:modelValue":i[1]||(i[1]=l=>r(a).title=l),filled:"",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0447\u0430\u0441\u0442\u0438",rules:u,style:{width:"100%"},ref_key:"refTitle",ref:b},null,8,["modelValue"]),e($,{modelValue:r(a).caption,"onUpdate:modelValue":i[2]||(i[2]=l=>r(a).caption=l),filled:"",label:"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(N,{align:"right"},{default:t(()=>[e(S,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",flat:"",onClick:i[3]||(i[3]=l=>d.value=!1)}),e(S,{color:"green",type:"submit",label:"\u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",flat:"",loading:o.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ke=T({__name:"PartitionItem",props:{partition:{},idx:{},length:{}},emits:["onDel","onSort","onEdit"],setup(V,{emit:g}){const s=W(),d=g,a=p(!1),_=I("editMode"),o=I("isOpenPartitionDialog");M("isOpenPartitionDialog",o);async function c(n){await F.del(s,n)&&d("onDel")}async function y(n,u){a.value=!0,await F.moveSort(s,n,u)&&d("onSort"),a.value=!1}return(n,u)=>(f(),D(R,null,[e(z,null,{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(L,null,{default:t(()=>[O(q(n.partition.sortVal),1)]),_:1})]),_:1}),e(w,{avatar:""},{default:t(()=>[e(L,null,{default:t(()=>[O("\u2116"+q(n.partition.num),1)]),_:1})]),_:1}),e(w,null,{default:t(()=>[e(L,null,{default:t(()=>[O(q(n.partition.title),1)]),_:1}),e(L,{caption:""},{default:t(()=>[O(q(n.partition.caption),1)]),_:1})]),_:1}),e(w,{side:""},{default:t(()=>[e(L,null,{default:t(()=>[e(S,{label:`ID: ${n.partition.id}`,flat:"",onClick:u[0]||(u[0]=v=>r(h)(n.partition.id,r(s))),"icon-right":"content_copy"},null,8,["label"])]),_:1})]),_:1})]),_:1}),r(_)?(f(),D(R,{key:0},[e(z,null,{default:t(()=>[e(w),e(w,{side:""},{default:t(()=>[e(S,{icon:"edit",dense:"",round:"",flat:"",onClick:u[1]||(u[1]=v=>d("onEdit",n.partition))},{default:t(()=>[e(te,null,{default:t(()=>u[5]||(u[5]=[O("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")])),_:1})]),_:1})]),_:1}),e(w,{side:""},{default:t(()=>[e(ee,{"throw-confirm":"",danger:"",flat:"",onOnOk:u[2]||(u[2]=v=>c(n.partition.id)),tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C"})]),_:1}),e(w,{side:""},{default:t(()=>[e(Y,{disable:n.idx<1,loading:a.value,onOnClick:u[3]||(u[3]=v=>y("up",n.partition.id)),direction:"up"},null,8,["disable","loading"])]),_:1}),e(w,{side:""},{default:t(()=>[e(Y,{disable:n.idx>=n.length-1,loading:a.value,onOnClick:u[4]||(u[4]=v=>y("down",n.partition.id)),direction:"down"},null,8,["disable","loading"])]),_:1})]),_:1}),e(ue)],64)):C("",!0)],64))}}),Ve=T({__name:"PartitionList",props:{workId:{}},setup(V){const g=W(),s=I("editMode");p(!1);const d=V,a=p([]),_=p({});M("selectedPartition",_);const o=p(!1);M("isOpenPartitionDialog",o);function c(){return{id:void 0,num:a.value.length+1,title:"",workId:d.workId}}function y(){_.value=c(),o.value=!0}function n(v){_.value=v,o.value=!0}async function u(){const v=await F.getList(g,d.workId);v.length&&(a.value=[],a.value=v)}return M("loadPartitions",u),G(()=>{u()}),(v,b)=>(f(),D(R,null,[e(x,null,{default:t(()=>[e(E,null,{default:t(()=>b[0]||(b[0]=[O("\u0427\u0430\u0441\u0442\u0438 \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u044F ")])),_:1}),e(E,null,{default:t(()=>[e(ve,null,{default:t(()=>[(f(!0),D(R,null,Z(a.value,(Q,U)=>(f(),k(ke,{key:Q.id,partition:Q,onOnEdit:n,onOnDel:u,onOnSort:u,idx:U,length:a.value.length},null,8,["partition","idx","length"]))),128))]),_:1})]),_:1}),e(N,{align:"right"},{default:t(()=>[r(s)?(f(),k(S,{key:0,icon:"add",label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C",flat:"",onClick:y},{default:t(()=>[e(te,null,{default:t(()=>b[1]||(b[1]=[O("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0447\u0430\u0441\u0442\u044C")])),_:1})]),_:1})):C("",!0)]),_:1})]),_:1}),e(ye)],64))}}),be={};function we(V,g){return f(),k(x,null,{default:t(()=>[e(E,null,{default:t(()=>g[0]||(g[0]=[O("\u0418\u0437\u0434\u0430\u043D\u0438\u044F")])),_:1}),e(E)]),_:1})}var Ie=le(be,[["render",we]]);const Pe=T({__name:"GenreSelect",props:{genreId:{},readonly:{type:Boolean}},emits:["onSelect"],setup(V,{emit:g}){const s=I("genres"),d=p(),a=V,_=g;return G(()=>{d.value=s.value.find(o=>o.id===a.genreId)}),(o,c)=>(f(),k(ce,{modelValue:d.value,"onUpdate:modelValue":[c[0]||(c[0]=y=>d.value=y),c[1]||(c[1]=y=>_("onSelect",d.value))],options:r(s),readonly:o.readonly,label:"\u0416\u0430\u043D\u0440","map-options":"","option-value":"id","option-label":"name",clearable:""},null,8,["modelValue","options","readonly"]))}});const Ce={key:0,class:"vidarea"},Oe=T({__name:"VideoList",props:{workId:{}},setup(V){const g=p([]),s=W(),d=p(!1);M("editMode",d);const a=V;return G(async()=>{g.value=await pe.getListByWork(s,a.workId)}),(_,o)=>(f(),k(x,null,{default:t(()=>[e(E,null,{default:t(()=>[g.value.length?(f(),D("div",Ce,[(f(!0),D(R,null,Z(g.value,c=>(f(),k(_e,{key:`v-list${c.id}`,video:c},null,8,["video"]))),128))])):C("",!0)]),_:1})]),_:1}))}});var Qe=le(Oe,[["__scopeId","data-v-03d8f378"]]);const Se={class:"centralCol"},ut={__name:"WorkPage",setup(V){const g=String("https://sakh-orch.ru/stapi/"),s=W(),d=ie(),a=I("editMode"),_=p(!1),o=p({});p(null);const c=I("selectedAuthorId"),y=j.selected,n=p(!1),u=p(!1),v=p(!1);async function b(){o.value=await X.get(s,d.params.id),await Q()}async function Q(){y.value=await j.get(s,o.value.authorId)}function U(){_.value=!0,X.update(s,o.value),_.value=!1}function H(i){var l;o.value.genreId=(l=i==null?void 0:i.id)!=null?l:null}function P(){de.post(g+"epoint/lib/work.php",{params:{method:"del",workId:d.params.id}}).then(i=>{var l,m,B;if(!((l=i==null?void 0:i.data)!=null&&l.result))throw new Error;s.notify(se((B=(m=i==null?void 0:i.data)==null?void 0:m.result)!=null?B:null))}).catch(i=>{s.notify(fe(i))})}return G(()=>{b()}),(i,l)=>(f(),k(re,{"page-title":o.value.titleRu},{ToolPanel:t(()=>{var m,B,J;return[e(me,{id:r(c),iofEn:(m=r(j))==null?void 0:m.iofEn,iconUrl:(B=r(y))==null?void 0:B.iconUrl,fioRu:(J=r(y))==null?void 0:J.fioRu},null,8,["id","iofEn","iconUrl","fioRu"])]}),PageContent:t(()=>[A("div",Se,[l[7]||(l[7]=A("br",null,null,-1)),o.value.id?(f(),k(x,{key:0},{default:t(()=>[e(E,null,{default:t(()=>[e(z,null,{default:t(()=>[e(S,{label:`ID: ${o.value.id}`,flat:"",onClick:l[0]||(l[0]=m=>r(h)(o.value.id,r(s))),"icon-right":"content_copy"},null,8,["label"])]),_:1}),e($,{modelValue:o.value.titleRu,"onUpdate:modelValue":l[1]||(l[1]=m=>o.value.titleRu=m),readonly:!r(a),label:"\u041B\u043E\u043A\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue","readonly"]),e($,{modelValue:o.value.titleEn,"onUpdate:modelValue":l[2]||(l[2]=m=>o.value.titleEn=m),readonly:!r(a),label:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue","readonly"]),e($,{modelValue:o.value.opus,"onUpdate:modelValue":l[3]||(l[3]=m=>o.value.opus=m),label:"opus",readonly:!r(a),prefix:"Op."},null,8,["modelValue","readonly"]),e(Pe,{onOnSelect:H,readonly:!r(a),genreId:o.value.genreId},null,8,["readonly","genreId"])]),_:1}),r(a)?(f(),k(N,{key:0,align:"right"},{default:t(()=>[e(ee,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435","throw-confirm":"",danger:"",flat:"",onOnOk:P,tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435"}),e(S,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green","icon-right":"save",flat:"",onClick:U})]),_:1})):C("",!0)]),_:1})):C("",!0),l[8]||(l[8]=A("br",null,null,-1)),e(K,{label:"\u0420\u0430\u0437\u0434\u0435\u043B\u044B",modelValue:n.value,"onUpdate:modelValue":l[4]||(l[4]=m=>n.value=m)},{default:t(()=>[n.value?(f(),k(Ve,{key:0,workId:o.value.id},null,8,["workId"])):C("",!0)]),_:1},8,["modelValue"]),l[9]||(l[9]=A("br",null,null,-1)),e(K,{label:"\u0412\u0438\u0434\u0435\u043E",modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=m=>v.value=m)},{default:t(()=>[v.value?(f(),k(Qe,{key:0,workId:o.value.id},null,8,["workId"])):C("",!0)]),_:1},8,["modelValue"]),l[10]||(l[10]=A("br",null,null,-1)),e(K,{label:"\u0418\u0437\u0434\u0430\u043D\u0438\u044F",modelValue:u.value,"onUpdate:modelValue":l[6]||(l[6]=m=>u.value=m)},{default:t(()=>[u.value?(f(),k(Ie,{key:0,workId:o.value.id},null,8,["workId"])):C("",!0)]),_:1},8,["modelValue"])])]),_:1},8,["page-title"]))}};export{ut as default};
