import{P as O}from"./LocalStorage.e50f995d.js";import{u as B}from"./use-quasar.c9b9d459.js";import{a as I}from"./axios.7c1287c1.js";import{n as H,d as G}from"./myFuncts.671597d2.js";import{u as F,i as C,r as l,p as u,k as N,o as R,l as $,m as _,n as D,q as a,f as t,Q as J,t as L,v as K,x as A,y as X,z as q,A as E,B as Y,C as Z,D as ee,E as U,F as W,G as te,b as oe,H as ae,I as ne,w as se,J as le}from"./index.52314c0a.js";import{m as f}from"./myAuth.5621b016.js";import{H as P}from"./hall.9439a2df.js";import{u as ie}from"./use-meta.bb1668c8.js";import{Q as b}from"./QItemLabel.1623a9a2.js";import{Q as h,a as re,b as V}from"./QImg.596a2b33.js";/* empty css               */import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";const T="SessionToken",w="AccessToken",ce={__name:"AuthComponent",setup(v,{expose:d}){const r=B();F();const i=C("isOptionsLoaded"),m=C("admin");async function y(){console.log("loadOptions started");const e=await P.getList(r);P.List=l(e),P.List.value.length?(i.value=!0,console.log("options Loaded")):console.error("Halls is empty")}const Q=l(""),o=l("");function n(e,s,c="90d"){r.cookies.set(e,s,{expires:c,path:"/",domain:null,sameSite:"Strict",secure:!0,httpOnly:!1}),e===w&&(I.defaults.headers.common.AccessToken=s,Q.value=s,f.self.AccessToken=s),e===T&&(o.value=s,f.self.SessionToken=s)}function S(){I.post(String("https://auth.symphograph.ru/")+"/api/register.php",{params:{method:"register",authType:"default"}}).then(e=>{var s,c,p,g,k;if(!((s=e==null?void 0:e.data)!=null&&s.result))throw new Error;n(w,(p=(c=e==null?void 0:e.data)==null?void 0:c.data.AccessToken)!=null?p:""),n(T,(k=(g=e==null?void 0:e.data)==null?void 0:g.data.SessionToken)!=null?k:""),y()}).catch(e=>{r.notify(H(e))})}u("register",S);function x(){I.post(String("https://auth.symphograph.ru/")+"/api/refresh.php",{params:{method:"refresh",SessionToken:f.self.SessionToken,AccessToken:f.self.AccessToken}}).then(e=>{var s,c,p,g,k;if(!((s=e==null?void 0:e.data)!=null&&s.result))throw new Error;n(T,(p=(c=e==null?void 0:e.data)==null?void 0:c.data.SessionToken)!=null?p:""),n(w,(k=(g=e==null?void 0:e.data)==null?void 0:g.data.AccessToken)!=null?k:""),m.value=f.self.isPermit([4]),y()}).catch(e=>{var s;if(((s=e==null?void 0:e.response)==null?void 0:s.status)===401){S();return}r.notify(H(e))})}return u("refreshAccessToken",x),d({}),N(()=>{console.log("auth beforeMounted"),I.defaults.headers.common.Accept="application/json",f.self=new f}),R(()=>{console.log("auth Mounted"),!r.cookies.getAll()[w]||!r.cookies.getAll()[T]?S():(n(T,r.cookies.getAll()[T]),n(w,r.cookies.getAll()[w]),x())}),(e,s)=>$("",!0)}},fe={__name:"DynamicFormItem",props:{btnLabel:String,icon:String,url:String},setup(v){B();const d=v;return(r,i)=>(_(),D(V,{clickable:"",onClick:i[0]||(i[0]=m=>A(G)(v.url,{AccessToken:A(f).self.AccessToken,SessionToken:A(f).self.SessionToken}))},{default:a(()=>[t(h,{avatar:""},{default:a(()=>[t(J,null,{default:a(()=>[t(re,{src:v.icon},null,8,["src"])]),_:1})]),_:1}),t(h,null,{default:a(()=>[t(b,{caption:""},{default:a(()=>i[1]||(i[1]=[L("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),t(b,null,{default:a(()=>[L(K(d.btnLabel),1)]),_:1})]),_:1})]),_:1}))}};const de={__name:"LoginDialog",setup(v){const d=C("authTypes"),r=String("https://auth.symphograph.ru/"),i=C("showLoginDialog"),m=C("leftDrawerOpen");function y(){m.value=!1}return(Q,o)=>(_(),D(ae,{modelValue:A(i),"onUpdate:modelValue":o[3]||(o[3]=n=>oe(i)?i.value=n:null),onHide:o[4]||(o[4]=n=>y())},{default:a(()=>[t(X,{class:"dialogArea",style:{color:"var(--dTitle)"}},{default:a(()=>[t(q,null,{default:a(()=>[t(V,{dense:""},{default:a(()=>[t(h,null,{default:a(()=>[t(b,{lines:"1",class:"cardTitle"},{default:a(()=>[t(E,{name:"lock"}),o[5]||(o[5]=L("\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0439 \u0432\u0445\u043E\u0434"))]),_:1})]),_:1}),t(h,{side:""},{default:a(()=>[t(Y,{round:"",flat:"",icon:"close",onMouseover:o[0]||(o[0]=()=>console.log("kjk")),onClick:o[1]||(o[1]=Z(n=>i.value=!1,["stop","prevent"]))})]),_:1})]),_:1}),t(ee),t(V,null,{default:a(()=>[t(h,null,{default:a(()=>[t(b,null,{default:a(()=>o[6]||(o[6]=[L(" \u041F\u0440\u0435\u0434\u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D \u0434\u043B\u044F \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u043E\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430 ")])),_:1})]),_:1})]),_:1}),t(V,{clickable:"",to:"/vacancies",onClick:o[2]||(o[2]=n=>i.value=!1)},{default:a(()=>[t(h,null,{default:a(()=>[t(b,{caption:""},{default:a(()=>o[7]||(o[7]=[L(" \u0415\u0441\u043B\u0438 \u0412\u044B \u043D\u0435 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430, \u0442\u043E \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442\u0435 \u043A \u043D\u0430\u043C \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C. ")])),_:1}),t(b,{caption:""},{default:a(()=>o[8]||(o[8]=[L(" \u0423 \u043D\u0430\u0441 \u0441\u0435\u0439\u0447\u0430\u0441 \u0435\u0441\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0438\u043D\u0442\u0435\u0440\u0435\u0441\u043D\u044B\u0445 \u0432\u0430\u043A\u0430\u043D\u0441\u0438\u0439.\u{1F603} ")])),_:1})]),_:1}),t(h,{side:""},{default:a(()=>[t(E,{name:"open_in_new"})]),_:1})]),_:1})]),_:1}),t(q,null,{default:a(()=>[(_(!0),U(W,null,te(A(d),n=>(_(),D(fe,{key:n.id,btnLabel:n.label,icon:n.img,url:A(r)+n.url},null,8,["btnLabel","icon","url"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var me=ue(de,[["__scopeId","data-v-761e7acf"]]);const Ce={__name:"MainLayout",setup(v){const d=ne();ie({meta:{viewport:{name:"viewport",content:"initial-scale=1, width=device-width, user-scalable=yes"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}});const i=B(),m=F(),y=l(),Q=l([{id:2,label:"\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C",url:"login/telegram/login.php",img:"/img/auth/telegram.svg"},{id:3,label:"MailRu",url:"login/mailru/login.php",img:"/img/auth/mailru.svg"},{id:4,label:"Discord",url:"login/discord/login.php",img:"/img/auth/discord.svg"},{id:4,label:"V\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435",url:"login/vkontakte/login.php",img:"/img/auth/vkontakte.svg"}]);u("authTypes",Q);const o=l(!1);u("progress",o);const n={entry:l(!1),announce:l(!1),doc:l(!1),staff:l(!1),libVideo:l(!1)};u("editModes",n);const S=l(!1);u("admin",S);const x=l(!1);u("leftDrawerOpen",x);const e=l(!1);u("isOptionsLoaded",e);const s=l(!1);u("showLoginDialog",s);const c=l(!0);u("scrollWatch",c);const p=l(0);u("scrollPos",p),se(m,M=>{O.set("lastPath",M.path)});function g(){O.set("CookieConfirm","1")}function k(){O.getItem("CookieConfirm")||i.notify({message:"\u041C\u044B \u0442\u043E\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C Cookies. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0431\u0435\u0437 \u043D\u0438\u0445 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442.",color:"primary",timeout:0,multiLine:!0,onDismiss:g,icon:"ion-information-circle-outline",actions:[{label:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E",color:"yellow",handler:()=>{}}]})}function j(M=500){c.value=!1,setTimeout(()=>{c.value=!0},M)}return u("stopScrollWatch",j),N(()=>{d.push({path:"/maintenance"}),console.log("mainLayout beforeMount"),document.body.style.backgroun="none"}),R(()=>{O.set("lastPath",m.path),console.log("mainLayout Mounted"),k()}),(M,pe)=>{const z=le("router-view");return _(),U(W,null,[t(ce,{ref_key:"refAuth",ref:y},null,512),e.value?(_(),D(z,{key:0})):$("",!0),e.value?(_(),D(me,{key:1})):$("",!0)],64)}}};export{Ce as default};
