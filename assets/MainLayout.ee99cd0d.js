import{P as I}from"./LocalStorage.30a0f8ee.js";import{u as B,Q as h,a as H}from"./QItem.23ea6b26.js";import{api as Q}from"./axios.f32b2135.js";import{n as V,d as z}from"./myFuncts.2ef749ed.js";import{u as F,i as b,r as n,p as r,k as N,o as U,l as $,m as _,n as x,q as o,f as e,Q as G,t as S,v as J,x as L,y as K,z as E,A as q,B as X,C as Y,D as Z,E as R,F as W,G as tt,b as et,H as ot,I as at,w as lt,J as nt}from"./index.71b2f5af.js";import{m as p}from"./myAuth.f2132660.js";import{u as st}from"./use-meta.a68f7bd3.js";import{Q as A}from"./QItemLabel.0de1a3e1.js";/* empty css               */import{Q as it}from"./QImg.a2fc22c0.js";import{_ as ut}from"./plugin-vue_export-helper.21dcd24c.js";const T="SessionToken",w="AccessToken",rt={__name:"AuthComponent",setup(k,{expose:v}){const s=B(),i=String("https://api.sakh-orch.ru/");F();const y=b("isOptionsLoaded"),C=b("admin"),M=b("Halls");function l(){console.log("loadOptions started"),Q.post(i+"api/get/options.php",{params:{}}).then(t=>{var a,c,f,m;if(!((a=t==null?void 0:t.data)!=null&&a.result))throw new Error;M.value=(m=(f=(c=t==null?void 0:t.data)==null?void 0:c.data)==null?void 0:f.Halls)!=null?m:[],y.value=!0,console.log("options Loaded")}).catch(t=>{s.notify(V(t))})}const u=n(""),P=n("");function d(t,a,c="90d"){s.cookies.set(t,a,{expires:c,path:"/",domain:null,sameSite:"Strict",secure:!0,httpOnly:!1}),t===w&&(Q.defaults.headers.common.AccessToken=a,u.value=a,p.self.AccessToken=a),t===T&&(P.value=a,p.self.SessionToken=a)}function D(){Q.post(String("https://auth.symphograph.ru/")+"/api/register.php",{params:{authType:"default"}}).then(t=>{var a,c,f,m,g;if(!((a=t==null?void 0:t.data)!=null&&a.result))throw new Error;d(w,(f=(c=t==null?void 0:t.data)==null?void 0:c.data.AccessToken)!=null?f:""),d(T,(g=(m=t==null?void 0:t.data)==null?void 0:m.data.SessionToken)!=null?g:""),l()}).catch(t=>{s.notify(V(t))})}r("register",D);function O(){Q.post(String("https://auth.symphograph.ru/")+"/api/refresh.php",{params:{SessionToken:p.self.SessionToken,AccessToken:p.self.AccessToken}}).then(t=>{var a,c,f,m,g;if(!((a=t==null?void 0:t.data)!=null&&a.result))throw new Error;d(T,(f=(c=t==null?void 0:t.data)==null?void 0:c.data.SessionToken)!=null?f:""),d(w,(g=(m=t==null?void 0:t.data)==null?void 0:m.data.AccessToken)!=null?g:""),C.value=p.self.isPermit([4]),l()}).catch(t=>{var a;if(((a=t==null?void 0:t.response)==null?void 0:a.status)===401){D();return}s.notify(V(t))})}return r("refreshAccessToken",O),v({}),N(()=>{console.log("auth beforeMounted"),Q.defaults.headers.common.Accept="application/json",p.self=new p}),U(()=>{console.log("auth Mounted"),!s.cookies.getAll()[w]||!s.cookies.getAll()[T]?D():(d(T,s.cookies.getAll()[T]),d(w,s.cookies.getAll()[w]),O())}),(t,a)=>$("",!0)}},ct={__name:"DynamicFormItem",props:{btnLabel:String,icon:String,url:String},setup(k){B();const v=k;return(s,i)=>(_(),x(H,{clickable:"",onClick:i[0]||(i[0]=y=>L(z)(k.url,{AccessToken:L(p).self.AccessToken,SessionToken:L(p).self.SessionToken}))},{default:o(()=>[e(h,{avatar:""},{default:o(()=>[e(G,null,{default:o(()=>[e(it,{src:k.icon},null,8,["src"])]),_:1})]),_:1}),e(h,null,{default:o(()=>[e(A,{caption:""},{default:o(()=>[S("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")]),_:1}),e(A,null,{default:o(()=>[S(J(v.btnLabel),1)]),_:1})]),_:1})]),_:1}))}};const dt={__name:"LoginDialog",setup(k){const v=b("authTypes"),s=String("https://auth.symphograph.ru/"),i=b("showLoginDialog"),y=b("leftDrawerOpen");function C(){y.value=!1}return(M,l)=>(_(),x(ot,{modelValue:L(i),"onUpdate:modelValue":l[3]||(l[3]=u=>et(i)?i.value=u:null),onHide:l[4]||(l[4]=u=>C())},{default:o(()=>[e(K,{class:"dialogArea",style:{color:"var(--dTitle)"}},{default:o(()=>[e(E,null,{default:o(()=>[e(H,{dense:""},{default:o(()=>[e(h,null,{default:o(()=>[e(A,{lines:"1",class:"cardTitle"},{default:o(()=>[e(q,{name:"lock"}),S("\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0439 \u0432\u0445\u043E\u0434")]),_:1})]),_:1}),e(h,{side:""},{default:o(()=>[e(X,{round:"",flat:"",icon:"close",onMouseover:l[0]||(l[0]=()=>console.log("kjk")),onClick:l[1]||(l[1]=Y(u=>i.value=!1,["stop","prevent"]))})]),_:1})]),_:1}),e(Z),e(H,null,{default:o(()=>[e(h,null,{default:o(()=>[e(A,null,{default:o(()=>[S(" \u041F\u0440\u0435\u0434\u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D \u0434\u043B\u044F \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u043E\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430 ")]),_:1})]),_:1})]),_:1}),e(H,{clickable:"",to:"/vacancies",onClick:l[2]||(l[2]=u=>i.value=!1)},{default:o(()=>[e(h,null,{default:o(()=>[e(A,{caption:""},{default:o(()=>[S(" \u0415\u0441\u043B\u0438 \u0412\u044B \u043D\u0435 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430, \u0442\u043E \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442\u0435 \u043A \u043D\u0430\u043C \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C. ")]),_:1}),e(A,{caption:""},{default:o(()=>[S(" \u0423 \u043D\u0430\u0441 \u0441\u0435\u0439\u0447\u0430\u0441 \u0435\u0441\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0438\u043D\u0442\u0435\u0440\u0435\u0441\u043D\u044B\u0445 \u0432\u0430\u043A\u0430\u043D\u0441\u0438\u0439.\u{1F603} ")]),_:1})]),_:1}),e(h,{side:""},{default:o(()=>[e(q,{name:"open_in_new"})]),_:1})]),_:1})]),_:1}),e(E,null,{default:o(()=>[(_(!0),R(W,null,tt(L(v),u=>(_(),x(ct,{key:u.id,btnLabel:u.label,icon:u.img,url:L(s)+u.url},null,8,["btnLabel","icon","url"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var ft=ut(dt,[["__scopeId","data-v-761e7acf"]]);const bt={__name:"MainLayout",setup(k){at(),st({meta:{viewport:{name:"viewport",content:"initial-scale=1, width=device-width, user-scalable=yes"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}});const s=B(),i=F(),y=n(),C=n([{id:2,label:"\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C",url:"auth/telegram/login.php",img:"/img/auth/telegram.svg"},{id:3,label:"MailRu",url:"auth/mailru/login.php",img:"/img/auth/mailru.svg"},{id:4,label:"Discord",url:"auth/discord/login.php",img:"/img/auth/discord.svg"},{id:4,label:"V\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435",url:"auth/vkontakte/login.php",img:"/img/auth/vkontakte.svg"}]);r("authTypes",C);const M=n(!1);r("progress",M);const l=n(!1);r("editMode",l);const u=n(!1);r("admin",u);const P=n(!1);r("leftDrawerOpen",P),n("gfdsg"),n("gfdsg");const d=n(!1);r("isOptionsLoaded",d);const D=n([]);r("Halls",D);const O=n(!1);r("showLoginDialog",O);const t=n(!0);r("scrollWatch",t);const a=n(0);r("scrollPos",a),lt(i,g=>{I.set("lastPath",g.path)});function c(){I.set("CookieConfirm","1")}function f(){I.getItem("CookieConfirm")||s.notify({message:"\u041C\u044B \u0442\u043E\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C Cookies. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0431\u0435\u0437 \u043D\u0438\u0445 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442.",color:"primary",timeout:0,multiLine:!0,onDismiss:c,icon:"ion-information-circle-outline",actions:[{label:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E",color:"yellow",handler:()=>{}}]})}function m(g=500){t.value=!1,setTimeout(()=>{t.value=!0},g)}return r("stopScrollWatch",m),N(()=>{console.log("mainLayout beforeMount"),document.body.style.backgroun="none"}),U(()=>{I.set("lastPath",i.path),console.log("mainLayout Mounted"),f()}),(g,mt)=>{const j=nt("router-view");return _(),R(W,null,[e(rt,{ref_key:"refAuth",ref:y},null,512),d.value?(_(),x(j,{key:0})):$("",!0),d.value?(_(),x(ft,{key:1})):$("",!0)],64)}}};export{bt as default};
