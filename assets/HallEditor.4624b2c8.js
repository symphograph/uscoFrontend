import{i as v,m as p,D as b,F as E,E as D,ax as k,f as l,v as n,bi as K,z as le,q as r,t as C,b as W,df as oe,A as G,n as R,bk as ae,bl as ne,u as h,l as $,C as ue,r as g,bN as Z,y as ce,p as S,k as de,o as pe,x as me,au as F,bm as fe}from"./index.89609573.js";import{a as ee}from"./axios.e621819c.js";import{n as te,a as ve}from"./myFuncts.2186fc9b.js";import{u as X}from"./use-quasar.06f765f0.js";import{_ as Y}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as L}from"./QTooltip.31e2ede8.js";import{Q as A}from"./QItemLabel.1f0e3975.js";import{b as J,Q as M,a as _e}from"./QImg.c3c20473.js";import{Q as ie}from"./QSelect.6f1d235f.js";import{m as ye}from"./entry.33e05696.js";import"./position-engine.60b61593.js";import"./selection.27c53126.js";import"./QMenu.eedc4e6f.js";import"./use-virtual-scroll.1dab1b66.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./myAxios.f4538610.js";const ke={class:"priceRow"},be=["onClick"],we={__name:"PriceInputs",emits:["onSelectPrice"],setup(I,{emit:T}){const e=v("selectedPrice"),i=v("HallPlan");function a(c){e.value=c}const d=v("colors");function u(c){return c.priceType===e.value.priceType?"1.5em":"1em"}return(c,t)=>(p(),b("div",ke,[(p(!0),b(E,null,D(n(i).pricing,s=>(p(),b("div",{key:s.priceType,class:"priceCell"},[k("div",{style:{cursor:"pointer"},onClick:_=>a(s)},[l(K,{label:s.label,dense:"","label-color":n(d)[s.priceType][0],step:"100","input-class":"priceInput",modelValue:n(i).pricing.find(_=>_.priceType===s.priceType).price,"onUpdate:modelValue":_=>n(i).pricing.find(w=>w.priceType===s.priceType).price=_,type:"number"},null,8,["label","label-color","modelValue","onUpdate:modelValue"]),l(le,{name:"edit",color:n(d)[s.priceType][0],size:u(s)},null,8,["color","size"])],8,be)]))),128))]))}};var Ce=Y(we,[["__scopeId","data-v-607c9cf6"]]);const Te={style:{width:"100%",border:"1px solid lightgray","border-radius":"3px"}},ge={__name:"StructureInputs",setup(I){const T=v("initCells"),e=v("HallPlan"),i=v("addCountable");return(a,d)=>(p(),b(E,null,[l(K,{label:"\u0420\u044F\u0434\u043E\u0432",modelValue:n(e).structure.cntRows,"onUpdate:modelValue":d[0]||(d[0]=u=>n(e).structure.cntRows=u),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),l(K,{label:"\u042F\u0447\u0435\u0435\u043A",modelValue:n(e).structure.cntCols,"onUpdate:modelValue":d[1]||(d[1]=u=>n(e).structure.cntCols=u),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),k("div",Te,[l(L,{delay:"300"},{default:r(()=>d[3]||(d[3]=[C("\u0412\u0441\u0435\u0433\u0434\u0430 \u0443\u0447\u0438\u0442\u044B\u0432\u0430\u0442\u044C \u044F\u0447\u0435\u0439\u043A\u0443 \u043F\u0440\u0438 \u043F\u043E\u0434\u0441\u0447\u0435\u0442\u0435 \u043C\u0435\u0441\u0442 \u0440\u044F\u0434\u0430.")])),_:1}),l(oe,{modelValue:n(i),"onUpdate:modelValue":d[2]||(d[2]=u=>W(i)?i.value=u:null),label:"+1"},null,8,["modelValue"])]),l(G,{label:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",onClick:n(T),class:"defbtn",outline:""},null,8,["onClick"])],64))}},he={__name:"ModeSelect",setup(I){const T=[{value:"Offline",label:"\u0417\u0430\u043D\u044F\u0442\u044B\u0435 \u043C\u0435\u0441\u0442\u0430",descr:"\u041C\u0435\u0441\u0442\u0430, \u0447\u044C\u0438 \u0431\u0438\u043B\u0435\u0442\u044B \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B \u043E\u043D\u043B\u0430\u0439\u043D. \u0418\u0445 \u0437\u0430\u0431\u0440\u0430\u043B\u0438 \u043E\u0447\u043D\u043E."},{value:"Prices",label:"\u0426\u0435\u043D\u044B",descr:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u0446\u0435\u043D \u0438 \u043F\u0440\u0438\u0432\u044F\u0437\u043A\u0430 \u043C\u0435\u0441\u0442\u0430 \u043A \u0442\u0438\u043F\u0443 \u0446\u0435\u043D\u044B"},{value:"Structure",label:"\u0421\u0442\u0440\u0443\u043A\u0442\u0443\u0440\u0430 \u0417\u0430\u043B\u0430",descr:"\u041E\u0442\u043C\u0435\u0447\u0430\u0435\u0442 \u044F\u0447\u0435\u0439\u043A\u0443 \u043A\u0430\u043A \u043F\u0440\u043E\u0445\u043E\u0434 \u0438\u043B\u0438 \u043C\u0435\u0441\u0442\u043E"}],e=v("selectedMode"),i=v("selectedPrice"),a=v("colors");function d(){return e.value==="Prices"?a[i.value.priceType][0]:"amber"}return(u,c)=>(p(),R(ie,{modelValue:n(e),"onUpdate:modelValue":c[0]||(c[0]=t=>W(e)?e.value=t:null),color:"amber","label-color":d(),outlined:"","emit-value":"","map-options":"",style:{width:"100%"},options:T,label:"\u0427\u0442\u043E \u0431\u0443\u0434\u0435\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C?"},{prepend:r(()=>[l(le,{name:"edit",color:d()},null,8,["color"])]),option:r(t=>[l(J,ae(ne(t.itemProps)),{default:r(()=>[l(M,null,{default:r(()=>[l(A,null,{default:r(()=>[C(h(t.opt.label),1)]),_:2},1024),l(A,{caption:""},{default:r(()=>[C(h(t.opt.descr),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label-color"]))}},Pe=["src"],xe={__name:"AnnounceSelect",emits:["onSelectAnnounce"],setup(I,{emit:T}){const e=X(),i=v("announceList"),a=v("selectedAnnounce"),d=T;function u(c){let t=480;return e.platform.is.mobile&&(t=1080),String("https://sakh-orch.ru/api/")+c.folder+"/"+t+"/"+c.fileName+"?ver="+c.md5}return(c,t)=>n(i).length?(p(),R(ie,{key:0,options:n(i),modelValue:n(a),"onUpdate:modelValue":[t[0]||(t[0]=s=>W(a)?a.value=s:null),t[1]||(t[1]=s=>d("onSelectAnnounce"))],color:"amber",outlined:"",style:{width:"100%"},"map-options":"","option-value":"id","option-label":"progName"},{selected:r(()=>[l(J,{dense:""},{default:r(()=>[l(M,null,{default:r(()=>[l(A,null,{default:r(()=>[C(h(n(a).progName),1)]),_:1}),l(A,{caption:""},{default:r(()=>[C(h(n(a).eventTime)+" | "+h(n(a).Hall.name),1)]),_:1})]),_:1})]),_:1})]),prepend:r(()=>[l(_e,{width:"50px",ratio:"16/9",src:u(n(a).Sketch)},null,8,["src"])]),option:r(s=>[l(J,ae(ne(s.itemProps)),{default:r(()=>[l(M,{avatar:""},{default:r(()=>[k("img",{style:{width:"50px"},src:u(s.opt.Sketch)},null,8,Pe),$("",!0)]),_:2},1024),l(M,null,{default:r(()=>[l(A,null,{default:r(()=>[C(h(s.opt.progName),1)]),_:2},1024),l(A,{caption:""},{default:r(()=>[C(h(s.opt.Hall.name),1)]),_:2},1024),l(A,{caption:""},{default:r(()=>[C(h(s.opt.eventTime),1)]),_:2},1024)]),_:2},1024),l(M,{side:""},{default:r(()=>[$("",!0),l(oe,{disable:"",modelValue:s.opt.isShow,"onUpdate:modelValue":_=>s.opt.isShow=_,color:"green"},{default:r(()=>[l(L,null,{default:r(()=>t[2]||(t[2]=[C("\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u043D")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040),l(ue)]),_:1},8,["options","modelValue"])):$("",!0)}};const Ie={class:"menuArea"},Se={class:"menuBlock"},Ve={class:"blockRow"},He={class:"menuBlock"},$e={class:"blockRow"},Ne={key:0,class:"blockRow"},Qe={__name:"HallCreatorMenu",emits:["onSelectHall","onSelectPrice","onSelectAnnounce"],setup(I,{emit:T}){X(),v("HallPlan");const e=T,i=v("selectedMode");v("colors");function a(){e("onSelectAnnounce")}return(d,u)=>(p(),b("div",Ie,[k("div",Se,[k("div",Ve,[l(xe,{onOnSelectAnnounce:u[0]||(u[0]=c=>a())})])]),k("div",He,[k("div",$e,[l(he)]),n(i)==="Structure"?(p(),b("div",Ne,[l(ge)])):$("",!0)]),n(i)==="Prices"?(p(),R(Ce,{key:0})):$("",!0)]))}};var Ae=Y(Qe,[["__scopeId","data-v-af72b178"]]);const Re={key:1,class:"forceCount"},Ue={__name:"HallBuilderCell",props:{cell:Object,ticket:Object},emits:["cellClick"],setup(I,{emit:T}){const e=I,i=v("colors"),a=g(e.ticket),d=v("HallPlan"),u=v("selectedMode"),c=v("selectedPrice"),t=v("addCountable"),s=g("Invite"),_=g(0);function w(m){var f;return(f=d.value.tickets.find(H=>H.cellid===m))!=null?f:!1}function x(){var m,f,H,Q;!((f=(m=a==null?void 0:a.value)==null?void 0:m.cellId)!=null&&f)||(_.value.cellId!==((Q=(H=a==null?void 0:a.value)==null?void 0:H.cellId)!=null?Q:0)&&(s.value="Invite"),c.value.priceType===a.value.priceType?a.value.priceType=s.value:(s.value=a.value.priceType,a.value.priceType=c.value.priceType),_.value=a.value.cellId)}function V(m){m.exist=!m.exist,w(m.id)||d.value.tickets.push({cellId:m.id,offline:!1,seatRow:0,seatNum:0,priceType:"Invite"}),m.forceCount=!!(!m.exist&&t.value)}function O(m){switch(u.value){case"Structure":{V(m);break}case"Prices":{x();break}case"Offline":{a.value.offline=!a.value.offline;break}default:{if(m.priceType===u.value.value){m.priceType="Invite";break}m.priceType=u.value.value}}}return(m,f)=>{var H,Q,U,z;return p(),b("div",{class:"cellArea",onClick:f[0]||(f[0]=j=>O(I.cell))},[e.cell.exist?(p(),b(E,{key:0},[(H=I.ticket)!=null&&H.offline?(p(),b("div",{key:0,class:"offlineCell",style:Z({borderColor:n(i)[((Q=e.ticket)==null?void 0:Q.priceType)||"Invite"][1],backgroundColor:n(i)[((U=e.ticket)==null?void 0:U.priceType)||"Invite"][1]})},null,4)):(p(),b("div",{key:1,class:"availableCell",style:Z({borderColor:n(i)[((z=e.ticket)==null?void 0:z.priceType)||"Invite"][1]})},[C(h(e.ticket.seatNum)+" ",1),l(L,{offset:[0,-120],"max-width":"20em",delay:300},{default:r(()=>[C(h("\u041C\u0435\u0441\u0442\u043E: "+e.ticket.seatNum),1),f[1]||(f[1]=k("br",null,null,-1)),C(" "+h("\u0420\u044F\u0434: "+e.ticket.seatRow),1),f[2]||(f[2]=k("br",null,null,-1)),C(" "+h("\u0426\u0435\u043D\u0430: "+e.ticket.priceType),1)]),_:1})],4))],64)):e.cell.forceCount?(p(),b("div",Re,[f[4]||(f[4]=C("? ")),l(L,{offset:[0,-100],"max-width":"20em"},{default:r(()=>f[3]||(f[3]=[C(" \u041F\u043E \u043A\u0430\u043A\u0438\u043C-\u0442\u043E \u043F\u0440\u0438\u0447\u0438\u043D\u0430\u043C \u044D\u0442\u043E \u043C\u0435\u0441\u0442\u043E \u043F\u043E\u0441\u0447\u0438\u0442\u0430\u043D\u043E \u0432 \u0441\u0445\u0435\u043C\u0435, \u043D\u043E \u043D\u0430 \u0441\u0430\u043C\u043E\u043C \u0434\u0435\u043B\u0435 \u0435\u0433\u043E \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 ")])),_:1})])):$("",!0)])}}};const Be={style:{width:"max-content",margin:"auto"}},Me={style:{margin:"auto"}},Ee={class:"rowNumber"},Oe={class:"rowNumber"},ze={__name:"HallTable",emits:["cellClick","ticket"],setup(I,{emit:T}){const e=v("HallPlan"),i=T;function a(c){i("cellClick",c)}function d(c){i("ticket",c)}function u(c){return e.value.tickets.find(t=>t.cellId===c)}return(c,t)=>n(e).tickets.length?(p(),R(ce,{key:0},{default:r(()=>[k("table",Be,[k("tbody",Me,[(p(!0),b(E,null,D(n(e).cells,(s,_)=>(p(),b("tr",{key:"row_"+_},[k("td",null,[k("div",Ee,h(n(e).structure.rowNums[_]||""),1)]),(p(!0),b(E,null,D(s,(w,x)=>(p(),b("td",{key:_+"_"+x},[(p(),R(Ue,{cell:n(e).cells[w.row-1][w.col-1],"onUpdate:cell":V=>n(e).cells[w.row-1][w.col-1]=V,ticket:u(w.id),key:w.id,onCellClick:V=>a(V),onTickedClick:t[0]||(t[0]=V=>d(V))},null,8,["cell","onUpdate:cell","ticket","onCellClick"]))]))),128)),k("td",null,[k("div",Oe,h(n(e).structure.rowNums[_]||""),1)])]))),128))])])]),_:1})):$("",!0)}};var Le=Y(ze,[["__scopeId","data-v-0fddd53a"]]);const je={class:"content"},qe={style:{overflow:"auto",margin:"1em auto","min-width":"100vw"}},ut={__name:"HallEditor",setup(I){const T=String("https://sakh-orch.ru/api/"),e=X(),i=g("Prices");S("selectedMode",i);const a=g([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);S("defaultPricing",a);const d=g({priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"});S("selectedPrice",d);const u=g({});S("selectedAnnounce",u);const c=g(!1);S("addCountable",c);const t=g({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:a.value,cells:[],tickets:[]});S("HallPlan",t),S("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]});const _=g(!1);S("progress",_);const w=g([]);S("announceList",w);const x=g(!1);function V(){i.value==="Structure"&&U(),ee.post(T+"epoint/tickets/hallplan.php",{params:{method:"put",plan:t.value}}).then(o=>{var y,P,N;if(!((y=o==null?void 0:o.data)!=null&&y.result))throw new Error;e.notify(ve((N=(P=o==null?void 0:o.data)==null?void 0:P.result)!=null?N:""))}).catch(o=>{e.notify(te(o))})}async function O(){x.value=!1,t.value.cells=[];let o=[],y=[],P=0,N={};for(let B=1;B<=t.value.structure.cntRows;B++){for(let q=1;q<=t.value.structure.cntCols;q++)P++,N={id:P,row:B,col:q,exist:!0,forceCount:!1},y.push(N);o.push(y),y=[]}t.value.cells=o,await U(),await F(),x.value=!0}S("initCells",O);const m=g(0),f=g(0);function H(o){if(!o.exist&&!o.forceCount)return;if(o.forceCount){m.value++;return}if(!o.exist)return;m.value++;let y={cellId:o.id,offline:!1,seatRow:f.value,seatNum:m.value,priceType:"Invite"};t.value.tickets.push(y)}function Q(o){if(m.value=0,z(o)){t.value.structure.rowNums.push(!1);return}f.value++,t.value.structure.rowNums.push(f.value),o.forEach(y=>H(y))}async function U(){x.value=!1,f.value=0,t.value.tickets=[],t.value.structure.rowNums=[],t.value.cells.forEach(o=>Q(o)),await F(),x.value=!0,console.log("cntOfTickets:",t.value.tickets.length)}function z(o){return![...o].filter(P=>P.exist).length}function j(){ee.post(T+"epoint/tickets/hallplan.php",{params:{method:"get",id:u.value.id}}).then(async o=>{var y,P,N,B;if(o.status===204){t.value.id=u.value.id,await O();return}if(!((P=(y=o==null?void 0:o.data)==null?void 0:y.data)!=null&&P.HallPlan))throw new Error;x.value=!1,t.value=(B=(N=o==null?void 0:o.data)==null?void 0:N.data)==null?void 0:B.HallPlan,await F(),x.value=!0}).catch(o=>{t.value={},e.notify(te(o))})}async function re(){_.value=!0,w.value=await ye.listFuture(e),w.value.length&&(u.value=w.value[0],j()),_.value=!1}function se(){switch(i.value){case"Prices":{console.log("resetTickets"),U();break}default:console.log(i.value)}}return de(()=>{}),pe(()=>{re()}),(o,y)=>(p(),b("div",je,[l(Ae,{onOnSelectAnnounce:y[0]||(y[0]=P=>j())}),k("div",qe,[l(me,{style:{width:"max-content","min-width":"80vw",padding:"2em",margin:"0 auto"},dark:""},{default:r(()=>[x.value?(p(),R(Le,{key:0})):$("",!0),l(fe,{style:{display:"flex","justify-content":"end"}},{default:r(()=>[i.value==="Prices"?(p(),R(G,{key:0,label:"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C",onClick:y[1]||(y[1]=P=>se())})):$("",!0),l(G,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",onClick:V})]),_:1})]),_:1})])]))}};export{ut as default};
