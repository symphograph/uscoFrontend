import{P as x}from"./LocalStorage.444a7db9.js";import{u as $}from"./use-quasar.87d72c4b.js";import{a as O}from"./axios.07914dc4.js";import{n as B,d as j}from"./myFuncts.bdba1267.js";import{m as f}from"./myAuth.5621b016.js";import{H as V}from"./hall.2342e7d5.js";import{i as S,r as s,p as u,k as E,o as F,l as P,m as _,n as C,q as a,f as o,Q as z,t as w,u as G,v as b,x as J,y as H,z as q,A as K,B as X,C as Y,D as N,F as R,E as Z,b as tt,G as et,H as ot,I as at,w as nt,J as st}from"./index.e91fb510.js";import{u as lt}from"./use-meta.dc215004.js";import{Q as L}from"./QItemLabel.5220bd87.js";import{Q as k,a as it,b as I}from"./QImg.74d9d22f.js";/* empty css               */import{_ as rt}from"./plugin-vue_export-helper.21dcd24c.js";const y="SessionToken",T="AccessToken",ut={__name:"AuthComponent",setup(h){const r=$(),v=S("isOptionsLoaded"),l=S("admin");async function d(){console.log("loadOptions started");const t=await V.getList(r);V.List=s(t),V.List.value.length?(v.value=!0,console.log("options Loaded")):console.error("Halls is empty")}const A=s(""),D=s("");function e(t,n,c="90d"){r.cookies.set(t,n,{expires:c,path:"/",domain:null,sameSite:"Strict",secure:!0,httpOnly:!1}),t===T&&(O.defaults.headers.common.AccessToken=n,A.value=n,f.self.AccessToken=n),t===y&&(D.value=n,f.self.SessionToken=n)}function i(){O.post(String("https://sakh-orch.ru/auth/")+"epoint/register.php",{params:{method:"register",authType:"default"}}).then(t=>{var n,c,m,g,p;if(!((n=t==null?void 0:t.data)!=null&&n.result))throw new Error;e(T,(m=(c=t==null?void 0:t.data)==null?void 0:c.data.AccessToken)!=null?m:""),e(y,(p=(g=t==null?void 0:t.data)==null?void 0:g.data.SessionToken)!=null?p:""),d()}).catch(t=>{r.notify(B(t))})}u("register",i);function Q(){O.post(String("https://sakh-orch.ru/auth/")+"epoint/refresh.php",{params:{method:"refresh",SessionToken:f.self.SessionToken,AccessToken:f.self.AccessToken}}).then(t=>{var n,c,m,g,p;if(!((n=t==null?void 0:t.data)!=null&&n.result))throw new Error;e(y,(m=(c=t==null?void 0:t.data)==null?void 0:c.data.SessionToken)!=null?m:""),e(T,(p=(g=t==null?void 0:t.data)==null?void 0:g.data.AccessToken)!=null?p:""),l.value=f.self.isPermit([4]),d()}).catch(t=>{var n;if(((n=t==null?void 0:t.response)==null?void 0:n.status)===401){i();return}r.notify(B(t))})}return u("refreshAccessToken",Q),E(()=>{console.log("auth beforeMounted"),O.defaults.headers.common.Accept="application/json",f.self=new f}),F(()=>{console.log("auth Mounted"),!r.cookies.getAll()[T]||!r.cookies.getAll()[y]?i():(e(y,r.cookies.getAll()[y]),e(T,r.cookies.getAll()[T]),Q())}),(t,n)=>P("",!0)}},ct={__name:"DynamicFormItem",props:{btnLabel:String,icon:String,url:String},setup(h){$();const r=h;return(v,l)=>(_(),C(I,{clickable:"",onClick:l[0]||(l[0]=d=>b(j)(h.url,{AccessToken:b(f).self.AccessToken,SessionToken:b(f).self.SessionToken}))},{default:a(()=>[o(k,{avatar:""},{default:a(()=>[o(z,null,{default:a(()=>[o(it,{src:h.icon},null,8,["src"])]),_:1})]),_:1}),o(k,null,{default:a(()=>[o(L,{caption:""},{default:a(()=>l[1]||(l[1]=[w("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),o(L,null,{default:a(()=>[w(G(r.btnLabel),1)]),_:1})]),_:1})]),_:1}))}};const ft={__name:"LoginDialog",setup(h){const r=S("authTypes"),v=String("https://sakh-orch.ru/auth/"),l=S("showLoginDialog"),d=S("leftDrawerOpen");function A(){d.value=!1}return(D,e)=>(_(),C(et,{modelValue:b(l),"onUpdate:modelValue":e[3]||(e[3]=i=>tt(l)?l.value=i:null),onHide:e[4]||(e[4]=i=>A())},{default:a(()=>[o(J,{class:"dialogArea",style:{color:"var(--dTitle)"}},{default:a(()=>[o(H,null,{default:a(()=>[o(I,{dense:""},{default:a(()=>[o(k,null,{default:a(()=>[o(L,{lines:"1",class:"cardTitle"},{default:a(()=>[o(q,{name:"lock"}),e[5]||(e[5]=w("\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0439 \u0432\u0445\u043E\u0434"))]),_:1})]),_:1}),o(k,{side:""},{default:a(()=>[o(K,{round:"",flat:"",icon:"close",onMouseover:e[0]||(e[0]=()=>console.log("kjk")),onClick:e[1]||(e[1]=X(i=>l.value=!1,["stop","prevent"]))})]),_:1})]),_:1}),o(Y),o(I,null,{default:a(()=>[o(k,null,{default:a(()=>[o(L,null,{default:a(()=>e[6]||(e[6]=[w(" \u041F\u0440\u0435\u0434\u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D \u0434\u043B\u044F \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u043E\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430 ")])),_:1})]),_:1})]),_:1}),o(I,{clickable:"",to:"/vacancies",onClick:e[2]||(e[2]=i=>l.value=!1)},{default:a(()=>[o(k,null,{default:a(()=>[o(L,{caption:""},{default:a(()=>e[7]||(e[7]=[w(" \u0415\u0441\u043B\u0438 \u0412\u044B \u043D\u0435 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430, \u0442\u043E \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442\u0435 \u043A \u043D\u0430\u043C \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C. ")])),_:1}),o(L,{caption:""},{default:a(()=>e[8]||(e[8]=[w(" \u0423 \u043D\u0430\u0441 \u0441\u0435\u0439\u0447\u0430\u0441 \u0435\u0441\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0438\u043D\u0442\u0435\u0440\u0435\u0441\u043D\u044B\u0445 \u0432\u0430\u043A\u0430\u043D\u0441\u0438\u0439.\u{1F603} ")])),_:1})]),_:1}),o(k,{side:""},{default:a(()=>[o(q,{name:"open_in_new"})]),_:1})]),_:1})]),_:1}),o(H,null,{default:a(()=>[(_(!0),N(R,null,Z(b(r),i=>(_(),C(ct,{key:i.id,btnLabel:i.label,icon:i.img,url:b(v)+i.url},null,8,["btnLabel","icon","url"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var dt=rt(ft,[["__scopeId","data-v-761e7acf"]]);const St={__name:"MainLayout",setup(h){ot(),lt({meta:{viewport:{name:"viewport",content:"initial-scale=1, width=device-width, user-scalable=yes"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}});const v=$(),l=at(),d=s(),A=s([{id:2,label:"\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C",url:"login/telegram/login.php",img:"/img/auth/telegram.svg"},{id:3,label:"MailRu",url:"login/mailru/login.php",img:"/img/auth/mailru.svg"},{id:4,label:"Discord",url:"login/discord/login.php",img:"/img/auth/discord.svg"},{id:4,label:"V\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435",url:"login/vkontakte/login.php",img:"/img/auth/vkontakte.svg"}]);u("authTypes",A);const D=s(!1);u("progress",D);const e={entry:s(!1),announce:s(!1),doc:s(!1),staff:s(!1),libVideo:s(!1)};u("editModes",e);const i=s(!1);u("admin",i);const Q=s(!1);u("leftDrawerOpen",Q);const t=s(!1);u("isOptionsLoaded",t);const n=s(!1);u("showLoginDialog",n);const c=s(!0);u("scrollWatch",c);const m=s(0);u("scrollPos",m),nt(l,M=>{x.set("lastPath",M.path)});function g(){x.set("CookieConfirm","1")}function p(){x.getItem("CookieConfirm")||v.notify({message:"\u041C\u044B \u0442\u043E\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C Cookies. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0431\u0435\u0437 \u043D\u0438\u0445 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442.",color:"primary",timeout:0,multiLine:!0,onDismiss:g,icon:"ion-information-circle-outline",actions:[{label:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E",color:"yellow",handler:()=>{}}]})}function U(M=500){c.value=!1,setTimeout(()=>{c.value=!0},M)}return u("stopScrollWatch",U),E(()=>{console.log("mainLayout beforeMount"),document.body.style.backgroun="none"}),F(()=>{x.set("lastPath",l.path),console.log("mainLayout Mounted"),p()}),(M,mt)=>{const W=st("router-view");return _(),N(R,null,[o(ut,{ref_key:"refAuth",ref:d},null,512),t.value?(_(),C(W,{key:0})):P("",!0),t.value?(_(),C(dt,{key:1})):P("",!0)],64)}}};export{St as default};
