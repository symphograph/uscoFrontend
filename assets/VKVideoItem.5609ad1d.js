import{d as ue,i as Z,r as C,c as Y,m as n,n as p,q as e,v as K,b as ae,G as ie,f as u,y as N,t as f,u as D,l as V,bi as te,D as q,bk as le,bl as oe,F as J,bm as me,A,x as X,p as G,B as ee,ax as R,aY as De,E as ce}from"./index.f5e978c0.js";import{b as M,Q as T,a as Ce}from"./QImg.628e9f39.js";import{Q as k}from"./QItemLabel.4c832645.js";import{d as ge,e as be,b as Ve}from"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.990b59f1.js";import{Q as Ee}from"./QList.c6e92f7b.js";import{Q as ne}from"./QSelect.ed6de9a4.js";/* empty css               */import{W as Se,T as W,V as de}from"./lib.ab987395.js";import{u as h}from"./use-quasar.cdf0ea62.js";import{_ as _e}from"./BtnDelete.921da25f.js";import{i as we}from"./myFuncts.28762f14.js";import{u as Te}from"./myAxios.e0606f23.js";import{m as ye}from"./entry.f6555cc6.js";import{_ as $e}from"./plugin-vue_export-helper.21dcd24c.js";const ke=ue({__name:"TimeCodeDialog",props:{video:{type:Object,required:!0},timeCode:{type:Object,default:()=>({id:0,start:"00:00:00",uLabel:"",type:"init"})}},emits:["onDelete","onSave"],setup(o,{emit:Q}){const S=h(),m=Z("isTCodeDialogOpen"),g=Q,F={id:0,start:"00:00:00",uLabel:"",type:"init"},d=o,y=C(d.timeCode),_=C(!1),O=C([]),E=C(),c=C(),b=Y(()=>!d.timeCode.id),L=Y(()=>b.value?E.value?c.value?"part":"work":"init":d.timeCode.type);function I(){m.value=!1}Y(()=>["work","part"].includes(y.value.type));function w(){b.value&&j(),b.value&&t()}function j(){y.value={...F},E.value=void 0,c.value=void 0}function z(){_.value=!1,b.value&&j()}function x(i){const l=i.split(":");return+l[0]*60*60+ +l[1]*60+ +l[2]}function U(i){const l=(i%60).toString(),B=Math.floor(i/60%60).toString();return`${Math.floor(i/60/60%60).toString().padStart(2,"0")}:${B.padStart(2,"0")}:${l.padStart(2,"0")}`}function H(i){const l=x(i);return i===U(l)}async function r(){_.value=!0,(b.value?await a():await W.update(S,y.value))&&(g("onSave"),I()),_.value=!1}async function a(){y.value.type=L.value;const i=y.value,l=d.video.id,B=i.start;switch(i.type){case"init":return W.addInit(S,l,B,i.uLabel);case"work":return W.addWork(S,l,B,E.value.id);case"part":return W.addPartition(S,l,B,c.value.id)}}async function t(){!d.video.announceId||(_.value=!0,O.value=await Se.getListByAnnounce(S,d.video.announceId),_.value=!1)}function s(){var i,l;(l=(i=E.value)==null?void 0:i.children)!=null&&l.length||(c.value=null),c.value=E.value.children[0]}async function $(){_.value=!0,await W.del(S,d.timeCode.id)&&(g("onDelete"),I()),_.value=!1}return(i,l)=>(n(),p(ie,{modelValue:K(m),"onUpdate:modelValue":l[5]||(l[5]=B=>ae(m)?m.value=B:null),onBeforeHide:z,onBeforeShow:w},{default:e(()=>[u(X,{bordered:"",class:"dialogArea"},{default:e(()=>{var B;return[u(N,null,{default:e(()=>[u(M,null,{default:e(()=>[u(T,null,{default:e(()=>[u(k,{caption:""},{default:e(()=>[f(D(b.value?"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434":"\u0418\u043C\u0435\u043D\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434 \u0434\u043B\u044F:"),1)]),_:1}),b.value?V("",!0):(n(),p(k,{key:0},{default:e(()=>[f(D(o.timeCode.label),1)]),_:1}))]),_:1})]),_:1})]),_:1}),u(N,null,{default:e(()=>{var P,re,se,ve,fe;return[u(te,{mask:"##:##:##",clearable:"",label:`${U(0)} - ${U(o.video.duration)}`,"onUpdate:modelValue":[l[0]||(l[0]=v=>x(String(v))),l[1]||(l[1]=v=>y.value.start=v)],rules:[v=>!!v||"* \u041E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043F\u043E\u043B\u0435",v=>H(v)||"\u041D\u0443\u0436\u0435\u043D \u0444\u043E\u0440\u043C\u0430\u0442 [HH:MM:SS]",v=>x(String(v))<=o.video.duration||"\u0417\u0430 \u043F\u0440\u0435\u0434\u0435\u043B\u0430\u043C\u0438 \u0432\u0438\u0434\u0435\u043E"],modelValue:y.value.start},null,8,["label","rules","modelValue"]),L.value==="init"?(n(),p(te,{key:0,modelValue:y.value.uLabel,"onUpdate:modelValue":l[2]||(l[2]=v=>y.value.uLabel=v),clearable:"",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u0430\u0439\u043C\u043A\u043E\u0434\u0430","stack-label":""},null,8,["modelValue"])):V("",!0),b.value?(n(),q(J,{key:1},[O.value.length?(n(),p(ne,{key:0,modelValue:E.value,"onUpdate:modelValue":[l[3]||(l[3]=v=>E.value=v),s],label:((P=E.value)==null?void 0:P.author.fioRu)||"\u041F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435",options:O.value,clearable:"","map-options":"","option-value":"id","option-label":"titleRu"},{option:e(v=>[u(M,le(oe(v.itemProps)),{default:e(()=>[u(T,null,{default:e(()=>[u(k,{caption:""},{default:e(()=>[f(D(v.opt.author.fioRu),1)]),_:2},1024),u(k,null,{default:e(()=>[f(D(v.opt.titleRu),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label","options"])):(n(),p(M,{key:1},{default:e(()=>[u(T,null,{default:e(()=>[u(k,null,{default:e(()=>l[6]||(l[6]=[f("\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0439 \u043F\u0443\u0441\u0442")])),_:1}),o.video.announceId?(n(),p(k,{key:0,caption:""},{default:e(()=>l[7]||(l[7]=[f(" \u041F\u043E\u0445\u043E\u0436\u0435, \u0432 \u0430\u043D\u043E\u043D\u0441\u0435 \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u0430 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430 \u043A\u043E\u043D\u0446\u0435\u043D\u0442\u0430. ")])),_:1})):(n(),p(k,{key:1,caption:""},{default:e(()=>l[8]||(l[8]=[f(" \u041F\u0440\u0438\u0432\u044F\u0436\u0438\u0442\u0435 \u0432\u0438\u0434\u0435\u043E \u043A \u0430\u043D\u043E\u043D\u0441\u0443, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0439. ")])),_:1}))]),_:1})]),_:1})),(se=(re=E.value)==null?void 0:re.children)!=null&&se.length?(n(),p(ne,{key:2,modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=v=>c.value=v),options:(fe=(ve=E.value)==null?void 0:ve.children)!=null?fe:[],label:"\u0427\u0430\u0441\u0442\u044C, \u043D\u043E\u043C\u0435\u0440, \u0440\u0430\u0437\u0434\u0435\u043B",clearable:"","stack-label":"","map-options":"","option-value":"id","option-label":"title"},{option:e(v=>[u(M,le(oe(v.itemProps)),{default:e(()=>[u(T,{avatar:""},{default:e(()=>[f(D(v.opt.sortVal),1)]),_:2},1024),u(T,null,{default:e(()=>[u(k,null,{default:e(()=>[f(D(v.opt.title),1)]),_:2},1024),u(k,{caption:""},{default:e(()=>[f(D(v.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])):V("",!0)],64)):V("",!0)]}),_:1}),V("",!0),(B=E.value)!=null&&B.children.length?(n(),p(N,{key:1},{default:e(()=>[u(M,null,{default:e(()=>[u(T,null,{default:e(()=>[u(k,null,{default:e(()=>[f(D(c.value?"\u0427\u0430\u0441\u0442\u044C \u0431\u0443\u0434\u0435\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0430 \u0432 \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u043D\u043E\u0439 \u043F\u0430\u043F\u043A\u0435":"\u0411\u0443\u0434\u0435\u0442 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435 \u0431\u0435\u0437 \u0447\u0430\u0441\u0442\u0435\u0439"),1)]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0),f(" "+D(L.value)+" ",1),u(me,{align:"right"},{default:e(()=>[o.timeCode.id?(n(),p(_e,{key:0,label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C","throw-confirm":"",onOnOk:$,danger:""})):V("",!0),u(ge),u(A,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",onClick:I}),u(A,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",loading:_.value,color:"green",onClick:r},null,8,["loading"])]),_:1})]}),_:1})]),_:1},8,["modelValue"]))}}),pe=ue({__name:"TimeCodeItem",props:{video:{type:Object,required:!0},timeCode:{type:Object,required:!0}},emits:["goToMoment","onDelete","onSave"],setup(o,{emit:Q}){h();const S=Z("editMode"),m=C(!1);G("isTCodeDialogOpen",m);const g=Q;return C(!1),(F,d)=>(n(),p(M,{clickable:"",onClick:d[3]||(d[3]=y=>g("goToMoment",o.timeCode.formattedStart))},{default:e(()=>[u(T,{avatar:""},{default:e(()=>[u(k,{caption:""},{default:e(()=>[f(D(o.timeCode.start),1)]),_:1}),V("",!0)]),_:1}),u(T,null,{default:e(()=>[o.timeCode.type!=="part"?(n(),p(k,{key:0,caption:""},{default:e(()=>[f(D(o.timeCode.caption),1)]),_:1})):V("",!0),u(k,null,{default:e(()=>[f(D(o.timeCode.label),1)]),_:1}),o.timeCode.type==="part"?(n(),p(k,{key:1,caption:""},{default:e(()=>[f(D(o.timeCode.caption),1)]),_:1})):V("",!0)]),_:1}),K(S)?(n(),q(J,{key:0},[u(T,{side:""},{default:e(()=>[u(A,{icon:"edit",flat:"",round:"",onClick:d[0]||(d[0]=ee(y=>m.value=!0,["stop","prevent"]))})]),_:1}),u(ke,{timeCode:o.timeCode,onOnDelete:d[1]||(d[1]=y=>g("onDelete")),onOnSave:d[2]||(d[2]=y=>g("onSave")),video:o.video},null,8,["timeCode","video"])],64)):V("",!0)]),_:1}))}}),Be=["innerHTML"],Oe=ue({__name:"DescrDialog",props:{video:{type:Object,required:!0}},setup(o){const Q=h(),S=o,m=C(),g=C(!1),F=Z("isOpenDescrDialog");function d(){}function y(){}function _(){m.value.hide()}async function O(){g.value=!0,await de.putDescrToVK(Q,S.video.id)&&_(),g.value=!1}return(E,c)=>(n(),p(ie,{modelValue:K(F),"onUpdate:modelValue":c[0]||(c[0]=b=>ae(F)?F.value=b:null),onBeforeHide:d,onBeforeShow:y,ref_key:"refDialog",ref:m},{default:e(()=>[u(X,{bordered:""},{default:e(()=>[u(N,null,{default:e(()=>[u(M,null,{default:e(()=>[u(T,null,{default:e(()=>[u(k,null,{default:e(()=>c[1]||(c[1]=[f("\u0422\u0435\u043F\u0435\u0440\u044C \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0432\u044B\u0433\u043B\u044F\u0434\u0438\u0442 \u0442\u0430\u043A:")])),_:1})]),_:1})]),_:1})]),_:1}),u(N,null,{default:e(()=>[u(X,null,{default:e(()=>[u(N,null,{default:e(()=>{var b;return[R("section",{innerHTML:(b=o.video)==null?void 0:b.description,style:{whiteSpace:"pre-line"}},null,8,Be)]}),_:1})]),_:1})]),_:1}),u(N,null,{default:e(()=>c[2]||(c[2]=[f("\u0412\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0435\u0433\u043E \u0432 \u0438\u0441\u0445\u043E\u0434\u043D\u043E\u043C \u0432\u0438\u0434\u0435\u043E \u043D\u0430 VK \u0438\u043B\u0438 \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")])),_:1}),u(me,{align:"between"},{default:e(()=>[u(ge),u(A,{label:"\u041D\u0435 \u0441\u0435\u0439\u0447\u0430\u0441",onClick:_}),u(A,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043D\u0430 VK",color:"green",onClick:O})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ae=ue({__name:"VKVideoDialog",props:{video:{type:Object,required:!0}},emits:["onSave"],setup(o,{emit:Q}){const S=h(),m=Z("isOpenVKVideoDialog"),g=C(!1),F=Te.getApiUrl(""),d=ye.all,y=C("");function _(r){y.value=r}const O=Y(()=>{if(!y.value)return d.value;const r=y.value.toLowerCase().trim();return r?d.value.filter(a=>{var i,l,B,P;const t=((i=a.progName)==null?void 0:i.toLowerCase())||"",s=((l=a.eventTime)==null?void 0:l.toLowerCase())||"",$=((P=(B=a.Hall)==null?void 0:B.name)==null?void 0:P.toLowerCase())||"";return t.includes(r)||s.includes(r)||$.includes(r)}):d.value}),E=Q,c=o,b=C(c.video),L=C(),I=C(!1),w=C();function j(){g.value=!1}function z(){!c.video.announceId||(w.value=d.value.find(r=>r.id===c.video.announceId))}function x(){m.value=!1}function U(r){var $,i;const a=(($=r==null?void 0:r.sketch)==null?void 0:$.md5)||null,t=((i=r==null?void 0:r.sketch)==null?void 0:i.ext)||null;return we(F,a,t,100)}async function H(){g.value=!0;const r={id:w.value.id,progName:w.value.progName,eventTime:w.value.eventTime};await de.linkToAnnounce(S,c.video.id,r)&&(E("onSave"),x())}return(r,a)=>(n(),p(ie,{modelValue:K(m),"onUpdate:modelValue":a[4]||(a[4]=t=>ae(m)?m.value=t:null),onBeforeShow:z,onBeforeHide:j},{default:e(()=>[u(X,{bordered:"",class:"dialogArea"},{default:e(()=>[u(N,null,{default:e(()=>[u(ne,{modelValue:w.value,"onUpdate:modelValue":[a[0]||(a[0]=t=>w.value=t),()=>{}],options:O.value,label:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u043A\u043E\u043D\u0446\u0435\u0440\u0442","map-options":"","option-label":"progName","option-value":"id",clearable:"","use-input":"",onInputValue:_},De({option:e(t=>[u(M,le(oe(t.itemProps)),{default:e(()=>[u(T,{avatar:""},{default:e(()=>[u(Ce,{src:U(t.opt)},null,8,["src"])]),_:2},1024),u(T,null,{default:e(()=>[u(k,null,{default:e(()=>[f(D(t.opt.progName),1)]),_:2},1024),u(k,{caption:""},{default:e(()=>[f(D(t.opt.eventTime),1)]),_:2},1024),u(k,{caption:""},{default:e(()=>[f(D(t.opt.Hall.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},[w.value?{name:"append",fn:e(()=>[u(A,{icon:"save",color:"green",onClick:ee(H,["stop","prevent"]),flat:"",round:""})]),key:"0"}:void 0]),1032,["modelValue","options"])]),_:1}),u(N,null,{default:e(()=>[u(te,{modelValue:b.value.title,"onUpdate:modelValue":a[1]||(a[1]=t=>b.value.title=t),label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",onFocus:a[2]||(a[2]=t=>I.value=!0),onBlur:a[3]||(a[3]=t=>I.value=!1),ref_key:"refTitle",ref:L},{append:e(()=>[I.value?(n(),p(A,{key:0,icon:"save",color:"green",label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"})):V("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const Fe={class:"absolute-top-left text-subtitle2"},Ie={key:0,class:"absolute-top-right no-padding"},xe={key:1,class:"absolute-center",style:{"border-radius":"50%"}},Me={__name:"VKVideoItem",props:{video:{type:Object,required:!0}},emits:["onSave"],setup(o,{emit:Q}){const S=h(),m=o,g=C(m.video),F=Q;function d(){const a=g.value.announceId;return ye.findById(a)}const y=Y(()=>{const a=d();return a?`${g.value.recordedAt} - ${a.Hall.name}`:g.value.recordedAt});async function _(){F("onSave")}const O=Z("editMode"),E=C(!1),c=C(!1);G("isOpenVKVideoDialog",c);const b=C(!1);G("isOpenDescrDialog",b);const L=C(!1),I=C(!1);G("isTCodeDialogOpen",I);const w=C(!1);function j(){c.value=!0}function z(a=null){let t="https://vk.com/video";const s=`${m.video.owner_id}_${m.video.id}`;let $=`list=${m.video.access_key}`;return a&&($=`${$}&t=${a}`),`${t}${s}?${$}`}function x(a=null){const t=z(a);window.open(t,"_blank")}function U(){I.value=!0}async function H(){w.value=!0,g.value.timeCodes=await W.getList(S,m.video.id),w.value=!1}G("loadTCodes",H);async function r(){await H(),g.value.description=await de.getDescr(S,m.video.id),b.value=!0}return(a,t)=>(n(),p(X,null,{default:e(()=>[u(Ce,{style:{cursor:"pointer"},src:o.video.image[4].url,ratio:1920/1080,onMouseover:t[5]||(t[5]=s=>E.value=!0),onMouseleave:t[6]||(t[6]=s=>E.value=!1),class:"rounded-borders"},{default:e(()=>[R("div",Fe,D(y.value),1),K(O)?(n(),q("div",Ie,[u(A,{loading:w.value,icon:"edit",flat:"",onClick:t[0]||(t[0]=ee(s=>j(),["stop","prevent"]))},null,8,["loading"]),V("",!0)])):V("",!0),E.value?(n(),q("div",xe,[u(A,{icon:"play_circle",style:{cursor:"pointer"},round:"",loading:w.value,onClick:t[2]||(t[2]=s=>x())},null,8,["loading"])])):V("",!0),R("div",{class:"absolute-bottom text-center",style:{display:"flex","justify-content":"space-between"},onClick:t[4]||(t[4]=s=>x())},[t[8]||(t[8]=R("div",null,D(" "),-1)),R("div",null,D(o.video.title),1),R("div",null,[u(A,{icon:"menu",loading:w.value,onClick:t[3]||(t[3]=ee(s=>L.value=!L.value,["stop","prevent"]))},null,8,["loading"])])])]),_:1},8,["src"]),K(O)?(n(),p(Ae,{key:0,video:g.value,onOnSave:_},null,8,["video"])):V("",!0),u(be,null,{default:e(()=>[L.value?(n(),p(Ee,{key:0,separator:""},{default:e(()=>[(n(!0),q(J,null,ce(g.value.timeCodes,s=>{var $;return n(),q(J,{key:`work_${o.video.id}_${s.id}`},[($=s==null?void 0:s.children)!=null&&$.length?(n(),p(Ve,{key:0,"content-inset-level":.5},{header:e(()=>[u(M,{class:"full-width no-padding"},{default:e(()=>[u(T,null,{default:e(()=>[u(k,{caption:""},{default:e(()=>[f(D(s.caption),1)]),_:2},1024),u(k,null,{default:e(()=>[f(D(s.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),default:e(()=>[(n(!0),q(J,null,ce(s.children,(i,l)=>(n(),p(pe,{key:`part_${i.workId}_${l}`,timeCode:i,video:o.video,onOnDelete:H,onOnSave:r,onGoToMoment:x},null,8,["timeCode","video"]))),128))]),_:2},1024)):s.type!=="part"?(n(),p(pe,{key:1,video:o.video,onOnDelete:H,onGoToMoment:x,onOnSave:r,timeCode:s},null,8,["video","timeCode"])):V("",!0)],64)}),128)),K(O)?(n(),p(M,{key:0,clickable:"",onClick:t[7]||(t[7]=s=>U())},{default:e(()=>[u(T,{avatar:""},{default:e(()=>[u(A,{icon:"add"})]),_:1}),u(T,null,{default:e(()=>[u(k,null,{default:e(()=>t[9]||(t[9]=[f("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434")])),_:1})]),_:1}),u(ke,{dur:o.video.duration,video:o.video,onOnSave:r},null,8,["dur","video"]),u(Oe,{video:g.value},null,8,["video"])]),_:1})):V("",!0)]),_:1})):V("",!0)]),_:1})]),_:1}))}};var Xe=$e(Me,[["__scopeId","data-v-339161fe"]]);export{Xe as V};
