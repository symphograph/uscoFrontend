import{Q as v}from"./QItemLabel.44fa218d.js";import{b as S,Q as I}from"./QImg.17b0c661.js";import{d as T,i as B,m as r,C as Q,f as e,p as t,q as k,t as g,n as _,l as E,u as l,z as x,c as ee,a_ as te,r as y,b as le,E as ae,A as M,x as G,bi as R,bm as oe,v as ue,H as se,G as re,I as A,k as ie,F as j,B as J,ax as ne,y as K}from"./index.b51d6ac9.js";import{b as X}from"./QSlideTransition.4b2a6b78.js";import{u as de}from"./use-meta.32d17331.js";import{u as O,g as ce}from"./myFuncts.226b0de9.js";import{Q as fe}from"./QVirtualScroll.78f1d79c.js";import{Q as pe,M as me}from"./MainFooter.7a1f0a13.js";import{_ as ve}from"./BtnDelete.37cd7562.js";import{W as L,A as d}from"./lib.761978b0.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import{A as Y}from"./AuthorItem.6938789a.js";import{Q as ke}from"./QForm.030e1dac.js";/* empty css               */import"./touch.9135741d.js";import"./selection.96e83ad7.js";import"./QList.5b97fc5a.js";import"./use-virtual-scroll.9d7267f0.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./QTooltip.8f8febcf.js";import"./position-engine.846fdfaa.js";import"./myAxios.432c2c9b.js";import"./axios.12dda01d.js";const _e=T({__name:"WorkItem",props:{work:{}},emits:["onDel"],setup(D,{emit:w}){const c=O(),m=B("editMode"),h=B("genres"),a=D,o=w;function p(u){return h.value.find(C=>C.id===u)}async function b(){await L.del(c,a.work.id)&&o("onDel")}return(u,C)=>(r(),Q("div",{key:`w${u.work.id}`},[e(S,{clickable:"",to:`/work/${u.work.id}`,class:"mainCol"},{default:t(()=>[e(I,null,{default:t(()=>[e(v,null,{default:t(()=>[k(g(u.work.titleRu),1)]),_:1}),e(v,null,{default:t(()=>[k(g(u.work.titleCO),1)]),_:1}),e(v,{caption:""},{default:t(()=>[k(g(u.work.titleEn),1)]),_:1}),u.work.genreId?(r(),_(v,{key:0,caption:""},{default:t(()=>[k(g(p(u.work.genreId).name),1)]),_:1})):E("",!0)]),_:1}),e(I,{side:"",class:"opus"},{default:t(()=>[e(v,{caption:""},{default:t(()=>{var i;return[k(g((i=u.work.opus)!=null?i:"Op.?"),1)]}),_:1}),e(v,{caption:""},{default:t(()=>{var i;return[k(g((i=u.work.icatno)!=null?i:"cat\u2116.?"),1)]}),_:1}),e(v,{caption:""},{default:t(()=>{var i;return[k(g((i=u.work.catalogIndex)!=null?i:"catIdx: ?"),1)]}),_:1}),E("",!0)]),_:1}),e(I,{side:""},{default:t(()=>[l(m)?(r(),_(ve,{key:0,title:`\u0423\u0434\u0430\u043B\u0438\u0442\u044C: ${u.work.titleRu}`,flat:"",danger:"","throw-confirm":"",onOnOk:b},null,8,["title"])):E("",!0)]),_:1})]),_:1},8,["to"])]))}});var we=Z(_e,[["__scopeId","data-v-6256c6ac"]]);const ge=T({__name:"WorkList",props:{works:{},searchText:{}},emits:["onDel"],setup(D,{emit:w}){const c=D,m=ee(()=>{if(!c.searchText)return c.works;const a=c.searchText.toLowerCase();return c.works.filter(o=>(o.titleRu?o.titleRu.toLowerCase().includes(a):!1)||(o.titleEn?o.titleEn.toLowerCase().includes(a):!1))}),h=w;return(a,o)=>(r(),_(pe,{id:"scroll-area-with-virtual-scroll-1",style:{height:"100%"}},{default:t(()=>[e(fe,{items:m.value,"virtual-scroll-item-size":"40","virtual-scroll-slice-size":"30","virtual-scroll-sticky-size-start":48,"virtual-scroll-sticky-size-end":132,"scroll-target":"#scroll-area-with-virtual-scroll-1 > .scroll",style:{height:"100%"}},{default:t(({item:p})=>[(r(),_(we,{work:p,onOnDel:o[0]||(o[0]=b=>h("onDel")),key:`wrk${p.id}`},null,8,["work"]))]),after:t(()=>[te(a.$slots,"after")]),_:3},8,["items"])]),_:3}))}}),ye=T({__name:"WorkCreateDialog",props:{id:{},titleRu:{default:""},titleEn:{default:""},authorId:{},opus:{},icatno:{}},emits:["onSave"],setup(D,{emit:w}){const c=O(),m=B("isOpenWorkDialog"),a=y({...D}),o=y(!1),p=y();function b(){m.value=!1}const u=w;function C(){!U()||i()}async function i(){await L.add(c,a.value)&&(u("onSave",a.value.authorId),b())}function V(){o.value=!1}function U(){return p.value.validate()}return($,n)=>(r(),_(ae,{modelValue:l(m),"onUpdate:modelValue":n[3]||(n[3]=s=>le(m)?m.value=s:null),onBeforeHide:V},{default:t(()=>[e(ue,{bordered:"",class:"dialogArea"},{default:t(()=>[e(ke,{onSubmit:M(C,["prevent","stop"])},{default:t(()=>[e(G,null,{default:t(()=>[e(S,{style:{"font-size":"23px"}},{default:t(()=>[e(I,null,{default:t(()=>[e(v,null,{default:t(()=>n[4]||(n[4]=[k("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435")])),_:1})]),_:1})]),_:1})]),_:1}),e(G,null,{default:t(()=>[e(R,{modelValue:a.value.titleRu,"onUpdate:modelValue":n[0]||(n[0]=s=>a.value.titleRu=s),ref_key:"refTitle",ref:p,prefix:"RU","stack-label":"",label:"\u0420\u0443\u0441\u0441\u043A\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue"]),e(R,{modelValue:a.value.titleEn,"onUpdate:modelValue":n[1]||(n[1]=s=>a.value.titleEn=s),prefix:"EN","stack-label":"",label:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},null,8,["modelValue"]),e(R,{modelValue:a.value.opus,"onUpdate:modelValue":n[2]||(n[2]=s=>a.value.opus=s),prefix:"Op.",label:"\u041E\u043F\u0443\u0441","stack-label":""},null,8,["modelValue"])]),_:1}),e(oe,{align:"right"},{default:t(()=>[e(x,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",onClick:b}),e(x,{type:"submit",label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C","icon-right":"save",color:"green",flat:l(c).dark.isActive},null,8,["flat"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const he={key:0},be={key:1,class:"mainCol"},Ce={style:{display:"flex","flex-wrap":"nowrap"}},Ee=T({__name:"WorkListPage",setup(D){const w=O(),c=se(),m=re(),h=ce("\u041F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u044F");de(h);const a=B("loadingAuthors"),o=y("");A("searchText",o);const p=y(!1);A("progress",p);const b=y([]),u=B("editMode"),C=y(!1);A("isOpenWorkDialog",C);const i=y();A("work",i);async function V(s){p.value=!0;const f=await L.getListByAuthor(w,s);f&&(b.value=f),p.value=!1}async function U(s){a.value=!0;const f=await d.get(w,s);f&&(d.selected.value=f),a.value=!1}function $(){i.value={id:void 0,titleRu:"",titleEn:"",authorId:c.params.authorId,opus:"",icatno:""},C.value=!0}ie(()=>{const s=Number(c.params.authorId);if(!s){m.push({path:"/lib/author/"});return}U(s),V(s)});const n=y(!1);return(s,f)=>{var F,z,N,q,H,P;return r(),Q(j,null,[l(d).selected.value?(r(),Q(j,{key:0},[l(w).platform.is.mobile?(r(),Q("div",he,[e(S,{class:"pageTitle"},{default:t(()=>[e(v,{lines:"0"},{default:t(()=>[k(g(l(h).title),1)]),_:1})]),_:1}),e(Y,{id:l(d).selected.value.id,iofEn:(F=l(d).selected.value)==null?void 0:F.iofEn,iconUrl:(z=l(d).selected.value)==null?void 0:z.iconUrl,fioRu:(N=l(d).selected.value)==null?void 0:N.fioRu},{sections:t(()=>[e(I,{side:""},{default:t(()=>[l(u)?(r(),_(x,{key:0,onClick:$,icon:"add",round:""})):(r(),_(x,{key:1,icon:"tune",flat:"",stretch:"",onClick:f[0]||(f[0]=M(W=>n.value=!n.value,["stop","prevent"]))}))]),_:1})]),_:1},8,["id","iofEn","iconUrl","fioRu"]),e(X,null,{default:t(()=>[n.value?(r(),_(R,{key:0,modelValue:o.value,"onUpdate:modelValue":f[1]||(f[1]=W=>o.value=W),style:{width:"100%"},label:"\u0444\u0438\u043B\u044C\u0442\u0440","stack-label":"",clearable:""},{append:t(()=>[e(K,{name:"search"})]),_:1},8,["modelValue"])):E("",!0)]),_:1}),e(J)])):(r(),Q("div",be,[ne("div",Ce,[e(S,{class:"pageTitle"},{default:t(()=>[e(v,{lines:"0"},{default:t(()=>[k(g(l(h).title),1)]),_:1})]),_:1}),e(Y,{id:l(d).selected.value.id,iofEn:(q=l(d).selected.value)==null?void 0:q.iofEn,iconUrl:(H=l(d).selected.value)==null?void 0:H.iconUrl,fioRu:(P=l(d).selected.value)==null?void 0:P.fioRu},{sections:t(()=>[e(I,{side:""},{default:t(()=>[l(u)?(r(),_(x,{key:0,onClick:M($,["stop","prevent"]),icon:"add",round:""})):E("",!0)]),_:1})]),_:1},8,["id","iofEn","iconUrl","fioRu"]),e(X,null,{default:t(()=>[e(R,{modelValue:o.value,"onUpdate:modelValue":f[2]||(f[2]=W=>o.value=W),style:{width:"100%"},label:"\u0444\u0438\u043B\u044C\u0442\u0440","stack-label":"",clearable:""},{append:t(()=>[e(K,{name:"search"})]),_:1},8,["modelValue"])]),_:1})]),e(J)]))],64)):E("",!0),e(ge,{works:b.value,searchText:o.value,onOnDel:V},{after:t(()=>[e(me)]),_:1},8,["works","searchText"]),l(d).selected.value?(r(),_(ye,{key:1,authorId:l(d).selected.value.id,onOnSave:V},null,8,["authorId"])):E("",!0)],64)}}});var Je=Z(Ee,[["__scopeId","data-v-1b8d5f18"]]);export{Je as default};
