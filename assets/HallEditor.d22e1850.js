import{i as _,m as p,D as b,F as M,E as G,ax as k,f as a,v as n,bi as J,z as le,q as r,t as h,b as Y,df as ae,A as W,n as R,bk as oe,bl as ne,u as P,l as N,C as ce,r as g,bN as te,y as se,p as V,k as de,o as pe,x as me,au as D,bm as fe}from"./index.e7a4ac85.js";import{a as F}from"./axios.5c9aa56c.js";import{n as K,a as ve}from"./myFuncts.c18e673c.js";import{u as Z}from"./use-quasar.b2ee9ea6.js";import{_ as ee}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as L}from"./QTooltip.9fa97258.js";import{Q as A}from"./QItemLabel.0376b164.js";import{b as X,Q as E,a as _e}from"./QImg.da576236.js";import{Q as ie}from"./QSelect.f2ed9855.js";import"./position-engine.ce8a837e.js";import"./selection.94a39ba5.js";import"./QMenu.70146b47.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";const ye={class:"priceRow"},ke=["onClick"],be={__name:"PriceInputs",emits:["onSelectPrice"],setup(S,{emit:w}){const t=_("selectedPrice"),i=_("HallPlan");function o(s){t.value=s}const d=_("colors");function c(s){return s.priceType===t.value.priceType?"1.5em":"1em"}return(s,l)=>(p(),b("div",ye,[(p(!0),b(M,null,G(n(i).pricing,u=>(p(),b("div",{key:u.priceType,class:"priceCell"},[k("div",{style:{cursor:"pointer"},onClick:y=>o(u)},[a(J,{label:u.label,dense:"","label-color":n(d)[u.priceType][0],step:"100","input-class":"priceInput",modelValue:n(i).pricing.find(y=>y.priceType===u.priceType).price,"onUpdate:modelValue":y=>n(i).pricing.find(C=>C.priceType===u.priceType).price=y,type:"number"},null,8,["label","label-color","modelValue","onUpdate:modelValue"]),a(le,{name:"edit",color:n(d)[u.priceType][0],size:c(u)},null,8,["color","size"])],8,ke)]))),128))]))}};var we=ee(be,[["__scopeId","data-v-607c9cf6"]]);const Ce={style:{width:"100%",border:"1px solid lightgray","border-radius":"3px"}},Te={__name:"StructureInputs",setup(S){const w=_("initCells"),t=_("HallPlan"),i=_("addCountable");return(o,d)=>(p(),b(M,null,[a(J,{label:"\u0420\u044F\u0434\u043E\u0432",modelValue:n(t).structure.cntRows,"onUpdate:modelValue":d[0]||(d[0]=c=>n(t).structure.cntRows=c),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),a(J,{label:"\u042F\u0447\u0435\u0435\u043A",modelValue:n(t).structure.cntCols,"onUpdate:modelValue":d[1]||(d[1]=c=>n(t).structure.cntCols=c),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),k("div",Ce,[a(L,{delay:"300"},{default:r(()=>d[3]||(d[3]=[h("\u0412\u0441\u0435\u0433\u0434\u0430 \u0443\u0447\u0438\u0442\u044B\u0432\u0430\u0442\u044C \u044F\u0447\u0435\u0439\u043A\u0443 \u043F\u0440\u0438 \u043F\u043E\u0434\u0441\u0447\u0435\u0442\u0435 \u043C\u0435\u0441\u0442 \u0440\u044F\u0434\u0430.")])),_:1}),a(ae,{modelValue:n(i),"onUpdate:modelValue":d[2]||(d[2]=c=>Y(i)?i.value=c:null),label:"+1"},null,8,["modelValue"])]),a(W,{label:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",onClick:n(w),class:"defbtn",outline:""},null,8,["onClick"])],64))}},he={__name:"ModeSelect",setup(S){const w=[{value:"Offline",label:"\u0417\u0430\u043D\u044F\u0442\u044B\u0435 \u043C\u0435\u0441\u0442\u0430",descr:"\u041C\u0435\u0441\u0442\u0430, \u0447\u044C\u0438 \u0431\u0438\u043B\u0435\u0442\u044B \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B \u043E\u043D\u043B\u0430\u0439\u043D. \u0418\u0445 \u0437\u0430\u0431\u0440\u0430\u043B\u0438 \u043E\u0447\u043D\u043E."},{value:"Prices",label:"\u0426\u0435\u043D\u044B",descr:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u0446\u0435\u043D \u0438 \u043F\u0440\u0438\u0432\u044F\u0437\u043A\u0430 \u043C\u0435\u0441\u0442\u0430 \u043A \u0442\u0438\u043F\u0443 \u0446\u0435\u043D\u044B"},{value:"Structure",label:"\u0421\u0442\u0440\u0443\u043A\u0442\u0443\u0440\u0430 \u0417\u0430\u043B\u0430",descr:"\u041E\u0442\u043C\u0435\u0447\u0430\u0435\u0442 \u044F\u0447\u0435\u0439\u043A\u0443 \u043A\u0430\u043A \u043F\u0440\u043E\u0445\u043E\u0434 \u0438\u043B\u0438 \u043C\u0435\u0441\u0442\u043E"}],t=_("selectedMode"),i=_("selectedPrice"),o=_("colors");function d(){return t.value==="Prices"?o[i.value.priceType][0]:"amber"}return(c,s)=>(p(),R(ie,{modelValue:n(t),"onUpdate:modelValue":s[0]||(s[0]=l=>Y(t)?t.value=l:null),color:"amber","label-color":d(),outlined:"","emit-value":"","map-options":"",style:{width:"100%"},options:w,label:"\u0427\u0442\u043E \u0431\u0443\u0434\u0435\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C?"},{prepend:r(()=>[a(le,{name:"edit",color:d()},null,8,["color"])]),option:r(l=>[a(X,oe(ne(l.itemProps)),{default:r(()=>[a(E,null,{default:r(()=>[a(A,null,{default:r(()=>[h(P(l.opt.label),1)]),_:2},1024),a(A,{caption:""},{default:r(()=>[h(P(l.opt.descr),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label-color"]))}},ge=["src"],Pe={__name:"AnnounceSelect",emits:["onSelectAnnounce"],setup(S,{emit:w}){const t=Z(),i=_("announceList"),o=_("selectedAnnounce"),d=w;function c(s){let l=480;return t.platform.is.mobile&&(l=1080),String("https://sakh-orch.ru/api/")+s.folder+"/"+l+"/"+s.fileName+"?ver="+s.md5}return(s,l)=>n(i).length?(p(),R(ie,{key:0,options:n(i),modelValue:n(o),"onUpdate:modelValue":[l[0]||(l[0]=u=>Y(o)?o.value=u:null),l[1]||(l[1]=u=>d("onSelectAnnounce"))],color:"amber",outlined:"",style:{width:"100%"},"map-options":"","option-value":"id","option-label":"progName"},{selected:r(()=>[a(X,{dense:""},{default:r(()=>[a(E,null,{default:r(()=>[a(A,null,{default:r(()=>[h(P(n(o).progName),1)]),_:1}),a(A,{caption:""},{default:r(()=>[h(P(n(o).eventTime)+" | "+P(n(o).Hall.name),1)]),_:1})]),_:1})]),_:1})]),prepend:r(()=>[a(_e,{width:"50px",ratio:"16/9",src:c(n(o).Sketch)},null,8,["src"])]),option:r(u=>[a(X,oe(ne(u.itemProps)),{default:r(()=>[a(E,{avatar:""},{default:r(()=>[k("img",{style:{width:"50px"},src:c(u.opt.Sketch)},null,8,ge),N("",!0)]),_:2},1024),a(E,null,{default:r(()=>[a(A,null,{default:r(()=>[h(P(u.opt.progName),1)]),_:2},1024),a(A,{caption:""},{default:r(()=>[h(P(u.opt.Hall.name),1)]),_:2},1024),a(A,{caption:""},{default:r(()=>[h(P(u.opt.eventTime),1)]),_:2},1024)]),_:2},1024),a(E,{side:""},{default:r(()=>[N("",!0),a(ae,{disable:"",modelValue:u.opt.isShow,"onUpdate:modelValue":y=>u.opt.isShow=y,color:"green"},{default:r(()=>[a(L,null,{default:r(()=>l[2]||(l[2]=[h("\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u043D")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040),a(ce)]),_:1},8,["options","modelValue"])):N("",!0)}};const xe={class:"menuArea"},Ie={class:"menuBlock"},Se={class:"blockRow"},Ve={class:"menuBlock"},He={class:"blockRow"},$e={key:0,class:"blockRow"},Ne={__name:"HallCreatorMenu",emits:["onSelectHall","onSelectPrice","onSelectAnnounce"],setup(S,{emit:w}){Z(),_("HallPlan");const t=w,i=_("selectedMode");_("colors");function o(){t("onSelectAnnounce")}return(d,c)=>(p(),b("div",xe,[k("div",Ie,[k("div",Se,[a(Pe,{onOnSelectAnnounce:c[0]||(c[0]=s=>o())})])]),k("div",Ve,[k("div",He,[a(he)]),n(i)==="Structure"?(p(),b("div",$e,[a(Te)])):N("",!0)]),n(i)==="Prices"?(p(),R(we,{key:0})):N("",!0)]))}};var Qe=ee(Ne,[["__scopeId","data-v-af72b178"]]);const Ae={key:1,class:"forceCount"},Re={__name:"HallBuilderCell",props:{cell:Object,ticket:Object},emits:["cellClick"],setup(S,{emit:w}){const t=S,i=_("colors"),o=g(t.ticket),d=_("HallPlan"),c=_("selectedMode"),s=_("selectedPrice"),l=_("addCountable"),u=g("Invite"),y=g(0);function C(m){var v;return(v=d.value.tickets.find($=>$.cellid===m))!=null?v:!1}function x(){var m,v,$,Q;!((v=(m=o==null?void 0:o.value)==null?void 0:m.cellId)!=null&&v)||(y.value.cellId!==((Q=($=o==null?void 0:o.value)==null?void 0:$.cellId)!=null?Q:0)&&(u.value="Invite"),s.value.priceType===o.value.priceType?o.value.priceType=u.value:(u.value=o.value.priceType,o.value.priceType=s.value.priceType),y.value=o.value.cellId)}function H(m){m.exist=!m.exist,C(m.id)||d.value.tickets.push({cellId:m.id,offline:!1,seatRow:0,seatNum:0,priceType:"Invite"}),m.forceCount=!!(!m.exist&&l.value)}function O(m){switch(c.value){case"Structure":{H(m);break}case"Prices":{x();break}case"Offline":{o.value.offline=!o.value.offline;break}default:{if(m.priceType===c.value.value){m.priceType="Invite";break}m.priceType=c.value.value}}}return(m,v)=>{var $,Q,U,z;return p(),b("div",{class:"cellArea",onClick:v[0]||(v[0]=j=>O(S.cell))},[t.cell.exist?(p(),b(M,{key:0},[($=S.ticket)!=null&&$.offline?(p(),b("div",{key:0,class:"offlineCell",style:te({borderColor:n(i)[((Q=t.ticket)==null?void 0:Q.priceType)||"Invite"][1],backgroundColor:n(i)[((U=t.ticket)==null?void 0:U.priceType)||"Invite"][1]})},null,4)):(p(),b("div",{key:1,class:"availableCell",style:te({borderColor:n(i)[((z=t.ticket)==null?void 0:z.priceType)||"Invite"][1]})},[h(P(t.ticket.seatNum)+" ",1),a(L,{offset:[0,-120],"max-width":"20em",delay:300},{default:r(()=>[h(P("\u041C\u0435\u0441\u0442\u043E: "+t.ticket.seatNum),1),v[1]||(v[1]=k("br",null,null,-1)),h(" "+P("\u0420\u044F\u0434: "+t.ticket.seatRow),1),v[2]||(v[2]=k("br",null,null,-1)),h(" "+P("\u0426\u0435\u043D\u0430: "+t.ticket.priceType),1)]),_:1})],4))],64)):t.cell.forceCount?(p(),b("div",Ae,[v[4]||(v[4]=h("? ")),a(L,{offset:[0,-100],"max-width":"20em"},{default:r(()=>v[3]||(v[3]=[h(" \u041F\u043E \u043A\u0430\u043A\u0438\u043C-\u0442\u043E \u043F\u0440\u0438\u0447\u0438\u043D\u0430\u043C \u044D\u0442\u043E \u043C\u0435\u0441\u0442\u043E \u043F\u043E\u0441\u0447\u0438\u0442\u0430\u043D\u043E \u0432 \u0441\u0445\u0435\u043C\u0435, \u043D\u043E \u043D\u0430 \u0441\u0430\u043C\u043E\u043C \u0434\u0435\u043B\u0435 \u0435\u0433\u043E \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 ")])),_:1})])):N("",!0)])}}};const Ue={style:{width:"max-content",margin:"auto"}},Be={style:{margin:"auto"}},Ee={class:"rowNumber"},Me={class:"rowNumber"},Oe={__name:"HallTable",emits:["cellClick","ticket"],setup(S,{emit:w}){const t=_("HallPlan"),i=w;function o(s){i("cellClick",s)}function d(s){i("ticket",s)}function c(s){return t.value.tickets.find(l=>l.cellId===s)}return(s,l)=>n(t).tickets.length?(p(),R(se,{key:0},{default:r(()=>[k("table",Ue,[k("tbody",Be,[(p(!0),b(M,null,G(n(t).cells,(u,y)=>(p(),b("tr",{key:"row_"+y},[k("td",null,[k("div",Ee,P(n(t).structure.rowNums[y]||""),1)]),(p(!0),b(M,null,G(u,(C,x)=>(p(),b("td",{key:y+"_"+x},[(p(),R(Re,{cell:n(t).cells[C.row-1][C.col-1],"onUpdate:cell":H=>n(t).cells[C.row-1][C.col-1]=H,ticket:c(C.id),key:C.id,onCellClick:H=>o(H),onTickedClick:l[0]||(l[0]=H=>d(H))},null,8,["cell","onUpdate:cell","ticket","onCellClick"]))]))),128)),k("td",null,[k("div",Me,P(n(t).structure.rowNums[y]||""),1)])]))),128))])])]),_:1})):N("",!0)}};var ze=ee(Oe,[["__scopeId","data-v-0fddd53a"]]);const Le={class:"content"},je={style:{overflow:"auto",margin:"1em auto","min-width":"100vw"}},nt={__name:"HallEditor",setup(S){const w=String("https://sakh-orch.ru/api/"),t=Z(),i=g("Prices");V("selectedMode",i);const o=g([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);V("defaultPricing",o);const d=g({priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"});V("selectedPrice",d);const c=g({});V("selectedAnnounce",c);const s=g(!1);V("addCountable",s);const l=g({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:o.value,cells:[],tickets:[]});V("HallPlan",l),V("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]});const y=g(!1);V("progress",y);const C=g([]);V("announceList",C);const x=g(!1);function H(){i.value==="Structure"&&U(),F.post(w+"epoint/tickets/hallplan.php",{params:{method:"put",plan:l.value}}).then(e=>{var f,T,I;if(!((f=e==null?void 0:e.data)!=null&&f.result))throw new Error;t.notify(ve((I=(T=e==null?void 0:e.data)==null?void 0:T.result)!=null?I:""))}).catch(e=>{t.notify(K(e))})}async function O(){x.value=!1,l.value.cells=[];let e=[],f=[],T=0,I={};for(let B=1;B<=l.value.structure.cntRows;B++){for(let q=1;q<=l.value.structure.cntCols;q++)T++,I={id:T,row:B,col:q,exist:!0,forceCount:!1},f.push(I);e.push(f),f=[]}l.value.cells=e,await U(),await D(),x.value=!0}V("initCells",O);const m=g(0),v=g(0);function $(e){if(!e.exist&&!e.forceCount)return;if(e.forceCount){m.value++;return}if(!e.exist)return;m.value++;let f={cellId:e.id,offline:!1,seatRow:v.value,seatNum:m.value,priceType:"Invite"};l.value.tickets.push(f)}function Q(e){if(m.value=0,z(e)){l.value.structure.rowNums.push(!1);return}v.value++,l.value.structure.rowNums.push(v.value),e.forEach(f=>$(f))}async function U(){x.value=!1,v.value=0,l.value.tickets=[],l.value.structure.rowNums=[],l.value.cells.forEach(e=>Q(e)),await D(),x.value=!0,console.log("cntOfTickets:",l.value.tickets.length)}function z(e){return![...e].filter(T=>T.exist).length}function j(){F.post(w+"epoint/tickets/hallplan.php",{params:{method:"get",id:c.value.id}}).then(async e=>{var f,T,I,B;if(e.status===204){l.value.id=c.value.id,await O();return}if(!((T=(f=e==null?void 0:e.data)==null?void 0:f.data)!=null&&T.HallPlan))throw new Error;x.value=!1,l.value=(B=(I=e==null?void 0:e.data)==null?void 0:I.data)==null?void 0:B.HallPlan,await D(),x.value=!0}).catch(e=>{l.value={},t.notify(K(e))})}function re(){y.value=!0,F.post(w+"epoint/event/announce.php",{params:{method:"futureList"}}).then(e=>{var f,T,I;if(!((f=e==null?void 0:e.data)!=null&&f.result))throw new Error;C.value=(I=(T=e==null?void 0:e.data)==null?void 0:T.data)!=null?I:[],c.value=C.value[0],j()}).catch(e=>{t.notify(K(e)),C.value=[]}).finally(()=>{y.value=!1})}function ue(){switch(i.value){case"Prices":{console.log("resetTickets"),U();break}default:console.log(i.value)}}return de(()=>{}),pe(()=>{re()}),(e,f)=>(p(),b("div",Le,[a(Qe,{onOnSelectAnnounce:f[0]||(f[0]=T=>j())}),k("div",je,[a(me,{style:{width:"max-content","min-width":"80vw",padding:"2em",margin:"0 auto"},dark:""},{default:r(()=>[x.value?(p(),R(ze,{key:0})):N("",!0),a(fe,{style:{display:"flex","justify-content":"end"}},{default:r(()=>[i.value==="Prices"?(p(),R(W,{key:0,label:"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C",onClick:f[1]||(f[1]=T=>ue())})):N("",!0),a(W,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",onClick:H})]),_:1})]),_:1})])]))}};export{nt as default};
