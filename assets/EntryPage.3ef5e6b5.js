import{Q as me}from"./QVideo.0a4abdc4.js";import{d as Y,H as Z,i as z,r as U,w as fe,a as ve,m as n,C as p,ax as s,f as t,u as o,n as g,p as a,v as te,l as _,F as P,bm as ce,D as j,x as le,z as se,G as _e,I as O,o as re,bi as L,aY as ye,q as b,t as M,cq as ke,ay as ue,ak as ge,al as he,B as K,c as oe,y as we}from"./index.bc11f4d7.js";import{a as de,b as R,Q as S}from"./QImg.448eb956.js";import{Q as D}from"./QItemLabel.6f822438.js";import{u as xe}from"./use-meta.9df972cf.js";import{u as X,a as Pe,h as Ee,g as be}from"./myFuncts.d4b02984.js";import{Q as Ce}from"./QSelect.8d95d6c1.js";import{Q as ae}from"./QTooltip.dcd6f58a.js";import{Q as Ve}from"./QList.0e3b907c.js";import{Q as $e,S as Ie}from"./QInnerLoading.cbc4cb57.js";import{a as Qe}from"./style.2dc25cb4.js";import{_ as W}from"./BtnDelete.307e8830.js";import{m as Se}from"./myAuth.8de88893.js";import{P as q,a as Ue,S as Ae,E as F}from"./entry.439cf3e2.js";import{_ as ee}from"./plugin-vue_export-helper.21dcd24c.js";import{m as Be}from"./announce.d13a9b89.js";import{S as G}from"./img.c8a2a222.js";import{_ as J}from"./SketchImg.a0266007.js";import{_ as De}from"./BtnHideOrShow.00996a97.js";import{P as Oe}from"./PageShell.60dd4b3f.js";import"./QMenu.9b09f739.js";import"./position-engine.6616cb3e.js";import"./selection.295e94e6.js";import"./use-virtual-scroll.18864eed.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";/* empty css               */import"./use-file.77392fae.js";import"./get-emits-object.a3f16783.js";import"./myAxios.f72ca8da.js";import"./axios.63d2f48d.js";import"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.c49da512.js";import"./touch.9135741d.js";import"./QScrollArea.0b5361ec.js";import"./QLinearProgress.1a146b15.js";/* empty css                                                    */const Ne={class:"uploaderArea"},Me={class:"imagesArea"},Te={class:"absolute delBthArea"},Le={class:"row no-wrap"},ze=Y({__name:"PhotoUploader",emits:["onDel"],setup(H,{emit:d}){const h=X(),l=Z(),m=d,c=z("Entry"),C=z("isPhotosCompleted",()=>!1),V=U(),w=z("loading");async function N(){w.value=!0,await q.unlinkAll(h,Number(l.params.id))&&(c.value.Photos=[]),w.value=!1}function f(){return{url:q.getApiUrl(),headers:[{name:"ACCESSTOKEN",value:Se.self.AccessToken}],formFields:[{name:"entryId",value:c.value.id},{name:"method",value:"add"}]}}function $(i){console.log(i.xhr.response),V.value.reset(),A.value=!0}function y(i){var x,B,T;console.log(i.xhr.response);let I=(T=(B=JSON.parse((x=i==null?void 0:i.xhr)==null?void 0:x.response))==null?void 0:B.error)!=null?T:"";h.notify(Pe(null,I))}async function v(){c.value.Photos=await q.getList(h,Number(l.params.id)),(C()||!c.value.Photos.length)&&(A.value=!1)}function E(i){const I=`
![](${i.md5}.${i.ext})
`;Ee(I,h)}const A=U(!1);let r=null;return fe(A,i=>{i&&!r?r=setInterval(v,3e3):!i&&r&&(clearInterval(r),r=null)}),ve(()=>{r&&clearInterval(r)}),(i,I)=>(n(),p(P,null,[s("div",Ne,[t(Qe,{style:{width:"100%"},label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438 (\u0434\u043E 20)",factory:f,"max-file-size":5e7,"max-files":20,ref_key:"uploader",ref:V,onUploaded:$,onFailed:y,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)]),o(c).Photos&&o(c).Photos.length?(n(),g(te,{key:0,bordered:"",flat:"",class:"transparent"},{default:a(()=>[t(ce,{align:"right"},{default:a(()=>[t(W,{"throw-confirm":"",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",onOnOk:I[0]||(I[0]=x=>N()),title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438"}),_("",!0)]),_:1}),t(le,null,{default:a(()=>[s("div",Me,[(n(!0),p(P,null,j(o(c).Photos,(x,B)=>(n(),g(te,{key:B},{default:a(()=>[x.status==="completed"?(n(),g(de,{key:0,ratio:96/54,src:o(Ue).srcByProps(o(h),x)},null,8,["src"])):(n(),g(R,{key:1},{default:a(()=>[t(S,null,{default:a(()=>[t($e,{showing:"",label:"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0430"})]),_:1})]),_:1})),t(le,null,{default:a(()=>[s("div",Te,[t(W,{size:"0.7em","throw-confirm":"",onOnOk:T=>m("onDel",x.id),title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E",loading:o(w)},null,8,["onOnOk","loading"])]),s("div",Le,[t(se,{padding:"0.5em 1em",icon:"content_copy",label:"\u041A\u043E\u0434",onClick:T=>E(x)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])]),_:1})]),_:1})):_("",!0)],64))}});var Fe=ee(ze,[["__scopeId","data-v-ab3abfc6"]]);const Re={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},qe={class:"nimg_block",style:{position:"relative"}},We={class:"delBtnArea"},je={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},He={class:"inputArea"},Ge={class:"inputArea"},Je={class:"input"},Ke={id:"categs",class:"input"},Ye={style:{display:"flex","justify-content":"flex-end","grid-gap":"1em",padding:"1em"}},Ze={__name:"NewEditor",emits:["uploaded"],setup(H,{expose:d,emit:h}){const l=z("Entry"),m=X(),c=Z(),C=_e(),V=h,w=U([]),N=U(!1),f=U(!1);O("loading",f);const $=U("");O("pwUrl",$);function y(){return $.value?$.value:G.srcByProps(m,l.value.sketch)}async function v(){f.value=!0,await Ae.unlink(m,c.params.id)&&V("uploaded"),f.value=!1}async function E(k){if(f.value=!0,await q.unlink(m,c.params.id,k)){let u=l.value.Photos.findIndex(pe=>pe.id===k),Q=l.value.Photos[u];A(Q.md5),l.value.Photos.splice(u,1)}f.value=!1}O("unlinkPhoto",E);function A(k){const e=new RegExp(`!\\[]\\(${k}\\.[a-zA-Z0-9]+\\)`,"g"),u=l.value.markdown;l.value.markdown=l.value.markdown.replace(e,""),l.value.markdown!==u&&B()}async function r(){f.value=!0,await F.update(m,l.value)&&V("uploaded"),f.value=!1}async function i(){f.value=!0,await F.del(m,l.value.id)&&C.push({path:"/news/all"}),f.value=!1}async function I(){N.value=!0,w.value=await Be.listFuture(m,l.value.date),N.value=!1}async function x(){f.value=!0,await F.hideOrShow(m,l.value.id,!l.value.isShow)&&(l.value.isShow=!l.value.isShow),f.value=!1}async function B(){const k=await F.updateMarkdown(m,l.value.id,l.value.markdown);k&&(l.value.parsedMD=k)}O("updateMarkdown",B);function T(){return!l.value.Photos||l.value.Photos.length===0?!1:l.value.Photos.every(k=>k.status==="completed")}O("isPhotosCompleted",T);function ie(){V("uploaded")}return d({unlinkPhoto:E}),re(()=>{I()}),(k,e)=>(n(),p(P,null,[t(L,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",class:"inputArea",modelValue:o(l).title,"onUpdate:modelValue":e[0]||(e[0]=u=>o(l).title=u)},null,8,["modelValue"]),s("div",Re,[e[14]||(e[14]=s("br",null,null,-1)),e[15]||(e[15]=s("br",null,null,-1)),e[16]||(e[16]=s("br",null,null,-1)),s("div",qe,[s("div",We,[$.value?_("",!0):(n(),g(W,{key:0,title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437","throw-confirm":"",danger:"",onOnOk:e[1]||(e[1]=u=>v())}))]),t(J,{url:y()},null,8,["url"])]),s("div",je,[t(Ie,{id:o(l).id,type:"entry",onOnUploaded:ie},null,8,["id"])])]),s("div",He,[t(L,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",style:{width:"100%"},type:"textarea",autogrow:"",modelValue:o(l).descr,"onUpdate:modelValue":e[2]||(e[2]=u=>o(l).descr=u),outlined:""},null,8,["modelValue"])]),s("div",Ge,[s("div",Je,[t(L,{type:"date",modelValue:o(l).date,"onUpdate:modelValue":e[3]||(e[3]=u=>o(l).date=u),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438",onChange:e[4]||(e[4]=u=>I())},null,8,["modelValue"]),t(Ce,{modelValue:o(l).announceId,"onUpdate:modelValue":e[5]||(e[5]=u=>o(l).announceId=u),loading:N.value,options:w.value,clearable:"","emit-value":"","map-options":"","option-value":"id","option-label":"progName",label:"\u041F\u0435\u0440\u0435\u043D\u0430\u043F\u0440\u0430\u0432\u043B\u044F\u0442\u044C \u043D\u0430 \u0430\u043D\u043E\u043D\u0441","stack-label":""},ye({_:2},[w.value.length?{name:"selected-item",fn:a(u=>[u.opt?(n(),g(R,{key:0},{default:a(()=>[t(S,{avatar:""},{default:a(()=>{var Q;return[t(J,{url:o(G).srcByProps(o(m),(Q=u.opt)==null?void 0:Q.sketch)},null,8,["url"])]}),_:2},1024),t(S,null,{default:a(()=>[t(D,null,{default:a(()=>[b(M(u.opt.progName),1)]),_:2},1024),t(D,{caption:""},{default:a(()=>[b(M(u.opt.eventTime),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0)]),key:"0"}:void 0,w.value.length?{name:"option",fn:a(u=>[u.opt.isShow?(n(),g(R,ke({key:0},u.itemProps,{dense:"",class:"optionItem"}),{default:a(()=>[t(S,{avatar:""},{default:a(()=>{var Q;return[t(J,{url:o(G).srcByProps(o(m),(Q=u.opt)==null?void 0:Q.sketch)},null,8,["url"])]}),_:2},1024),t(S,null,{default:a(()=>[t(D,null,{default:a(()=>[b(M(u.opt.progName),1)]),_:2},1024),t(D,{caption:""},{default:a(()=>[b(M(u.opt.eventTime),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)):_("",!0)]),key:"1"}:void 0]),1032,["modelValue","loading","options"]),o(l).announceId?_("",!0):(n(),p(P,{key:0},[t(L,{modelValue:o(l).refName,"onUpdate:modelValue":e[6]||(e[6]=u=>o(l).refName=u),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),t(L,{modelValue:o(l).refLink,"onUpdate:modelValue":e[8]||(e[8]=u=>o(l).refLink=u),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},{append:a(()=>[t(ue,{modelValue:o(l).isExternal,"onUpdate:modelValue":e[7]||(e[7]=u=>o(l).isExternal=u),color:"green"},{default:a(()=>[t(ae,null,{default:a(()=>e[17]||(e[17]=[b("\u041F\u0440\u0438 \u043A\u043B\u0438\u043A\u0435 \u0432 \u043B\u0435\u043D\u0442\u0435 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])],64))]),s("div",Ke,[t(Ve,{bordered:"",padding:""},{default:a(()=>[t(D,{header:""},{default:a(()=>e[18]||(e[18]=[b("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")])),_:1}),(n(!0),p(P,null,j(o(l).categs,u=>ge((n(),g(R,{key:u.id,tag:"label"},{default:a(()=>[t(S,null,{default:a(()=>[t(D,null,{default:a(()=>[b(M(u.label),1)]),_:2},1024),t(D,{caption:""},{default:a(()=>[b(M(u.caption),1)]),_:2},1024)]),_:2},1024),t(S,{side:"",top:""},{default:a(()=>[t(ue,{color:"green",modelValue:u.checked,"onUpdate:modelValue":Q=>u.checked=Q,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[he]])),128))]),_:1})])]),o(l).announceId?_("",!0):(n(),p(P,{key:0},[t(Fe,{onOnDel:E}),t(K,{spaced:"2em"}),t(L,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",autogrow:"",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:o(l).markdown,"onUpdate:modelValue":[e[9]||(e[9]=u=>o(l).markdown=u),e[10]||(e[10]=u=>B())],debounce:300,dense:""},null,8,["modelValue"])],64)),s("div",Ye,[t(W,{loading:f.value,title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u043E\u0432\u043E\u0441\u0442\u044C",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u043E\u0432\u043E\u0441\u0442\u044C",danger:"",flat:"",onOnOk:e[11]||(e[11]=u=>i()),"throw-confirm":""},null,8,["loading"]),t(De,{"is-show":o(l).isShow,onOnOk:e[12]||(e[12]=u=>x()),loading:f.value,"throw-confirm":""},null,8,["is-show","loading"]),t(se,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",loading:f.value,"icon-right":"save",flat:o(m).dark.isActive,color:"green",onClick:e[13]||(e[13]=u=>r())},{default:a(()=>[t(ae,null,{default:a(()=>e[19]||(e[19]=[b("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])),_:1})]),_:1},8,["loading","flat"])]),e[20]||(e[20]=s("br",null,null,-1)),e[21]||(e[21]=s("br",null,null,-1)),e[22]||(e[22]=s("br",null,null,-1)),e[23]||(e[23]=s("br",null,null,-1)),e[24]||(e[24]=s("br",null,null,-1)),e[25]||(e[25]=s("br",null,null,-1))],64))}};var Xe=ee(Ze,[["__scopeId","data-v-12e29f00"]]);const et={class:"newsImg"},tt={key:0,class:"btnArea"},lt=Y({__name:"EntryPhoto",props:{id:{},md5:{},ext:{},size:{default:1080}},emits:["onDel"],setup(H,{emit:d}){const h=z("editMode"),l=d;return(m,c)=>(n(),p("div",et,[o(h)?(n(),p("div",tt,[t(W,{tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E","throw-confirm":"",onOnOk:c[0]||(c[0]=C=>l("onDel",m.id))})])):_("",!0),t(de,{src:o(q).getSrc(m.md5,m.ext,m.size),fit:"fill"},null,8,["src"])]))}});var ne=ee(lt,[["__scopeId","data-v-63444f80"]]);const ut={key:0,class:"contentArea"},ot={key:1,class:"contentArea"},at={key:0,class:"textBlock"},nt=["innerHTML"],st={key:1},rt={key:2,class:"videoItem"},dt={key:2,class:"content"},jt=Y({__name:"EntryPage",setup(H){const d=U();O("Entry",d);const h=X(),l=Z(),c=z("editModes").entry;O("editMode",c);const C=U(!0);O("progress",C);const V=U();xe(()=>{var y,v;return be((v=(y=d==null?void 0:d.value)==null?void 0:y.title)!=null?v:"\u041D\u043E\u0432\u043E\u0441\u0442\u044C")});async function w(){C.value=!0,d.value=await F.get(h,Number(l.params.id)),C.value=!1}const N=oe(()=>d.value.parsedMD.filter(v=>v.type==="img").map(v=>d.value.Photos.find(E=>E.id===v.fileId)).filter(Boolean)),f=oe(()=>{const y=N.value.map(v=>v.id);return d.value.Photos.filter(v=>!y.includes(v.id))});function $(y){c.value&&V.value.unlinkPhoto(y)}return re(()=>{w()}),(y,v)=>{var E,A;return n(),g(Oe,{"page-title":(A=(E=d.value)==null?void 0:E.title)!=null?A:"\u041D\u043E\u0432\u043E\u0441\u0442\u044C","no-stick-title":""},{PageContent:a(()=>[o(c)&&d.value?(n(),p("div",ut,[o(c)&&d.value?(n(),g(Xe,{key:0,onUploaded:v[0]||(v[0]=r=>w()),ref_key:"editorRef",ref:V},null,512)):_("",!0)])):_("",!0),d.value?(n(),p("div",ot,[(n(!0),p(P,null,j(d.value.parsedMD,(r,i)=>(n(),p(P,{key:i},[r.type==="text"?(n(),p("div",at,[r.content!==`
`?(n(),p("section",{key:0,innerHTML:r.content},null,8,nt)):(n(),p("br",st))])):_("",!0),r.type==="img"?(n(),g(ne,{key:1,id:r.fileId,md5:r.md5,ext:r.ext,onOnDel:$},null,8,["id","md5","ext"])):_("",!0),r.type==="video"?(n(),p("div",rt,[t(me,{ratio:16/9,src:"https://www.youtube.com/embed/"+r.content},null,8,["src"])])):_("",!0)],64))),128)),d.value.refLink?(n(),p(P,{key:0},[t(K,{spaced:"1em"}),t(R,{clickable:"",href:d.value.refLink},{default:a(()=>[t(S,{avatar:""},{default:a(()=>[t(we,{name:"link"})]),_:1}),t(S,null,{default:a(()=>[t(D,null,{default:a(()=>[b("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "+M(d.value.refName),1)]),_:1})]),_:1})]),_:1},8,["href"])],64)):_("",!0),f.value.length?(n(),p(P,{key:1},[t(K,{spaced:"2em"}),(n(!0),p(P,null,j(f.value,(r,i)=>(n(),g(ne,{key:i,id:r.id,ext:r.ext,md5:r.md5,onOnDel:$},null,8,["id","ext","md5"]))),128))],64)):_("",!0)])):C.value?_("",!0):(n(),p("div",dt,v[1]||(v[1]=[s("div",{class:"newsarea"},[s("div",{class:"narea"},[s("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1)])))]),_:1},8,["page-title"])}}});export{jt as default};
