import{Q as pe}from"./QLinearProgress.da172fe4.js";import{i as A,r as k,e as c,f as v,F as W,bW as B,H as d,G as m,at as f,g as e,z as t,c as D,A as s,_ as Z,h as C,aW as X,a8 as J,E as Q,a9 as Y,a5 as F,aY as ve,aV as ee,B as se,C as ce,O as ge,Q as he,bd as ye,bh as re,u as Te,p as j,m as be,a as we,as as G,Y as oe}from"./index.f8bce937.js";import{api as V}from"./axios.a54fe075.js";import{v as ue,e as Ce,w as Se,n as U}from"./myFuncts.5ef64f85.js";import{u as xe}from"./use-meta.38264a6c.js";import{u as de}from"./jwt-decode.esm.0f879628.js";import{Q as ie}from"./QTooltip.cccc2130.js";import{Q as Ae}from"./QImg.1fcdbbb2.js";import{b as S,Q as h,a as $}from"./QItemLabel.6b954253.js";import{Q as Ie}from"./QList.ceaa9d0c.js";import{g as Pe}from"./get-emits-object.24798346.js";import{_ as Qe}from"./TelegramForm.d2c79bfd.js";import{Q as $e}from"./QForm.34aa4b95.js";import"./position-engine.9f018488.js";import"./use-ratio.2c8c3905.js";const De={class:"cellArea"},He=s("br",null,null,-1),Ne=s("br",null,null,-1),Be=s("br",null,null,-1),Re=s("br",null,null,-1),Ee=s("br",null,null,-1),Le={__name:"HallUserCell",props:{cell:Object,ticket:Object},emits:["reserve","returnTicket"],setup(o,{emit:p}){const n=o,r=A("colors"),g=k(n.ticket);A("HallPlan");const y=p;k("Invite"),k(0);const T=A("AccessToken"),b=ue(T.value)*1;function I(){y("reserve",g.value.id)}function P(){y("returnTicket",g.value.id)}return(te,x)=>{var u,z,H,R,E,L,O;return c(),v("div",De,[o.cell.exist?(c(),v(W,{key:0},[(u=o.ticket)!=null&&u.offline?(c(),v("div",{key:0,class:"offlineCell",style:B({borderColor:d(r)[((z=n.ticket)==null?void 0:z.priceType)||"Invite"][1],backgroundColor:d(r)[((H=n.ticket)==null?void 0:H.priceType)||"Invite"][1]})},null,4)):n.ticket.userId===b?(c(),v("div",{key:1,class:"userCell",onClick:x[0]||(x[0]=K=>P()),style:B({borderColor:d(r)[((R=n.ticket)==null?void 0:R.priceType)||"Invite"][1]})},[m(f(n.ticket.seatNum)+" ",1),e(ie,{offset:[0,-120],"max-width":"20em",delay:300},{default:t(()=>[m(f("\u042D\u0442\u043E \u0412\u0430\u0448\u0435 \u043C\u0435\u0441\u0442\u043E")),He,m(" "+f("\u0420\u044F\u0434: "+n.ticket.seatRow),1),Ne,m(" "+f("\u041C\u0435\u0441\u0442\u043E: "+n.ticket.seatNum),1),Be,m(" "+f("\u0426\u0435\u043D\u0430: "+n.ticket.priceType),1)]),_:1})],4)):n.ticket.userId?(c(),v("div",{key:2,class:"offlineCell",style:B({borderColor:d(r)[((E=n.ticket)==null?void 0:E.priceType)||"Invite"][1],backgroundColor:d(r)[((L=n.ticket)==null?void 0:L.priceType)||"Invite"][1]})},null,4)):(c(),v("div",{key:3,class:"availableCell",style:B({borderColor:d(r)[((O=n.ticket)==null?void 0:O.priceType)||"Invite"][1]}),onClick:x[1]||(x[1]=K=>I())},[m(f(n.ticket.seatNum)+" ",1),e(ie,{offset:[0,-120],"max-width":"20em",delay:300},{default:t(()=>[m(f("\u0420\u044F\u0434: "+n.ticket.seatRow),1),Re,m(" "+f("\u041C\u0435\u0441\u0442\u043E: "+n.ticket.seatNum),1),Ee,m(" "+f("\u0426\u0435\u043D\u0430: "+n.ticket.priceType),1)]),_:1})],4))],64)):D("",!0)])}}};const Oe=o=>(se("data-v-1e7f3ac7"),o=o(),ce(),o),je={class:"mapLink"},Ve={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"space-between"}},Ue=Oe(()=>s("div",null,[s("div",{style:{border:"1px solid white",width:"100px",height:"100px"}})],-1)),We={__name:"TicketCard",props:{ticket:{},price:Number},emits:["reserve","returnTicket"],setup(o,{emit:p}){const n=String("https://api.sakh-orch.ru/");de();const r=A("Announce"),g=p,y=k("");function T(b){y.value=" returning",setTimeout(()=>{g("returnTicket",b)},600)}return(b,I)=>(c(),C(ee,{class:ve("ticketCard"+y.value)},{default:t(()=>[e(X,{class:"progName"},{default:t(()=>[m(f(d(r).progName),1)]),_:1}),e(S,{dense:""},{default:t(()=>[e(h,{avatar:""},{default:t(()=>[e(Ae,{width:"10em",ratio:16/9,src:d(n)+d(r).Sketch.verLink},null,8,["src"])]),_:1}),e(h,{avatar:""},{default:t(()=>[J((c(),C(S,{dense:""},{default:t(()=>[e(h,{avatar:""},{default:t(()=>[e(Q,{name:"schedule",color:"amber"})]),_:1}),e(h,null,{default:t(()=>[e($,{caption:""},{default:t(()=>[m(f(d(Ce)(d(r).eventTime)),1)]),_:1})]),_:1})]),_:1})),[[Y]]),e(S,{clickable:"",dense:"",href:d(r).Hall.map,target:"_blank"},{default:t(()=>[e(h,{avatar:""},{default:t(()=>[e(Q,{color:"amber",name:"place"})]),_:1}),e($,null,{default:t(()=>[s("span",je,f(d(r).Hall.name),1)]),_:1})]),_:1},8,["href"]),J((c(),C(S,{dense:""},{default:t(()=>[e(h,{avatar:""},{default:t(()=>[e(Q,{name:"ion-person",color:"amber"})]),_:1}),e(h,null,{default:t(()=>[e($,{lines:"1"},{default:t(()=>[m("\u0420\u044F\u0434: "+f(o.ticket.seatRow)+" | \u041C\u0435\u0441\u0442\u043E: "+f(o.ticket.seatNum),1)]),_:1})]),_:1})]),_:1})),[[Y]]),o.price?J((c(),C(S,{key:0,dense:""},{default:t(()=>[e(h,{avatar:""},{default:t(()=>[e(Q,{name:"ion-wallet",color:"amber"})]),_:1}),e(h,null,{default:t(()=>[e($,{lines:1},{default:t(()=>[m("\u0426\u0435\u043D\u0430: "+f(o.price),1)]),_:1})]),_:1})]),_:1})),[[Y]]):D("",!0)]),_:1}),e(h),e(h,{side:""},{default:t(()=>[s("div",Ve,[Ue,s("div",null,[e(F,{onClick:I[0]||(I[0]=P=>T(o.ticket.id)),flat:""},{default:t(()=>[e(Q,{name:"delete",color:"red"})]),_:1})])])]),_:1})]),_:1})]),_:1},8,["class"]))}};var Me=Z(We,[["__scopeId","data-v-1e7f3ac7"]]);function M(){const{emit:o,proxy:p}=ge(),n=k(null);function r(){n.value.show()}function g(){n.value.hide()}function y(b){o("ok",b),g()}function T(){o("hide")}return Object.assign(p,{show:r,hide:g}),{dialogRef:n,onDialogHide:T,onDialogOK:y,onDialogCancel:g}}const fe=["ok","hide"];M.emits=fe;M.emitsObject=Pe(fe);const Fe=["value"],qe=["value"],ze=["value"],Ke={__name:"VkontakteForm",props:{AccessToken:String,SessionToken:String},setup(o){const p=String("sakh-orch.ru"),n=String("https://auth.symphograph.ru/"),r=k(null);return(g,y)=>o.AccessToken?(c(),C($e,{key:0,ref_key:"formVk",ref:r,action:d(n)+"auth/vk/login.php",method:"post"},{default:t(()=>[s("input",{type:"hidden",name:"AccessToken",value:o.AccessToken},null,8,Fe),s("input",{type:"hidden",name:"SessionToken",value:o.SessionToken},null,8,qe),s("input",{type:"hidden",name:"from",value:d(p)},null,8,ze),e(F,{type:"submit","no-caps":"",align:"between",outline:!1,padding:"none",style:{width:"100%"},flat:"",dense:"",square:""},{default:t(()=>[e(S,{dense:""},{default:t(()=>[e(h,{avatar:""},{default:t(()=>[e(he,{style:{"background-color":"#e9d26c"}},{default:t(()=>[e(Q,{name:"ion-logo-vk",color:"info"})]),_:1})]),_:1}),e(h,null,{default:t(()=>[e($,{caption:""},{default:t(()=>[m("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")]),_:1}),e($,null,{default:t(()=>[m("\u0412\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["action"])):D("",!0)}};const Je=["innerHTML"],Ye={__name:"DialogLogin",props:{text:k(""),okBtnText:k("OK"),cancelBtnText:k("\u041E\u0442\u043C\u0435\u043D\u0430"),AccessToken:String,SessionToken:String},emits:[...M.emits],setup(o){const{dialogRef:p,onDialogHide:n,onDialogOK:r,onDialogCancel:g}=M();return(y,T)=>(c(),C(ye,{ref_key:"dialogRef",ref:p,onHide:d(n)},{default:t(()=>[e(ee,{class:"q-dialog-plugin DialogCard"},{default:t(()=>[e(X,{class:"DialogText"},{default:t(()=>[s("div",{innerHTML:o.text},null,8,Je)]),_:1}),e(X,null,{default:t(()=>[e(Ie,null,{default:t(()=>[e(S,null,{default:t(()=>[e(Qe,{AccessToken:o.AccessToken,SessionToken:o.SessionToken},null,8,["AccessToken","SessionToken"])]),_:1}),e(S,null,{default:t(()=>[e(Ke,{AccessToken:o.AccessToken,SessionToken:o.SessionToken},null,8,["AccessToken","SessionToken"])]),_:1})]),_:1})]),_:1}),e(re,{align:"right"},{default:t(()=>[e(F,{label:o.cancelBtnText,class:"DefBtn","no-caps":"",outline:"",onClick:d(g)},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Ge=Z(Ye,[["__scopeId","data-v-09934c76"]]);const q=o=>(se("data-v-70a5506f"),o=o(),ce(),o),Xe={class:"content"},Ze=q(()=>s("div",null,"rer",-1)),et=q(()=>s("div",null,"rer",-1)),tt=q(()=>s("div",null,"rer",-1)),at=q(()=>s("div",{class:"scene"},"\u0421\u0446\u0435\u043D\u0430",-1)),lt={class:"rowNumber"},nt={class:"rowNumber"},ot={key:0,class:"ticketList"},it={__name:"EventPage",setup(o){const p=String("https://api.sakh-orch.ru/"),n=de(),r=Te(),g=k(null),y=k([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);j("defaultPricing",y);const T=A("progress"),b=A("AccessToken"),I=A("SessionToken"),P=ue(b.value)*1,te=Se(b.value),x=k({});j("Announce",x);const u=k({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:y.value,cells:[],tickets:[]});j("HallPlan",u),j("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]});const H=k(!1),R=be(()=>[...u.value.tickets].filter(a=>a.userId===P));function E(l){var a,i;return(i=(a=u.value.pricing.find(_=>_.priceType===l.priceType))==null?void 0:a.price)!=null?i:0}function L(l){return u.value.tickets.find(a=>a.cellId===l)}function O(){n.dialog({component:Ge,componentProps:{text:"\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",okBtnText:"\u0412 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",cancelBtnText:"\u041D\u0435 \u0441\u0435\u0439\u0447\u0430\u0441",AccessToken:b.value,SessionToken:I.value},cancel:!0,persistent:!0}).onOk(()=>{}).onOk(()=>{router.push("/account")}).onCancel(()=>{}).onDismiss(()=>{})}function K(){V.post(p+"api/tickets/hallplan.php",{params:{method:"get",id:r.params.id}}).then(async l=>{var a,i,_,w;if(!((i=(a=l==null?void 0:l.data)==null?void 0:a.data)!=null&&i.HallPlan))throw new Error;H.value=!1,u.value=(w=(_=l==null?void 0:l.data)==null?void 0:_.data)==null?void 0:w.HallPlan,await oe(),H.value=!0,console.log("HallPlan loaded")}).catch(l=>{u.value={},n.notify(U(l))}).finally(()=>{T.value=!1,console.log("progress off"),oe(()=>{let l=document.getElementById("tableArea");l.scrollTo(l.clientWidth/2,0),console.log(l.scrollWidth),ke()})})}function _e(){T.value=!0,console.log("progress on"),V.post(p+"api/event/announce.php",{params:{method:"get",id:r.params.id}}).then(l=>{var a,i,_;if(!((a=l==null?void 0:l.data)!=null&&a.result))throw console.log("announce err:",l.data),new Error;x.value=(_=(i=l==null?void 0:l.data)==null?void 0:i.data)!=null?_:{},console.log("Announce loaded"),K()}).catch(l=>{n.notify(U(l))}).finally(()=>{})}function ae(l){u.value.tickets.find(a=>a.id===l).userId=P,V.post(p+"api/tickets/ticket.php",{params:{method:"reserve",id:l}}).then(a=>{var i;if(!((i=a==null?void 0:a.data)!=null&&i.result))throw new Error}).catch(a=>{u.value.tickets.find(i=>i.id===l).userId=null,n.notify(U(a)),a.response.status===403&&(u.value.tickets.find(i=>i.id===l).offline=!0)})}function le(l){u.value.tickets.find(a=>a.id===l).userId=null,V.post(p+"api/tickets/ticket.php",{params:{method:"returnTicket",id:l}}).then(a=>{var i;if(!((i=a==null?void 0:a.data)!=null&&i.result))throw new Error}).catch(a=>{u.value.tickets.find(i=>i.id===l).userId=P,n.notify(U(a))})}const ne=k(50);function ke(){setTimeout(()=>{ne.value=100},1e3)}return we(()=>{_e(),console.log(te)}),k({width:"100%",height:"100%",margin:"auto",overflow:"scroll"}),xe({title:"\u0411\u0438\u043B\u0435\u0442\u044B"}),(l,a)=>(c(),v("div",Xe,[Ze,et,tt,e(ee,{class:"card"},{default:t(()=>[d(T)?(c(),C(pe,{key:0,indeterminate:"",color:"secondary"})):D("",!0),d(T)?D("",!0):(c(),v("div",{key:1,class:"tableArea",id:"tableArea",ref_key:"tableAreaRef",ref:g},[s("div",{style:B({transform:"scale("+ne.value+"%)"})},[s("div",null,[at,s("table",null,[s("tbody",null,[(c(!0),v(W,null,G(u.value.cells,(i,_)=>(c(),v("tr",{key:"row_"+_},[s("td",null,[s("div",lt,f(u.value.structure.rowNums[_]||""),1)]),(c(!0),v(W,null,G(i,(w,me)=>(c(),v("td",{key:_+"_"+me},[(c(),C(Le,{cell:u.value.cells[w.row-1][w.col-1],"onUpdate:cell":N=>u.value.cells[w.row-1][w.col-1]=N,ticket:L(w.id),key:w.id,onReserve:a[0]||(a[0]=N=>ae(N)),onReturnTicket:a[1]||(a[1]=N=>le(N))},null,8,["cell","onUpdate:cell","ticket"]))]))),128)),s("td",null,[s("div",nt,f(u.value.structure.rowNums[_]||""),1)])]))),128))])])])],4)],512)),e(re,{style:{display:"flex","justify-content":"end",padding:"1em"}},{default:t(()=>[e(F,{label:"\u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",outline:"",color:"green",onClick:O})]),_:1})]),_:1}),u.value.tickets.length?(c(),v("div",ot,[(c(!0),v(W,null,G(R.value,i=>(c(),C(Me,{key:"tic_"+i.id,ticket:i,price:E(i),onReserve:a[2]||(a[2]=_=>ae(_)),onReturnTicket:a[3]||(a[3]=_=>le(_))},null,8,["ticket","price"]))),128))])):D("",!0)]))}};var wt=Z(it,[["__scopeId","data-v-70a5506f"]]);export{wt as default};
