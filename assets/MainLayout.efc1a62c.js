import{P as E}from"./LocalStorage.6ccd8c61.js";import{u as $}from"./use-quasar.aa6207a9.js";import{a as O}from"./axios.05724ddf.js";import{n as B,d as K}from"./myFuncts.307cdec6.js";import{u as F,i as C,r as l,p as r,k as N,o as R,l as V,m as h,n as M,q as a,f as e,Q as X,t as L,v as Y,x as S,y as Z,z as H,A as q,B as tt,C as et,D as ot,E as U,F as W,G as at,b as nt,H as st,I as lt,w as it,J as rt}from"./index.42886fbc.js";import{m as f}from"./myAuth.5621b016.js";import{H as P}from"./hall.7df29de4.js";import{u as ut}from"./use-meta.5e561af0.js";import{Q as A}from"./QItemLabel.7115a48b.js";import{Q as g,a as I}from"./QItem.a479c108.js";/* empty css               */import{Q as ct}from"./QImg.842befea.js";import{_ as dt}from"./plugin-vue_export-helper.21dcd24c.js";const T="SessionToken",w="AccessToken",ft={__name:"AuthComponent",setup(k,{expose:_}){const u=$();F();const i=C("isOptionsLoaded"),v=C("admin");async function y(){console.log("loadOptions started");const t=await P.getList(u);P.List=l(t),P.List.value.length?(i.value=!0,console.log("options Loaded")):console.error("Halls is empty")}const D=l(""),o=l("");function n(t,s,c="90d"){u.cookies.set(t,s,{expires:c,path:"/",domain:null,sameSite:"Strict",secure:!0,httpOnly:!1}),t===w&&(O.defaults.headers.common.AccessToken=s,D.value=s,f.self.AccessToken=s),t===T&&(o.value=s,f.self.SessionToken=s)}function b(){O.post(String("https://auth.symphograph.ru/")+"/api/register.php",{params:{method:"register",authType:"default"}}).then(t=>{var s,c,m,d,p;if(!((s=t==null?void 0:t.data)!=null&&s.result))throw new Error;n(w,(m=(c=t==null?void 0:t.data)==null?void 0:c.data.AccessToken)!=null?m:""),n(T,(p=(d=t==null?void 0:t.data)==null?void 0:d.data.SessionToken)!=null?p:""),y()}).catch(t=>{u.notify(B(t))})}r("register",b);function Q(){O.post(String("https://auth.symphograph.ru/")+"/api/refresh.php",{params:{method:"refresh",SessionToken:f.self.SessionToken,AccessToken:f.self.AccessToken}}).then(t=>{var s,c,m,d,p;if(!((s=t==null?void 0:t.data)!=null&&s.result))throw new Error;n(T,(m=(c=t==null?void 0:t.data)==null?void 0:c.data.SessionToken)!=null?m:""),n(w,(p=(d=t==null?void 0:t.data)==null?void 0:d.data.AccessToken)!=null?p:""),v.value=f.self.isPermit([4]),y()}).catch(t=>{var s;if(((s=t==null?void 0:t.response)==null?void 0:s.status)===401){b();return}u.notify(B(t))})}return r("refreshAccessToken",Q),_({}),N(()=>{console.log("auth beforeMounted"),O.defaults.headers.common.Accept="application/json",f.self=new f}),R(()=>{console.log("auth Mounted"),!u.cookies.getAll()[w]||!u.cookies.getAll()[T]?b():(n(T,u.cookies.getAll()[T]),n(w,u.cookies.getAll()[w]),Q())}),(t,s)=>V("",!0)}},mt={__name:"DynamicFormItem",props:{btnLabel:String,icon:String,url:String},setup(k){$();const _=k;return(u,i)=>(h(),M(I,{clickable:"",onClick:i[0]||(i[0]=v=>S(K)(k.url,{AccessToken:S(f).self.AccessToken,SessionToken:S(f).self.SessionToken}))},{default:a(()=>[e(g,{avatar:""},{default:a(()=>[e(X,null,{default:a(()=>[e(ct,{src:k.icon},null,8,["src"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(A,{caption:""},{default:a(()=>i[1]||(i[1]=[L("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),e(A,null,{default:a(()=>[L(Y(_.btnLabel),1)]),_:1})]),_:1})]),_:1}))}};const pt={__name:"LoginDialog",setup(k){const _=C("authTypes"),u=String("https://auth.symphograph.ru/"),i=C("showLoginDialog"),v=C("leftDrawerOpen");function y(){v.value=!1}return(D,o)=>(h(),M(st,{modelValue:S(i),"onUpdate:modelValue":o[3]||(o[3]=n=>nt(i)?i.value=n:null),onHide:o[4]||(o[4]=n=>y())},{default:a(()=>[e(Z,{class:"dialogArea",style:{color:"var(--dTitle)"}},{default:a(()=>[e(H,null,{default:a(()=>[e(I,{dense:""},{default:a(()=>[e(g,null,{default:a(()=>[e(A,{lines:"1",class:"cardTitle"},{default:a(()=>[e(q,{name:"lock"}),o[5]||(o[5]=L("\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0439 \u0432\u0445\u043E\u0434"))]),_:1})]),_:1}),e(g,{side:""},{default:a(()=>[e(tt,{round:"",flat:"",icon:"close",onMouseover:o[0]||(o[0]=()=>console.log("kjk")),onClick:o[1]||(o[1]=et(n=>i.value=!1,["stop","prevent"]))})]),_:1})]),_:1}),e(ot),e(I,null,{default:a(()=>[e(g,null,{default:a(()=>[e(A,null,{default:a(()=>o[6]||(o[6]=[L(" \u041F\u0440\u0435\u0434\u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D \u0434\u043B\u044F \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u043E\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430 ")])),_:1})]),_:1})]),_:1}),e(I,{clickable:"",to:"/vacancies",onClick:o[2]||(o[2]=n=>i.value=!1)},{default:a(()=>[e(g,null,{default:a(()=>[e(A,{caption:""},{default:a(()=>o[7]||(o[7]=[L(" \u0415\u0441\u043B\u0438 \u0412\u044B \u043D\u0435 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430, \u0442\u043E \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442\u0435 \u043A \u043D\u0430\u043C \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C. ")])),_:1}),e(A,{caption:""},{default:a(()=>o[8]||(o[8]=[L(" \u0423 \u043D\u0430\u0441 \u0441\u0435\u0439\u0447\u0430\u0441 \u0435\u0441\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0438\u043D\u0442\u0435\u0440\u0435\u0441\u043D\u044B\u0445 \u0432\u0430\u043A\u0430\u043D\u0441\u0438\u0439.\u{1F603} ")])),_:1})]),_:1}),e(g,{side:""},{default:a(()=>[e(q,{name:"open_in_new"})]),_:1})]),_:1})]),_:1}),e(H,null,{default:a(()=>[(h(!0),U(W,null,at(S(_),n=>(h(),M(mt,{key:n.id,btnLabel:n.label,icon:n.img,url:S(u)+n.url},null,8,["btnLabel","icon","url"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var gt=dt(pt,[["__scopeId","data-v-761e7acf"]]);const Qt={__name:"MainLayout",setup(k){lt(),ut({meta:{viewport:{name:"viewport",content:"initial-scale=1, width=device-width, user-scalable=yes"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}});const u=$(),i=F(),v=l(),y=l([{id:2,label:"\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C",url:"auth/telegram/login.php",img:"/img/auth/telegram.svg"},{id:3,label:"MailRu",url:"auth/mailru/login.php",img:"/img/auth/mailru.svg"},{id:4,label:"Discord",url:"auth/discord/login.php",img:"/img/auth/discord.svg"},{id:4,label:"V\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435",url:"auth/vkontakte/login.php",img:"/img/auth/vkontakte.svg"}]);r("authTypes",y);const D=l(!1);r("progress",D);const o=l(!1);r("entryEditMode",o);const n=l(!1);r("announceEditMode",n);const b=l(!1);r("docEditMode",b);const Q=l(!1);r("staffEditMode",Q);const t=l(!1);r("admin",t);const s=l(!1);r("leftDrawerOpen",s);const c=l(!1);r("isOptionsLoaded",c);const m=l(!1);r("showLoginDialog",m);const d=l(!0);r("scrollWatch",d);const p=l(0);r("scrollPos",p),it(i,x=>{E.set("lastPath",x.path)});function j(){E.set("CookieConfirm","1")}function z(){E.getItem("CookieConfirm")||u.notify({message:"\u041C\u044B \u0442\u043E\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C Cookies. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0431\u0435\u0437 \u043D\u0438\u0445 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442.",color:"primary",timeout:0,multiLine:!0,onDismiss:j,icon:"ion-information-circle-outline",actions:[{label:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E",color:"yellow",handler:()=>{}}]})}function G(x=500){d.value=!1,setTimeout(()=>{d.value=!0},x)}return r("stopScrollWatch",G),N(()=>{console.log("mainLayout beforeMount"),document.body.style.backgroun="none"}),R(()=>{E.set("lastPath",i.path),console.log("mainLayout Mounted"),z()}),(x,ht)=>{const J=rt("router-view");return h(),U(W,null,[e(ft,{ref_key:"refAuth",ref:v},null,512),c.value?(h(),M(J,{key:0})):V("",!0),c.value?(h(),M(gt,{key:1})):V("",!0)],64)}}};export{Qt as default};
