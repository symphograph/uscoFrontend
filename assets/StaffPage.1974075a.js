import{Q as q}from"./QTooltip.0e7277dc.js";import{i as z,r as l,p as r,o as lt,m as n,E as v,f as a,q as e,x as p,F as Q,n as d,t as _,B as g,l as c,ax as h,G as F,v as C,D as rt,Q as it,C as O,bl as nt}from"./index.bd97e9c1.js";import{Q as N}from"./QItemLabel.2de18a52.js";import{a as W,Q as y}from"./QItem.42e8eee9.js";import{a as ut}from"./QExpansionItem.0b8df4a3.js";import{Q as K}from"./QImg.8430c3f7.js";import{Q as dt}from"./QList.f2c9d2ce.js";import{h as ft,g as pt,n as x}from"./myFuncts.eda7a4d2.js";import{u as ct}from"./use-meta.efc19951.js";import{u as mt}from"./use-quasar.2b1b4907.js";import{a as A}from"./axios.ad5085a6.js";import{_ as vt,a as _t,b as gt,c as ht,d as yt}from"./AddPlayerDialog.e8684850.js";import{m as S}from"./myAuth.5621b016.js";import{P as kt}from"./PageShell.195bf33e.js";import{_ as Dt}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.55550dc5.js";import"./selection.db5b1e6e.js";import"./style.97a2fd80.js";import"./format.de7e9769.js";import"./use-file.3e8e86c0.js";import"./get-emits-object.a3f16783.js";/* empty css               */import"./BtnDelete.5480a871.js";import"./QPopupProxy.034d26ae.js";import"./use-render-cache.3aae9b27.js";import"./QMenu.3a1b066a.js";import"./ClosePopup.37ce5abd.js";import"./QToolbar.46b6485c.js";import"./QScrollArea.3d1595d7.js";import"./TouchPan.d2e1aed3.js";import"./touch.9135741d.js";import"./QLinearProgress.61f529b3.js";import"./MainFooter.76d58485.js";import"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.95e4fb79.js";import"./AnderHeader.de8c65e8.js";/* empty css                                                    */const Pt={class:"centralCol"},Qt={class:"gridArea"},Ct={key:0,class:"group"},St={class:"cardTitle"},wt={class:"lastName"},It={__name:"StaffPage",setup($t){const w=mt(),I=String("https://api.staff.sakh-orch.ru/"),k=z("editMode"),u=l(!1);r("staffEditMode",u);const m=l(!1);r("progress",m);const f=l([]);r("groups",f);const H=l(""),$=l(ft(new Date).format("YYYY-MM-DD"));r("condDate",$);const B=l(!1);r("showUploader",B),r("pwUrl",H);const J=S.self.persId(),U=l(0);r("selectedPersId",U);const E=l({});r("selectedPers",E);const V=l(null);r("selectedGroup",V);const D=l([]);r("actionDates",D);const R=z("stopScrollWatch"),T=l([{id:1,name:"\u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043D\u0442 \u0434\u0438\u0440\u0438\u0436\u0435\u0440\u0430"},{id:2,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"},{id:3,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u0433\u0440\u0443\u043F\u043F\u044B"},{id:4,name:"\u041F\u043E\u043C\u043E\u0449\u043D\u0438\u043A \u043A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440\u0430"},{id:5,name:"\u0420\u0435\u0433\u0443\u043B\u044F\u0442\u043E\u0440"}]);r("statusNames",T);const Y=l(!1);r("showStatusDialog",Y);const G=l(!1);r("showAddPlayerDialog",G);const X=l("\u0421\u043E\u0441\u0442\u0430\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"),L=pt(X.value);ct(L);function b(o=!1){return m.value=!0,D.value=[],A.post(I+"api/staff.php",{params:{method:"actionDates",force:o}}).then(t=>{var s,i;D.value=(i=(s=t==null?void 0:t.data)==null?void 0:s.data)!=null?i:[]}).catch(t=>{throw D.value=[],w.notify(x(t)),t}).finally(()=>{m.value=!1})}function M(){console.log("start loadData"),m.value=!0,A.post(I+"api/staff.php",{params:{method:"get",date:$.value}}).then(o=>{var t,s;R(),f.value=[],f.value=Object.values((s=(t=o==null?void 0:o.data)==null?void 0:t.data)!=null?s:[])}).catch(o=>{f.value=[],w.notify(x(o))}).finally(()=>{m.value=!1})}r("loadData",M);function j(){A.post(I+"/api/staff.php",{params:{method:"update",groups:f.value,date:$.value}}).then(o=>{b()}).catch(o=>{w.notify(x(o))})}function Z(o){!S.self.isPermit([1,2])||!k.value&&J!==o||(U.value=o,B.value=!0)}function tt(o){!k.value||(E.value=o,Y.value=!0)}function at(o){V.value=o,G.value=!0}function et(o){return"/img/avatars/init_ava.png"}return lt(()=>{b().then(()=>{M()})}),(o,t)=>(n(),v(Q,null,[a(kt,{"page-title":p(L).title},{ToolPanel:e(()=>[p(S).self.isPermit([1,2])&&p(k)?(n(),d(g,{key:0,icon:"update",flat:"",stretch:"",onClick:t[0]||(t[0]=s=>b(!0))},{default:e(()=>[a(q,null,{default:e(()=>t[3]||(t[3]=[_("\u0416\u0435\u0441\u0442\u043A\u043E \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u0442\u044B")])),_:1})]),_:1})):c("",!0),p(S).self.isPermit([1,2,3])?(n(),d(g,{key:1,icon:"edit",flat:"",stretch:"",color:u.value?"red":"grey",onClick:t[1]||(t[1]=s=>u.value=!u.value)},{default:e(()=>[a(q,null,{default:e(()=>t[4]||(t[4]=[_("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u043E\u0441\u0442\u0430\u0432")])),_:1})]),_:1},8,["color"])):c("",!0),a(ht)]),PageContent:e(()=>[h("div",Pt,[h("div",Qt,[(n(!0),v(Q,null,F(f.value,s=>(n(),v(Q,{key:s.groupId},[u.value||s.groupId!==200?(n(),v("div",Ct,[a(dt,null,{default:e(()=>[a(W,{dense:""},{default:e(()=>[a(y,{avatar:""},{default:e(()=>[a(N,null,{default:e(()=>[h("span",St,C(s.groupName),1)]),_:2},1024)]),_:2},1024),a(ut),u.value?(n(),d(y,{key:0,side:""},{default:e(()=>[a(g,{round:"",icon:"add",onClick:i=>at(s)},null,8,["onClick"])]),_:2},1024)):c("",!0)]),_:2},1024),a(rt,{inset:""}),t[5]||(t[5]=h("br",null,null,-1)),a(p(yt),{list:s.Players,itemKey:"persId",disabled:!u.value,group:"people"},{item:e(({element:i})=>[a(W,{clickable:u.value},{default:e(()=>[(n(),d(y,{key:0,avatar:""},{default:e(()=>[a(it,{size:"50px"},{default:e(()=>[a(K,{src:et(i==null?void 0:i.avatar),alt:"img",onClick:O(P=>Z(i.persId),["stop","prevent"]),style:{height:"100%"}},{error:e(()=>[a(K,{style:{height:"100%"},src:"/img/avatars/init_ava.png",alt:"img"})]),_:2},1032,["src","onClick"])]),_:2},1024)]),_:2},1024)),a(y,null,{default:e(()=>[a(N,null,{default:e(()=>[_(C(i.name)+" ",1),h("span",wt,C(i.lastName),1)]),_:2},1024),(n(!0),v(Q,null,F(i.statuses,(P,ot)=>(n(),d(N,{key:`${ot}_${P}`,caption:""},{default:e(()=>[_(C(T.value.find(st=>st.id===P).name),1)]),_:2},1024))),128))]),_:2},1024),p(k)?(n(),d(y,{key:1,side:"",onClick:O(P=>tt(i),["prevent","stop"])},{default:e(()=>[a(g,{icon:"edit",stretch:"",size:"1em",flat:""})]),_:2},1032,["onClick"])):c("",!0)]),_:2},1032,["clickable"])]),_:2},1032,["list","disabled"])]),_:2},1024)])):c("",!0)],64))),128))]),a(nt,{align:"right"},{default:e(()=>[u.value?(n(),d(g,{key:0,class:"goldBtn",onClick:j},{default:e(()=>t[6]||(t[6]=[_("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])),_:1})):c("",!0)]),_:1})])]),_:1},8,["page-title"]),a(vt,{onUpdated:t[2]||(t[2]=s=>M())}),a(_t),a(gt,{onOnPlayersAdd:j})],64))}};var fa=Dt(It,[["__scopeId","data-v-667aecfd"]]);export{fa as default};
