import{P as I}from"./LocalStorage.d6e5af67.js";import{u as B}from"./use-quasar.0de5ef34.js";import{a as Q}from"./axios.cfc20e25.js";import{n as V,d as z}from"./myFuncts.53913e80.js";import{u as F,i as b,r as s,p as r,k as N,o as U,l as $,m as k,n as x,q as a,f as e,Q as G,t as S,v as J,x as L,y as K,z as E,A as q,B as X,C as Y,D as Z,E as R,F as W,G as tt,b as et,H as ot,I as at,w as lt,J as nt}from"./index.a5870079.js";import{m as p}from"./myAuth.5621b016.js";import{u as st}from"./use-meta.cf01c1ff.js";import{Q as A}from"./QItemLabel.0d0b080b.js";import{Q as h,a as H}from"./QItem.3e6977f2.js";/* empty css               */import{Q as it}from"./QImg.91ad1435.js";import{_ as ut}from"./plugin-vue_export-helper.21dcd24c.js";const T="SessionToken",w="AccessToken",rt={__name:"AuthComponent",setup(_,{expose:v}){const i=B(),n=String("https://api.sakh-orch.ru/");F();const y=b("isOptionsLoaded"),C=b("admin"),M=b("Halls");function o(){console.log("loadOptions started"),Q.post(n+"api/get/options.php",{params:{}}).then(t=>{var l,c,f,m;if(!((l=t==null?void 0:t.data)!=null&&l.result))throw new Error;M.value=(m=(f=(c=t==null?void 0:t.data)==null?void 0:c.data)==null?void 0:f.Halls)!=null?m:[],y.value=!0,console.log("options Loaded")}).catch(t=>{i.notify(V(t))})}const u=s(""),P=s("");function d(t,l,c="90d"){i.cookies.set(t,l,{expires:c,path:"/",domain:null,sameSite:"Strict",secure:!0,httpOnly:!1}),t===w&&(Q.defaults.headers.common.AccessToken=l,u.value=l,p.self.AccessToken=l),t===T&&(P.value=l,p.self.SessionToken=l)}function D(){Q.post(String("https://auth.symphograph.ru/")+"/api/register.php",{params:{authType:"default"}}).then(t=>{var l,c,f,m,g;if(!((l=t==null?void 0:t.data)!=null&&l.result))throw new Error;d(w,(f=(c=t==null?void 0:t.data)==null?void 0:c.data.AccessToken)!=null?f:""),d(T,(g=(m=t==null?void 0:t.data)==null?void 0:m.data.SessionToken)!=null?g:""),o()}).catch(t=>{i.notify(V(t))})}r("register",D);function O(){Q.post(String("https://auth.symphograph.ru/")+"/api/refresh.php",{params:{SessionToken:p.self.SessionToken,AccessToken:p.self.AccessToken}}).then(t=>{var l,c,f,m,g;if(!((l=t==null?void 0:t.data)!=null&&l.result))throw new Error;d(T,(f=(c=t==null?void 0:t.data)==null?void 0:c.data.SessionToken)!=null?f:""),d(w,(g=(m=t==null?void 0:t.data)==null?void 0:m.data.AccessToken)!=null?g:""),C.value=p.self.isPermit([4]),o()}).catch(t=>{var l;if(((l=t==null?void 0:t.response)==null?void 0:l.status)===401){D();return}i.notify(V(t))})}return r("refreshAccessToken",O),v({}),N(()=>{console.log("auth beforeMounted"),Q.defaults.headers.common.Accept="application/json",p.self=new p}),U(()=>{console.log("auth Mounted"),!i.cookies.getAll()[w]||!i.cookies.getAll()[T]?D():(d(T,i.cookies.getAll()[T]),d(w,i.cookies.getAll()[w]),O())}),(t,l)=>$("",!0)}},ct={__name:"DynamicFormItem",props:{btnLabel:String,icon:String,url:String},setup(_){B();const v=_;return(i,n)=>(k(),x(H,{clickable:"",onClick:n[0]||(n[0]=y=>L(z)(_.url,{AccessToken:L(p).self.AccessToken,SessionToken:L(p).self.SessionToken}))},{default:a(()=>[e(h,{avatar:""},{default:a(()=>[e(G,null,{default:a(()=>[e(it,{src:_.icon},null,8,["src"])]),_:1})]),_:1}),e(h,null,{default:a(()=>[e(A,{caption:""},{default:a(()=>n[1]||(n[1]=[S("\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437")])),_:1}),e(A,null,{default:a(()=>[S(J(v.btnLabel),1)]),_:1})]),_:1})]),_:1}))}};const dt={__name:"LoginDialog",setup(_){const v=b("authTypes"),i=String("https://auth.symphograph.ru/"),n=b("showLoginDialog"),y=b("leftDrawerOpen");function C(){y.value=!1}return(M,o)=>(k(),x(ot,{modelValue:L(n),"onUpdate:modelValue":o[3]||(o[3]=u=>et(n)?n.value=u:null),onHide:o[4]||(o[4]=u=>C())},{default:a(()=>[e(K,{class:"dialogArea",style:{color:"var(--dTitle)"}},{default:a(()=>[e(E,null,{default:a(()=>[e(H,{dense:""},{default:a(()=>[e(h,null,{default:a(()=>[e(A,{lines:"1",class:"cardTitle"},{default:a(()=>[e(q,{name:"lock"}),o[5]||(o[5]=S("\u0421\u043B\u0443\u0436\u0435\u0431\u043D\u044B\u0439 \u0432\u0445\u043E\u0434"))]),_:1})]),_:1}),e(h,{side:""},{default:a(()=>[e(X,{round:"",flat:"",icon:"close",onMouseover:o[0]||(o[0]=()=>console.log("kjk")),onClick:o[1]||(o[1]=Y(u=>n.value=!1,["stop","prevent"]))})]),_:1})]),_:1}),e(Z),e(H,null,{default:a(()=>[e(h,null,{default:a(()=>[e(A,null,{default:a(()=>o[6]||(o[6]=[S(" \u041F\u0440\u0435\u0434\u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D \u0434\u043B\u044F \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u043E\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430 ")])),_:1})]),_:1})]),_:1}),e(H,{clickable:"",to:"/vacancies",onClick:o[2]||(o[2]=u=>n.value=!1)},{default:a(()=>[e(h,null,{default:a(()=>[e(A,{caption:""},{default:a(()=>o[7]||(o[7]=[S(" \u0415\u0441\u043B\u0438 \u0412\u044B \u043D\u0435 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430, \u0442\u043E \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442\u0435 \u043A \u043D\u0430\u043C \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C. ")])),_:1}),e(A,{caption:""},{default:a(()=>o[8]||(o[8]=[S(" \u0423 \u043D\u0430\u0441 \u0441\u0435\u0439\u0447\u0430\u0441 \u0435\u0441\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0438\u043D\u0442\u0435\u0440\u0435\u0441\u043D\u044B\u0445 \u0432\u0430\u043A\u0430\u043D\u0441\u0438\u0439.\u{1F603} ")])),_:1})]),_:1}),e(h,{side:""},{default:a(()=>[e(q,{name:"open_in_new"})]),_:1})]),_:1})]),_:1}),e(E,null,{default:a(()=>[(k(!0),R(W,null,tt(L(v),u=>(k(),x(ct,{key:u.id,btnLabel:u.label,icon:u.img,url:L(i)+u.url},null,8,["btnLabel","icon","url"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var ft=ut(dt,[["__scopeId","data-v-761e7acf"]]);const Lt={__name:"MainLayout",setup(_){at(),st({meta:{viewport:{name:"viewport",content:"initial-scale=1, width=device-width, user-scalable=yes"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}});const i=B(),n=F(),y=s(),C=s([{id:2,label:"\u0422\u0435\u043B\u0435\u0433\u0440\u0430\u043C",url:"auth/telegram/login.php",img:"/img/auth/telegram.svg"},{id:3,label:"MailRu",url:"auth/mailru/login.php",img:"/img/auth/mailru.svg"},{id:4,label:"Discord",url:"auth/discord/login.php",img:"/img/auth/discord.svg"},{id:4,label:"V\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435",url:"auth/vkontakte/login.php",img:"/img/auth/vkontakte.svg"}]);r("authTypes",C);const M=s(!1);r("progress",M);const o=s(!1);r("editMode",o);const u=s(!1);r("admin",u);const P=s(!1);r("leftDrawerOpen",P),s("gfdsg"),s("gfdsg");const d=s(!1);r("isOptionsLoaded",d);const D=s([]);r("Halls",D);const O=s(!1);r("showLoginDialog",O);const t=s(!0);r("scrollWatch",t);const l=s(0);r("scrollPos",l),lt(n,g=>{I.set("lastPath",g.path)});function c(){I.set("CookieConfirm","1")}function f(){I.getItem("CookieConfirm")||i.notify({message:"\u041C\u044B \u0442\u043E\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C Cookies. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0431\u0435\u0437 \u043D\u0438\u0445 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442.",color:"primary",timeout:0,multiLine:!0,onDismiss:c,icon:"ion-information-circle-outline",actions:[{label:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E",color:"yellow",handler:()=>{}}]})}function m(g=500){t.value=!1,setTimeout(()=>{t.value=!0},g)}return r("stopScrollWatch",m),N(()=>{console.log("mainLayout beforeMount"),document.body.style.backgroun="none"}),U(()=>{I.set("lastPath",n.path),console.log("mainLayout Mounted"),f()}),(g,mt)=>{const j=nt("router-view");return k(),R(W,null,[e(rt,{ref_key:"refAuth",ref:y},null,512),d.value?(k(),x(j,{key:0})):$("",!0),d.value?(k(),x(ft,{key:1})):$("",!0)],64)}}};export{Lt as default};
