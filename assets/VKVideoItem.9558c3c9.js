import{d as ee,i as X,r as p,c as G,m as o,n as v,p as e,u as U,b as ae,E as ie,f as u,x as q,q as r,t as b,l as V,bi as te,aY as me,z as F,C as K,bk as le,bl as oe,F as Y,bm as Ce,v as J,I as z,A as h,ax as P,D as ce}from"./index.b51d6ac9.js";import{b as L,Q as T,a as De}from"./QImg.17b0c661.js";import{Q as D}from"./QItemLabel.44fa218d.js";import{b as ge,Q as be}from"./QExpansionItem.f89f8067.js";import{Q as Ve}from"./QList.5b97fc5a.js";import{b as Ee}from"./QSlideTransition.4b2a6b78.js";import{Q as ne}from"./QSelect.6c76a8de.js";/* empty css               */import{W as Se,T as R,V as de}from"./lib.761978b0.js";import{u as Z}from"./myFuncts.226b0de9.js";import{_ as _e}from"./BtnDelete.37cd7562.js";import{m as ke}from"./announce.db0381ec.js";import{_ as we}from"./SketchImg.c9670014.js";import{_ as $e}from"./plugin-vue_export-helper.21dcd24c.js";const ye=ee({__name:"TimeCodeDialog",props:{video:{type:Object,required:!0},timeCode:{type:Object,default:()=>({id:0,start:"00:00:00",uLabel:"",type:"init"})}},emits:["onDelete","onSave"],setup(l,{emit:N}){const w=Z(),f=X("isTCodeDialogOpen"),m=N,O={id:0,start:"00:00:00",uLabel:"",type:"init"},i=l,C=p(i.timeCode),$=p(!1),I=p([]),g=p(),k=p(),E=G(()=>!i.timeCode.id),A=G(()=>E.value?g.value?k.value?"part":"work":"init":i.timeCode.type);function B(){f.value=!1}G(()=>["work","part"].includes(C.value.type));function H(){E.value&&j(),E.value&&n()}function j(){C.value={...O},g.value=void 0,k.value=void 0}function W(){$.value=!1,E.value&&j()}function Q(s){const t=s.split(":");return+t[0]*60*60+ +t[1]*60+ +t[2]}function S(s){const t=(s%60).toString(),M=Math.floor(s/60%60).toString();return`${Math.floor(s/60/60%60).toString().padStart(2,"0")}:${M.padStart(2,"0")}:${t.padStart(2,"0")}`}function y(s){const t=Q(s);return s===S(t)}async function c(){$.value=!0,(E.value?await _():await R.update(w,C.value))&&(m("onSave"),B()),$.value=!1}async function _(){C.value.type=A.value;const s=C.value,t=i.video.id,M=s.start;switch(s.type){case"init":return R.addInit(w,t,M,s.uLabel);case"work":return R.addWork(w,t,M,g.value.id);case"part":return R.addPartition(w,t,M,k.value.id)}}async function n(){!i.video.announceId||($.value=!0,I.value=await Se.getListByAnnounce(w,i.video.announceId),$.value=!1)}function d(){var s,t;(t=(s=g.value)==null?void 0:s.children)!=null&&t.length||(k.value=null),k.value=g.value.children[0]}async function x(){$.value=!0,await R.del(w,i.timeCode.id)&&(m("onDelete"),B()),$.value=!1}return(s,t)=>(o(),v(ie,{modelValue:U(f),"onUpdate:modelValue":t[6]||(t[6]=M=>ae(f)?f.value=M:null),onBeforeHide:W,onBeforeShow:H},{default:e(()=>[u(J,{bordered:"",class:"dialogArea"},{default:e(()=>{var M;return[u(q,null,{default:e(()=>[u(L,null,{default:e(()=>[u(T,null,{default:e(()=>[u(D,{caption:""},{default:e(()=>[r(b(E.value?"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434":"\u0418\u043C\u0435\u043D\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434 \u0434\u043B\u044F:"),1)]),_:1}),E.value?V("",!0):(o(),v(D,{key:0},{default:e(()=>[r(b(l.timeCode.label),1)]),_:1}))]),_:1})]),_:1})]),_:1}),u(q,null,{default:e(()=>{var ue,re,se,ve,fe;return[u(te,{mask:"##:##:##",clearable:"",label:`${S(0)} - ${S(l.video.duration)}`,"onUpdate:modelValue":[t[0]||(t[0]=a=>Q(String(a))),t[1]||(t[1]=a=>C.value.start=a)],rules:[a=>!!a||"* \u041E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043F\u043E\u043B\u0435",a=>y(a)||"\u041D\u0443\u0436\u0435\u043D \u0444\u043E\u0440\u043C\u0430\u0442 [HH:MM:SS]",a=>Q(String(a))<=l.video.duration||"\u0417\u0430 \u043F\u0440\u0435\u0434\u0435\u043B\u0430\u043C\u0438 \u0432\u0438\u0434\u0435\u043E"],modelValue:C.value.start},null,8,["label","rules","modelValue"]),A.value==="init"?(o(),v(te,{key:0,modelValue:C.value.uLabel,"onUpdate:modelValue":t[3]||(t[3]=a=>C.value.uLabel=a),clearable:"",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u0430\u0439\u043C\u043A\u043E\u0434\u0430","stack-label":""},me({_:2},[C.value.uLabel?void 0:{name:"append",fn:e(()=>[u(F,{label:"\u0432\u0441\u0442. \u0441\u043B\u043E\u0432\u043E",onClick:t[2]||(t[2]=a=>C.value.uLabel="\u0412\u0441\u0442\u0443\u043F\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u0441\u043B\u043E\u0432\u043E")})]),key:"0"}]),1032,["modelValue"])):V("",!0),E.value?(o(),K(Y,{key:1},[I.value.length?(o(),v(ne,{key:0,modelValue:g.value,"onUpdate:modelValue":[t[4]||(t[4]=a=>g.value=a),d],label:((ue=g.value)==null?void 0:ue.author.fioRu)||"\u041F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435",options:I.value,clearable:"","map-options":"","option-value":"id","option-label":"titleRu"},{option:e(a=>[u(L,le(oe(a.itemProps)),{default:e(()=>[u(T,null,{default:e(()=>[u(D,{caption:""},{default:e(()=>[r(b(a.opt.author.fioRu),1)]),_:2},1024),u(D,null,{default:e(()=>[r(b(a.opt.titleRu),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label","options"])):(o(),v(L,{key:1},{default:e(()=>[u(T,null,{default:e(()=>[u(D,null,{default:e(()=>t[7]||(t[7]=[r("\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0439 \u043F\u0443\u0441\u0442")])),_:1}),l.video.announceId?(o(),v(D,{key:0,caption:""},{default:e(()=>t[8]||(t[8]=[r(" \u041F\u043E\u0445\u043E\u0436\u0435, \u0432 \u0430\u043D\u043E\u043D\u0441\u0435 \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u0430 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430 \u043A\u043E\u043D\u0446\u0435\u043D\u0442\u0430. ")])),_:1})):(o(),v(D,{key:1,caption:""},{default:e(()=>t[9]||(t[9]=[r(" \u041F\u0440\u0438\u0432\u044F\u0436\u0438\u0442\u0435 \u0432\u0438\u0434\u0435\u043E \u043A \u0430\u043D\u043E\u043D\u0441\u0443, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0439. ")])),_:1}))]),_:1})]),_:1})),(se=(re=g.value)==null?void 0:re.children)!=null&&se.length?(o(),v(ne,{key:2,modelValue:k.value,"onUpdate:modelValue":t[5]||(t[5]=a=>k.value=a),options:(fe=(ve=g.value)==null?void 0:ve.children)!=null?fe:[],label:"\u0427\u0430\u0441\u0442\u044C, \u043D\u043E\u043C\u0435\u0440, \u0440\u0430\u0437\u0434\u0435\u043B",clearable:"","stack-label":"","map-options":"","option-value":"id","option-label":"title"},{option:e(a=>[u(L,le(oe(a.itemProps)),{default:e(()=>[u(T,{avatar:""},{default:e(()=>[r(b(a.opt.sortVal),1)]),_:2},1024),u(T,null,{default:e(()=>[u(D,null,{default:e(()=>[r(b(a.opt.title),1)]),_:2},1024),u(D,{caption:""},{default:e(()=>[r(b(a.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])):V("",!0)],64)):V("",!0)]}),_:1}),V("",!0),(M=g.value)!=null&&M.children.length?(o(),v(q,{key:1},{default:e(()=>[u(L,null,{default:e(()=>[u(T,null,{default:e(()=>[u(D,null,{default:e(()=>[r(b(k.value?"\u0427\u0430\u0441\u0442\u044C \u0431\u0443\u0434\u0435\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0430 \u0432 \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u043D\u043E\u0439 \u043F\u0430\u043F\u043A\u0435":"\u0411\u0443\u0434\u0435\u0442 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E \u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435 \u0431\u0435\u0437 \u0447\u0430\u0441\u0442\u0435\u0439"),1)]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0),r(" "+b(A.value)+" ",1),u(Ce,{align:"right"},{default:e(()=>[l.timeCode.id?(o(),v(_e,{key:0,label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C","throw-confirm":"",onOnOk:x,danger:""})):V("",!0),u(ge),u(F,{label:"\u041E\u0442\u043C\u0435\u043D\u0430",onClick:B}),u(F,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",loading:$.value,color:"green",onClick:c},null,8,["loading"])]),_:1})]}),_:1})]),_:1},8,["modelValue"]))}}),pe=ee({__name:"TimeCodeItem",props:{video:{type:Object,required:!0},timeCode:{type:Object,required:!0}},emits:["goToMoment","onDelete","onSave"],setup(l,{emit:N}){Z();const w=X("editMode"),f=p(!1);z("isTCodeDialogOpen",f);const m=N;return p(!1),(O,i)=>(o(),v(L,{clickable:"",onClick:i[3]||(i[3]=C=>m("goToMoment",l.timeCode.formattedStart))},{default:e(()=>[u(T,{avatar:""},{default:e(()=>[u(D,{caption:""},{default:e(()=>[r(b(l.timeCode.start),1)]),_:1}),V("",!0)]),_:1}),u(T,null,{default:e(()=>[l.timeCode.type!=="part"?(o(),v(D,{key:0,caption:""},{default:e(()=>[r(b(l.timeCode.caption),1)]),_:1})):V("",!0),u(D,null,{default:e(()=>[r(b(l.timeCode.label),1)]),_:1}),l.timeCode.type==="part"?(o(),v(D,{key:1,caption:""},{default:e(()=>[r(b(l.timeCode.caption),1)]),_:1})):V("",!0)]),_:1}),U(w)?(o(),K(Y,{key:0},[u(T,{side:""},{default:e(()=>[u(F,{icon:"edit",flat:"",round:"",onClick:i[0]||(i[0]=h(C=>f.value=!0,["stop","prevent"]))})]),_:1}),u(ye,{timeCode:l.timeCode,onOnDelete:i[1]||(i[1]=C=>m("onDelete")),onOnSave:i[2]||(i[2]=C=>m("onSave")),video:l.video},null,8,["timeCode","video"])],64)):V("",!0)]),_:1}))}}),Te=["innerHTML"],Be=ee({__name:"DescrDialog",props:{video:{type:Object,required:!0}},setup(l){const N=Z(),w=l,f=p(),m=p(!1),O=X("isOpenDescrDialog");function i(){}function C(){}function $(){f.value.hide()}async function I(){m.value=!0,await de.putDescrToVK(N,w.video.id)&&$(),m.value=!1}return(g,k)=>(o(),v(ie,{modelValue:U(O),"onUpdate:modelValue":k[0]||(k[0]=E=>ae(O)?O.value=E:null),onBeforeHide:i,onBeforeShow:C,ref_key:"refDialog",ref:f},{default:e(()=>[u(J,{bordered:""},{default:e(()=>[u(q,null,{default:e(()=>[u(L,null,{default:e(()=>[u(T,null,{default:e(()=>[u(D,null,{default:e(()=>k[1]||(k[1]=[r("\u0422\u0435\u043F\u0435\u0440\u044C \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0432\u044B\u0433\u043B\u044F\u0434\u0438\u0442 \u0442\u0430\u043A:")])),_:1})]),_:1})]),_:1})]),_:1}),u(q,null,{default:e(()=>[u(J,null,{default:e(()=>[u(q,null,{default:e(()=>{var E;return[P("section",{innerHTML:(E=l.video)==null?void 0:E.description,style:{whiteSpace:"pre-line"}},null,8,Te)]}),_:1})]),_:1})]),_:1}),u(q,null,{default:e(()=>k[2]||(k[2]=[r("\u0412\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0435\u0433\u043E \u0432 \u0438\u0441\u0445\u043E\u0434\u043D\u043E\u043C \u0432\u0438\u0434\u0435\u043E \u043D\u0430 VK \u0438\u043B\u0438 \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")])),_:1}),u(Ce,{align:"between"},{default:e(()=>[u(ge),u(F,{label:"\u041D\u0435 \u0441\u0435\u0439\u0447\u0430\u0441",onClick:$}),u(F,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043D\u0430 VK",color:"green",onClick:I})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Oe=ee({__name:"VKVideoDialog",props:{video:{type:Object,required:!0}},emits:["onSave"],setup(l,{emit:N}){const w=Z(),f=X("isOpenVKVideoDialog"),m=p(!1),O=ke.all,i=p("");function C(S){i.value=S}const $=G(()=>{if(!i.value)return O.value;const S=i.value.toLowerCase().trim();return S?O.value.filter(y=>{var d,x,s,t;const c=((d=y.progName)==null?void 0:d.toLowerCase())||"",_=((x=y.eventTime)==null?void 0:x.toLowerCase())||"",n=((t=(s=y.Hall)==null?void 0:s.name)==null?void 0:t.toLowerCase())||"";return c.includes(S)||_.includes(S)||n.includes(S)}):O.value}),I=N,g=l,k=p(g.video),E=p(),A=p(!1),B=p();function H(){m.value=!1}function j(){!g.video.announceId||(B.value=O.value.find(S=>S.id===g.video.announceId))}function W(){f.value=!1}async function Q(){m.value=!0;const S={id:B.value.id,progName:B.value.progName,eventTime:B.value.eventTime};await de.linkToAnnounce(w,g.video.id,S)&&(I("onSave"),W())}return(S,y)=>(o(),v(ie,{modelValue:U(f),"onUpdate:modelValue":y[4]||(y[4]=c=>ae(f)?f.value=c:null),onBeforeShow:j,onBeforeHide:H},{default:e(()=>[u(J,{bordered:"",class:"dialogArea"},{default:e(()=>[u(q,null,{default:e(()=>[u(ne,{modelValue:B.value,"onUpdate:modelValue":[y[0]||(y[0]=c=>B.value=c),()=>{}],options:$.value,label:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u043A\u043E\u043D\u0446\u0435\u0440\u0442","map-options":"","option-label":"progName","option-value":"id",clearable:"","use-input":"",onInputValue:C},me({option:e(c=>[u(L,le(oe(c.itemProps)),{default:e(()=>[u(T,{avatar:""},{default:e(()=>{var _,n;return[u(we,{ext:(_=c.opt.sketch)==null?void 0:_.ext,md5:(n=c.opt.sketch)==null?void 0:n.md5,size:100},null,8,["ext","md5"])]}),_:2},1024),u(T,null,{default:e(()=>[u(D,null,{default:e(()=>[r(b(c.opt.progName),1)]),_:2},1024),u(D,{caption:""},{default:e(()=>[r(b(c.opt.eventTime),1)]),_:2},1024),u(D,{caption:""},{default:e(()=>[r(b(c.opt.Hall.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},[B.value?{name:"append",fn:e(()=>[u(F,{icon:"save",color:"green",onClick:h(Q,["stop","prevent"]),flat:"",round:""})]),key:"0"}:void 0]),1032,["modelValue","options"])]),_:1}),u(q,null,{default:e(()=>[u(te,{modelValue:k.value.title,"onUpdate:modelValue":y[1]||(y[1]=c=>k.value.title=c),label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",onFocus:y[2]||(y[2]=c=>A.value=!0),onBlur:y[3]||(y[3]=c=>A.value=!1),ref_key:"refTitle",ref:E},{append:e(()=>[A.value?(o(),v(F,{key:0,icon:"save",color:"green",label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"})):V("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const Fe={class:"absolute-top-left text-subtitle2"},Ie={key:0,class:"absolute-top-right no-padding"},Ae={key:1,class:"absolute-center",style:{"border-radius":"50%"}},xe={__name:"VKVideoItem",props:{video:{type:Object,required:!0}},emits:["onSave"],setup(l,{emit:N}){const w=Z(),f=l,m=p(f.video),O=N;function i(){const _=m.value.announceId;return ke.findById(_)}const C=G(()=>{const _=i();return _?`${m.value.recordedAt} - ${_.Hall.name}`:m.value.recordedAt});async function $(){O("onSave")}const I=X("editMode"),g=p(!1),k=p(!1);z("isOpenVKVideoDialog",k);const E=p(!1);z("isOpenDescrDialog",E);const A=p(!1),B=p(!1);z("isTCodeDialogOpen",B);const H=p(!1);function j(){k.value=!0}function W(_=null){let n="https://vk.com/video";const d=`${f.video.owner_id}_${f.video.id}`;let x=`list=${f.video.access_key}`;return _&&(x=`${x}&t=${_}`),`${n}${d}?${x}`}function Q(_=null){const n=W(_);window.open(n,"_blank")}function S(){B.value=!0}async function y(){H.value=!0,m.value.timeCodes=await R.getList(w,f.video.id),H.value=!1}z("loadTCodes",y);async function c(){await y(),m.value.description=await de.getDescr(w,f.video.id),E.value=!0}return(_,n)=>(o(),v(J,null,{default:e(()=>[u(De,{style:{cursor:"pointer"},src:l.video.image[4].url,ratio:1920/1080,onMouseover:n[5]||(n[5]=d=>g.value=!0),onMouseleave:n[6]||(n[6]=d=>g.value=!1),class:"rounded-borders"},{default:e(()=>[P("div",Fe,b(C.value),1),U(I)?(o(),K("div",Ie,[u(F,{loading:H.value,icon:"edit",flat:"",onClick:n[0]||(n[0]=h(d=>j(),["stop","prevent"]))},null,8,["loading"]),V("",!0)])):V("",!0),g.value?(o(),K("div",Ae,[u(F,{icon:"play_circle",style:{cursor:"pointer"},round:"",loading:H.value,onClick:n[2]||(n[2]=d=>Q())},null,8,["loading"])])):V("",!0),P("div",{class:"absolute-bottom text-center",style:{display:"flex","justify-content":"space-between"},onClick:n[4]||(n[4]=d=>Q())},[n[8]||(n[8]=P("div",null,b(" "),-1)),P("div",null,b(l.video.title),1),P("div",null,[u(F,{icon:"menu",loading:H.value,onClick:n[3]||(n[3]=h(d=>A.value=!A.value,["stop","prevent"]))},null,8,["loading"])])])]),_:1},8,["src"]),U(I)?(o(),v(Oe,{key:0,video:m.value,onOnSave:$},null,8,["video"])):V("",!0),u(Ee,null,{default:e(()=>[A.value?(o(),v(Ve,{key:0,separator:""},{default:e(()=>[(o(!0),K(Y,null,ce(m.value.timeCodes,d=>{var x;return o(),K(Y,{key:`work_${l.video.id}_${d.id}`},[(x=d==null?void 0:d.children)!=null&&x.length?(o(),v(be,{key:0,"content-inset-level":.5},{header:e(()=>[u(L,{class:"full-width no-padding"},{default:e(()=>[u(T,null,{default:e(()=>[u(D,{caption:""},{default:e(()=>[r(b(d.caption),1)]),_:2},1024),u(D,null,{default:e(()=>[r(b(d.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),default:e(()=>[(o(!0),K(Y,null,ce(d.children,(s,t)=>(o(),v(pe,{key:`part_${s.workId}_${t}`,timeCode:s,video:l.video,onOnDelete:y,onOnSave:c,onGoToMoment:Q},null,8,["timeCode","video"]))),128))]),_:2},1024)):d.type!=="part"?(o(),v(pe,{key:1,video:l.video,onOnDelete:y,onGoToMoment:Q,onOnSave:c,timeCode:d},null,8,["video","timeCode"])):V("",!0)],64)}),128)),U(I)?(o(),v(L,{key:0,clickable:"",onClick:n[7]||(n[7]=d=>S())},{default:e(()=>[u(T,{avatar:""},{default:e(()=>[u(F,{icon:"add"})]),_:1}),u(T,null,{default:e(()=>[u(D,null,{default:e(()=>n[9]||(n[9]=[r("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u043A\u043E\u0434")])),_:1})]),_:1}),u(ye,{dur:l.video.duration,video:l.video,onOnSave:c},null,8,["dur","video"]),u(Be,{video:m.value},null,8,["video"])]),_:1})):V("",!0)]),_:1})):V("",!0)]),_:1})]),_:1}))}};var Je=$e(xe,[["__scopeId","data-v-a043c990"]]);export{Je as V};
