import{aS as pe,c as ue,aT as me,h as m,p as i,b1 as ge,v as Y,r as x,a8 as oe,a4 as ne,aw as _e,a as he,e as be,aW as Fe,T as ye,bg as Se,w as qe,l as ke,L as xe,bf as ze,bh as we,Y as ae,a3 as Ue,N as te,bd as Ce}from"./index.b9c3de56.js";import{b as Be,h as le}from"./format.3e32b8d9.js";const Pe={...pe,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},X=50,ie=2*X,se=ie*Math.PI,Re=Math.round(se*1e3)/1e3;var Ee=ue({name:"QCircularProgress",props:{...Pe,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:v}){const{proxy:{$q:t}}=Y(),_=me(e),n=m(()=>{const F=(t.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(t.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-F}deg)`:`rotate3d(0, 0, 1, ${F-90}deg)`}}),h=m(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),b=m(()=>ie/(1-e.thickness/2)),R=m(()=>`${b.value/2} ${b.value/2} ${b.value} ${b.value}`),B=m(()=>Be(e.value,e.min,e.max)),z=m(()=>se*(1-(B.value-e.min)/(e.max-e.min))),C=m(()=>e.thickness/2*b.value);function P({thickness:F,offset:a,color:u,cls:g,rounded:w}){return i("circle",{class:"q-circular-progress__"+g+(u!==void 0?` text-${u}`:""),style:h.value,fill:"transparent",stroke:"currentColor","stroke-width":F,"stroke-dasharray":Re,"stroke-dashoffset":a,"stroke-linecap":w,cx:b.value,cy:b.value,r:X})}return()=>{const F=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&F.push(i("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:X-C.value/2,cx:b.value,cy:b.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&F.push(P({cls:"track",thickness:C.value,offset:0,color:e.trackColor})),F.push(P({cls:"circle",thickness:C.value,offset:z.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const a=[i("svg",{class:"q-circular-progress__svg",style:n.value,viewBox:R.value,"aria-hidden":"true"},F)];return e.showValue===!0&&a.push(i("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},v.default!==void 0?v.default():[i("div",B.value)])),i("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:_.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:B.value},ge(v.internal,a))}}});function M(e,v,t,_){const n=[];return e.forEach(h=>{_(h)===!0?n.push(h):v.push({failedPropValidation:t,file:h})}),n}function W(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),ne(e)}const Le={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ne=["rejected"];function je({editable:e,dnd:v,getFileInput:t,addFilesToQueue:_}){const{props:n,emit:h,proxy:b}=Y(),R=x(null),B=m(()=>n.accept!==void 0?n.accept.split(",").map(r=>(r=r.trim(),r==="*"?"*/":(r.endsWith("/*")&&(r=r.slice(0,r.length-1)),r.toUpperCase()))):null),z=m(()=>parseInt(n.maxFiles,10)),C=m(()=>parseInt(n.maxTotalSize,10));function P(r){if(e.value)if(r!==Object(r)&&(r={target:null}),r.target!==null&&r.target.matches('input[type="file"]')===!0)r.clientX===0&&r.clientY===0&&oe(r);else{const q=t();q&&q!==r.target&&q.click(r)}}function F(r){e.value&&r&&_(null,r)}function a(r,q,j,T){let o=Array.from(q||r.target.files);const y=[],U=()=>{y.length>0&&h("rejected",y)};if(n.accept!==void 0&&B.value.indexOf("*/")===-1&&(o=M(o,y,"accept",c=>B.value.some(p=>c.type.toUpperCase().startsWith(p)||c.name.toUpperCase().endsWith(p))),o.length===0))return U();if(n.maxFileSize!==void 0){const c=parseInt(n.maxFileSize,10);if(o=M(o,y,"max-file-size",p=>p.size<=c),o.length===0)return U()}if(n.multiple!==!0&&o.length>0&&(o=[o[0]]),o.forEach(c=>{c.__key=c.webkitRelativePath+c.lastModified+c.name+c.size}),T===!0){const c=j.map(p=>p.__key);o=M(o,y,"duplicate",p=>c.includes(p.__key)===!1)}if(o.length===0)return U();if(n.maxTotalSize!==void 0){let c=T===!0?j.reduce((p,O)=>p+O.size,0):0;if(o=M(o,y,"max-total-size",p=>(c+=p.size,c<=C.value)),o.length===0)return U()}if(typeof n.filter=="function"){const c=n.filter(o);o=M(o,y,"filter",p=>c.includes(p))}if(n.maxFiles!==void 0){let c=T===!0?j.length:0;if(o=M(o,y,"max-files",()=>(c++,c<=z.value)),o.length===0)return U()}if(U(),o.length>0)return o}function u(r){W(r),v.value!==!0&&(v.value=!0)}function g(r){ne(r),(r.relatedTarget!==null||_e.is.safari!==!0?r.relatedTarget!==R.value:document.elementsFromPoint(r.clientX,r.clientY).includes(R.value)===!1)===!0&&(v.value=!1)}function w(r){W(r);const q=r.dataTransfer.files;q.length>0&&_(null,q),v.value=!1}function f(r){if(v.value===!0)return i("div",{ref:R,class:`q-${r}__dnd absolute-full`,onDragenter:W,onDragover:W,onDragleave:g,onDrop:w})}return Object.assign(b,{pickFiles:P,addFiles:F}),{pickFiles:P,addFiles:F,onDragover:u,onDragleave:g,processFiles:a,getDndNode:f,maxFilesNumber:z,maxTotalSizeNumber:C}}function re(e){return(e*100).toFixed(2)+"%"}const Te={...he,...Le,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},de=[...Ne,"start","finish","added","removed"];function Oe(e){const v=Y(),{props:t,slots:_,emit:n,proxy:h}=v,{$q:b}=h,R=be(t,b);function B(l,d,S){if(l.__status=d,d==="idle"){l.__uploaded=0,l.__progress=0,l.__sizeLabel=le(l.size),l.__progressLabel="0.00%";return}if(d==="failed"){h.$forceUpdate();return}l.__uploaded=d==="uploaded"?l.size:S,l.__progress=d==="uploaded"?1:Math.min(.9999,l.__uploaded/l.size),l.__progressLabel=re(l.__progress),h.$forceUpdate()}const z=m(()=>t.disable!==!0&&t.readonly!==!0),C=x(!1),P=x(null),F=x(null),a={files:x([]),queuedFiles:x([]),uploadedFiles:x([]),uploadedSize:x(0),updateFileStatus:B,isAlive:()=>Fe(v)===!1},{pickFiles:u,addFiles:g,onDragover:w,onDragleave:f,processFiles:r,getDndNode:q,maxFilesNumber:j,maxTotalSizeNumber:T}=je({editable:z,dnd:C,getFileInput:J,addFilesToQueue:V});Object.assign(a,e({props:t,slots:_,emit:n,helpers:a})),a.isBusy===void 0&&(a.isBusy=x(!1));const o=x(0),y=m(()=>o.value===0?0:a.uploadedSize.value/o.value),U=m(()=>re(y.value)),c=m(()=>le(o.value)),p=m(()=>z.value===!0&&a.isUploading.value!==!0&&(t.multiple===!0||a.queuedFiles.value.length===0)&&(t.maxFiles===void 0||a.files.value.length<j.value)&&(t.maxTotalSize===void 0||o.value<T.value)),O=m(()=>z.value===!0&&a.isBusy.value!==!0&&a.isUploading.value!==!0&&a.queuedFiles.value.length>0);ye(Se,Z);const s=m(()=>"q-uploader column no-wrap"+(R.value===!0?" q-uploader--dark q-dark":"")+(t.bordered===!0?" q-uploader--bordered":"")+(t.square===!0?" q-uploader--square no-border-radius":"")+(t.flat===!0?" q-uploader--flat no-shadow":"")+(t.disable===!0?" disabled q-uploader--disable":"")+(C.value===!0?" q-uploader--dnd":"")),$=m(()=>"q-uploader__header"+(t.color!==void 0?` bg-${t.color}`:"")+(t.textColor!==void 0?` text-${t.textColor}`:""));qe(a.isUploading,(l,d)=>{d===!1&&l===!0?n("start"):d===!0&&l===!1&&n("finish")});function I(){t.disable===!1&&(a.abort(),a.uploadedSize.value=0,o.value=0,K(),a.files.value=[],a.queuedFiles.value=[],a.uploadedFiles.value=[])}function A(){t.disable===!1&&H(["uploaded"],()=>{a.uploadedFiles.value=[]})}function E(){H(["idle","failed"],({size:l})=>{o.value-=l,a.queuedFiles.value=[]})}function H(l,d){if(t.disable===!0)return;const S={files:[],size:0},L=a.files.value.filter(k=>l.indexOf(k.__status)===-1?!0:(S.size+=k.size,S.files.push(k),k.__img!==void 0&&window.URL.revokeObjectURL(k.__img.src),!1));S.files.length>0&&(a.files.value=L,d(S),n("removed",S.files))}function G(l){t.disable||(l.__status==="uploaded"?a.uploadedFiles.value=a.uploadedFiles.value.filter(d=>d.__key!==l.__key):l.__status==="uploading"?l.__abort():o.value-=l.size,a.files.value=a.files.value.filter(d=>d.__key!==l.__key?!0:(d.__img!==void 0&&window.URL.revokeObjectURL(d.__img.src),!1)),a.queuedFiles.value=a.queuedFiles.value.filter(d=>d.__key!==l.__key),n("removed",[l]))}function K(){a.files.value.forEach(l=>{l.__img!==void 0&&window.URL.revokeObjectURL(l.__img.src)})}function J(){return F.value||P.value.getElementsByClassName("q-uploader__input")[0]}function V(l,d){const S=r(l,d,a.files.value,!0),L=J();L!=null&&(L.value=""),S!==void 0&&(S.forEach(k=>{if(a.updateFileStatus(k,"idle"),o.value+=k.size,t.noThumbnails!==!0&&k.type.toUpperCase().startsWith("IMAGE")){const ee=new Image;ee.src=window.URL.createObjectURL(k),k.__img=ee}}),a.files.value=a.files.value.concat(S),a.queuedFiles.value=a.queuedFiles.value.concat(S),n("added",S),t.autoUpload===!0&&a.upload())}function ce(){O.value===!0&&a.upload()}function Q(l,d,S){if(l===!0){const L={type:"a",key:d,icon:b.iconSet.uploader[d],flat:!0,dense:!0};let k;return d==="add"?(L.onClick=u,k=Z):L.onClick=S,i(te,L,k)}}function Z(){return i("input",{ref:F,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:t.accept,multiple:t.multiple===!0?"multiple":void 0,capture:t.capture,onMousedown:oe,onClick:u,onChange:V})}function ve(){return _.header!==void 0?_.header(D):[i("div",{class:"q-uploader__header-content column"},[i("div",{class:"flex flex-center no-wrap q-gutter-xs"},[Q(a.queuedFiles.value.length>0,"removeQueue",E),Q(a.uploadedFiles.value.length>0,"removeUploaded",A),a.isUploading.value===!0?i(ae,{class:"q-uploader__spinner"}):null,i("div",{class:"col column justify-center"},[t.label!==void 0?i("div",{class:"q-uploader__title"},[t.label]):null,i("div",{class:"q-uploader__subtitle"},[c.value+" / "+U.value])]),Q(p.value,"add"),Q(t.hideUploadBtn===!1&&O.value===!0,"upload",a.upload),Q(a.isUploading.value,"clear",a.abort)])])]}function fe(){return _.list!==void 0?_.list(D):a.files.value.map(l=>i("div",{key:l.__key,class:"q-uploader__file relative-position"+(t.noThumbnails!==!0&&l.__img!==void 0?" q-uploader__file--img":"")+(l.__status==="failed"?" q-uploader__file--failed":l.__status==="uploaded"?" q-uploader__file--uploaded":""),style:t.noThumbnails!==!0&&l.__img!==void 0?{backgroundImage:'url("'+l.__img.src+'")'}:null},[i("div",{class:"q-uploader__file-header row flex-center no-wrap"},[l.__status==="failed"?i(Ue,{class:"q-uploader__file-status",name:b.iconSet.type.negative,color:"negative"}):null,i("div",{class:"q-uploader__file-header-content col"},[i("div",{class:"q-uploader__title"},[l.name]),i("div",{class:"q-uploader__subtitle row items-center no-wrap"},[l.__sizeLabel+" / "+l.__progressLabel])]),l.__status==="uploading"?i(Ee,{value:l.__progress,min:0,max:1,indeterminate:l.__progress===0}):i(te,{round:!0,dense:!0,flat:!0,icon:b.iconSet.uploader[l.__status==="uploaded"?"done":"clear"],onClick:()=>{G(l)}})])]))}ke(()=>{a.isUploading.value===!0&&a.abort(),a.files.value.length>0&&K()});const D={};for(const l in a)xe(a[l])===!0?ze(D,l,()=>a[l].value):D[l]=a[l];return Object.assign(D,{upload:ce,reset:I,removeUploadedFiles:A,removeQueuedFiles:E,removeFile:G,pickFiles:u,addFiles:g}),we(D,{canAddFiles:()=>p.value,canUpload:()=>O.value,uploadSizeLabel:()=>c.value,uploadProgressLabel:()=>U.value}),Object.assign(h,D),()=>{const l=[i("div",{class:$.value},ve()),i("div",{class:"q-uploader__list scroll"},fe()),q("uploader")];a.isBusy.value===!0&&l.push(i("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[i(ae)]));const d={ref:P,class:s.value};return p.value===!0&&Object.assign(d,{onDragover:w,onDragleave:f}),i("div",d,l)}}const $e=()=>!0;function De(e){const v={};return e.forEach(t=>{v[t]=$e}),v}const Ie=De(de);var Ae=({name:e,props:v,emits:t,injectPlugin:_})=>ue({name:e,props:{...Te,...v},emits:Ce(t)===!0?{...Ie,...t}:[...de,...t],setup(){return Oe(_)}});function N(e){return typeof e=="function"?e:()=>e}const Me={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},Qe=["factory-failed","uploaded","failed","uploading"];function We({props:e,emit:v,helpers:t}){const _=x([]),n=x([]),h=x(0),b=m(()=>({url:N(e.url),method:N(e.method),headers:N(e.headers),formFields:N(e.formFields),fieldName:N(e.fieldName),withCredentials:N(e.withCredentials),sendRaw:N(e.sendRaw),batch:N(e.batch)})),R=m(()=>h.value>0),B=m(()=>n.value.length>0);let z;function C(){_.value.forEach(u=>{u.abort()}),n.value.length>0&&(z=!0)}function P(){const u=t.queuedFiles.value.slice(0);t.queuedFiles.value=[],b.value.batch(u)?F(u):u.forEach(g=>{F([g])})}function F(u){if(h.value++,typeof e.factory!="function"){a(u,{});return}const g=e.factory(u);if(!g)v("factory-failed",new Error("QUploader: factory() does not return properly"),u),h.value--;else if(typeof g.catch=="function"&&typeof g.then=="function"){n.value.push(g);const w=f=>{t.isAlive()===!0&&(n.value=n.value.filter(r=>r!==g),n.value.length===0&&(z=!1),t.queuedFiles.value=t.queuedFiles.value.concat(u),u.forEach(r=>{t.updateFileStatus(r,"failed")}),v("factoryFailed",f,u),h.value--)};g.then(f=>{z===!0?w(new Error("Aborted")):t.isAlive()===!0&&(n.value=n.value.filter(r=>r!==g),a(u,f))}).catch(w)}else a(u,g||{})}function a(u,g){const w=new FormData,f=new XMLHttpRequest,r=(s,$)=>g[s]!==void 0?N(g[s])($):b.value[s]($),q=r("url",u);if(!q){console.error("q-uploader: invalid or no URL specified"),h.value--;return}const j=r("formFields",u);j!==void 0&&j.forEach(s=>{w.append(s.name,s.value)});let T=0,o=0,y=0,U=0,c;f.upload.addEventListener("progress",s=>{if(c===!0)return;const $=Math.min(U,s.loaded);t.uploadedSize.value+=$-y,y=$;let I=y-o;for(let A=T;I>0&&A<u.length;A++){const E=u[A];if(I>E.size)I-=E.size,T++,o+=E.size,t.updateFileStatus(E,"uploading",E.size);else{t.updateFileStatus(E,"uploading",I);return}}},!1),f.onreadystatechange=()=>{f.readyState<4||(f.status&&f.status<400?(t.uploadedFiles.value=t.uploadedFiles.value.concat(u),u.forEach(s=>{t.updateFileStatus(s,"uploaded")}),v("uploaded",{files:u,xhr:f})):(c=!0,t.uploadedSize.value-=y,t.queuedFiles.value=t.queuedFiles.value.concat(u),u.forEach(s=>{t.updateFileStatus(s,"failed")}),v("failed",{files:u,xhr:f})),h.value--,_.value=_.value.filter(s=>s!==f))},f.open(r("method",u),q),r("withCredentials",u)===!0&&(f.withCredentials=!0);const p=r("headers",u);p!==void 0&&p.forEach(s=>{f.setRequestHeader(s.name,s.value)});const O=r("sendRaw",u);u.forEach(s=>{t.updateFileStatus(s,"uploading",0),O!==!0&&w.append(r("fieldName",s),s,s.name),s.xhr=f,s.__abort=()=>{f.abort()},U+=s.size}),v("uploading",{files:u,xhr:f}),_.value.push(f),O===!0?f.send(new Blob(u)):f.send(w)}return{isUploading:R,isBusy:B,abort:C,upload:P}}var He={name:"QUploader",props:Me,emits:Qe,injectPlugin:We},Ge=Ae(He);export{Ge as Q};
