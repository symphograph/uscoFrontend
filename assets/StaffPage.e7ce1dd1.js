import{Q as j}from"./QTooltip.67a45e1b.js";import{i as q,r as l,p as r,o as it,m as d,E as m,f as t,q as e,x as v,F as Q,n as c,t as _,B as g,l as p,ax as C,G as F,v as S,D as nt,Q as dt,C as O,bm as ut,az as ct,aA as pt}from"./index.cdb55744.js";import{Q as $}from"./QItemLabel.1ffda0e9.js";import{u as ft,a as W,Q as h}from"./QItem.d03f1607.js";import{a as mt}from"./QExpansionItem.83ba4730.js";import{Q as K}from"./QImg.5dbdf016.js";import{Q as vt}from"./QList.ef1a3de3.js";import{h as H,g as _t,n as b,i as gt}from"./myFuncts.bfbbf36a.js";import{u as ht}from"./use-meta.35c26380.js";import{api as x}from"./axios.99fb408e.js";import{_ as yt,a as Dt,b as kt,c as Pt,d as Qt}from"./AddPlayerDialog.26e5db4f.js";import{m as N}from"./myAuth.f2132660.js";import"./MainFooter.vue_vue_type_style_index_0_scoped_true_lang.def8ad07.js";import{_ as St}from"./plugin-vue_export-helper.21dcd24c.js";import{P as Ct}from"./PageShell.7a519892.js";import"./position-engine.e84d1f21.js";import"./selection.519b1b62.js";import"./style.713f61fd.js";import"./format.3e32b8d9.js";import"./use-file.84a5c15f.js";import"./get-emits-object.24798346.js";/* empty css               */import"./BtnDelete.f7729f93.js";import"./QPopupProxy.0b06f872.js";import"./use-render-cache.1a7235d4.js";import"./QMenu.ae9fc987.js";import"./ClosePopup.1d290350.js";import"./QToolbar.bef3d2b7.js";import"./QScrollArea.7b61ecad.js";import"./TouchPan.4598c748.js";import"./touch.3df10340.js";import"./QLinearProgress.aee70d20.js";import"./MainFooter.8023fb59.js";import"./AnderHeader.9edb8c2b.js";/* empty css                                                    */const It=y=>(ct("data-v-36069eed"),y=y(),pt(),y),wt={class:"centralCol"},At={class:"gridArea"},Mt={key:0,class:"group"},$t={class:"cardTitle"},bt=It(()=>C("br",null,null,-1)),xt={__name:"StaffPage",setup(y){const I=ft(),D=String("https://api.staff.sakh-orch.ru/"),J=q("editMode"),i=l(!1);r("staffEditMode",i);const f=l(!1);r("progress",f);const u=l([]);r("groups",u);const R=l(""),w=l(H(new Date).format("YYYY-MM-DD"));r("condDate",w);const U=l(!1);r("showUploader",U),r("pwUrl",R);const X=N.self.persId(),Y=l(0);r("selectedPersId",Y);const B=l({});r("selectedPers",B);const E=l(null);r("selectedGroup",E);const k=l([]);r("actionDates",k);const Z=q("stopScrollWatch"),T=l([{id:1,name:"\u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043D\u0442 \u0434\u0438\u0440\u0438\u0436\u0435\u0440\u0430"},{id:2,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"},{id:3,name:"\u041A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440 \u0433\u0440\u0443\u043F\u043F\u044B"},{id:4,name:"\u041F\u043E\u043C\u043E\u0449\u043D\u0438\u043A \u043A\u043E\u043D\u0446\u0435\u0440\u0442\u043C\u0435\u0439\u0441\u0442\u0435\u0440\u0430"},{id:5,name:"\u0420\u0435\u0433\u0443\u043B\u044F\u0442\u043E\u0440"}]);r("statusNames",T);const V=l(!1);r("showStatusDialog",V);const z=l(!1);r("showAddPlayerDialog",z);const tt=l("\u0421\u043E\u0441\u0442\u0430\u0432 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430"),G=_t(tt.value);ht(G);function A(a=!1){return f.value=!0,k.value=[],console.log("start loadActionDates"),x.post(D+"api/staff.php",{params:{method:"actionDates",force:a}}).then(o=>{var s,n;k.value=(n=(s=o==null?void 0:o.data)==null?void 0:s.data)!=null?n:[],console.log("end loadActionDates")}).catch(o=>{throw k.value=[],I.notify(b(o)),o}).finally(()=>{f.value=!1})}function M(){console.log("start loadData"),f.value=!0,x.post(D+"api/staff.php",{params:{method:"get",date:w.value}}).then(a=>{var o,s;Z(),u.value=[],u.value=Object.values((s=(o=a==null?void 0:a.data)==null?void 0:o.data)!=null?s:[])}).catch(a=>{u.value=[],I.notify(b(a))}).finally(()=>{f.value=!1})}r("loadData",M);function L(){x.post(D+"/api/staff.php",{params:{method:"update",groups:u.value,date:w.value}}).then(a=>{A()}).catch(a=>{I.notify(b(a))})}function at(a){!i.value&&X!==a||(Y.value=a,U.value=!0)}function et(a){!i.value||(console.log(a),B.value=a,V.value=!0)}function ot(a){E.value=a,z.value=!0}function st(a){return a?gt(D,a.md5,a.ext,50):"/img/avatars/init_ava.png"}return it(()=>{A().then(()=>{M()}),console.log(H(new Date).format("YYYY-MM-DD"))}),(a,o)=>(d(),m(Q,null,[t(Ct,{"page-title":v(G).title},{ToolPanel:e(()=>[v(N).self.isPermit([1,2])&&v(J)?(d(),c(g,{key:0,icon:"update",flat:"",stretch:"",onClick:o[0]||(o[0]=s=>A(!0))},{default:e(()=>[t(j,null,{default:e(()=>[_("\u0416\u0435\u0441\u0442\u043A\u043E \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u0442\u044B")]),_:1})]),_:1})):p("",!0),v(N).self.isPermit([1,2,3])?(d(),c(g,{key:1,icon:"edit",flat:"",stretch:"",color:i.value?"red":"grey",onClick:o[1]||(o[1]=s=>i.value=!i.value)},{default:e(()=>[t(j,null,{default:e(()=>[_("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u043E\u0441\u0442\u0430\u0432")]),_:1})]),_:1},8,["color"])):p("",!0),t(Pt)]),PageContent:e(()=>[C("div",wt,[C("div",At,[(d(!0),m(Q,null,F(u.value,s=>(d(),m(Q,{key:s.groupId},[i.value||s.groupId!==200?(d(),m("div",Mt,[t(vt,null,{default:e(()=>[t(W,{dense:""},{default:e(()=>[t(h,{avatar:""},{default:e(()=>[t($,null,{default:e(()=>[C("span",$t,S(s.groupName),1)]),_:2},1024)]),_:2},1024),t(mt),i.value?(d(),c(h,{key:0,side:""},{default:e(()=>[t(g,{round:"",icon:"add",onClick:n=>ot(s)},null,8,["onClick"])]),_:2},1024)):p("",!0)]),_:2},1024),t(nt,{inset:""}),bt,t(v(Qt),{list:s.Players,itemKey:"persId",disabled:!i.value,group:"people"},{item:e(({element:n})=>[t(W,{clickable:i.value},{default:e(()=>[t(h,{avatar:""},{default:e(()=>[t(dt,{size:"50px"},{default:e(()=>[t(K,{src:st(n==null?void 0:n.avatar),alt:"img",onClick:O(P=>at(n.persId),["stop","prevent"]),style:{height:"100%"}},{error:e(()=>[t(K,{style:{height:"100%"},src:"/img/avatars/init_ava.png",alt:"img"})]),_:2},1032,["src","onClick"])]),_:2},1024)]),_:2},1024),t(h,null,{default:e(()=>[t($,null,{default:e(()=>[_(S(n.name)+" "+S(n.lastName),1)]),_:2},1024),(d(!0),m(Q,null,F(n.statuses,(P,lt)=>(d(),c($,{key:`${lt}_${P}`,caption:""},{default:e(()=>[_(S(T.value.find(rt=>rt.id===P).name),1)]),_:2},1024))),128))]),_:2},1024),i.value?(d(),c(h,{key:0,side:""},{default:e(()=>[t(g,{icon:"edit",stretch:"",size:"0.5em",flat:"",onClick:O(P=>et(n),["stop","prevent"])},null,8,["onClick"])]),_:2},1024)):p("",!0)]),_:2},1032,["clickable"])]),_:2},1032,["list","disabled"])]),_:2},1024)])):p("",!0)],64))),128))]),t(ut,{align:"right"},{default:e(()=>[i.value?(d(),c(g,{key:0,class:"goldBtn",onClick:L},{default:e(()=>[_("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")]),_:1})):p("",!0)]),_:1})])]),_:1},8,["page-title"]),t(yt,{onUpdated:o[2]||(o[2]=s=>M())}),t(Dt),t(kt,{onOnPlayersAdd:L})],64))}};var ma=St(xt,[["__scopeId","data-v-36069eed"]]);export{ma as default};
