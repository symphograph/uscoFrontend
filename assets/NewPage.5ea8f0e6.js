import{Q as pe}from"./QVideo.f0f467bb.js";import{R as he,ap as fe,a6 as ve,ar as _e,az as ye,c as W,h as j,aD as ke,g as ge,aH as we,i as O,u as G,r as I,w as xe,a as be,n as r,q as _,H as c,f as a,N as d,t as P,G as h,bk as Pe,a9 as z,M as L,l as g,aZ as ne,F as S,aw as J,aY as ie,aX as $e,p as R,o as ce,bh as q,ay as re,ac as Ie,ax as K,O as Y,ad as Se,I as Ve,J as Ce,L as Ee}from"./index.cd1e76ba.js";import{b as X,Q as F,a as H}from"./QItemLabel.971d5e50.js";import{u as de}from"./use-meta.1f2e8af7.js";import{u as ee}from"./use-quasar.887a5898.js";import{api as Q}from"./axios.95308f7a.js";import{Q as te}from"./QImg.8c76714d.js";import{Q as Qe}from"./QTooltip.4fda66b0.js";import{Q as Ue}from"./QList.17cc8592.js";import{b as ae,n as U,e as Ne,c as Oe,g as se}from"./myFuncts.9f42497d.js";import{Q as Ae,S as De}from"./SketchUploader.2554143a.js";import{_ as Z}from"./BtnDelete.a2a2705d.js";import{_ as le}from"./plugin-vue_export-helper.21dcd24c.js";import{_ as Me}from"./PageTitle.5a1d61af.js";import"./use-ratio.5639a88d.js";import"./position-engine.b0415672.js";import"./format.3e32b8d9.js";import"./use-file.2c693066.js";import"./get-emits-object.24798346.js";import"./QToolbarTitle.943cd697.js";import"./QToolbar.537561d3.js";import"./QLinearProgress.1cc758cb.js";var Te=he({name:"QInnerLoading",props:{...fe,...ve,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(m,{slots:s}){const V=ge(),t=_e(m,V.proxy.$q),{transitionProps:y,transitionStyle:f}=ye(m),k=W(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(t.value===!0?" q-inner-loading--dark":"")),C=W(()=>"q-inner-loading__label"+(m.labelClass!==void 0?` ${m.labelClass}`:""));function w(){const b=[j(we,{size:m.size,color:m.color})];return m.label!==void 0&&b.push(j("div",{class:C.value,style:m.labelStyle},[m.label])),b}function $(){return m.showing===!0?j("div",{class:k.value,style:f.value},s.default!==void 0?s.default():w()):null}return()=>j(ke,y.value,$)}});const qe={class:"uploaderArea"},ze={class:"imagesArea"},Be={class:"absolute delBthArea"},Le={class:"row no-wrap"},Re={__name:"PhotoUploader",setup(m){const s=String("https://api.sakh-orch.ru/"),V=O("AccessToken"),t=ee(),y=G(),f=O("Entry"),k=O("isPhotosCompleted"),C=I(null),w=O("unlinkPhoto");function $(){Q.post(s+"api/news/photo.php",{params:{entryId:y.params.id,method:"unlinkAll"}}).then(o=>{var i;if(!((i=o==null?void 0:o.data)!=null&&i.result))throw new Error;f.value.Photos=[]}).catch(o=>{t.notify(U(o))})}function b(){return{url:s+"api/news/photo.php",headers:[{name:"ACCESSTOKEN",value:V.value}],formFields:[{name:"entryId",value:f.value.id},{name:"method",value:"add"}]}}function D(o){console.log(o.xhr.response),N(),C.value.reset(),v.value=!0}function B(o){var u,x,E;console.log(o.xhr.response);let i=(E=(x=JSON.parse((u=o==null?void 0:o.xhr)==null?void 0:u.response))==null?void 0:x.error)!=null?E:"";t.notify(U(null,i))}function N(){Q.post(s+"api/news/photo.php",{params:{method:"list",entryId:y.params.id}}).then(o=>{var i,u,x;if(!((i=o==null?void 0:o.data)!=null&&i.result))throw new Error;f.value.Photos=(x=(u=o==null?void 0:o.data)==null?void 0:u.data)!=null?x:[],k()&&(v.value=!1)}).catch(o=>{t.notify(U(o))}).finally(()=>{})}function M(o){const i=`
![](${o.md5}.${o.ext})
`;Ne(i,t)}const v=I(!1);let p=null;return xe(v,o=>{o&&!p?p=setInterval(N,3e3):!o&&p&&(clearInterval(p),p=null)}),be(()=>{p&&clearInterval(p)}),(o,i)=>(r(),_(S,null,[c("div",qe,[a(Ae,{style:{width:"100%"},label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438 (\u0434\u043E 20)",factory:b,"max-file-size":5e7,"max-files":20,ref_key:"uploader",ref:C,onUploaded:D,onFailed:B,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)]),d(f).Photos&&d(f).Photos.length?(r(),P(ie,{key:0,bordered:"",flat:"",class:"transparent"},{default:h(()=>[a(Pe,{align:"right"},{default:h(()=>[a(Z,{"throw-confirm":"",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",onOnOk:i[0]||(i[0]=u=>$()),title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438"}),g("",!0)]),_:1}),a(ne,null,{default:h(()=>[c("div",ze,[(r(!0),_(S,null,J(d(f).Photos,(u,x)=>(r(),P(ie,{key:x},{default:h(()=>[u.status==="completed"?(r(),P(te,{key:0,ratio:96/54,src:d(ae)(d(s),u.md5,u.ext,260)},null,8,["src"])):(r(),P(X,{key:1},{default:h(()=>[a(F,null,{default:h(()=>[a(Te,{showing:"",label:"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0430"})]),_:1})]),_:1})),a(ne,null,{default:h(()=>[c("div",Be,[a(Z,{size:"0.7em","throw-confirm":"",onOnOk:E=>d(w)(u.id),title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E",tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E"},null,8,["onOnOk"])]),c("div",Le,[a(z,{padding:"0.5em 1em",icon:"content_copy",label:"\u041A\u043E\u0434",onClick:E=>M(u)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])]),_:1})]),_:1})):g("",!0)],64))}};var Fe=le(Re,[["__scopeId","data-v-2c740d18"]]);const A=m=>(Ve("data-v-21d83a11"),m=m(),Ce(),m),je={key:0,class:"newsarea"},He=A(()=>c("br",null,null,-1)),We={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},Je={class:"nimg_block",style:{position:"relative"}},Ke=A(()=>c("img",{src:"/img/news/default_sketch.svg"},null,-1)),Ye={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},Ze={class:"inputArea"},Ge={class:"inputArea"},Xe={class:"input"},et={id:"categs",class:"input"},tt={style:{display:"flex","justify-content":"flex-end","grid-gap":"1em",padding:"1em"}},at=A(()=>c("br",null,null,-1)),lt=A(()=>c("br",null,null,-1)),ot=A(()=>c("br",null,null,-1)),nt=A(()=>c("br",null,null,-1)),it=A(()=>c("br",null,null,-1)),rt=A(()=>c("br",null,null,-1)),dt={__name:"NewEditor",emits:["uploaded"],setup(m,{expose:s,emit:V}){const t=O("Entry"),y=String("https://api.sakh-orch.ru/"),f=ee(),k=G(),C=$e(),w=V;O("AccessToken");const $=I([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u0421\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]),b=I("");R("pwUrl",b);function D(){if(b.value)return b.value;let l=f.platform.is.mobile?1080:260;return t.value.sketch?ae(y,t.value.sketch.md5,t.value.sketch.ext,l):"error.err"}function B(){Q.post(y+"api/news/sketch.php",{params:{method:"unlink",id:k.params.id}}).then(l=>{var e;if(!((e=l==null?void 0:l.data)!=null&&e.result))throw new Error;w("uploaded")}).catch(l=>{f.notify(U(l))})}function N(l){Q.post(y+"api/news/photo.php",{params:{entryId:k.params.id,imgId:l,method:"unlink"}}).then(e=>{var oe;if(!((oe=e==null?void 0:e.data)!=null&&oe.result))throw new Error;let n=t.value.Photos.findIndex(me=>me.id===l),T=t.value.Photos[n];M(T.md5),t.value.Photos.splice(n,1)}).catch(e=>{f.notify(U(e))})}R("unlinkPhoto",N);function M(l){const e=new RegExp(`!\\[]\\(${l}\\.[a-zA-Z0-9]+\\)`,"g"),n=t.value.markdown;t.value.markdown=t.value.markdown.replace(e,""),t.value.markdown!==n&&u()}function v(){const l=Object.keys($.value);let e=[];return l.forEach(n=>{e[$.value[n].id]=$.value[n].checked}),e}function p(l=0){Q.post(y+"api/news/entry.php",{params:{method:"update",entry:t.value,addNew:l,categs:v()}}).then(e=>{var n,T;f.notify(Oe((T=(n=e==null?void 0:e.data)==null?void 0:n.result)!=null?T:"")),w("uploaded")}).catch(e=>{f.notify(U(e))})}function o(){Q.post(y+"api/news/entry.php",{params:{method:"del",entryId:t.value.id,force:!1}}).then(l=>{var e;if(!((e=l==null?void 0:l.data)!=null&&e.result))throw new Error;C.push({path:"/news/all"})}).catch(l=>{f.notify(U(l))})}function i(){Q.post(y+"api/news/entry.php",{params:{method:t.value.isShow?"hide":"show",entryId:t.value.id}}).then(l=>{var e;if(!((e=l==null?void 0:l.data)!=null&&e.result))throw new Error;t.value.isShow=!t.value.isShow}).catch(l=>{f.notify(U(l))}).finally(()=>{})}function u(){Q.post(y+"api/news/entry.php",{params:{method:"updateMarkdown",id:t.value.id,markdown:t.value.markdown}}).then(l=>{var e;if(!((e=l==null?void 0:l.data)!=null&&e.result))throw new Error;t.value.parsedMD=l==null?void 0:l.data.data}).catch(l=>{})}R("updateMarkdown",u);function x(){return!t.value.Photos||t.value.Photos.length===0?!1:t.value.Photos.every(l=>l.status==="completed")}R("isPhotosCompleted",x);function E(){w("uploaded")}return s({unlinkPhoto:N}),ce(()=>{}),(l,e)=>(r(),_(S,null,[d(t)?(r(),_("div",je,[a(q,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:d(t).title,"onUpdate:modelValue":e[0]||(e[0]=n=>d(t).title=n)},null,8,["modelValue"]),He,c("div",We,[c("div",Je,[a(te,{ratio:16/9,src:D(),fit:"fill"},{error:h(()=>[Ke]),_:1},8,["src"]),b.value?g("",!0):(r(),P(z,{key:0,size:"0.7em",round:"",color:"red",icon:"delete",style:{transform:"translateY(-50%)",right:"1em","z-index":"100",position:"absolute",top:"2em"},onClick:e[1]||(e[1]=n=>B(d(t).img))}))]),c("div",Ye,[a(De,{id:d(t).id,type:"news",onOnUploaded:E},null,8,["id"])])]),c("div",Ze,[a(q,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",style:{width:"100%"},type:"textarea",autogrow:"",modelValue:d(t).descr,"onUpdate:modelValue":e[2]||(e[2]=n=>d(t).descr=n),outlined:""},null,8,["modelValue"])]),c("div",Ge,[c("div",Xe,[a(q,{type:"date",modelValue:d(t).date,"onUpdate:modelValue":e[3]||(e[3]=n=>d(t).date=n),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),a(q,{modelValue:d(t).refName,"onUpdate:modelValue":e[4]||(e[4]=n=>d(t).refName=n),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),a(q,{modelValue:d(t).refLink,"onUpdate:modelValue":e[6]||(e[6]=n=>d(t).refLink=n),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},{append:h(()=>[a(re,{modelValue:d(t).isExternal,"onUpdate:modelValue":e[5]||(e[5]=n=>d(t).isExternal=n),color:"green"},{default:h(()=>[a(Qe,null,{default:h(()=>[L("\u041F\u0440\u0438 \u043A\u043B\u0438\u043A\u0435 \u0432 \u043B\u0435\u043D\u0442\u0435 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),c("div",et,[a(Ue,{bordered:"",padding:""},{default:h(()=>[a(H,{header:""},{default:h(()=>[L("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(r(!0),_(S,null,J(d(t).categs,n=>Ie((r(),P(X,{key:n.id,tag:"label"},{default:h(()=>[a(F,null,{default:h(()=>[a(H,null,{default:h(()=>[L(K(n.label),1)]),_:2},1024),a(H,{caption:""},{default:h(()=>[L(K(n.caption),1)]),_:2},1024)]),_:2},1024),a(F,{side:"",top:""},{default:h(()=>[a(re,{color:"green",modelValue:n.checked,"onUpdate:modelValue":T=>n.checked=T,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[Se]])),128))]),_:1})])]),a(Fe),a(Y,{spaced:"2em"}),a(q,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",autogrow:"",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:d(t).markdown,"onUpdate:modelValue":[e[7]||(e[7]=n=>d(t).markdown=n),e[8]||(e[8]=n=>u())],debounce:300,dense:""},null,8,["modelValue"]),c("div",tt,[a(z,{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",color:"red",onClick:e[9]||(e[9]=n=>o())}),d(t).isShow?(r(),P(z,{key:0,label:"\u0421\u043A\u0440\u044B\u0442\u044C",color:"orange",outline:"",onClick:e[10]||(e[10]=n=>i())})):(r(),P(z,{key:1,label:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C",color:"green",outline:"",onClick:e[11]||(e[11]=n=>i())})),a(z,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",color:"green",onClick:e[12]||(e[12]=n=>p(0))})]),at,lt,ot,nt])):g("",!0),it,rt],64))}};var st=le(dt,[["__scopeId","data-v-21d83a11"]]);const ut={class:"newsImg"},ct={key:0,class:"btnArea"},mt={__name:"EntryPhoto",props:{id:{type:Number,required:!0},md5:{type:String,required:!0},ext:{type:String,required:!0},size:{type:Number,required:!1,default:1080}},emits:["onDel"],setup(m,{emit:s}){const V=String("https://api.sakh-orch.ru/"),t=O("editMode"),y=s;return(f,k)=>(r(),_("div",ut,[d(t)?(r(),_("div",ct,[a(Z,{tooltip:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",title:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E","throw-confirm":"",onOnOk:k[0]||(k[0]=C=>y("onDel",m.id))})])):g("",!0),a(te,{src:d(ae)(d(V),m.md5,m.ext,m.size),fit:"fill"},null,8,["src"])]))}};var ue=le(mt,[["__scopeId","data-v-a666a9ca"]]);const pt={key:0,class:"contentArea"},ht={key:1,class:"contentArea"},ft={key:0,class:"textBlock"},vt=["innerHTML"],_t={key:1},yt={key:2,class:"videoItem"},kt={key:2,class:"content"},gt=c("div",{class:"newsarea"},[c("div",{class:"narea"},[c("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),wt=[gt],Ft={__name:"NewPage",setup(m){I(0);const s=I(null);R("Entry",s);const V=ee(),t=String("https://api.sakh-orch.ru/"),y=G(),f=O("editMode"),k=I("\u041D\u043E\u0432\u043E\u0441\u0442\u044C"),C=I(!1),w=I(!0),$=I(),b=se(k.value||"\u041D\u043E\u0432\u043E\u0441\u0442\u044C");de(b);function D(){w.value=!0,Q.post(t+"api/news/entry.php",{params:{method:"get",id:y.params.id}}).then(v=>{var o,i,u,x,E;if(!((o=v==null?void 0:v.data)!=null&&o.result))throw new Error;s.value=(u=(i=v==null?void 0:v.data)==null?void 0:i.data)!=null?u:null,k.value=(E=(x=s==null?void 0:s.value)==null?void 0:x.title)!=null?E:"";const p=se(k.value||"\u041D\u043E\u0432\u043E\u0441\u0442\u044C");de(p)}).catch(v=>{C.value=!0,V.notify(U(v))}).finally(()=>{w.value=!1})}const B=W(()=>s.value.parsedMD.filter(p=>p.type==="img").map(p=>s.value.Photos.find(o=>o.id===p.fileId)).filter(Boolean)),N=W(()=>{const v=B.value.map(p=>p.id);return s.value.Photos.filter(p=>!v.includes(p.id))});function M(v){f.value&&$.value.unlinkPhoto(v)}return ce(()=>{D()}),(v,p)=>{var o;return r(),_(S,null,[d(f)&&s.value?(r(),_("div",pt,[d(f)&&s.value?(r(),P(st,{key:0,onUploaded:p[0]||(p[0]=i=>D()),ref_key:"editorRef",ref:$},null,512)):g("",!0)])):g("",!0),a(Me,{title:((o=s.value)==null?void 0:o.title)||"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",loading:w.value},null,8,["title","loading"]),s.value?(r(),_("div",ht,[(r(!0),_(S,null,J(s.value.parsedMD,(i,u)=>(r(),_(S,{key:u},[i.type==="text"?(r(),_("div",ft,[i.content!==`
`?(r(),_("section",{key:0,innerHTML:i.content},null,8,vt)):(r(),_("br",_t))])):g("",!0),i.type==="img"?(r(),P(ue,{key:1,id:i.fileId,md5:i.md5,ext:i.ext,onOnDel:M},null,8,["id","md5","ext"])):g("",!0),i.type==="video"?(r(),_("div",yt,[a(pe,{ratio:16/9,src:"https://www.youtube.com/embed/"+i.content},null,8,["src"])])):g("",!0)],64))),128)),s.value.refLink?(r(),_(S,{key:0},[a(Y,{spaced:"1em"}),a(X,{clickable:"",href:s.value.refLink},{default:h(()=>[a(F,{avatar:""},{default:h(()=>[a(Ee,{name:"link"})]),_:1}),a(F,null,{default:h(()=>[a(H,null,{default:h(()=>[L("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "+K(s.value.refName),1)]),_:1})]),_:1})]),_:1},8,["href"])],64)):g("",!0),N.value.length?(r(),_(S,{key:1},[a(Y,{spaced:"2em"}),(r(!0),_(S,null,J(N.value,(i,u)=>(r(),P(ue,{key:u,id:i.id,ext:i.ext,md5:i.md5,onOnDel:M},null,8,["id","ext","md5"]))),128))],64)):g("",!0)])):w.value?g("",!0):(r(),_("div",kt,wt))],64)}}};export{Ft as default};
