import{Q as U}from"./QImg.4ded629f.js";import{Q as Y}from"./QVideo.94ddc4ae.js";import{u as q}from"./use-meta.e49711e2.js";import{u as z}from"./use-quasar.31d66723.js";import{api as I}from"./axios.512df4e1.js";import{aK as J,aL as X,r as h,i as L,S as O,z as s,A as i,B as n,aY as V,H as o,y as C,N as B,C as m,F as k,G as F,I as y,_ as G,E as N,m as W,D as T,J as S,K as Z,a3 as ee,aV as te,aU as ae,O as oe,P as ne,R as le,o as se}from"./index.b9c3de56.js";import{b as E,a as A,Q as ie}from"./QItem.17ed31da.js";import{Q as re}from"./QList.52243d93.js";import{Q as R}from"./QUploader.7eb0bb32.js";import"./use-ratio.e3f2baad.js";import"./format.3e32b8d9.js";function de(r){const a=document.createElement("textarea");a.value=r,a.contentEditable="true",a.style.position="fixed";const p=()=>{};J(p),document.body.appendChild(a),a.focus(),a.select();const l=document.execCommand("copy");return a.remove(),X(p),l}function ue(r){return navigator.clipboard!==void 0?navigator.clipboard.writeText(r):new Promise((a,p)=>{const l=de(r);l?a(!0):p(l)})}const w=r=>(oe("data-v-15d49c5e"),r=r(),ne(),r),ce={key:0,class:"newsarea"},pe=w(()=>o("br",null,null,-1)),me={id:"descr",style:{padding:"1em",display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},ve={class:"nimg_block"},fe={style:{width:"calc(100% - 260px)",padding:"0 1em",margin:"1em auto 0","min-width":"300px"}},_e={class:"inputArea"},ge={class:"input"},ye={id:"categs",class:"input"},he={id:"uploaderArea",class:"input"},ke={class:"uploaderArea"},we={id:"uploaderArea2",class:"input"},be={class:"uploaderArea"},xe={class:"imagesArea"},Ve={class:"row no-wrap"},$e=w(()=>o("br",null,null,-1)),De=w(()=>o("br",null,null,-1)),Ne=w(()=>o("br",null,null,-1)),Qe=w(()=>o("br",null,null,-1)),Be=w(()=>o("br",null,null,-1)),Ie=w(()=>o("br",null,null,-1)),Ue={__name:"NewEditor",props:{newData:h(null)},emits:["uploaded"],setup(r,{emit:a}){const p=r,l=h(p.newData),v=String("https://api.sakh-orch.ru/"),d=z(),f=L("token"),$=O(),_=h(null),g=h([{id:1,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u042E\u0421\u041A\u041E",caption:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043E\u0440\u043A\u0435\u0441\u0442\u0440\u0430",url:"/news/usco",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:2,name:"\u0417\u0432\u0435\u0437\u0434\u044B \u042D\u0432\u0442\u0435\u0440\u043F\u044B",caption:"\u041C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0439 \u0444\u0435\u0441\u0442\u0438\u0432\u0430\u043B\u044C",url:"/news/euterpe",ava:"/img/logo/logo_init.svg",icon:"",checked:!1},{id:3,name:"\u041D\u043E\u0432\u043E\u0441\u0442\u0438 \u043F\u0430\u0440\u0442\u043D\u0435\u0440\u043E\u0432",caption:"\u041F\u0440\u043E\u0447\u0438\u0435 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",url:"/news/other",ava:"",icon:"volunteer_activism",checked:!1}]);function b(c){c=`
![](`+c+")",ue(c).then(()=>{d.notify({color:"positive",position:"center",message:"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E",icon:"content_copy",timeout:1})}).catch(()=>{})}function x(c,t){I.post(v+"api/set/news/delimg.php",{params:{id:$.params.id,img:c,token:f.value}}).then(e=>{if(e.data.error)return d.notify({color:"negative",position:"center",message:e.data.error,icon:"report_problem",closeBtn:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C",timeout:1}),!1;if(e.data.result)return d.notify({color:"positive",position:"center",message:e.data.result,icon:"done",closeBtn:"\u041E\u043A",timeout:1}),console.log(t),l.value.Images.splice(t,1),a("uploaded"),!0}).catch(()=>{d.notify({color:"negative",position:"center",message:"\u0421\u0435\u0440\u0432\u0435\u0440 \u043D\u0435 \u043E\u0442\u0432\u0435\u0447\u0430\u0435\u0442",icon:"report_problem",closeBtn:"\u041E\u043A",timeout:1})})}function u(c){I.post(v+"api/set/news/delpw.php",{params:{id:$.params.id,img:c,token:f.value}}).then(t=>{if(t.data.error)return d.notify({color:"negative",position:"center",message:t.data.error,icon:"report_problem",closeBtn:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C",timeout:1}),!1;if(t.data.result)return d.notify({color:"positive",position:"center",message:t.data.result,icon:"done",closeBtn:"\u041E\u043A",timeout:1}),l.value.img="/img/entry/default.svg",!0}).catch(()=>{d.notify({color:"negative",position:"center",message:"\u0421\u0435\u0440\u0432\u0435\u0440 \u043D\u0435 \u043E\u0442\u0432\u0435\u0447\u0430\u0435\u0442",icon:"report_problem",closeBtn:"\u041E\u043A",timeout:1})})}function D(){return{url:v+"api/upload/entrypw.php",headers:[{name:"X-CSRF-TOKEN",value:f.value}],formFields:[{name:"id",value:p.newData.id}]}}function P(){return{url:v+"api/upload/entryimg.php",headers:[{name:"X-CSRF-TOKEN",value:f.value}],formFields:[{name:"id",value:p.newData.id}]}}function M(c){let t=c.xhr.responseText;console.log(t);let e=JSON.parse(t);if(e.error){d.notify({type:"negative",position:"center",message:e.error,closeBtn:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"}),_.value.reset();return}e.result&&(d.notify({type:"positive",position:"center",message:"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E",closeBtn:"\u041E\u043A"}),a("uploaded")),_.value.reset()}function j(){const c=Object.keys(g.value);let t=[];return c.forEach(e=>{t[g.value[e].id]=g.value[e].checked}),t}function K(c=0){I.post(v+"api/set/news/entry.php",{params:{entry:p.newData,token:f.value,addNew:c,categs:j()}}).then(t=>{if(t.data.result)return d.notify({type:"positive",position:"center",message:"\u0413\u043E\u0442\u043E\u0432\u043E",timeout:1,closeBtn:"\u041E\u043A"}),a("uploaded"),!0;let e="\u041E\u0439! \u041A\u0430\u043A\u0430\u044F \u0434\u043E\u0441\u0430\u0434\u0430!";t.data.error&&(e=t.data.error),d.notify({color:"negative",position:"center",message:e,icon:"report_problem",timeout:300,closeBtn:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"})}).catch(()=>{d.notify({color:"negative",position:"center",message:"\u0421\u0435\u0440\u0432\u0435\u0440 \u043D\u0435 \u043E\u0442\u0432\u0435\u0447\u0430\u0435\u0442",icon:"report_problem",closeBtn:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"})})}return(c,t)=>(s(),i(k,null,[r.newData?(s(),i("div",ce,[n(V,{label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",type:"text",modelValue:l.value.title,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.title=e)},null,8,["modelValue"]),pe,o("div",me,[o("div",ve,[n(U,{ratio:1080/684,src:C(v)+r.newData.img},null,8,["src"])]),n(B,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{transform:"translateY(-50%)"},onClick:t[1]||(t[1]=e=>u(r.newData.img))}),o("div",fe,[n(V,{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",type:"textarea",modelValue:l.value.descr,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.descr=e),outlined:""},null,8,["modelValue"])])]),o("div",_e,[o("div",ge,[n(V,{type:"date",modelValue:l.value.date,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.date=e),label:"\u0414\u0430\u0442\u0430 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438"},null,8,["modelValue"]),n(V,{modelValue:l.value.refName,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.refName=e),label:"\u0422\u0435\u043A\u0441\u0442 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text"},null,8,["modelValue"]),n(V,{modelValue:l.value.refLink,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.refLink=e),label:"\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0430 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A",type:"text",placeholder:"https://example.com"},null,8,["modelValue"])]),o("div",ye,[n(re,{bordered:"",padding:""},{default:m(()=>[n(E,{header:""},{default:m(()=>[N("\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u0445")]),_:1}),(s(!0),i(k,null,F(g.value,e=>W((s(),T(ie,{key:e.id,tag:"label"},{default:m(()=>[n(A,null,{default:m(()=>[n(E,null,{default:m(()=>[N(S(e.name),1)]),_:2},1024),n(E,{caption:""},{default:m(()=>[N(S(e.caption),1)]),_:2},1024)]),_:2},1024),n(A,{side:"",top:""},{default:m(()=>[n(Z,{color:"green",modelValue:l.value.categs[e.id],"onUpdate:modelValue":Q=>l.value.categs[e.id]=Q,val:"friend"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)),[[le]])),128))]),_:1})]),o("div",he,[o("div",ke,[n(R,{label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0441\u043A\u0438\u0437",factory:D,"max-file-size":"50000000",ref_key:"uploader",ref:_,onUploaded:M,padding:"0",margin:"0",bordered:""},null,512)])]),o("div",we,[o("div",be,[n(R,{"input-style":"max-width: 300px; padding: 0",label:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438",factory:P,"max-file-size":"50000000",ref_key:"uploader",ref:_,onUploaded:M,multiple:"",batch:"",padding:"0",margin:"0",bordered:""},null,512)])])]),o("div",xe,[(s(!0),i(k,null,F(r.newData.Images,(e,Q)=>(s(),T(ae,{key:Q},{default:m(()=>[n(U,{ratio:96/54,src:C(v)+"/img/entry/1080/"+r.newData.id+"/"+e.fileName},null,8,["src"]),n(te,null,{default:m(()=>[n(B,{size:"0.7em",round:"",color:"red",icon:"delete",class:"absolute",style:{top:"0",right:"0.5em",transform:"translateY(-50%)"},onClick:H=>x(e.fileName,Q)},null,8,["onClick"]),o("div",Ve,[n(B,{padding:"0.5em 1em",onClick:H=>b(e.fileName)},{default:m(()=>[n(ee,{name:"content_copy"}),N(" \u041A\u043E\u0434 \u0432\u0441\u0442\u0430\u0432\u043A\u0438 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),n(V,{label:"\u0422\u0435\u043A\u0441\u0442 \u043D\u043E\u0432\u043E\u0441\u0442\u0438",type:"textarea",outlined:"","input-style":"{padding: 5em}",padding:"1em",modelValue:l.value.markdown,"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.markdown=e),dense:""},null,8,["modelValue"]),$e,De,n(B,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",onClick:t[7]||(t[7]=e=>K(0))}),Ne,Qe])):y("",!0),Be,Ie],64))}};var Ce=G(Ue,[["__scopeId","data-v-15d49c5e"]]);const Fe={key:0,class:"content"},Se={key:1,class:"newsarea"},Ee={class:"p_title"},Le={class:"narea"},Te={class:"text"},Me=["innerHTML"],Ae={key:1},Re=o("br",null,null,-1),ze={key:1,class:"newsImg"},Oe={key:2,class:"vitem"},Pe={key:0},je=["href"],Ke={key:1,class:"content"},He=o("div",{class:"newsarea"},[o("div",{class:"narea"},[o("div",{class:"text"}," \u041D\u043E\u0432\u043E\u0441\u0442\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430 ")])],-1),Ye=[He],lt={__name:"NewPage",setup(r){h(0);const a=h(null),p=z(),l=String("https://api.sakh-orch.ru/"),v=L("token"),d=O(),f=L("editMode"),$=h("\u041D\u043E\u0432\u043E\u0441\u0442\u044C");q(()=>({title:$.value}));function _(b){return l+"/img/entry/1080/"+a.value.id+"/"+b}function g(){I.post(l+"api/new.php",{params:{id:d.params.id,token:v.value}}).then(b=>{a.value=b.data,$.value=a.value.title}).catch(()=>{p.notify({color:"negative",position:"center",message:"\u0421\u0435\u0440\u0432\u0435\u0440 \u043D\u0435 \u043E\u0442\u0432\u0435\u0447\u0430\u0435\u0442",icon:"report_problem"})})}return se(()=>{g()}),(b,x)=>a.value||C(f)?(s(),i("div",Fe,[C(f)&&a.value?(s(),T(Ce,{key:0,newData:a.value,"onUpdate:newData":x[0]||(x[0]=u=>a.value=u),onUploaded:x[1]||(x[1]=u=>g())},null,8,["newData"])):y("",!0),a.value?(s(),i("div",Se,[o("div",Ee,S(a.value.title),1),o("div",Le,[o("div",Te,[(s(!0),i(k,null,F(a.value.parsedMD,(u,D)=>(s(),i(k,{key:D},[u.type==="text"?(s(),i(k,{key:0},[u.content!==`
`?(s(),i("section",{key:0,innerHTML:u.content},null,8,Me)):(s(),i("br",Ae)),Re],64)):y("",!0),u.type==="img"?(s(),i("div",ze,[n(U,{src:_(u.content),fit:"fill"},null,8,["src"])])):y("",!0),u.type==="video"?(s(),i("div",Oe,[n(Y,{ratio:16/9,src:"https://www.youtube.com/embed/"+u.content},null,8,["src"])])):y("",!0)],64))),128)),a.value.refLink?(s(),i("div",Pe,[N("\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A: "),o("a",{href:a.value.refLink,target:"_blank"},S(a.value.refName),9,je)])):y("",!0),(s(!0),i(k,null,F(a.value.unusedImages,(u,D)=>(s(),i("div",{class:"newsImg",key:D},[n(U,{src:_(u),fit:"fill"},null,8,["src"])]))),128))])])])):y("",!0)])):(s(),i("div",Ke,Ye))}};export{lt as default};
