import{_ as q,i as p,f as c,g as v,F as O,au as j,t as m,h as s,A as o,aZ as A,a1 as Z,s as w,z as x,ax as G,bk as W,a2 as F,j as B,bM as ee,ce as le,av as I,c as U,r as h,bN as D,aY as te,p as N,o as ae,a as oe,aX as ie,T as z,da as ce}from"./index.f6bac8d8.js";import{api as K}from"./axios.49c9e841.js";import{n as X,b as ne}from"./myFuncts.8c7f864e.js";import{u as re}from"./use-quasar.5b03c6bf.js";import{Q as J}from"./QSelect.2238cbee.js";import{Q as L}from"./QTooltip.29399d88.js";import{Q as se,b as ue,a as Y}from"./QItemSection.ac5a22d4.js";import"./jwt-decode.esm.74bd4619.js";import"./rtl.d9d8c3e2.js";import"./position-engine.1187e8f2.js";import"./format.3e32b8d9.js";const de={class:"priceRow"},pe=["onClick"],_e={__name:"PriceInputs",emits:["onSelectPrice"],setup(P,{emit:y}){const e=p("selectedPrice"),n=p("HallPlan");function a(t){e.value=t}const r=p("colors");function i(t){return t.priceType===e.value.priceType?"1.5em":"1em"}return(t,b)=>(c(),v("div",de,[(c(!0),v(O,null,j(o(n).pricing,d=>(c(),v("div",{key:d.priceType,class:"priceCell"},[m("div",{style:{cursor:"pointer"},onClick:_=>a(d)},[s(A,{label:d.label,dense:"","label-color":o(r)[d.priceType][0],step:"100","input-class":"priceInput",modelValue:o(n).pricing.find(_=>_.priceType===d.priceType).price,"onUpdate:modelValue":_=>o(n).pricing.find(S=>S.priceType===d.priceType).price=_,type:"number"},null,8,["label","label-color","modelValue","onUpdate:modelValue"]),s(Z,{name:"edit",color:o(r)[d.priceType][0],size:i(d)},null,8,["color","size"])],8,pe)]))),128))]))}};var fe=q(_e,[["__scopeId","data-v-607c9cf6"]]);const ve={style:{width:"100%",border:"1px solid lightgray","border-radius":"3px"}},me={__name:"StructureInputs",setup(P){const y=p("initCells"),e=p("HallPlan"),n=p("addCountable");return(a,r)=>(c(),v(O,null,[s(A,{label:"\u0420\u044F\u0434\u043E\u0432",modelValue:o(e).structure.cntRows,"onUpdate:modelValue":r[0]||(r[0]=i=>o(e).structure.cntRows=i),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),s(A,{label:"\u042F\u0447\u0435\u0435\u043A",modelValue:o(e).structure.cntCols,"onUpdate:modelValue":r[1]||(r[1]=i=>o(e).structure.cntCols=i),color:"amber",type:"number",outlined:"",class:"inputNumber"},null,8,["modelValue"]),m("div",ve,[s(L,{delay:"300"},{default:w(()=>[x("\u0412\u0441\u0435\u0433\u0434\u0430 \u0443\u0447\u0438\u0442\u044B\u0432\u0430\u0442\u044C \u044F\u0447\u0435\u0439\u043A\u0443 \u043F\u0440\u0438 \u043F\u043E\u0434\u0441\u0447\u0435\u0442\u0435 \u043C\u0435\u0441\u0442 \u0440\u044F\u0434\u0430.")]),_:1}),s(W,{modelValue:o(n),"onUpdate:modelValue":r[2]||(r[2]=i=>G(n)?n.value=i:null),label:"+1"},null,8,["modelValue"])]),s(F,{label:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",onClick:o(y),class:"defbtn",outline:""},null,8,["onClick"])],64))}},ye={__name:"ModeSelect",setup(P){const y=[{value:"Offline",label:"\u0417\u0430\u043D\u044F\u0442\u044B\u0435 \u043C\u0435\u0441\u0442\u0430",descr:"\u041C\u0435\u0441\u0442\u0430, \u0447\u044C\u0438 \u0431\u0438\u043B\u0435\u0442\u044B \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B \u043E\u043D\u043B\u0430\u0439\u043D. \u0418\u0445 \u0437\u0430\u0431\u0440\u0430\u043B\u0438 \u043E\u0447\u043D\u043E."},{value:"Prices",label:"\u0426\u0435\u043D\u044B",descr:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u0446\u0435\u043D \u0438 \u043F\u0440\u0438\u0432\u044F\u0437\u043A\u0430 \u043C\u0435\u0441\u0442\u0430 \u043A \u0442\u0438\u043F\u0443 \u0446\u0435\u043D\u044B"},{value:"Structure",label:"\u0421\u0442\u0440\u0443\u043A\u0442\u0443\u0440\u0430 \u0417\u0430\u043B\u0430",descr:"\u041E\u0442\u043C\u0435\u0447\u0430\u0435\u0442 \u044F\u0447\u0435\u0439\u043A\u0443 \u043A\u0430\u043A \u043F\u0440\u043E\u0445\u043E\u0434 \u0438\u043B\u0438 \u043C\u0435\u0441\u0442\u043E"}],e=p("selectedMode"),n=p("selectedPrice"),a=p("colors");function r(){return e.value==="Prices"?a[n.value.priceType][0]:"amber"}return(i,t)=>(c(),B(J,{modelValue:o(e),"onUpdate:modelValue":t[0]||(t[0]=b=>G(e)?e.value=b:null),color:"amber","label-color":r(),outlined:"","emit-value":"","map-options":"",style:{width:"100%"},options:y,label:"\u0427\u0442\u043E \u0431\u0443\u0434\u0435\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C?"},{prepend:w(()=>[s(Z,{name:"edit",color:r()},null,8,["color"])]),option:w(b=>[s(se,ee(le(b.itemProps)),{default:w(()=>[s(ue,null,{default:w(()=>[s(Y,null,{default:w(()=>[x(I(b.opt.label),1)]),_:2},1024),s(Y,{caption:""},{default:w(()=>[x(I(b.opt.descr),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label-color"]))}};const be={class:"menuArea"},ke={class:"menuBlock"},Ce={class:"blockRow"},we={class:"menuBlock"},Te={class:"blockRow"},he={key:0,class:"blockRow"},Pe={__name:"HallCreatorMenu",emits:["onSelectHall","onSelectPrice"],setup(P,{emit:y}){const e=p("HallPlan"),n=p("Halls"),a=p("selectedMode");p("colors");function r(){y("onSelectHall")}return(i,t)=>(c(),v("div",be,[m("div",ke,[m("div",Ce,[s(J,{options:o(n),modelValue:o(e).id,"onUpdate:modelValue":[t[0]||(t[0]=b=>o(e).id=b),r],color:"amber",outlined:"",style:{width:"100%"},"emit-value":"","map-options":"","option-value":"id","option-label":"name"},null,8,["options","modelValue"])])]),m("div",we,[m("div",Te,[s(ye)]),o(a)==="Structure"?(c(),v("div",he,[s(me)])):U("",!0),o(a)==="Prices"?(c(),B(fe,{key:1})):U("",!0)])]))}};var ge=q(Pe,[["__scopeId","data-v-cb98c4d8"]]);const He=m("br",null,null,-1),xe=m("br",null,null,-1),Ve={key:1,class:"forceCount"},Ie={__name:"HallBuilderCell",props:{cell:Object,ticket:Object},emits:["cellClick"],setup(P,{emit:y}){const e=P,n=p("colors"),a=h(e.ticket),r=p("HallPlan"),i=p("selectedMode"),t=p("selectedPrice"),b=p("addCountable"),d=h(!1),_=h(0);function S(u){var C;return(C=r.value.tickets.find(H=>H.id===u))!=null?C:!1}function k(){var u,C,H,$;console.log(a.value),(C=(u=a==null?void 0:a.value)==null?void 0:u.id)!=null&&C&&(console.log(e.ticket),_.value.id!==(($=(H=a==null?void 0:a.value)==null?void 0:H.id)!=null?$:0)&&(d.value=!1),t.value.priceType===a.value.priceType?a.value.priceType=d.value:(d.value=a.value.priceType,a.value.priceType=t.value.priceType),_.value=a.value.id)}function Q(u){u.exist=!u.exist,S(u.id)||r.value.tickets.push({id:u.id,offline:!1,seatRow:0,seatNum:0,priceType:"Invite"}),u.forceCount=!!(!u.exist&&b.value),console.log(u)}function g(u){switch(i.value){case"Structure":{Q(u);break}case"Prices":{k();break}case"Offline":{a.value.offline=!a.value.offline;break}default:{if(u.priceType===i.value.value){u.priceType="Invite";break}u.priceType=i.value.value}}}return(u,C)=>{var H,$,E;return c(),v("div",{class:"cellArea",onClick:C[0]||(C[0]=l=>g(P.cell))},[e.cell.exist?(c(),v(O,{key:0},[P.ticket.offline?(c(),v("div",{key:0,class:"offlineCell",style:D({borderColor:o(n)[((H=e.ticket)==null?void 0:H.priceType)||"Invite"][1],backgroundColor:o(n)[(($=e.ticket)==null?void 0:$.priceType)||"Invite"][1]})},null,4)):(c(),v("div",{key:1,class:"availableCell",style:D({borderColor:o(n)[((E=e.ticket)==null?void 0:E.priceType)||"Invite"][1]})},[x(I(e.ticket.seatNum)+" ",1),s(L,{offset:[0,-120],"max-width":"20em",delay:300},{default:w(()=>[x(I("\u041C\u0435\u0441\u0442\u043E: "+e.ticket.seatNum),1),He,x(" "+I("\u0420\u044F\u0434: "+e.ticket.seatRow),1),xe,x(" "+I("\u0426\u0435\u043D\u0430: "+e.ticket.priceType),1)]),_:1})],4))],64)):e.cell.forceCount?(c(),v("div",Ve,[x("? "),s(L,{offset:[0,-100],"max-width":"20em"},{default:w(()=>[x(" \u041F\u043E \u043A\u0430\u043A\u0438\u043C-\u0442\u043E \u043F\u0440\u0438\u0447\u0438\u043D\u0430\u043C \u044D\u0442\u043E \u043C\u0435\u0441\u0442\u043E \u043F\u043E\u0441\u0447\u0438\u0442\u0430\u043D\u043E \u0432 \u0441\u0445\u0435\u043C\u0435, \u043D\u043E \u043D\u0430 \u0441\u0430\u043C\u043E\u043C \u0434\u0435\u043B\u0435 \u0435\u0433\u043E \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 ")]),_:1})])):U("",!0)])}}};const Se={style:{width:"max-content"}},$e={style:{margin:"auto"}},Ne={class:"rowNumber"},Qe={class:"rowNumber"},Re={__name:"HallTable",emits:["cellClick","ticket"],setup(P,{emit:y}){const e=p("HallPlan");function n(i){y("cellClick",i)}function a(i){y("ticket",i)}function r(i){return e.value.tickets.find(t=>t.id===i)}return(i,t)=>o(e).tickets.length?(c(),B(te,{key:0},{default:w(()=>[m("table",Se,[m("tbody",$e,[(c(!0),v(O,null,j(o(e).cells,(b,d)=>(c(),v("tr",{key:"row_"+d},[m("td",null,[m("div",Ne,I(o(e).structure.rowNums[d]||""),1)]),(c(!0),v(O,null,j(b,(_,S)=>(c(),v("td",{key:d+"_"+S},[(c(),B(Ie,{cell:o(e).cells[_.row-1][_.col-1],"onUpdate:cell":k=>o(e).cells[_.row-1][_.col-1]=k,ticket:r(_.id),key:_.id,onCellClick:k=>n(k),onTickedClick:t[0]||(t[0]=k=>a(k))},null,8,["cell","onUpdate:cell","ticket","onCellClick"]))]))),128)),m("td",null,[m("div",Qe,I(o(e).structure.rowNums[d]||""),1)])]))),128))])])]),_:1})):U("",!0)}};var Me=q(Re,[["__scopeId","data-v-4c630040"]]);const Be={class:"content"},Ue={style:{overflow:"auto",margin:"1em auto"}},Ye={__name:"HallEditor",setup(P){const y=String("https://api.sakh-orch.ru/"),e=re(),n=h("Prices");N("selectedMode",n);const a=h([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);N("defaultPricing",a);const r=h({priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"});N("selectedPrice",r);const i=h(!1);N("addCountable",i);const t=h({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:a.value,cells:[],tickets:[]});N("HallPlan",t),N("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]});function d(){n.value==="Structure"&&C(),K.post(y+"api/tickets/hallplan/set.php",{params:{plan:t.value,id:t.value.id}}).then(l=>{var f,T,V;if(!((f=l==null?void 0:l.data)!=null&&f.result))throw new Error;e.notify(ne((V=(T=l==null?void 0:l.data)==null?void 0:T.result)!=null?V:""))}).catch(l=>{e.notify(X(l))})}async function _(){g.value=!1,t.value.cells=[];let l=[],f=[],T=0,V={};for(let R=1;R<=t.value.structure.cntRows;R++){for(let M=1;M<=t.value.structure.cntCols;M++)T++,V={id:T,row:R,col:M,exist:!0,forceCount:!1},f.push(V);l.push(f),f=[]}t.value.cells=l,await C(),await z(),g.value=!0}N("initCells",_);function S(l){if(!l.exist&&!l.forceCount||(l.forceCount&&k.value++,!l.exist))return!1;k.value++;let f={id:l.id,offline:!1,seatRow:Q.value,seatNum:k.value,priceType:"Invite"};t.value.tickets.push(f)}const k=h(0),Q=h(0),g=h(!1);function u(l){if(k.value=0,H(l)){t.value.structure.rowNums.push(!1);return}Q.value++,t.value.structure.rowNums.push(Q.value),l.forEach(f=>S(f))}async function C(){g.value=!1,Q.value=0,t.value.tickets=[],t.value.structure.rowNums=[],t.value.cells.forEach(l=>u(l)),await z(),g.value=!0}function H(l){return![...l].filter(T=>T.exist).length}function $(){E()}function E(){K.post(y+"api/tickets/hallplan/get.php",{params:{id:t.value.id}}).then(async l=>{var f,T,V,R,M;if(!((f=l==null?void 0:l.data)!=null&&f.result))throw new Error;if(!((V=(T=l==null?void 0:l.data)==null?void 0:T.data)!=null&&V.HallPlan)){_();return}g.value=!1,t.value=(M=(R=l==null?void 0:l.data)==null?void 0:R.data)==null?void 0:M.HallPlan,await z(),g.value=!0}).catch(l=>{_(),e.notify(X(l))})}return ae(()=>{}),oe(()=>{E()}),(l,f)=>(c(),v("div",Be,[s(ge,{onOnSelectHall:f[0]||(f[0]=T=>$())}),m("div",Ue,[s(ie,{style:{width:"max-content",padding:"2em",margin:"0 auto"},dark:""},{default:w(()=>[g.value?(c(),B(Me,{key:0})):U("",!0),s(ce,{style:{display:"flex","justify-content":"end"}},{default:w(()=>[s(F,{label:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",onClick:d}),n.value==="Prices"?(c(),B(F,{key:0,label:"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C",onClick:C})):U("",!0)]),_:1})]),_:1})])]))}};export{Ye as default};
