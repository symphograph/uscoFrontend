import{Q as V}from"./QLinearProgress.396b46a3.js";import{u as q}from"./use-quasar.db3d9ef6.js";import{api as Q}from"./axios.a3758807.js";import{Q as O}from"./QImg.4e7cdb37.js";import{Q as z}from"./QItemSection.70e3115f.js";import{Q as $}from"./QTooltip.b5c4c14c.js";import{r as m,i as j,f as u,g as y,A as r,h,z as p,av as N,J as S,a4 as I,j as x,c as k,F as L,B as C,_ as U,D as F,E as R,u as T,d as A,w as D,a as H,au as J}from"./index.74d49af7.js";import{n as M,b as K,f as P}from"./myFuncts.86ce22cf.js";const f=s=>(F("data-v-0d5a8738"),s=s(),R(),s),G={class:"narea"},W={class:"nimg_block"},X={class:"tcol"},Y={class:"ntitle"},Z=["href"],tt=f(()=>r("br",null,null,-1)),et=["href"],nt=f(()=>r("br",null,null,-1)),it=f(()=>r("br",null,null,-1)),ot={class:"ndate"},rt=f(()=>r("br",null,null,-1)),at={key:0,style:{display:"flex","justify-content":"right","grid-gap":"1em"}},lt=f(()=>r("br",null,null,-1)),st=f(()=>r("hr",null,null,-1)),dt=f(()=>r("br",null,null,-1)),ut={__name:"NewItem",props:{item:m(null)},emits:["hideOrShow","delEntry"],setup(s,{emit:c}){const n=s,_=String("https://api.sakh-orch.ru/"),d=q(),b=j("editMode"),l=m(n.item.isShow);function v(){var t;return(t=n.item)!=null&&t.announceId?E():g()}function g(){var e,o;let t=d.platform.is.mobile?1080:260;return _+"/img/entry/sketch/"+t+"/entry_"+n.item.id+".jpg?ver="+((o=(e=n.item)==null?void 0:e.verString)!=null?o:"jhj")}function E(){var e,o;let t=d.platform.is.mobile?1080:480;return _+"/img/posters/sketch/"+t+"/poster_"+n.item.announceId+".jpg?ver="+((o=(e=n.item)==null?void 0:e.verString)!=null?o:"jhj")}function w(){var t,e;return(t=n.item)!=null&&t.announceId?"/announce/"+n.item.announceId:(e=n.item)!=null&&e.refLink?n.item.refLink:"/new/"+n.item.id}function a(){Q.post(_+"api/news/entry.php",{params:{method:l.value?"hide":"show",entryId:n.item.id}}).then(t=>{var e;if(!((e=t==null?void 0:t.data)!=null&&e.result))throw new Error;l.value=!l.value,c("hideOrShow",n.item.id)}).catch(t=>{d.notify(M(t))}).finally(()=>{})}function i(){Q.post(_+"api/news/entry.php",{params:{method:"del",entryId:n.item.id}}).then(t=>{var e,o,B;if(!((e=t==null?void 0:t.data)!=null&&e.result))throw new Error;d.notify(K((B=(o=t==null?void 0:t.data)==null?void 0:o.result)!=null?B:"")),c("delEntry",n.item.id)}).catch(t=>{d.notify(M(t))})}return(t,e)=>(u(),y(L,null,[r("div",G,[r("div",W,[r("div",null,[h(z,{href:w(),dense:"",class:"no-padding"},{default:p(()=>[h(O,{src:v(),ratio:1920/1080,fit:"fill","placeholder-src":"/img/news/default_1920x1080.png"},{error:p(()=>[h(O,{src:"/img/news/default_1920x1080.png",ratio:1920/960,fit:"fill"})]),_:1},8,["src"])]),_:1},8,["href"])])]),r("div",X,[r("div",Y,[r("a",{href:w()},N(s.item.title),9,Z)]),tt,r("a",{href:w()},N(s.item.descr),9,et),nt,it,r("span",ot,N(S(P)(s.item.date)),1),rt])]),S(b)?(u(),y("div",at,[h(I,{color:"red",icon:"delete",outline:"",onClick:e[0]||(e[0]=o=>i())},{default:p(()=>[h($,{anchor:"top middle"},{default:p(()=>[C("\u0423\u0434\u0430\u043B\u0438\u0442\u044C")]),_:1})]),_:1}),l.value?(u(),x(I,{key:0,label:"\u0421\u043A\u0440\u044B\u0442\u044C",color:"orange",outline:"",onClick:e[1]||(e[1]=o=>a())})):(u(),x(I,{key:1,label:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C",color:"green",outline:"",onClick:e[2]||(e[2]=o=>a())})),h(I,{icon:"edit",outline:"",to:"/new/"+s.item.id},{default:p(()=>[h($,{anchor:"top middle"},{default:p(()=>[C("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C")]),_:1})]),_:1},8,["to"])])):k("",!0),lt,st,dt],64))}};var ct=U(ut,[["__scopeId","data-v-0d5a8738"]]);const mt={class:"newscol"},ht={key:2,class:"noEntyes"},ft={__name:"NewsList",props:{query:m(null),category:m(null),year:m(null),limit:m(null)},setup(s){const c=s,n=String("https://api.sakh-orch.ru/"),_=T();A(),q();const d=j("progress"),b=j("editMode"),l=m([]),v=m(c.category);D(()=>c.query,()=>{g()},{deep:!0}),D(_,a=>{v.value=a.params.category,g()});function g(){!v.value||(d.value=!0,Q.post(n+"api/news/entry.php",{params:{method:c.limit===100?"list":"toplist",category:v.value,year:c.year,limit:c.limit}}).then(a=>{var i,t;l.value=(t=(i=a==null?void 0:a.data)==null?void 0:i.data)!=null?t:[]}).catch(a=>{l.value=[]}).finally(()=>{d.value=!1}))}function E(a){const i=l.value.find(t=>t.id===a);i.isShow=!i.isShow}function w(a){const i=l.value.findIndex(t=>t.id===a);i!==-1&&l.value.splice(i,1)}return H(()=>{g()}),(a,i)=>{var t;return u(),y("div",mt,[S(d)?(u(),x(V,{key:0,indeterminate:"",color:"secondary",class:"q-mt-sm"})):k("",!0),(t=l.value)!=null&&t.length?(u(!0),y(L,{key:1},J(l.value,e=>(u(),y(L,{key:e.id},[e.isShow||S(b)?(u(),x(ct,{key:0,item:e,onHideOrShow:i[0]||(i[0]=o=>{E(o)}),onDelEntry:i[1]||(i[1]=o=>{w(o)})},null,8,["item"])):k("",!0)],64))),128)):k("",!0),!l.value&&!S(d)?(u(),y("h5",ht," \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443. ")):k("",!0)])}}};var It=U(ft,[["__scopeId","data-v-450677ad"]]);export{It as N};
