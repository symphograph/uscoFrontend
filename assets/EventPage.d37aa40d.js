import{Q as se}from"./QLinearProgress.504f8fbc.js";import{i as P,r as k,f as o,g as _,F as z,bN as $,J as p,B as v,av as u,h as l,z as r,c as S,A as c,_ as ee,j as T,aY as ue,a7 as J,a3 as N,a8 as q,a4 as te,bl as de,aX as le,D as ae,E as re,u as fe,p as L,s as pe,a as _e,W as X,au as Y,da as ve}from"./index.f810a335.js";import{api as U}from"./axios.846e3752.js";import{u as ie,d as me,n as V}from"./myFuncts.2470a9df.js";import{u as ke}from"./use-meta.49d9c85d.js";import{u as ne}from"./use-quasar.c0f9e70c.js";import{Q as Z}from"./QTooltip.ce412095.js";import{Q as ye}from"./QImg.374560d7.js";import{Q,b as m,a as W}from"./QItemSection.265435ac.js";import"./jwt-decode.esm.74bd4619.js";import"./position-engine.fc8761e2.js";import"./use-ratio.07a15ad0.js";const he={class:"cellArea"},be=c("br",null,null,-1),ge=c("br",null,null,-1),Te=c("br",null,null,-1),we=c("br",null,null,-1),Ce=c("br",null,null,-1),Ie={__name:"HallUserCell",props:{cell:Object,ticket:Object},emits:["reserve","returnTicket"],setup(s,{emit:y}){const i=s,f=P("colors"),g=k(i.ticket);P("HallPlan"),k("Invite"),k(0);const w=P("AccessToken"),h=ie(w.value)*1;function C(){y("reserve",g.value.id)}function I(){y("returnTicket",g.value.id)}return(O,n)=>{var F,x,E,H,R,B,j;return o(),_("div",he,[s.cell.exist?(o(),_(z,{key:0},[(F=s.ticket)!=null&&F.offline?(o(),_("div",{key:0,class:"offlineCell",style:$({borderColor:p(f)[((x=i.ticket)==null?void 0:x.priceType)||"Invite"][1],backgroundColor:p(f)[((E=i.ticket)==null?void 0:E.priceType)||"Invite"][1]})},null,4)):i.ticket.userId===h?(o(),_("div",{key:1,class:"userCell",onClick:n[0]||(n[0]=D=>I()),style:$({borderColor:p(f)[((H=i.ticket)==null?void 0:H.priceType)||"Invite"][1]})},[v(u(i.ticket.seatNum)+" ",1),l(Z,{offset:[0,-120],"max-width":"20em",delay:300},{default:r(()=>[v(u("\u042D\u0442\u043E \u0412\u0430\u0448\u0435 \u043C\u0435\u0441\u0442\u043E")),be,v(" "+u("\u0420\u044F\u0434: "+i.ticket.seatRow),1),ge,v(" "+u("\u041C\u0435\u0441\u0442\u043E: "+i.ticket.seatNum),1),Te,v(" "+u("\u0426\u0435\u043D\u0430: "+i.ticket.priceType),1)]),_:1})],4)):i.ticket.userId?(o(),_("div",{key:2,class:"offlineCell",style:$({borderColor:p(f)[((R=i.ticket)==null?void 0:R.priceType)||"Invite"][1],backgroundColor:p(f)[((B=i.ticket)==null?void 0:B.priceType)||"Invite"][1]})},null,4)):(o(),_("div",{key:3,class:"availableCell",style:$({borderColor:p(f)[((j=i.ticket)==null?void 0:j.priceType)||"Invite"][1]}),onClick:n[1]||(n[1]=D=>C())},[v(u(i.ticket.seatNum)+" ",1),l(Z,{offset:[0,-120],"max-width":"20em",delay:300},{default:r(()=>[v(u("\u0420\u044F\u0434: "+i.ticket.seatRow),1),we,v(" "+u("\u041C\u0435\u0441\u0442\u043E: "+i.ticket.seatNum),1),Ce,v(" "+u("\u0426\u0435\u043D\u0430: "+i.ticket.priceType),1)]),_:1})],4))],64)):S("",!0)])}}};const Pe=s=>(ae("data-v-17470d55"),s=s(),re(),s),xe={class:"mapLink"},Ae={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"space-between"}},Ne=Pe(()=>c("div",null,[c("div",{style:{border:"1px solid white",width:"100px",height:"100px"}})],-1)),Qe={__name:"TicketCard",props:{ticket:{},price:Number},emits:["reserve","returnTicket"],setup(s,{emit:y}){const i=String("https://api.sakh-orch.ru/");ne();const f=P("Announce"),g=k("");function w(h){g.value=" returning",setTimeout(()=>{y("returnTicket",h)},600)}return(h,C)=>(o(),T(le,{class:de("ticketCard"+g.value)},{default:r(()=>[l(ue,{class:"progName"},{default:r(()=>[v(u(p(f).progName),1)]),_:1}),l(Q,{dense:""},{default:r(()=>[l(m,{avatar:""},{default:r(()=>[l(ye,{width:"10em",ratio:16/9,src:p(i)+p(f).Sketch.verLink},null,8,["src"])]),_:1}),l(m,{avatar:""},{default:r(()=>[J((o(),T(Q,{dense:""},{default:r(()=>[l(m,{avatar:""},{default:r(()=>[l(N,{name:"schedule",color:"amber"})]),_:1}),l(m,null,{default:r(()=>[l(W,{caption:""},{default:r(()=>[v(u(p(me)(p(f).datetime)),1)]),_:1})]),_:1})]),_:1})),[[q]]),l(Q,{clickable:"",dense:"",href:p(f).Hall.map,target:"_blank"},{default:r(()=>[l(m,{avatar:""},{default:r(()=>[l(N,{color:"amber",name:"place"})]),_:1}),l(W,null,{default:r(()=>[c("span",xe,u(p(f).Hall.name),1)]),_:1})]),_:1},8,["href"]),J((o(),T(Q,{dense:""},{default:r(()=>[l(m,{avatar:""},{default:r(()=>[l(N,{name:"ion-person",color:"amber"})]),_:1}),l(m,null,{default:r(()=>[l(W,{lines:"1"},{default:r(()=>[v("\u0420\u044F\u0434: "+u(s.ticket.seatRow)+" | \u041C\u0435\u0441\u0442\u043E: "+u(s.ticket.seatNum),1)]),_:1})]),_:1})]),_:1})),[[q]]),s.price?J((o(),T(Q,{key:0,dense:""},{default:r(()=>[l(m,{avatar:""},{default:r(()=>[l(N,{name:"ion-wallet",color:"amber"})]),_:1}),l(m,null,{default:r(()=>[l(W,{lines:1},{default:r(()=>[v("\u0426\u0435\u043D\u0430: "+u(s.price),1)]),_:1})]),_:1})]),_:1})),[[q]]):S("",!0)]),_:1}),l(m),l(m,{side:""},{default:r(()=>[c("div",Ae,[Ne,c("div",null,[l(te,{onClick:C[0]||(C[0]=I=>w(s.ticket.id)),flat:""},{default:r(()=>[l(N,{name:"delete",color:"red"})]),_:1})])])]),_:1})]),_:1})]),_:1},8,["class"]))}};var $e=ee(Qe,[["__scopeId","data-v-17470d55"]]);const M=s=>(ae("data-v-641ad34e"),s=s(),re(),s),Se={class:"content"},Ee=M(()=>c("div",null,"rer",-1)),He=M(()=>c("div",null,"rer",-1)),Re=M(()=>c("div",null,"rer",-1)),Be=M(()=>c("div",{class:"scene"},"\u0421\u0446\u0435\u043D\u0430",-1)),je={class:"rowNumber"},De={class:"rowNumber"},Le={key:0,class:"ticketList"},Ue={__name:"EventPage",setup(s){const y=String("https://api.sakh-orch.ru/"),i=ne(),f=fe(),g=k(null),w=k([{priceType:"Invite",price:null,label:"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435"},{priceType:"Price_1",price:200,label:"\u0426\u0435\u043D\u0430 1"},{priceType:"Price_2",price:300,label:"\u0426\u0435\u043D\u0430 2"},{priceType:"Price_3",price:500,label:"\u0426\u0435\u043D\u0430 3"},{priceType:"Price_4",price:800,label:"\u0426\u0435\u043D\u0430 4"},{priceType:"Price_5",price:1e3,label:"\u0426\u0435\u043D\u0430 5"}]);L("defaultPricing",w);const h=P("progress"),C=P("AccessToken"),I=ie(C.value)*1,O=k({});L("Announce",O);const n=k({id:1,structure:{cntRows:10,cntCols:12,rowNums:[]},pricing:w.value,cells:[],tickets:[]});L("HallPlan",n),L("colors",{Offline:["white","#bb6af3"],Existing:["white","#bb6af3"],Invite:["purple","#bb6af3"],Price_1:["blue","blue"],Price_2:["green","green"],Price_3:["yellow","yellow"],Price_4:["orange","orange"],Price_5:["red","#ad1010"]});const x=k(!1),E=pe(()=>[...n.value.tickets].filter(e=>e.userId===I));function H(t){var e,a;return(a=(e=n.value.pricing.find(d=>d.priceType===t.priceType))==null?void 0:e.price)!=null?a:0}function R(t){return n.value.tickets.find(e=>e.cellId===t)}function B(){U.post(y+"api/tickets/hallplan.php",{params:{method:"get",id:f.params.id}}).then(async t=>{var e,a,d,b;if(!((a=(e=t==null?void 0:t.data)==null?void 0:e.data)!=null&&a.HallPlan))throw new Error;x.value=!1,n.value=(b=(d=t==null?void 0:t.data)==null?void 0:d.data)==null?void 0:b.HallPlan,await X(),x.value=!0,console.log("HallPlan loaded")}).catch(t=>{n.value={},i.notify(V(t))}).finally(()=>{h.value=!1,console.log("progress off"),X(()=>{let t=document.getElementById("tableArea");t.scrollTo(t.clientWidth/2,0),console.log(t.scrollWidth),ce()})})}function j(){h.value=!0,console.log("progress on"),U.post(y+"api/event/announce.php",{params:{method:"get",id:f.params.id}}).then(t=>{var e,a,d;if(!((e=t==null?void 0:t.data)!=null&&e.result))throw console.log("announce err:",t.data),new Error;O.value=(d=(a=t==null?void 0:t.data)==null?void 0:a.data)!=null?d:{},console.log("Announce loaded"),B()}).catch(t=>{i.notify(V(t))}).finally(()=>{})}function D(t){n.value.tickets.find(e=>e.id===t).userId=I,U.post(y+"api/tickets/ticket.php",{params:{method:"reserve",id:t}}).then(e=>{var a;if(!((a=e==null?void 0:e.data)!=null&&a.result))throw new Error}).catch(e=>{n.value.tickets.find(a=>a.id===t).userId=null,i.notify(V(e)),e.response.status===403&&(n.value.tickets.find(a=>a.id===t).offline=!0)})}function G(t){n.value.tickets.find(e=>e.id===t).userId=null,U.post(y+"api/tickets/ticket.php",{params:{method:"returnTicket",id:t}}).then(e=>{var a;if(!((a=e==null?void 0:e.data)!=null&&a.result))throw new Error}).catch(e=>{n.value.tickets.find(a=>a.id===t).userId=I,i.notify(V(e))})}const K=k(50);function ce(){setTimeout(()=>{K.value=100},1e3)}return _e(()=>{j(),X(()=>{})}),k({width:"100%",height:"100%",margin:"auto",overflow:"scroll"}),ke({title:"\u0411\u0438\u043B\u0435\u0442\u044B"}),(t,e)=>(o(),_("div",Se,[Ee,He,Re,l(le,{class:"card"},{default:r(()=>[p(h)?(o(),T(se,{key:0,indeterminate:"",color:"secondary"})):S("",!0),p(h)?S("",!0):(o(),_("div",{key:1,class:"tableArea",id:"tableArea",ref_key:"tableAreaRef",ref:g},[c("div",{style:$({transform:"scale("+K.value+"%)"})},[c("div",null,[Be,c("table",null,[c("tbody",null,[(o(!0),_(z,null,Y(n.value.cells,(a,d)=>(o(),_("tr",{key:"row_"+d},[c("td",null,[c("div",je,u(n.value.structure.rowNums[d]||""),1)]),(o(!0),_(z,null,Y(a,(b,oe)=>(o(),_("td",{key:d+"_"+oe},[(o(),T(Ie,{cell:n.value.cells[b.row-1][b.col-1],"onUpdate:cell":A=>n.value.cells[b.row-1][b.col-1]=A,ticket:R(b.id),key:b.id,onReserve:e[0]||(e[0]=A=>D(A)),onReturnTicket:e[1]||(e[1]=A=>G(A))},null,8,["cell","onUpdate:cell","ticket"]))]))),128)),c("td",null,[c("div",De,u(n.value.structure.rowNums[d]||""),1)])]))),128))])])])],4)],512)),l(ve,{style:{display:"flex","justify-content":"end",padding:"1em"}},{default:r(()=>[l(te,{label:"\u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",outline:"",color:"green"})]),_:1})]),_:1}),n.value.tickets.length?(o(),_("div",Le,[(o(!0),_(z,null,Y(E.value,a=>(o(),T($e,{key:"tic_"+a.id,ticket:a,price:H(a),onReserve:e[2]||(e[2]=d=>D(d)),onReturnTicket:e[3]||(e[3]=d=>G(d))},null,8,["ticket","price"]))),128))])):S("",!0)]))}};var et=ee(Ue,[["__scopeId","data-v-641ad34e"]]);export{et as default};
